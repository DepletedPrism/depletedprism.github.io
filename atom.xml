<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>DepletedPrism&#39;s Blog</title>
  
  <subtitle>çŸ¥å…¶ç„¶è€Œä¸çŸ¥å…¶æ‰€ä»¥ç„¶æ˜¯å¯æ‚²çš„.</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://depletedprism.github.io/"/>
  <updated>2020-02-08T08:16:18.437Z</updated>
  <id>https://depletedprism.github.io/</id>
  
  <author>
    <name>DepletedPrism</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ã€Œç½®é¡¶ã€ç®—æ³•æ•™ç¨‹åˆè¾‘</title>
    <link href="https://depletedprism.github.io/%E7%AC%94%E8%AE%B0/compilation/"/>
    <id>https://depletedprism.github.io/%E7%AC%94%E8%AE%B0/compilation/</id>
    <published>9102-11-14T00:11:23.000Z</published>
    <updated>2020-02-08T08:16:18.437Z</updated>
    
    <content type="html"><![CDATA[<hr><p>è¿™ä¸ª idea æ¥æºäº <a href="https://www.cnblogs.com/mlystdcall/p/8078467.html" target="_blank" rel="noopener">__stdcall çš„æ•™ç¨‹åˆè¾‘</a>, è§‰å¾—è¿™ä¸ªå¾ˆå¥½, æ‰€ä»¥å­¦ä¹ äº†.</p><a id="more"></a><p><del>Hexo åšå®¢çš„å¼ºåˆ¶ç½®é¡¶</del></p><h4 id="æ ‘çŠ¶æ•°ç»„"><a href="#æ ‘çŠ¶æ•°ç»„" class="headerlink" title="æ ‘çŠ¶æ•°ç»„"></a>æ ‘çŠ¶æ•°ç»„</h4><ul><li>æ ‘çŠ¶æ•°ç»„è¿›é˜¶<ul><li><a href="https://www.cnblogs.com/RabbitHu/p/BIT.html" target="_blank" rel="noopener">https://www.cnblogs.com/RabbitHu/p/BIT.html</a></li></ul></li></ul><h4 id="ç½‘ç»œæµ"><a href="#ç½‘ç»œæµ" class="headerlink" title="ç½‘ç»œæµ"></a>ç½‘ç»œæµ</h4><ul><li>ç½‘ç»œæµå…¥é—¨<ul><li><a href="https://www.xht37.com/äºŒåˆ†å›¾ä¸ç½‘ç»œæµ-å­¦ä¹ ç¬”è®°/" target="_blank" rel="noopener">https://www.xht37.com/äºŒåˆ†å›¾ä¸ç½‘ç»œæµ-å­¦ä¹ ç¬”è®°/</a></li></ul></li><li>ä¸Šä¸‹ç•Œç½‘ç»œæµ<ul><li><a href="https://www.cnblogs.com/mlystdcall/p/6734852.html" target="_blank" rel="noopener">https://www.cnblogs.com/mlystdcall/p/6734852.html</a></li></ul></li></ul><h4 id="çº¿æ€§åŸº"><a href="#çº¿æ€§åŸº" class="headerlink" title="çº¿æ€§åŸº"></a>çº¿æ€§åŸº</h4><ul><li>åŸºç¡€æ„é€ <ul><li><a href="https://oi.men.ci/linear-basis-notes/" target="_blank" rel="noopener">https://oi.men.ci/linear-basis-notes/</a></li></ul></li><li>å¯é‡é›† Kth å¼‚æˆ–å’Œ<ul><li><a href="https://blog.csdn.net/qaq__qaq/article/details/53812883" target="_blank" rel="noopener">https://blog.csdn.net/qaq__qaq/article/details/53812883</a></li></ul></li></ul><h4 id="åŠ¨æ€è§„åˆ’"><a href="#åŠ¨æ€è§„åˆ’" class="headerlink" title="åŠ¨æ€è§„åˆ’"></a>åŠ¨æ€è§„åˆ’</h4><ul><li>å››è¾¹å½¢ä¸ç­‰å¼ä¼˜åŒ–<ul><li><a href="https://oi-wiki.org/dp/opt/quadrangle/" target="_blank" rel="noopener">https://oi-wiki.org/dp/opt/quadrangle/</a></li></ul></li></ul><h4 id="Link-Cut-Tree"><a href="#Link-Cut-Tree" class="headerlink" title="Link Cut Tree"></a>Link Cut Tree</h4><ul><li>åº”ç”¨ &amp; é¢˜å•<ul><li><a href="https://www.cnblogs.com/flashhu/p/9498517.html" target="_blank" rel="noopener">https://www.cnblogs.com/flashhu/p/9498517.html</a></li></ul></li></ul><h4 id="å·¦åæ ‘"><a href="#å·¦åæ ‘" class="headerlink" title="å·¦åæ ‘"></a>å·¦åæ ‘</h4><ul><li>ç‰¹ç‚¹åŠåº”ç”¨<ul><li><a href="https://files-cdn.cnblogs.com/files/shenben/ç®—æ³•åˆé›†ä¹‹ã€Šå·¦åæ ‘çš„ç‰¹ç‚¹åŠå…¶åº”ç”¨ã€‹.pdf" target="_blank" rel="noopener">https://files-cdn.cnblogs.com/files/shenben/ç®—æ³•åˆé›†ä¹‹ã€Šå·¦åæ ‘çš„ç‰¹ç‚¹åŠå…¶åº”ç”¨ã€‹.pdf</a></li></ul></li></ul><h4 id="Min-Max-å®¹æ–¥"><a href="#Min-Max-å®¹æ–¥" class="headerlink" title="Min-Max å®¹æ–¥"></a>Min-Max å®¹æ–¥</h4><ul><li>è¯æ˜åŠåº”ç”¨<ul><li><a href="https://www.cnblogs.com/GXZlegend/p/11563330.html" target="_blank" rel="noopener">https://www.cnblogs.com/GXZlegend/p/11563330.html</a></li></ul></li></ul><h4 id="Stirling-æ•°åŠ-Stirling-åæ¼”"><a href="#Stirling-æ•°åŠ-Stirling-åæ¼”" class="headerlink" title="Stirling æ•°åŠ Stirling åæ¼”"></a>Stirling æ•°åŠ Stirling åæ¼”</h4><ul><li>æ€§è´¨åŠåº”ç”¨<ul><li><a href="https://www.cnblogs.com/y2823774827y/p/10700231.html" target="_blank" rel="noopener">https://www.cnblogs.com/y2823774827y/p/10700231.html</a></li></ul></li></ul><h4 id="äºŒé¡¹å¼åæ¼”"><a href="#äºŒé¡¹å¼åæ¼”" class="headerlink" title="äºŒé¡¹å¼åæ¼”"></a>äºŒé¡¹å¼åæ¼”</h4><ul><li>è¯æ˜åŠåº”ç”¨<ul><li><a href="https://www.cnblogs.com/GXZlegend/p/11407185.html" target="_blank" rel="noopener">https://www.cnblogs.com/GXZlegend/p/11407185.html</a></li></ul></li></ul><hr>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;è¿™ä¸ª idea æ¥æºäº &lt;a href=&quot;https://www.cnblogs.com/mlystdcall/p/8078467.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;__stdcall çš„æ•™ç¨‹åˆè¾‘&lt;/a&gt;, è§‰å¾—è¿™ä¸ªå¾ˆå¥½, æ‰€ä»¥å­¦ä¹ äº†.&lt;/p&gt;
    
    </summary>
    
    
      <category term="ç¬”è®°" scheme="https://depletedprism.github.io/categories/%E7%AC%94%E8%AE%B0/"/>
    
    
  </entry>
  
  <entry>
    <title>AHOI / HNOI 2018 å¤§èµ</title>
    <link href="https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/AHOI-HNOI-2018-sol/"/>
    <id>https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/AHOI-HNOI-2018-sol/</id>
    <published>2020-03-14T06:11:32.000Z</published>
    <updated>2020-03-15T16:14:49.475Z</updated>
    
    <content type="html"><![CDATA[<hr><p>å…¶å®ä¸æƒ³å†å†™ 18 å¹´çš„é¢˜äº†â€¦ å†å†™å°±æ²¡æ—¶é—´å†™ 19 å¹´çš„äº† (</p><p>æœç„¶ç«‹ flag å°±æ˜¯ç”¨æ¥å€’çš„.</p><p><del>è¯è¯´è¿™å¥—é¢˜å•çœ‹æ­£è§£, è¿˜æŒºè€ƒéªŒæ€ç»´çš„?</del></p><a id="more"></a><p>å…¶å®å†™ä¸å†™éƒ½ä¸é‡è¦äº†.</p><h3 id="ã€ŒAHOI-HNOI2018ã€å¯»å®æ¸¸æˆ"><a href="#ã€ŒAHOI-HNOI2018ã€å¯»å®æ¸¸æˆ" class="headerlink" title="ã€ŒAHOI / HNOI2018ã€å¯»å®æ¸¸æˆ"></a>ã€ŒAHOI / HNOI2018ã€å¯»å®æ¸¸æˆ</h3><p>æŒºæœ‰æ„æ€çš„ä¸€é“é¢˜.</p><h4 id="é¢˜ç›®é“¾æ¥"><a href="#é¢˜ç›®é“¾æ¥" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2494" target="_blank" rel="noopener">https://loj.ac/problem/2494</a></li></ul><h4 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>å…ˆç¥­ä¸Šå®˜æ–¹é¢˜è§£: <a href="http://matthew99.blog.uoj.ac/blog/3488" target="_blank" rel="noopener">http://matthew99.blog.uoj.ac/blog/3488</a>.</p><p>ç€é‡è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯ â€œå®¹æ˜“è¯æ˜, ç¬¬ $i$ ä½çš„ç»“æœä¸º $1$, å½“ä¸”ä»…å½“ $x&lt;b_i$.â€</p><p>é¦–å…ˆæ ¹æ® myy çš„é¢˜è§£, æ„é€ å‡ºé•¿åº¦ä¸º $n$ çš„ä¸² $x$, ä»¥åŠ $m$ ä¸ªé•¿åº¦ä¸º $n$ çš„ä¸² $b_i$.</p><p>å¯¹äºäºŒè¿›åˆ¶ä¸‹æŸä¸€ä½çš„å€¼, æ­¤æ—¶å¯¹è¿™ä¸€ä½ <code>| 0</code> æˆ–è€… <code>&amp; 1</code>, å¹¶ä¸ä¼šå¯¹åŸæ¥çš„è¯¥ä½ä¸Šçš„å€¼é€ æˆå½±å“. é‚£ä¹ˆ, å¦‚æœç¬¬ $i$ ä½ä¸º <code>1</code>, é‚£ä¹ˆåœ¨ä¸€æ¬¡å½¢å¦‚ <code>&amp; 0</code> çš„æ“ä½œå, ä¸€å®šå­˜åœ¨æ“ä½œ <code>&amp; 1</code>.</p><p>ä¹Ÿå°±æ˜¯è¯´, å¦‚æœæŠŠå·¦è¾¹çœ‹ä½œä½ä½, é‚£ä¹ˆ $x$ å½¢å¦‚ <code>...1...0...</code>, $b_i$ å½¢å¦‚ <code>...0...1...</code>. æ¢å¥è¯è¯´, $x &lt; b_i$.</p><p>å¤§ä½“æ€è·¯å°±æ˜¯è¿™æ ·äº†, ä¹Ÿä¸çŸ¥é“è€ƒåœº AC çš„ â€œé€†æ¨â€ åšæ³•æ˜¯ä»€ä¹ˆæ ·çš„. è¿˜æœ‰ä¸€äº›å€¼å¾—æ³¨æ„çš„ç»†èŠ‚, ä¹Ÿåœ¨ä»£ç é‡Œäº†.</p><p>ç”±äºä½¿ç”¨äº†åŸºæ•°æ’åº, æ—¶é—´å¤æ‚åº¦ $O(nm + mq)$.</p><h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2494</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e3</span> + <span class="number">5</span>, MAXM = <span class="number">5e5</span> + <span class="number">5</span>, P = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, q;</span><br><span class="line"><span class="keyword">char</span> S[MAXM];</span><br><span class="line"><span class="keyword">int</span> idx[MAXM], pos[MAXM], A[MAXM];</span><br><span class="line"><span class="keyword">int</span> pow2[MAXN], val[MAXM], Ans[MAXM];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;n, &amp;m, &amp;q);</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    pow2[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) pow2[i] = <span class="number">2L</span>L * pow2[i<span class="number">-1</span>] % P;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) A[i] = i;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> c[<span class="number">2</span>];</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%s"</span>, S+<span class="number">1</span>);</span><br><span class="line">        <span class="comment">// å­—ç¬¦é›†ä¸º 2 çš„åŸºæ•°æ’åºç›¸å½“æ¸…çˆ½å•Š</span></span><br><span class="line">        c[<span class="number">0</span>] = <span class="number">0</span>, c[<span class="number">1</span>] = m;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= m; ++j)</span><br><span class="line">            <span class="keyword">if</span> (S[j] == <span class="string">'1'</span>) val[j] = (val[j] + pow2[i - <span class="number">1</span>]) % P; <span class="keyword">else</span> ++c[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = m; j; --j) idx[c[S[A[j]] - <span class="string">'0'</span>]--] = A[j];</span><br><span class="line">        <span class="built_in">memcpy</span>(A, idx, (m + <span class="number">1</span>) * <span class="keyword">sizeof</span> (<span class="keyword">int</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) Ans[i] = val[A[i]];</span><br><span class="line">    Ans[m + <span class="number">1</span>] = pow2[n];</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%s"</span>, S+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">int</span> L = <span class="number">0</span>, R = m + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = m; i &gt;= <span class="number">1</span>; --i) <span class="keyword">if</span> (S[A[i]] == <span class="string">'0'</span>) &#123; L = i; <span class="keyword">break</span>; &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) <span class="keyword">if</span> (S[A[i]] == <span class="string">'1'</span>) &#123; R = i; <span class="keyword">break</span>; &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, L &lt; R? (Ans[R] - Ans[L] + P) % P: <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒAHOI-HNOI2018ã€è½¬ç›˜"><a href="#ã€ŒAHOI-HNOI2018ã€è½¬ç›˜" class="headerlink" title="ã€ŒAHOI / HNOI2018ã€è½¬ç›˜"></a>ã€ŒAHOI / HNOI2018ã€è½¬ç›˜</h3><h4 id="é¢˜ç›®é“¾æ¥-1"><a href="#é¢˜ç›®é“¾æ¥-1" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2495" target="_blank" rel="noopener">https://loj.ac/problem/2495</a></li></ul><h4 id="è§£é¢˜æ€è·¯-1"><a href="#è§£é¢˜æ€è·¯-1" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>å°†é€‰æ‹©ç‰©å“è¿™ä¸ªè¿‡ç¨‹çš„é¡ºåºå€’è¿‡æ¥, ä¹Ÿå°±æ˜¯åœ¨æŸä¸ªæ—¶åˆ» $t$, ä»ä½ç½® $i$ å¼€å§‹å…ˆå‰ç§»åŠ¨, æ¯ä¸ªç‰©å“åœ¨æ—¶åˆ» $T_j$ æ¶ˆå¤±, éœ€è¦åœ¨æ¯ä¸ªç‰©å“æ¶ˆå¤±å‰åˆ°è¾¾è¯¥ç‰©å“çš„ä½ç½®.</p><p>æ­¤æ—¶å®¹æ˜“çœ‹å‡º, é€‰æ‹©å¥½ä½ç½®å’Œæ—¶åˆ»ä¹‹å, ä¸€åˆ»ä¸åœåœ°èµ°æ‰èƒ½å¾—åˆ°å½“å‰çŠ¶æ€ä¸‹çš„æœ€ä¼˜è§£. æœ¬é¢˜åšæ³•å°±æ­¤å±•å¼€.</p><p>é¦–å…ˆå°†å‡ºç°æ—¶åˆ»åºåˆ— $T_i$ å€é•¿, è®°å½“å‰å‡ºå‘ä½ç½®ä¸º $i$ ($i \in [n,\ 2n)$), å½“å‰æ—¶åˆ»ä¸º $t$, åˆ™æ ‡è®°æ‰€æœ‰ç‰©å“çš„é™åˆ¶å¯ä»¥è¡¨ç¤ºä¸º</p><p>$$\forall\ j \in (i-n,\ i],\ t - (i - j) \ge T_j$$</p><p>å³</p><p>$$t \ge (T_j - j) + i$$</p><p>è®° $a_j = T_j - j$, é‚£ä¹ˆç­”æ¡ˆä¸º</p><p>$$\min_{i = n} ^ {2n - 1} \{ \max_{j = i - n + 1} ^ {i} \{ a_j \} + i \}$$</p><p>å¯¹ $i$ è¿›è¡Œä¸€äº›å˜æ¢, å¾—</p><p>$$\min_{i = 1} ^ n \{ \max_{j = i} ^ {i + n -1} \{ a_j \} + i \} + (n-1)$$</p><p>è€ƒè™‘åˆ° $i \le j &lt; i + n$ è¿™ä¸ªé™åˆ¶åˆè‡­åˆé•¿, å› ä¸º $a_i = T_i - i &gt; a_{i + n} = T_{i + n} - (i + n) = T_i - i - n$, æ‰€ä»¥æ­¤æ—¶çš„ $a_j$ å°±æ˜¯ä¸ªåç¼€æœ€å¤§å€¼, å³</p><p>$$\min_{i = 1} ^ n \{ \max_{j = i} ^ {2 n} \{ a_j \} + i \} + (n-1)$$</p><p>è€ƒè™‘æŸä¸€ä¸ªä½ç½® $j$, ä»¤ $j$ æ»¡è¶³ $a_j$ ä¸ºåç¼€æœ€å¤§å€¼, é‚£ä¹ˆä» $j-1$ å¾€å‰æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ $a_i &gt; a_j$ çš„ä½ç½® $i$, æ­¤æ—¶ç­”æ¡ˆä¸º $a_j + i + 1$.</p><p>å¦‚æœæ­¤æ—¶ $a_j$ ä¸æ˜¯åç¼€æœ€å¤§å€¼, é‚£ä¹ˆç­”æ¡ˆå’Œåç¼€æœ€å¤§å€¼çš„æƒ…å†µç›¸åŒ.</p><p>å°±æ­¤æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªå•è°ƒæ ˆåšæ³•, å³ç»´æŠ¤ä¸€ä¸ª $a_j$ å€¼ä»å³åˆ°å·¦å•è°ƒä¸Šå‡çš„æ ˆ, å¹¶è®¾æ ˆä¸­å…ƒç´ ä¸º $p_i$, ä»¤ $p_0 = 0$, ç­”æ¡ˆå³ä¸º</p><p>$$\min_{i = 1} ^ j \{ a_{p_i} + p_{i-1} + 1\} + n - 1 = \min_{i = 1} ^ j \{ a_{p_i} + p_{i-1}\} + n$$</p><p>åˆ©ç”¨çº¿æ®µæ ‘ç»´æŠ¤è¿™ä¸ªå•è°ƒæ ˆå³å¯. è¿˜æ˜¯ç”±äº $a_i = T_i - i,\ a_{i + n} = T_{i + n} - i - n$, æ­¤æ—¶åªéœ€è¦ç»´æŠ¤ $[1,\ n]$ å³å¯.</p><p>ç±»ä¼¼çš„æŠ€å·§ä¹Ÿåœ¨ <a href="https://www.luogu.com.cn/problem/P4198" target="_blank" rel="noopener">Luogu P4198 æ¥¼æˆ¿é‡å»º</a> ä¸­ä½¿ç”¨è¿‡.</p><p>æ—¶é—´å¤æ‚åº¦ $O(n \log ^2 n)$.</p><h4 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2495</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">5</span>, INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, p;</span><br><span class="line"><span class="keyword">int</span> A[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SGT &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lc (nd&lt;&lt;1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rc (nd&lt;&lt;1|1)</span></span><br><span class="line">    <span class="keyword">int</span> datMax[MAXN &lt;&lt; <span class="number">2</span>], dat[MAXN &lt;&lt; <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Qry</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (L == R) <span class="keyword">return</span> datMax[nd] &gt; k? k + L: INF;</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (k &lt; datMax[rc]) <span class="keyword">return</span> min(dat[nd], Qry(rc, Mid+<span class="number">1</span>, R, k));</span><br><span class="line">        <span class="keyword">return</span> Qry(lc, L, Mid, k);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">maintain</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">const</span> <span class="keyword">int</span>&amp; L, <span class="keyword">const</span> <span class="keyword">int</span>&amp; R)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        datMax[nd] = max(datMax[lc], datMax[rc]);</span><br><span class="line">        dat[nd] = Qry(lc, L, Mid, datMax[rc]);</span><br><span class="line">        <span class="comment">// ç”¨å³å­æ ‘çš„æœ€å¤§å€¼åœ¨å·¦å­æ ‘ä¸­æŸ¥è¯¢, ä»¥æ›´æ–°ç­”æ¡ˆ</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (L == R) <span class="keyword">return</span> <span class="keyword">void</span>( datMax[nd] = A[L] - L );</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        build(lc, L, Mid), build(rc, Mid+<span class="number">1</span>, R);</span><br><span class="line">        maintain(nd, L, R);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; pos, <span class="keyword">const</span> <span class="keyword">int</span>&amp; val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (L == R) <span class="keyword">return</span> <span class="keyword">void</span>( datMax[nd] = val - L );</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (pos &lt;= Mid) Mdy(lc, L, Mid, pos, val);</span><br><span class="line">        <span class="keyword">else</span> Mdy(rc, Mid+<span class="number">1</span>, R, pos, val);</span><br><span class="line">        maintain(nd, L, R);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> lc</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> rc</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n), read(m), read(p);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) read(A[i]);</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    SGT::build(<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">int</span> x, y, lstans = SGT::Qry(<span class="number">1</span>, <span class="number">1</span>, n, SGT::datMax[<span class="number">1</span>] - n) + n;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, lstans);</span><br><span class="line">    <span class="keyword">while</span> (m--) &#123;</span><br><span class="line">        read(x), read(y);</span><br><span class="line">        x ^= p * lstans, y ^= p * lstans;</span><br><span class="line">        SGT::Mdy(<span class="number">1</span>, <span class="number">1</span>, n, x, y);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, lstans = SGT::Qry(<span class="number">1</span>, <span class="number">1</span>, n, SGT::datMax[<span class="number">1</span>] - n) + n);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒAHOI-HNOI2018ã€æ¯’ç˜¤"><a href="#ã€ŒAHOI-HNOI2018ã€æ¯’ç˜¤" class="headerlink" title="ã€ŒAHOI / HNOI2018ã€æ¯’ç˜¤"></a>ã€ŒAHOI / HNOI2018ã€æ¯’ç˜¤</h3><p>æ¯’ç˜¤.</p><h4 id="é¢˜ç›®é“¾æ¥-2"><a href="#é¢˜ç›®é“¾æ¥-2" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2496" target="_blank" rel="noopener">https://loj.ac/problem/2496</a></li></ul><h4 id="è§£é¢˜æ€è·¯-2"><a href="#è§£é¢˜æ€è·¯-2" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>é¦–å…ˆè€ƒè™‘æ ‘çš„æƒ…å†µä¸‹æ€ä¹ˆåš.</p><p>è®¾ $f(i, j)$ è¡¨ç¤ºä»¥èŠ‚ç‚¹ $i$ ä¸ºæ ¹çš„å­æ ‘å†…, ç¬¬ $i$ ä¸ªç‚¹é€‰ ($j = 1$) / ä¸é€‰ ($j = 0$) æ—¶çš„æ–¹æ¡ˆæ•°, å®¹æ˜“å¾—åˆ°è½¬ç§»</p><p>$$f(u, 1) \prod_{v \in son(u)} f(v, 0) \\ f(u, 0) = \prod_{v \in son(u)} (\ f(v, 0) + f(v, 1)\ )$$</p><p>è§‚å¯Ÿåˆ° $n - 1 \le m \le n + 10$ çš„é™åˆ¶, å¯ä»¥å¾—åˆ°ä¸€ä¸ª $O(n 2 ^ {m - n + 1})$, å³ä¾æ¬¡æšä¸¾éæ ‘è¾¹çš„é€‰æ‹©æƒ…å†µ, ä»¥æ­¤ä¸ºé™åˆ¶ä¿®æ”¹ DP åˆå§‹å€¼, æ¯æ¬¡éƒ½åšä¸€æ¬¡æ•´æ£µæ ‘çš„ DP.</p><p>æ­¤æ—¶ä»æœ‰ä¼˜åŒ–çš„ä½™åœ°, è€ƒè™‘åˆ°éæ ‘è¾¹å¾ˆå°‘, å½±å“åˆ°çš„ç‚¹å¾ˆå°‘, å¯ä»¥å¯¹è¿™äº›ç‚¹å»ºå‡ºè™šæ ‘, å¹¶åœ¨è™šæ ‘ä¸Š DP.</p><h1 id="å’•-ğŸ•Š"><a href="#å’•-ğŸ•Š" class="headerlink" title="å’• ğŸ•Š"></a>å’• ğŸ•Š</h1><p>å…·ä½“åœ°è¯´, é¢„å…ˆå¤„ç†å‡ºè™šæ•°ä¸Š DP åˆå€¼, è½¬ç§»ç³»æ•°, ç„¶åæ²¡äº†. æ•´ä¸ªè¿‡ç¨‹æœ‰äº›éº»çƒ¦â€¦</p><p>æ—¶é—´å¤æ‚åº¦ $O(n + (m-n+1)\ 2 ^ {m - n + 1})$.</p><h4 id="ä»£ç å®ç°-2"><a href="#ä»£ç å®ç°-2" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2496</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">114</span>, P = <span class="number">998244353</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="keyword">int</span> U[MAXN], V[MAXN], nE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> vis[MAXN];</span><br><span class="line"><span class="keyword">int</span> pre[MAXN], dfn[MAXN], A[MAXN], nA;</span><br><span class="line"><span class="keyword">int</span> f[<span class="number">2</span>][MAXN], g[<span class="number">2</span>][MAXN], K[<span class="number">2</span>][<span class="number">2</span>][MAXN];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt, to; &#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Graph</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> head[MAXN], eidx;</span><br><span class="line">    Edge edges[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    Graph() &#123; init(); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="keyword">sizeof</span> head), eidx = <span class="number">1</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to)</span> </span>&#123;</span><br><span class="line">        edges[++eidx] = (Edge)&#123; head[from], to &#125;, head[from] = eidx;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; G, T;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> HLD &#123;</span><br><span class="line">    <span class="keyword">int</span> son[MAXN], depth[MAXN], size[MAXN], topfa[MAXN], dfs_clock;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa)</span> </span>&#123;</span><br><span class="line">        pre[u] = fa, size[u] = <span class="number">1</span>, son[u] = <span class="number">-1</span>;</span><br><span class="line">        dfn[u] = ++dfs_clock, depth[u] = depth[fa] + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = G.head[u]; ~i; i = G.edges[i].nxt) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((v = G.edges[i].to) == fa) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span> (!dfn[v]) &#123;</span><br><span class="line">                dfs1(v, u), size[u] += size[v];</span><br><span class="line">                <span class="keyword">if</span> (son[u] == <span class="number">-1</span> || size[son[u]] &lt; size[v]) son[u] = v;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (dfn[v] &lt; dfn[u])</span><br><span class="line">                U[++nE] = v, V[nE] = u, vis[u] = vis[v] = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> top)</span> </span>&#123;</span><br><span class="line">        topfa[u] = top;</span><br><span class="line">        <span class="keyword">if</span> (~son[u]) dfs2(son[u], top), vis[u] |= vis[son[u]];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = G.head[u]; ~i; i = G.edges[i].nxt)</span><br><span class="line">            <span class="keyword">if</span> ((v = G.edges[i].to) != pre[u] &amp;&amp; v != son[u])</span><br><span class="line">                dfs2(v, v), vis[u] |= vis[v];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (topfa[u] != topfa[v]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (depth[topfa[u]] &lt; depth[topfa[v]]) swap(u, v);</span><br><span class="line">            u = pre[topfa[u]];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> depth[u] &gt; depth[v]? v: u;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        dfs1(<span class="number">1</span>, <span class="number">0</span>), G.init();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) <span class="keyword">if</span> (pre[i]) G.AddEdge(pre[i], i);</span><br><span class="line">        dfs2(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> VT &#123;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; a, <span class="keyword">const</span> <span class="keyword">int</span>&amp; b)</span> </span>&#123; <span class="keyword">return</span> dfn[a] &lt; dfn[b]; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> stk[MAXN], top;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nE; ++i) A[++nA] = U[i], A[++nA] = V[i];</span><br><span class="line">        sort(A+<span class="number">1</span>, A+<span class="number">1</span>+nA, cmp);</span><br><span class="line">        stk[top = <span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nA; ++i) <span class="keyword">if</span> (A[i] != <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (A[i] == stk[top]) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> lca = HLD::LCA(A[i], stk[top]);</span><br><span class="line">            <span class="keyword">if</span> (lca != stk[top]) &#123;</span><br><span class="line">                <span class="keyword">while</span> (top &gt; <span class="number">1</span> &amp;&amp; dfn[lca] &lt; dfn[stk[top<span class="number">-1</span>]])</span><br><span class="line">                    T.AddEdge(stk[top<span class="number">-1</span>], stk[top]), --top;</span><br><span class="line">                <span class="keyword">if</span> (top &gt; <span class="number">1</span> &amp;&amp; dfn[lca] &gt; dfn[stk[top<span class="number">-1</span>]])</span><br><span class="line">                    T.AddEdge(lca, stk[top]), stk[top] = lca;</span><br><span class="line">                <span class="keyword">else</span> T.AddEdge(lca, stk[top--]);</span><br><span class="line">            &#125;</span><br><span class="line">            stk[++top] = A[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; top; ++i) T.AddEdge(stk[i], stk[i + <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">DP</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">const</span> <span class="keyword">int</span>&amp; ban)</span> </span>&#123;</span><br><span class="line">        f[<span class="number">0</span>][u] = f[<span class="number">1</span>][u] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = G.head[u]; ~i; i = G.edges[i].nxt) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((v = G.edges[i].to) == ban || v == pre[u]) <span class="keyword">continue</span>;</span><br><span class="line">            DP(v, u);</span><br><span class="line">            f[<span class="number">1</span>][u] = <span class="number">1L</span>L * f[<span class="number">1</span>][u] * f[<span class="number">0</span>][v] % P;</span><br><span class="line">            f[<span class="number">0</span>][u] = <span class="number">1L</span>L * f[<span class="number">0</span>][u] * (f[<span class="number">0</span>][v] + f[<span class="number">1</span>][v]) % P;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">DPinit</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa)</span> </span>&#123;</span><br><span class="line">        g[<span class="number">0</span>][u] = g[<span class="number">1</span>][u] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = G.head[u]; ~i; i = G.edges[i].nxt) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((v = G.edges[i].to) == fa || vis[v]) <span class="keyword">continue</span>;</span><br><span class="line">            DPinit(v, u);</span><br><span class="line">            g[<span class="number">1</span>][u] = <span class="number">1L</span>L * g[<span class="number">1</span>][u] * g[<span class="number">0</span>][v] % P;</span><br><span class="line">            g[<span class="number">0</span>][u] = <span class="number">1L</span>L * g[<span class="number">0</span>][u] * (g[<span class="number">0</span>][v] + g[<span class="number">1</span>][v]) % P;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Jump</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">const</span> <span class="keyword">int</span>&amp; fa)</span> </span>&#123;</span><br><span class="line">        K[<span class="number">0</span>][<span class="number">0</span>][u] = K[<span class="number">0</span>][<span class="number">1</span>][u] = K[<span class="number">1</span>][<span class="number">0</span>][u] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = u; pre[i] != fa; i = pre[i]) &#123;</span><br><span class="line">            DP(pre[i], i);</span><br><span class="line">            <span class="keyword">int</span> ft = pre[i], k0 = K[<span class="number">0</span>][<span class="number">0</span>][u], k1 = K[<span class="number">0</span>][<span class="number">1</span>][u];</span><br><span class="line">            K[<span class="number">0</span>][<span class="number">0</span>][u] = (<span class="number">1L</span>L * f[<span class="number">0</span>][ft] * k0 % P + <span class="number">1L</span>L * f[<span class="number">1</span>][ft] * K[<span class="number">1</span>][<span class="number">0</span>][u] % P) % P;</span><br><span class="line">            K[<span class="number">0</span>][<span class="number">1</span>][u] = (<span class="number">1L</span>L * f[<span class="number">0</span>][ft] * k1 % P + <span class="number">1L</span>L * f[<span class="number">1</span>][ft] * K[<span class="number">1</span>][<span class="number">1</span>][u] % P) % P;</span><br><span class="line">            K[<span class="number">1</span>][<span class="number">1</span>][u] = <span class="number">1L</span>L * f[<span class="number">0</span>][ft] * k1 % P;</span><br><span class="line">            K[<span class="number">1</span>][<span class="number">0</span>][u] = <span class="number">1L</span>L * f[<span class="number">0</span>][ft] * k0 % P;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa)</span> </span>&#123;</span><br><span class="line">        A[++nA] = u, DPinit(u, fa);</span><br><span class="line">        <span class="keyword">if</span> (fa &amp;&amp; u != fa) Jump(u, fa);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = T.head[u]; ~i; i = T.edges[i].nxt)</span><br><span class="line">            <span class="keyword">if</span> ((v = T.edges[i].to) != fa) init(v, u);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123; build(), nA = <span class="number">0</span>, init(<span class="number">1</span>, <span class="number">0</span>); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = T.head[u]; ~i; i = T.edges[i].nxt) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((v = T.edges[i].to) == fa) <span class="keyword">continue</span>;</span><br><span class="line">            dfs(v, u);</span><br><span class="line">            f[<span class="number">0</span>][u] = <span class="number">1L</span>L * f[<span class="number">0</span>][u] *</span><br><span class="line">                (<span class="number">1L</span>L * K[<span class="number">0</span>][<span class="number">0</span>][v] * f[<span class="number">0</span>][v] % P + <span class="number">1L</span>L * K[<span class="number">0</span>][<span class="number">1</span>][v] * f[<span class="number">1</span>][v] % P) % P;</span><br><span class="line">            f[<span class="number">1</span>][u] = <span class="number">1L</span>L * f[<span class="number">1</span>][u] *</span><br><span class="line">                (<span class="number">1L</span>L * K[<span class="number">1</span>][<span class="number">0</span>][v] * f[<span class="number">0</span>][v] % P + <span class="number">1L</span>L * K[<span class="number">1</span>][<span class="number">1</span>][v] * f[<span class="number">1</span>][v] % P) % P;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n), read(m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> u, v, i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        read(u), read(v), G.AddEdge(u, v), G.AddEdge(v, u);</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    HLD::solve(), VT::solve();</span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> s = <span class="number">0</span>; s &lt; (<span class="number">1</span> &lt;&lt; nE); ++s) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nA; ++i)</span><br><span class="line">            f[<span class="number">0</span>][A[i]] = g[<span class="number">0</span>][A[i]], f[<span class="number">1</span>][A[i]] = g[<span class="number">1</span>][A[i]];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nE; ++i)</span><br><span class="line">            <span class="keyword">if</span> ((s &gt;&gt; (i<span class="number">-1</span>)) &amp; <span class="number">1</span>) f[<span class="number">0</span>][U[i]] = f[<span class="number">1</span>][V[i]] = <span class="number">0</span>; <span class="keyword">else</span> f[<span class="number">1</span>][U[i]] = <span class="number">0</span>;</span><br><span class="line">        VT::dfs(<span class="number">1</span>, <span class="number">0</span>), ans = (ans + (f[<span class="number">0</span>][<span class="number">1</span>] + f[<span class="number">1</span>][<span class="number">1</span>]) % P) % P;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒAHOI-HNOI2018ã€æ¸¸æˆ"><a href="#ã€ŒAHOI-HNOI2018ã€æ¸¸æˆ" class="headerlink" title="ã€ŒAHOI / HNOI2018ã€æ¸¸æˆ"></a>ã€ŒAHOI / HNOI2018ã€æ¸¸æˆ</h3><h4 id="é¢˜ç›®é“¾æ¥-3"><a href="#é¢˜ç›®é“¾æ¥-3" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2508" target="_blank" rel="noopener">https://loj.ac/problem/2508</a></li></ul><h4 id="è§£é¢˜æ€è·¯-3"><a href="#è§£é¢˜æ€è·¯-3" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>é¦–å…ˆå°†æˆ¿é—´æŒ‰ä¸Šé”çš„é—¨åˆ†å‰², å¤„ç†å‡ºæˆ¿é—´ $i$ èƒ½åˆ°è¾¾çš„æˆ¿é—´ä½ç½® $[L_i,\ R_i]$. è¿™æ ·åˆ¤æ–­ $s$ æ˜¯å¦èƒ½åˆ°è¾¾ $t$, åªéœ€è¦åˆ¤æ–­ $t$ æ˜¯å¦åœ¨åŒºé—´ $[L_i,\ R_i]$ å°±å¥½äº†.</p><p>æœ‰ä¸€ä¸ªæ˜¾ç„¶çš„æš´åŠ›, å¯¹äºæ¯ä¸ªä½ç½®å‘å·¦å³ä¸¤ä¸ªæ–¹å‘æ‰©å±•, å¹¶é€æ­¥æ›´æ–° $L_i$ / $R_i$.</p><p>æ€è€ƒå¦‚ä½•ä¼˜åŒ–è¿™ä¸ªæš´åŠ›. è€ƒè™‘åˆ°å¯¹æ¯ä¸ªä½ç½®æ‰©å±•æ—¶, å¾ˆå¤šçŠ¶æ€è¢«è®¡ç®—äº†å¤šæ¬¡. è€Œé¢˜ç›®ä¸­é’¥åŒ™æ”¾ç½®ä½ç½®, åˆå­˜åœ¨è¿™æ ·çš„æ€§è´¨:</p><ol><li><p>å¦‚æœæˆ¿é—´ $i$ å’Œæˆ¿é—´ $i+1$ å­˜åœ¨é”, ä¸”é’¥åŒ™åœ¨æˆ¿é—´ $i$ å·¦ä¾§ (åŒ…å« $i$), é‚£ä¹ˆæˆ¿é—´ $i+1$ ä¹‹åçš„ä½ç½®ä¸€å®šä¸èƒ½è¶Šè¿‡è¿™æ‰‡é—¨.</p></li><li><p>å¦‚æœæˆ¿é—´ $i$ å’Œæˆ¿é—´ $i+1$ å­˜åœ¨é”, ä¸”é’¥åŒ™åœ¨æˆ¿é—´ $i+1$ å³ä¾§ (åŒ…å« $i+1$), é‚£ä¹ˆæˆ¿é—´ $i$ ä¹‹å‰çš„ä½ç½®ä¸€å®šä¸èƒ½è¶Šè¿‡è¿™æ‰‡é—¨.</p></li></ol><p>æ¯æ¬¡é‡åˆ°ä¸€ä¸ªé”æ—¶, å°†ä¸€ä¸ªä½ç½®å‘è¯¥ä½ç½®ä¸èƒ½åˆ°è¾¾çš„åœ°æ–¹è¿è¾¹, å»ºå®Œè¾¹åå¯ä»¥å¾—åˆ°ä¸€ä¸ª DAG, åœ¨æ‹“æ‰‘æ’åºæ—¶æ›´æ–°å¯åˆ°è¾¾ä½ç½®åŒºé—´å³å¯.</p><p>å®é™…å®ç°æ—¶, ç›´æ¥ä½¿ç”¨æŒ‰é”åˆ†å‰²åçš„ç¼–å·, ä¹Ÿå°±æ˜¯æ‰€è°“ â€œç¼©ç‚¹â€ äº†.</p><p>è™½ç„¶æ‹“æ‰‘æ’åºæ›´æ–°åˆ°è¾¾ä½ç½®åŒºé—´ $[L_i, R_i]$ æ—¶çš„å¤æ‚åº¦çœ‹èµ·æ¥å¾ˆä¸å¯¹åŠ², ä½†å…¶å®å‡æ‘Šæ˜¯çº¿æ€§çš„â€¦ è¿™ä¹Ÿæ˜¯å»ºå›¾æ–¹æ³•æ‰€ä¿è¯çš„.</p><p>æ—¶é—´å¤æ‚åº¦ $O(n + m)$.</p><h4 id="ä»£ç å®ç°-3"><a href="#ä»£ç å®ç°-3" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2508</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e6</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, q;</span><br><span class="line"><span class="keyword">int</span> L[MAXN], R[MAXN];</span><br><span class="line"><span class="keyword">int</span> Key[MAXN], Idx[MAXN], idx;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Graph &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt, to; &#125; edges[MAXN];</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], in[MAXN], eidx;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="keyword">sizeof</span> head), eidx = <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to)</span> </span>&#123;</span><br><span class="line">        edges[++eidx] = (Edge)&#123; head[from], to &#125;, head[from] = eidx;</span><br><span class="line">        ++in[to];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Toposort</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; Q;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= idx; ++i) <span class="keyword">if</span> (!in[i]) Q.push(i);</span><br><span class="line">        <span class="keyword">while</span> (!Q.empty()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = Q.front(); Q.pop();</span><br><span class="line">            <span class="keyword">bool</span> flag = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">while</span> (flag) &#123;</span><br><span class="line">                flag = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">int</span> p1 = Key[L[u] - <span class="number">1</span>], p2 = Key[R[u]];</span><br><span class="line">                <span class="keyword">while</span> (L[u] &lt;= p1 &amp;&amp; p1 &lt;= R[u])</span><br><span class="line">                    flag = <span class="literal">true</span>, L[u] = L[Idx[L[u] - <span class="number">1</span>]], p1 = Key[L[u] - <span class="number">1</span>];</span><br><span class="line">                <span class="keyword">while</span> (L[u] &lt;= p2 &amp;&amp; p2 &lt;= R[u])</span><br><span class="line">                    flag = <span class="literal">true</span>, R[u] = R[Idx[R[u] + <span class="number">1</span>]], p2 = Key[R[u]];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> v, i = head[u]; ~i; i = edges[i].nxt)</span><br><span class="line">                <span class="keyword">if</span> (!(--in[v = edges[i].to])) Q.push(v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// init</span></span><br><span class="line">    Graph::init();</span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n), read(m), read(q);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> x, i = <span class="number">1</span>; i &lt;= m; ++i) read(x), read(Key[x]);</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    L[<span class="number">1</span>] = R[<span class="number">1</span>] = idx = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (Key[i - <span class="number">1</span>] != <span class="number">0</span>) &#123;</span><br><span class="line">            L[++idx] = i;</span><br><span class="line">            <span class="keyword">if</span> (Key[i - <span class="number">1</span>] &lt;= i - <span class="number">1</span>) Graph::AddEdge(idx, idx - <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">else</span> Graph::AddEdge(idx - <span class="number">1</span>, idx);</span><br><span class="line">        &#125;</span><br><span class="line">        R[idx] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è®° Idx[i] ä¸ºå®é™…æˆ¿é—´æ ‡å· i, å¯¹åº”æŒ‰é”åˆ†å‰²åå—çš„ç¼–å·</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= idx; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = L[i]; j &lt;= R[i]; ++j) Idx[j] = i;</span><br><span class="line">    Graph::Toposort();</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> s, t;</span><br><span class="line">        read(s), read(t);</span><br><span class="line">        <span class="built_in">puts</span>((L[Idx[s]] &lt;= t &amp;&amp; t &lt;= R[Idx[s]])? <span class="string">"YES"</span>: <span class="string">"NO"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒAHOI-HNOI2018ã€æ’åˆ—"><a href="#ã€ŒAHOI-HNOI2018ã€æ’åˆ—" class="headerlink" title="ã€ŒAHOI / HNOI2018ã€æ’åˆ—"></a>ã€ŒAHOI / HNOI2018ã€æ’åˆ—</h3><h4 id="é¢˜ç›®é“¾æ¥-4"><a href="#é¢˜ç›®é“¾æ¥-4" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2509" target="_blank" rel="noopener">https://loj.ac/problem/2509</a></li></ul><h4 id="è§£é¢˜æ€è·¯-4"><a href="#è§£é¢˜æ€è·¯-4" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>è€ƒè™‘é¢˜ç›®ä¸­è¿™ä¸ªå¾ˆå¥‡æ€ªçš„é™åˆ¶åœ¨è¯´ä»€ä¹ˆ.</p><p>æ—¢ç„¶æ»¡è¶³ â€œå¦‚æœ $a_{p_j} = p_k$, é‚£ä¹ˆ $k &lt; j$â€, æ¢å¥è¯è¯´, å¦‚æœå¢é‡æ„é€ å‡ºè¿™ä¸ªæ’åˆ—, åœ¨é€‰æ‹© $j$ æ—¶, ä¸€å®šè¦å…ˆé€‰ $a_j$.</p><p>æ­¤æ—¶å°† $a_j$ å‘ $j$ è¿è¾¹, å¦‚æœå½¢æˆç¯åˆ™ä¸€å®šæ— è§£, å¦åˆ™å°±æ˜¯ä¸€é¢—ä»¥ $0$ ä¸ºæ ¹çš„æ ‘.</p><p>è€ƒè™‘å¦‚ä½•æ„é€ å‡ºæœ€ä¼˜è§£, å¯ä»¥å‘ç°, æƒå€¼éƒ½æ˜¯å›ºå®šçš„, è¦åšçš„äº‹å°±æ˜¯åœ¨åˆæ³•çš„èŒƒå›´å†…, å°†å°½é‡å¤§çš„ $w_i$ æ”¾åœ¨åé¢.</p><p>äºæ˜¯å¯ä»¥å¾—åˆ°ä¸€ä¸ªè´ªå¿ƒç­–ç•¥. å¯¹äºå½“å‰æƒå€¼æœ€å°çš„èŠ‚ç‚¹ $u$, å¦‚æœ</p><ul><li><p>$a_u = 0$</p><p>æ­¤æ—¶ä¸€å®šé€‰æ‹© $u$.</p></li><li><p>$a_u \neq 0$</p><p>åœ¨é€‰æ‹© $a_u$ å, ä¸€å®šé€‰æ‹© $u$. å› æ­¤å¯ä»¥å°† $a_u$ åŒ $u$ åˆå¹¶.</p><p>è€ƒè™‘ä¸ª ğŸ”¨. å’•.</p></li></ul><p>æ•´ä¸ªè¿‡ç¨‹åˆ©ç”¨å¹¶æŸ¥é›†, ä»¥åŠä¼˜å…ˆé˜Ÿåˆ—å®ç°å³å¯. æ—¶é—´å¤æ‚åº¦ $O(n \log n)$.</p><h4 id="ä»£ç å®ç°-4"><a href="#ä»£ç å®ç°-4" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p>å¦‚æœè€ƒè™‘èŠ‚ç‚¹ $0$ åœ¨è®¡ç®—ç­”æ¡ˆæ—¶çš„å½±å“, åˆ™éœ€è¦æŠŠ <code>W[0]</code> è®¾ä¸º INF, ä½†æ˜¯è¿™ä¸ª INF å¤ªå¤§çˆ† <code>long long</code> (è™½ç„¶ä¸å½±å“ç»“æœ), å¤ªå°ä¼š WA = =</p><p>é‚£å°±ç›´æ¥ä¸è€ƒè™‘å§ (</p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2509</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">5e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Item</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> u, s; LL w;</span><br><span class="line">    Item(<span class="keyword">int</span> _u, <span class="keyword">int</span> _s, LL _w): u(_u), s(_s), w(_w) &#123; &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Item&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> w * rhs.s &gt; rhs.w * s;</span><br><span class="line">        <span class="comment">// é™¤æ³•... ä¸ºä»€ä¹ˆè¦å†™æˆé™¤æ³•.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">int</span> A[MAXN], size[MAXN];</span><br><span class="line">LL W[MAXN];</span><br><span class="line">priority_queue&lt;Item&gt; Q;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> DSU &#123;</span><br><span class="line">    <span class="keyword">int</span> fa[MAXN];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; ++i) fa[i] = i, size[i] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">findfa</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123; <span class="keyword">return</span> u == fa[u]? u: fa[u] = findfa(fa[u]); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">NoAns</span><span class="params">()</span> </span>&#123; <span class="built_in">puts</span>(<span class="string">"-1"</span>), <span class="built_in">exit</span>(<span class="number">0</span>); &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Graph &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt, to; &#125; edges[MAXN];</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], eidx;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="keyword">sizeof</span> head), eidx = <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to)</span> </span>&#123;</span><br><span class="line">        edges[++eidx] = (Edge)&#123; head[from], to &#125;, head[from] = eidx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">bool</span> vis[MAXN];</span><br><span class="line">        <span class="keyword">int</span> s = vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = head[u]; ~i; i = edges[i].nxt) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((v = edges[i].to) == fa) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span> (vis[v]) NoAns();</span><br><span class="line">            s += dfs(v, u);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// init</span></span><br><span class="line">    Graph::init();</span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) read(A[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) read(W[i]);</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) Graph::AddEdge(A[i], i);</span><br><span class="line">    <span class="keyword">if</span> (Graph::dfs(<span class="number">0</span>, <span class="number">-1</span>) != n + <span class="number">1</span>) NoAns();</span><br><span class="line">    DSU::init();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) Q.push(Item(i, size[i], W[i]));</span><br><span class="line">    LL ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (!Q.empty()) &#123;</span><br><span class="line">        Item x = Q.top(); Q.pop();</span><br><span class="line">        <span class="keyword">int</span> u = DSU::findfa(x.u), fa = DSU::findfa(A[u]);</span><br><span class="line">        <span class="keyword">if</span> (size[u] != x.s) <span class="keyword">continue</span>;</span><br><span class="line">        ans += W[u] * size[fa];</span><br><span class="line">        DSU::fa[u] = fa, W[fa] += W[u], size[fa] += size[u];</span><br><span class="line">        <span class="keyword">if</span> (fa) Q.push(Item(fa, size[fa], W[fa]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒAHOI-HNOI2018ã€é“è·¯"><a href="#ã€ŒAHOI-HNOI2018ã€é“è·¯" class="headerlink" title="ã€ŒAHOI / HNOI2018ã€é“è·¯"></a>ã€ŒAHOI / HNOI2018ã€é“è·¯</h3><p>è¿™æ˜¯ä¸€é“ NOIP é¢˜â€¦</p><h4 id="é¢˜ç›®é“¾æ¥-5"><a href="#é¢˜ç›®é“¾æ¥-5" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2510" target="_blank" rel="noopener">https://loj.ac/problem/2510</a></li></ul><h4 id="è§£é¢˜æ€è·¯-5"><a href="#è§£é¢˜æ€è·¯-5" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>è§‚å¯Ÿå¼å­</p><p>$$c_i \cdot (a_i + x) \cdot (b_i + y)$$</p><p>å¯ä»¥å‘ç°, è¿™ä¸ªå¼å­æ²¡æœ‰ç”¨.</p><p>é¢˜ç›®ç»™å®šçš„å…¶å®æ˜¯ä¸€é¢—ä»¥ $1$ ä¸ºæ ¹, å…± $2n - 1$ ä¸ªèŠ‚ç‚¹çš„äºŒå‰æ ‘, å¶èŠ‚ç‚¹éƒ½æ˜¯ä¹¡æ‘. å¹¶é’¦å®šè¿å‘å·¦å„¿å­çš„è¾¹ä¸ºå…¬è·¯, è¿å‘å³å„¿å­çš„è¾¹ä¸ºé“è·¯.</p><p>è®¾ $f(u, i, j)$ è¡¨ç¤ºèŠ‚ç‚¹ $u$, å…¶åˆ°æ ¹èŠ‚ç‚¹å…±ç»è¿‡ $i$ æ¡å…¬è·¯, $j$ æ¡é“è·¯. åˆ™</p><p>å¯¹äºå¶å­ $u$, æœ‰</p><p>$$f(u, i, j) = c_u \cdot (a_u + i) \cdot (b_u + j)$$</p><p>å¯¹äºå…¶ä»–èŠ‚ç‚¹ $u$, è®° $u$ å·¦å„¿å­ä¸º $lc$, å³å„¿å­ä¸º $rc$, æœ‰è½¬ç§»</p><p>$$f(u, i, j) = \min \{ f(lc, i + 1, j) + f(rc, i, j),\ f(lc, i, j) + f(rc, i,  j + 1) \}$$</p><p>ç­”æ¡ˆå³ä¸º $f(1, 0, 0)$.</p><p>ä»¥åŠä¸€ä¸ªå¡ç©ºé—´çš„æ–¹æ³•. è€ƒè™‘åˆ°æ¯æ¬¡è®¡ç®— $f(u, i, j)$ æ—¶, åªæ˜¯åˆ©ç”¨äº†ä¸€æ¡é“¾, ä¸ç›¸äº¤çš„é“¾ä¹‹é—´ä¸ä¼šäº’ç›¸å½±å“, è‹¥è®°äºŒå‰æ ‘æœ€å¤§æ·±åº¦ä¸º $h$, ç¬¬ä¸€ç»´åªéœ€è®°å½• $2h$ ä½å³å¯.</p><p>æ—¶é—´å¤æ‚åº¦ $O(h ^ 2 n)$.</p><h4 id="ä»£ç å®ç°-5"><a href="#ä»£ç å®ç°-5" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2510</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">4e4</span> + <span class="number">5</span>, MAXH = <span class="number">41</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">int</span> A[MAXN], B[MAXN], C[MAXN];</span><br><span class="line"><span class="keyword">int</span> ch[<span class="number">2</span>][(MAXN &gt;&gt; <span class="number">1</span>) | <span class="number">1</span>], dfn[MAXN];</span><br><span class="line">LL f[MAXH][MAXH][(MAXH &lt;&lt; <span class="number">1</span>) | <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> clk, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> du = dfn[u] = clk;</span><br><span class="line">    <span class="keyword">if</span> (u &gt;= n) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= x; ++i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= y; ++j)</span><br><span class="line">                f[i][j][du] = <span class="number">1L</span>L * C[u] * (A[u] + i) * (B[u] + j);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å‡è£…è‡ªå·±åœ¨ä¸‹ä¼  DFS åº.png</span></span><br><span class="line">    dfs(ch[<span class="number">0</span>][u], clk + <span class="number">1</span>, x + <span class="number">1</span>, y), dfs(ch[<span class="number">1</span>][u], clk + <span class="number">2</span>, x, y + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">int</span> d1 = dfn[ch[<span class="number">0</span>][u]], d2 = dfn[ch[<span class="number">1</span>][u]];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= x; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= y; ++j)</span><br><span class="line">            f[i][j][du] = min(f[i + <span class="number">1</span>][j][d1] + f[i][j][d2], f[i][j][d1] + f[i][j + <span class="number">1</span>][d2]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> u, v, i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        read(u), read(v);</span><br><span class="line">        ch[<span class="number">0</span>][i] = u &lt; <span class="number">0</span>? -u + n - <span class="number">1</span>: u, ch[<span class="number">1</span>][i] = v &lt; <span class="number">0</span>? -v + n - <span class="number">1</span>: v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &lt;= n + n<span class="number">-1</span>; ++i) read(A[i]), read(B[i]), read(C[i]);</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    dfs(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, f[<span class="number">0</span>][<span class="number">0</span>][dfn[<span class="number">1</span>]]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h3><p>è¿™å‘¨æ¯”ä¸Šå‘¨å°‘å†™äº†ä¸€æ•´å¥— SDOI = =, é€€å½¹ç¨³äº†.</p><hr>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;å…¶å®ä¸æƒ³å†å†™ 18 å¹´çš„é¢˜äº†â€¦ å†å†™å°±æ²¡æ—¶é—´å†™ 19 å¹´çš„äº† (&lt;/p&gt;
&lt;p&gt;æœç„¶ç«‹ flag å°±æ˜¯ç”¨æ¥å€’çš„.&lt;/p&gt;
&lt;p&gt;&lt;del&gt;è¯è¯´è¿™å¥—é¢˜å•çœ‹æ­£è§£, è¿˜æŒºè€ƒéªŒæ€ç»´çš„?&lt;/del&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="é¢˜è§£" scheme="https://depletedprism.github.io/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
  </entry>
  
  <entry>
    <title>HAOI 2018 å¤§èµ</title>
    <link href="https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/HAOI-2018-sol/"/>
    <id>https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/HAOI-2018-sol/</id>
    <published>2020-03-12T08:00:47.000Z</published>
    <updated>2020-03-13T13:31:28.412Z</updated>
    
    <content type="html"><![CDATA[<hr><p>å…ˆç¥­ä¸Šå‡ºé¢˜äººé¢˜è§£.</p><ul><li><a href="https://dy0607.github.io/%E7%9C%81%E9%80%89/oi%E5%8E%86%E7%A8%8B/2018/04/24/HAOI2018-Round1-%E8%A7%A3%E9%A2%98%E6%8A%A5%E5%91%8A.html" target="_blank" rel="noopener">dy0607 çš„ HAOI2018 Round1 è§£é¢˜æŠ¥å‘Š</a></li></ul><p>ç„¶è€Œæ²¡æœ‰æ‰¾åˆ° Round 2 çš„å®˜æ–¹é¢˜è§£ (</p><a id="more"></a><h3 id="ã€ŒHAOI2018ã€å¥‡æ€ªçš„èƒŒåŒ…"><a href="#ã€ŒHAOI2018ã€å¥‡æ€ªçš„èƒŒåŒ…" class="headerlink" title="ã€ŒHAOI2018ã€å¥‡æ€ªçš„èƒŒåŒ…"></a>ã€ŒHAOI2018ã€å¥‡æ€ªçš„èƒŒåŒ…</h3><p>è¦å‘½çš„ $\gcd$â€¦</p><h4 id="é¢˜ç›®é“¾æ¥"><a href="#é¢˜ç›®é“¾æ¥" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2523" target="_blank" rel="noopener">https://loj.ac/problem/2523</a></li></ul><h4 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>æ‰€æ±‚å³ä¸ºæ»¡è¶³</p><p>$$\sum_{i \in S} a_i V_i \equiv w \pmod P$$</p><p>çš„ä¸åŒé›†åˆ $S$ ä¸ªæ•°, å…¶ä¸­ $a_i &gt; 0$, è¡¨ç¤ºç‰©å“é€‰æ‹©ä¸ªæ•°.</p><p>å†™æˆä¸å®šæ–¹ç¨‹çš„å½¢å¼, å³</p><p>$$\sum_{i \in S} a_i V_i + yP = w$$</p><p>æ ¹æ®è£´èœ€å®šç†, è¯¥æ–¹ç¨‹æœ‰è§£, åˆ™éœ€æ»¡è¶³ $\gcd(V_1, V_2, \ldots, P) \mid w$.</p><p>å¯ä»¥å‘ç°, å¯¹æ‰€æœ‰å€¼, åŒ $P$ å– $\gcd$ å¹¶ä¸ä¼šå½±å“ç­”æ¡ˆ, é‚£ä¹ˆæšä¸¾ $P$ çš„çº¦æ•°, ç›´æ¥ DP å³å¯.</p><p>ç›´æ¥ DPâ€¦ ä»¤ $d(P)$ è¡¨ç¤º $P$ çš„çº¦æ•°ä¸ªæ•°, å®¹æ˜“å¾—åˆ°æ—¶é—´å¤æ‚åº¦ $O(nd(P)$ çš„åšæ³•, ä½†æ˜¯å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–.</p><p>æšä¸¾ $P$ çš„çº¦æ•°, å¯¹äºåŒ $P$ å– $\gcd$ ç›¸åŒçš„ $V_i$, åœ¨ DP æ—¶ä¸€èµ·ç®—å³å¯.</p><p>å…·ä½“åœ°, è®¾ $f(i, j)$ è¡¨ç¤ºé€‰æ‹© $P$ å‰ $i$ ä¸ªçº¦æ•°, å¾—åˆ° $P$ çš„ç¬¬ $j$ ä¸ªçº¦æ•°çš„æ–¹æ¡ˆæ•°. è®° $s(i)$ è¡¨ç¤ºç¬¬ $i$ ä¸ªçº¦æ•°åœ¨ $\gcd(V_j, P)$ ä¸­çš„å‡ºç°æ¬¡æ•°, $d_i$ è¡¨ç¤º $P$ ç¬¬ $i$ ä¸ªçº¦æ•°. é‚£ä¹ˆæœ‰</p><p>$$f(i, k) = f(i-1, k) + \sum_{\gcd(d_i, d_j) = d_k} f(i-1, j) \cdot (2 ^ {s(i)} -1)$$</p><p>ç”±äº $P$ çš„çº¦æ•°ä¸­å¯èƒ½å­˜åœ¨ä¸€äº›æ•´é™¤å…³ç³», æœ€å $O(d^2(P))$ æšä¸¾ä¸€éæŠŠè´¡çŒ®åŠ èµ·æ¥å°±å¥½äº†.</p><p>æ—¶é—´å¤æ‚åº¦ $O(\sqrt{P} + n \log P + d ^ 2(P) \log P)$.</p><p>å¦å¤–ç¥­ä¸ŠæŸå¼ æµä¼ å·²ä¹…çš„è¡¨æ ¼â€¦</p><div style="text-align:center;"><img src="/images/HAOI-2018-sol/wd.jpg"> </div><p><em><p style="text-align:center;">å›¾æº UOJ ç”¨æˆ·ç¾¤, è‡³å°‘æˆ‘æ˜¯ä»é‚£é‡Œæ‰¾åˆ°çš„</p></em></p><h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2523</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e6</span> + <span class="number">5</span>, MAXD = <span class="number">2e3</span> + <span class="number">5</span>, MOD = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, q, P, idx;</span><br><span class="line"><span class="keyword">int</span> id1[MAXN], id2[MAXN], pow2[MAXN];</span><br><span class="line"><span class="keyword">int</span> fact[MAXD], s[MAXD], f[MAXD][MAXD], g[MAXD];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">gcd</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123; <span class="keyword">return</span> !b? a: gcd(b, a  % b); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n), read(q), read(P);</span><br><span class="line">    m = <span class="built_in">sqrt</span>(P);</span><br><span class="line">    <span class="comment">// sovle</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> d = <span class="number">1</span>; d * d &lt;= P; ++d) <span class="keyword">if</span> (P % d == <span class="number">0</span>) &#123;</span><br><span class="line">        fact[++idx] = d, id1[d] = idx;</span><br><span class="line">        <span class="keyword">if</span> (d * d != P) fact[++idx] = P / d, id2[d] = idx;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> v, i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        read(v), v = gcd(v, P), ++s[(v &lt;= m)? id1[v]: id2[P / v]];</span><br><span class="line">    pow2[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) pow2[i] = <span class="number">2L</span>L * pow2[i<span class="number">-1</span>] % MOD;</span><br><span class="line">    f[<span class="number">0</span>][id2[<span class="number">1</span>]] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= idx; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= idx; ++j) &#123;</span><br><span class="line">            <span class="keyword">int</span> w = gcd(fact[i], fact[j]), k = (w &lt;= m)? id1[w]: id2[P / w];</span><br><span class="line">            f[i][k] = (f[i][k] + <span class="number">1L</span>L * f[i<span class="number">-1</span>][j] * (pow2[s[i]] - <span class="number">1</span> + MOD) % MOD) % MOD;</span><br><span class="line">            f[i][j] = (f[i][j] + f[i<span class="number">-1</span>][j]) % MOD;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= idx; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= idx; ++j)</span><br><span class="line">            <span class="keyword">if</span> (fact[i] % fact[j] == <span class="number">0</span>) g[i] = (g[i] + f[idx][j]) % MOD;</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> w;</span><br><span class="line">        read(w), w = gcd(w, P), <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, g[(w &lt;= m)? id1[w]: id2[P / w]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒHAOI2018ã€åè‰²æ¸¸æˆ"><a href="#ã€ŒHAOI2018ã€åè‰²æ¸¸æˆ" class="headerlink" title="ã€ŒHAOI2018ã€åè‰²æ¸¸æˆ"></a>ã€ŒHAOI2018ã€åè‰²æ¸¸æˆ</h3><h4 id="é¢˜ç›®é“¾æ¥-1"><a href="#é¢˜ç›®é“¾æ¥-1" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2524" target="_blank" rel="noopener">https://loj.ac/problem/2524</a></li></ul><h4 id="è§£é¢˜æ€è·¯-1"><a href="#è§£é¢˜æ€è·¯-1" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>é¦–å…ˆæœ‰ä¸€ä¸ªç®€æ´çš„ç»“è®º, æ‰€æ±‚çš„æ–¹æ¡ˆæ•°ä¸º $2^{m - n + p}$, å…¶ä¸­ $m$ ä¸ºè¾¹æ•°, $n$ ä¸ºç‚¹æ•°, $p$ ä¸ºè¿é€šåˆ†é‡ä¸ªæ•°.</p><p>å®˜æ–¹é¢˜è§£ä»å›¾è®ºå’Œçº¿æ€§ä»£æ•°ä¸¤ä¸ªè§’åº¦è§£é‡Šäº†è¿™ä¸ªç»“è®º, ç„¶è€Œæˆ‘åªèƒ½æµä¸‹å­¦ä¸ä¼šçº¿æ€§ä»£æ•°çš„æ³ªæ°´â€¦</p><p>äºæ˜¯ä»å›¾çš„è¿é€šæ€§å…¥æ‰‹è§£é‡Šè¿™ä¸ªç»“è®º.</p><p>å•ç‹¬è€ƒè™‘æ¯ä¸€ä¸ªè¿é€šåˆ†é‡, å¦‚æœè¯¥è¿é€šåˆ†é‡ä¸­å­˜åœ¨å¶æ•°ä¸ªé»‘ç‚¹, é‚£ä¹ˆä¸€å®šå­˜åœ¨å¯è¡Œæ–¹æ¡ˆ; å¦åˆ™ä¸å­˜åœ¨.</p><p>è€ƒè™‘å°†è¯¥è¿é€šåˆ†é‡ä¸­çš„é»‘ç‚¹ä»»æ„ä¸¤ä¸¤é…å¯¹, ç”±äºå­˜åœ¨å¶æ•°ä¸ªé»‘ç‚¹, æ‰€ä»¥æ²¡æœ‰å¤šä½™. å¯ä»¥å‘ç°</p><ul><li>å¯¹äºä¸¤é»‘ç‚¹é—´çš„ä»»æ„ä¸€æ¡è·¯å¾„, ä¸è®ºç»è¿‡çš„è¾¹æ•°æ˜¯å¥‡æ˜¯å¶, æ€»å¯ä»¥æ„é€ å‡ºä¸€ç§æ–¹æ¡ˆ, ä½¿å¾—è·¯å¾„ä¸Šåªæœ‰è¿™ä¸¤ä¸ªé»‘ç‚¹é¢œè‰²åè½¬.</li><li>å¯¹äºè¿™äº›è·¯å¾„çš„äº¤, æ¯æ¬¡æŠŠè¾¹é€‰ / ä¸é€‰çš„çŠ¶æ€å–å, ä¸ä¼šå½±å“åˆ°åŸæ¥çš„å±€é¢.</li></ul><p>å¦‚æœå­˜åœ¨å¥‡æ•°ä¸ªé»‘ç‚¹, åˆ™ä¸å­˜åœ¨ä»¥ä¸Šæ€§è´¨â€¦ å› è€Œä¸å­˜åœ¨åˆæ³•æ–¹æ¡ˆ.</p><p>åŒæ—¶æˆ‘ä»¬çŸ¥é“äº†, é…å¯¹æ•°å’Œæ–¹æ¡ˆæ•°æ˜¯ç­‰ä»·çš„. æ¢è¨€ä¹‹, æ¯ç§é»‘ç‚¹ä¸¤ä¸¤åŒ¹é…çš„æ–¹æ¡ˆ, å”¯ä¸€å¯¹åº”ç€ä¸€ä¸ªåˆæ³•è§£.</p><p>æ‰€ä»¥å¯¹äºä¸€ä¸ªç‚¹æ•°ä¸º $n$ çš„è¿é€šåˆ†é‡, æœ‰è§£çš„æƒ…å†µæœ‰ $2^{n-1}$ ç§ (æ‹¿ç»„åˆæ•°åŠ èµ·æ¥æ¨ä¸€æ¨å¯çŸ¥), ç”±äºè¾¹æ•°ä¸º $m$, å…± $2^m$ ç§æƒ…å†µ, æ‰€ä»¥æ¯ç§æœ‰è§£çš„æƒ…å†µä¸‹, è§£çš„ä¸ªæ•°ä¸º $2^{m-n+1}$. å¯¹ $p$ ä¸ªè¿é€šåˆ†é‡è¿›è¡Œæ¨å¹¿, ç­”æ¡ˆå³ä¸º $2 ^ {m - n + p}$.</p><p>ä¼¼ä¹è¿˜å¯ä»¥ä»å¦ä¸€ä¸ªè§’åº¦è§£é‡Š? å‚è§ <a href="https://www.cnblogs.com/xjqxjq/p/11781185.html" target="_blank" rel="noopener">https://www.cnblogs.com/xjqxjq/p/11781185.html</a>.</p><p>çŸ¥é“ç»“è®ºåçš„åšæ³•å°±å¾ˆæ˜æ™°äº†, è·‘ tarjan æ±‚å‰²ç‚¹, è®¨è®ºæ˜¯å¦æœ‰è§£, ä»¥åŠåˆ è¾¹åæ•´ä½“è¾¹æ•°, ç‚¹æ•°, è¿é€šåˆ†é‡ä¸ªæ•°çš„å˜åŒ–å³å¯.</p><p>æ—¶é—´å¤æ‚åº¦ $O(n + m)$.</p><h4 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2524</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">5</span>, P = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="keyword">int</span> V[MAXN], pow2[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Graph &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt, to; &#125; edges[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], deg[MAXN], eidx;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(deg, <span class="number">0</span>, <span class="keyword">sizeof</span> deg), <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="keyword">sizeof</span> head), eidx = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to)</span> </span>&#123;</span><br><span class="line">        edges[++eidx] = (Edge)&#123; head[from], to &#125;, head[from] = eidx;</span><br><span class="line">        ++deg[to];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> Even[MAXN];</span><br><span class="line">    <span class="keyword">int</span> cut[MAXN], dfn[MAXN], low[MAXN], dfs_clock;</span><br><span class="line">    <span class="keyword">int</span> Idx[MAXN], size[MAXN], sub[MAXN], idx;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">tarjan</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> child = <span class="number">0</span>;</span><br><span class="line">        Idx[u] = idx, size[u] = V[u];</span><br><span class="line">        low[u] = dfn[u] = ++dfs_clock;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = head[u]; ~i; i = edges[i].nxt) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!dfn[v = edges[i].to]) &#123;</span><br><span class="line">                tarjan(v, u);</span><br><span class="line">                size[u] += size[v], ++child;</span><br><span class="line">                low[u] = min(low[u], low[v]);</span><br><span class="line">                <span class="keyword">if</span> (low[v] &gt;= dfn[u])</span><br><span class="line">                    ++cut[u], sub[u] += size[v], Even[u] &amp;= !(size[v] &amp; <span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (dfn[v] &lt; dfn[u] &amp;&amp; v != fa)</span><br><span class="line">                low[u] = min(low[u], dfn[v]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!fa) --cut[u];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// init</span></span><br><span class="line">        dfs_clock = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> u = <span class="number">1</span>; u &lt;= n; ++u)</span><br><span class="line">            Even[u] = <span class="literal">true</span>, sub[u] = dfn[u] = low[u] = cut[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// solve</span></span><br><span class="line">        <span class="keyword">int</span> p = <span class="number">0</span>, s = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> u = <span class="number">1</span>; u &lt;= n; ++u)</span><br><span class="line">            <span class="keyword">if</span> (!dfn[u]) idx = u, ++p, tarjan(u, <span class="number">0</span>), s += size[u] &amp; <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// output</span></span><br><span class="line">        <span class="keyword">int</span> tot = m - n + p;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d "</span>, s &gt; <span class="number">0</span>? <span class="number">0</span>: pow2[tot]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> u = <span class="number">1</span>; u &lt;= n; ++u) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!deg[u]) <span class="built_in">printf</span>(<span class="string">"%d"</span>, s - size[u] &gt; <span class="number">0</span>? <span class="number">0</span>: pow2[tot]);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%d"</span>, (!Even[u] || s - (size[Idx[u]] &amp; <span class="number">1</span>) &gt; <span class="number">0</span> || ((size[Idx[u]] - V[u] - sub[u]) &amp; <span class="number">1</span>))?</span><br><span class="line">                    <span class="number">0</span>: pow2[tot - deg[u] + <span class="number">1</span> + cut[u]]);</span><br><span class="line">            <span class="built_in">putchar</span>(<span class="string">" \n"</span>[u == n]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    pow2[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; MAXN; ++i) pow2[i] = <span class="number">2L</span>L * pow2[i<span class="number">-1</span>] % P;</span><br><span class="line">    <span class="keyword">int</span> Ti;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;Ti);</span><br><span class="line">    <span class="keyword">while</span> (Ti--) &#123;</span><br><span class="line">        <span class="comment">// init</span></span><br><span class="line">        Graph::init();</span><br><span class="line">        <span class="comment">// input</span></span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> u, v, i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;u, &amp;v);</span><br><span class="line">            Graph::AddEdge(u, v), Graph::AddEdge(v, u);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) <span class="built_in">scanf</span>(<span class="string">"%1d"</span>, V+i);</span><br><span class="line">        <span class="comment">// solve</span></span><br><span class="line">        Graph::solve();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒHAOI2018ã€å­—ä¸²è¦†ç›–"><a href="#ã€ŒHAOI2018ã€å­—ä¸²è¦†ç›–" class="headerlink" title="ã€ŒHAOI2018ã€å­—ä¸²è¦†ç›–"></a>ã€ŒHAOI2018ã€å­—ä¸²è¦†ç›–</h3><h4 id="é¢˜ç›®é“¾æ¥-2"><a href="#é¢˜ç›®é“¾æ¥-2" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2525" target="_blank" rel="noopener">https://loj.ac/problem/2525</a></li></ul><h4 id="è§£é¢˜æ€è·¯-2"><a href="#è§£é¢˜æ€è·¯-2" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>å‡ºé¢˜äººç§°æœ¬é¢˜ç®—æ³•å¹¶ä¸ä¼˜ç¾â€¦ å…¶å®ä¹Ÿçš„ç¡®ä¸æ€ä¹ˆä¼˜ç¾ = =</p><p>LOJ ä¸Šçš„é¢˜é¢å¹¶æ²¡æœ‰æ‰€æœ‰æ•°æ®ç‚¹çš„é™åˆ¶, å¯ä»¥å‚è€ƒæ´›è°·çš„é¢˜é¢: <a href="https://www.luogu.com.cn/problem/P4493" target="_blank" rel="noopener">https://www.luogu.com.cn/problem/P4493</a>.</p><p>è§‚å¯Ÿæ•°æ®ç‚¹çš„é™åˆ¶, å¯ä»¥å‘ç° $r-l$ çš„é™åˆ¶éå¸¸ç‹¬ç‰¹, äºæ˜¯åˆ†ä¸¤ç§æƒ…å†µè®¨è®º:</p><ul><li><p>$r-l \ge 2000$</p><p>æ­¤æ—¶ä¸² $P$ è¾ƒé•¿, é‚£ä¹ˆ $P$ åœ¨ $T$ ä¸­åŒ¹é…æ¬¡æ•°è¾ƒå°.</p><p>è€ƒè™‘è¦†ç›–æ“ä½œ, æ¯æ¬¡é€‰æ‹©ä½ç½®æœ€é å‰, ä¸”æœªè¢«è¦†ç›–çš„ä½ç½®å»è¦†ç›–, ç›´åˆ°å•æ¬¡å¯¹ç­”æ¡ˆçš„è´¡çŒ® $\le 0$. æ­¤æ—¶å¾—åˆ°çš„ç­”æ¡ˆä¸€å®šæ˜¯æœ€ä¼˜çš„.</p><p>è®¾åŒ¹é…æ¬¡æ•°ä¸º $p$, åˆ©ç”¨ SAM ä»¥åŠçº¿æ®µæ ‘åˆå¹¶ç»´æŠ¤ $endpos$ é›†åˆçš„å¥—è·¯, å¯ä»¥åœ¨ $O(p \log n)$ çš„æ—¶é—´å®Œæˆå•æ¬¡è¯¢é—®.</p><p>å…·ä½“åœ°è¯´, å¯¹ä¸² $A$ å»º SAM, åœ¨çº¿æ®µæ ‘ä¸Šç»´æŠ¤ $endpos$ ä¸­æœ€é åä½ç½®. å¯¹äºä¸² $P$, åˆ©ç”¨å€å¢æ‰¾åˆ°å…¶åœ¨ SAM ä¸Šå¯¹åº”èŠ‚ç‚¹. å¦‚æœå¯ä»¥åŒ¹é…, æ¯æ¬¡åœ¨çº¿æ®µæ ‘ä¸ŠäºŒåˆ†, æ‰¾åˆ°ä¸€ä¸ªæœ€é å‰ä½ç½®, ç´¯è®¡ç­”æ¡ˆ, å¹¶ç»§ç»­åŒ¹é….</p><p>å¯¹äº $50 &lt; r-l &lt; 2000$ çš„æƒ…å†µ, æ•°æ®ä¸­é™åˆ¶äº†è¯¥æƒ…å†µçš„å‡ºç°æ¬¡æ•°, ç›´æ¥æŒ‰ä»¥ä¸Šæ–¹æ³•åšå³å¯.</p></li><li><p>$r-l \le 50$</p><p>æ­¤æ—¶ä¸² $P$ è¾ƒçŸ­, é‚£ä¹ˆä¸² $A$ ä¸­æ‰€æœ‰é•¿åº¦ä¸º $|P|$ çš„å­ä¸²åªæœ‰ $n - |P| + 1$ ç§. è€ƒè™‘ç”¨å€å¢å¤„ç†æ‰€æœ‰çš„è¿™äº›å­ä¸².</p><p>å‚è€ƒ <a href="http://phantasmdragon.leanote.com/post/%5B%E5%90%8E%E7%BC%80%E8%87%AA%E5%8A%A8%E6%9C%BA%5D%5B%E7%BA%BF%E6%AE%B5%E6%A0%91%5D%5B%E5%80%8D%E5%A2%9E%5D%5B%E4%B9%B1%E6%90%9E%5D%E3%80%8CHAOI2018%E3%80%8D%E5%AD%97%E4%B8%B2%E8%A6%86%E7%9B%96" target="_blank" rel="noopener">PhantasmDragon</a> çš„æ€è·¯, å¯¹äºä¸² $A$ ä¸­ä¸€ä¸ªä»ä½ç½® $i$ å¼€å§‹çš„å­ä¸² $s$, è®¾ $\operatorname{nxt}(|s|, i, j)$ è¡¨ç¤ºå $2^j$ ä¸ªå­—ç¬¦åŒ $s$ ç›¸åŒçš„å­—ç¬¦ä¸²çš„å·¦ç«¯ç‚¹ä½ç½®.</p><p>åŒæ—¶è®°å½• $f(|s|, i, j)$, è¡¨ç¤ºæ­¤æ—¶å¯¹ç­”æ¡ˆçš„è´¡çŒ®.</p><p>å•æ¬¡æŸ¥è¯¢æ—¶å½¢åŒä¸Šé¢ä¸€ç§æƒ…å†µ, å…ˆæ‰¾åˆ°ä¸² $P$ å¯¹åº”åœ¨ SAM çš„èŠ‚ç‚¹, ä»¥åŠç¬¬ä¸€ä¸ªåŒ¹é…ä½ç½®, ç„¶åå€å¢ç»Ÿè®¡ç­”æ¡ˆå³å¯.</p><p>å¯¹äºé¢„å¤„ç†, æšä¸¾æ¯ä¸ªé•¿åº¦, å¯¹äºæ¯ä¸ªä¸åŒçš„å­ä¸², åˆ©ç”¨å“ˆå¸Œå’ŒåŒç«¯é˜Ÿåˆ—ç»´æŠ¤ $\operatorname{nxt}$. æ¥ç€å¥—è·¯å€å¢å³å¯.</p><p>ç›´æ¥é¢„å¤„ç†ä¼¼ä¹ä¸å¤ªå¯è¡Œ, å¯ä»¥å°†æ‰€æœ‰è¯¢é—®ç¦»çº¿, æŒ‰ä¸² $P$ é•¿åº¦æ’åº, é‡åˆ°ä¸åŒé•¿åº¦ç›´æ¥é‡æ–°è®¡ç®—å€å¢æ•°ç»„å°±å¥½äº†.</p><p>å•æ¬¡è¯¢é—®æ—¶é—´å¤æ‚åº¦ $O(\log n)$.</p></li></ul><h4 id="ä»£ç å®ç°-2"><a href="#ä»£ç å®ç°-2" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p><del>ç›´ æ¥ è‡ª ç„¶ æº¢ å‡º å•¥ äº‹ æ²¡ æœ‰</del></p><p>ç„¶åæµä¸‹äº†åªä¼šå†™åŒå“ˆå¸Œçš„æ³ªæ°´â€¦</p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2525</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;deque&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">5</span>, MAXM = <span class="number">2e5</span> + <span class="number">5</span>, SIGMA = <span class="number">26</span>, LOG = <span class="number">19</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Ask</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> idx, s, t, L, R;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Ask&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> R - L &lt; rhs.R - rhs.L;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; Q[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, K, q;</span><br><span class="line"><span class="keyword">char</span> A[MAXN], B[MAXN];</span><br><span class="line"><span class="keyword">int</span> Bpos[MAXN], Blgt[MAXN], rt[MAXM], pre[LOG][MAXM];</span><br><span class="line">LL Ans[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SGT &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span> <span class="keyword">int</span> lc, rc, pos; &#125; dat[MAXM &lt;&lt; <span class="number">5</span>];</span><br><span class="line">    <span class="keyword">int</span> nidx;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">maintain</span><span class="params">(<span class="keyword">int</span> nd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">int</span> &amp;lc = dat[nd].lc, &amp;rc = dat[nd].rc;</span><br><span class="line">        dat[nd].pos = max(dat[lc].pos, dat[rc].pos);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; pos)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (L == R) <span class="keyword">return</span> <span class="keyword">void</span>( dat[nd].pos = L );</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (pos &lt;= Mid) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!dat[nd].lc) dat[nd].lc = ++nidx;</span><br><span class="line">            Mdy(dat[nd].lc, L, Mid, pos);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!dat[nd].rc) dat[nd].rc = ++nidx;</span><br><span class="line">            Mdy(dat[nd].rc, Mid+<span class="number">1</span>, R, pos);</span><br><span class="line">        &#125;</span><br><span class="line">        maintain(nd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Mrg</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!x || !y) <span class="keyword">return</span> x + y;</span><br><span class="line">        <span class="keyword">int</span> nd = ++nidx;</span><br><span class="line">        dat[nd].lc = Mrg(dat[x].lc, dat[y].lc);</span><br><span class="line">        dat[nd].rc = Mrg(dat[x].rc, dat[y].rc);</span><br><span class="line">        <span class="keyword">return</span> maintain(nd), nd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Qry</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; pos)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (L == R) <span class="keyword">return</span> L;</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (dat[dat[nd].lc].pos &gt;= pos) <span class="keyword">return</span> Qry(dat[nd].lc, L, Mid, pos);</span><br><span class="line">        <span class="keyword">return</span> Qry(dat[nd].rc, Mid+<span class="number">1</span>, R, pos);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SAM &#123;</span><br><span class="line">    <span class="keyword">int</span> ch[MAXM][SIGMA], len[MAXM], lnk[MAXM], nidx, last;</span><br><span class="line">    <span class="keyword">int</span> cnt[MAXN], idx[MAXM];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; nidx = last = <span class="number">1</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> val, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> nd = ++nidx, p = last;</span><br><span class="line">        len[nd] = len[last] + <span class="number">1</span>, SGT::Mdy(rt[nd] = ++SGT::nidx, <span class="number">1</span>, n, i);</span><br><span class="line">        <span class="keyword">while</span> (p &amp;&amp; !ch[p][val]) ch[p][val] = nd, p = lnk[p];</span><br><span class="line">        <span class="keyword">if</span> (!p) lnk[nd] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> q = ch[p][val];</span><br><span class="line">            <span class="keyword">if</span> (len[q] == len[p] + <span class="number">1</span>) lnk[nd] = q;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">int</span> nxt = ++nidx;</span><br><span class="line">                len[nxt] = len[p] + <span class="number">1</span>, lnk[nxt] = lnk[q];</span><br><span class="line">                <span class="built_in">memcpy</span>(ch[nxt], ch[q], <span class="keyword">sizeof</span> ch[nxt]);</span><br><span class="line">                <span class="keyword">while</span> (p &amp;&amp; ch[p][val] == q) ch[p][val] = nxt, p = lnk[p];</span><br><span class="line">                lnk[nd] = lnk[q] = nxt;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        last = nd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// toposort</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nidx; ++i) ++cnt[len[i]];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) cnt[i] += cnt[i<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nidx; ++i) idx[cnt[len[i]]--] = i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> u, i = nidx; i &gt; <span class="number">1</span>; --i)</span><br><span class="line">            u = idx[i], rt[lnk[u]] = SGT::Mrg(rt[lnk[u]], rt[u]);</span><br><span class="line">        <span class="comment">// multi</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nidx; ++i) pre[<span class="number">0</span>][i] = lnk[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; LOG; ++j)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nidx; ++i) pre[j][i] = pre[j<span class="number">-1</span>][pre[j<span class="number">-1</span>][i]];</span><br><span class="line">        <span class="comment">// match B</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> u = <span class="number">1</span>, l = <span class="number">0</span>, i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">int</span> val = B[i] - <span class="string">'a'</span>;</span><br><span class="line">            <span class="keyword">if</span> (ch[u][val]) u = ch[u][val], ++l;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (u &amp;&amp; !ch[u][val]) u = lnk[u];</span><br><span class="line">                <span class="keyword">if</span> (!u) u = <span class="number">1</span>, l = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">else</span> l = len[u] + <span class="number">1</span>, u = ch[u][val];</span><br><span class="line">            &#125;</span><br><span class="line">            Bpos[i] = u, Blgt[i] = l;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Jump</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">const</span> <span class="keyword">int</span>&amp; lgt)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (Blgt[u] &lt; lgt) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        u = Bpos[u];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = LOG<span class="number">-1</span>; j &gt;= <span class="number">0</span>; --j)</span><br><span class="line">            <span class="keyword">if</span> (pre[j][u] &amp;&amp; len[pre[j][u]] &gt;= lgt) u = pre[j][u];</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">LL <span class="title">Qry</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> lgt = R - L + <span class="number">1</span>, u = Jump(R, lgt);</span><br><span class="line">        <span class="keyword">if</span> (!u || SGT::dat[rt[u]].pos &lt; s + lgt - <span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        LL ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = SGT::Qry(rt[u], <span class="number">1</span>, n, s + lgt - <span class="number">1</span>); i &lt;= t; i = SGT::Qry(rt[u], <span class="number">1</span>, n, i + lgt)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (K - (i - lgt + <span class="number">1</span>) &lt;= <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            ret += K - (i - lgt + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (SGT::dat[rt[u]].pos &lt; i + lgt) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Hash &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Hash</span> &#123;</span></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> P1 = <span class="number">998244353</span>, P2 = <span class="number">1e9</span> + <span class="number">7</span>, B = <span class="number">19260817</span>;</span><br><span class="line">        <span class="keyword">int</span> H1, H2;</span><br><span class="line"></span><br><span class="line">        Hash(<span class="keyword">int</span> _H1 = <span class="number">0</span>, <span class="keyword">int</span> _H2 = <span class="number">0</span>): H1(_H1), H2(_H2) &#123; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; ch)</span> </span>&#123;</span><br><span class="line">            H1 = (<span class="number">1L</span>L * H1 * B % P1 + ch) % P1, H2 = (<span class="number">1L</span>L * H2 * B % P2 + ch) % P2;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Hash <span class="keyword">operator</span> + (<span class="keyword">const</span> Hash&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Hash((H1 + rhs.H1) % P1, (H2 + rhs.H2) % P2);</span><br><span class="line">        &#125;</span><br><span class="line">        Hash <span class="keyword">operator</span> - (<span class="keyword">const</span> Hash&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Hash((H1 - rhs.H1 + P1) % P1, (H2 - rhs.H2 + P2) % P2);</span><br><span class="line">        &#125;</span><br><span class="line">        Hash <span class="keyword">operator</span> * (<span class="keyword">const</span> Hash&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Hash(<span class="number">1L</span>L * H1 * rhs.H1 % P1, <span class="number">1L</span>L * H2 * rhs.H2 % P2);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Hash&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> H1 &lt; rhs.H1 || (H1 == rhs.H1 &amp;&amp; H2 &lt; rhs.H2);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; P[MAXN], hA[MAXN];</span><br><span class="line">    LL f[LOG][MAXM];</span><br><span class="line">    <span class="keyword">int</span> nxt[LOG][MAXN];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        P[<span class="number">0</span>] = Hash(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            P[i] = P[i<span class="number">-1</span>] * Hash(Hash::B, Hash::B);</span><br><span class="line">            hA[i] = hA[i<span class="number">-1</span>], hA[i].insert(A[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> lgt)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">map</span>&lt;Hash, <span class="built_in">deque</span>&lt;<span class="keyword">int</span>&gt; &gt; Q;</span><br><span class="line">        <span class="built_in">memset</span>(nxt, <span class="number">0</span>, <span class="keyword">sizeof</span> nxt);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n - lgt + <span class="number">1</span>; ++i) &#123;</span><br><span class="line">            Hash h = hA[i + lgt - <span class="number">1</span>] - hA[i<span class="number">-1</span>] * P[lgt];</span><br><span class="line">            <span class="keyword">while</span> (!Q[h].empty() &amp;&amp; Q[h].front() &lt;= i - lgt)</span><br><span class="line">                nxt[<span class="number">0</span>][Q[h].front()] = i, Q[h].pop_front();</span><br><span class="line">            Q[h].push_back(i), f[<span class="number">0</span>][i] = K - i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; LOG; ++j)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n - lgt + <span class="number">1</span>; ++i)</span><br><span class="line">                nxt[j][i] = nxt[j<span class="number">-1</span>][nxt[j<span class="number">-1</span>][i]], f[j][i] = f[j<span class="number">-1</span>][i] + f[j<span class="number">-1</span>][nxt[j<span class="number">-1</span>][i]];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">LL <span class="title">Qry</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> lgt = R - L + <span class="number">1</span>, u = SAM::Jump(R, lgt);</span><br><span class="line">        <span class="keyword">if</span> (!u || SGT::dat[rt[u]].pos &lt; s + lgt - <span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> st = SGT::Qry(rt[u], <span class="number">1</span>, n, s + lgt - <span class="number">1</span>) - lgt + <span class="number">1</span>, ed = t - lgt + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (st &gt; ed) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        LL ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = LOG<span class="number">-1</span>; j &gt;= <span class="number">0</span>; --j)</span><br><span class="line">            <span class="keyword">if</span> (nxt[j][st] &amp;&amp; nxt[j][st] &lt;= ed) ret += f[j][st], st = nxt[j][st];</span><br><span class="line">        <span class="keyword">return</span> ret + f[<span class="number">0</span>][st];</span><br><span class="line">        <span class="comment">// nxt[j][st] ä¸è¡Œ, ä¸ä»£è¡¨æˆ‘ st ä¸è¡Œäº† (</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// init</span></span><br><span class="line">    SAM::init();</span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d%s%s"</span>, &amp;n, &amp;K, A+<span class="number">1</span>, B+<span class="number">1</span>);</span><br><span class="line">    read(q);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> s, t, L, R, i = <span class="number">1</span>; i &lt;= q; ++i) &#123;</span><br><span class="line">        read(s), read(t), read(L), read(R);</span><br><span class="line">        Q[i] = (Ask)&#123; i, s, t, L, R &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    Hash::init();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) SAM::insert(A[i] - <span class="string">'a'</span>, i);</span><br><span class="line">    SAM::build();</span><br><span class="line">    sort(Q+<span class="number">1</span>, Q+<span class="number">1</span>+q);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= q; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (Q[i].R - Q[i].L &gt; <span class="number">50</span>) Ans[Q[i].idx] = SAM::Qry(Q[i].s, Q[i].t, Q[i].L, Q[i].R);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">1</span> || Q[i].R - Q[i].L != Q[i<span class="number">-1</span>].R - Q[i<span class="number">-1</span>].L)</span><br><span class="line">                Hash::build(Q[i].R - Q[i].L + <span class="number">1</span>);</span><br><span class="line">            Ans[Q[i].idx] = Hash::Qry(Q[i].s, Q[i].t, Q[i].L, Q[i].R);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= q; ++i) <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, Ans[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒHAOI2018ã€è‹¹æœæ ‘"><a href="#ã€ŒHAOI2018ã€è‹¹æœæ ‘" class="headerlink" title="ã€ŒHAOI2018ã€è‹¹æœæ ‘"></a>ã€ŒHAOI2018ã€è‹¹æœæ ‘</h3><h4 id="é¢˜ç›®é“¾æ¥-3"><a href="#é¢˜ç›®é“¾æ¥-3" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2526" target="_blank" rel="noopener">https://loj.ac/problem/2526</a></li></ul><h4 id="è§£é¢˜æ€è·¯-3"><a href="#è§£é¢˜æ€è·¯-3" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>å…ˆåæ§½å‡ºé¢˜äººä¸æŠŠæ¨¡æ•°çš„é™åˆ¶å†™è¯¦ç»†ä¸€ç‚¹â€¦</p><p>ä¸è¿‡ä¸æ€ä¹ˆå½±å“åšé¢˜æ¥ç€.</p><p>é¦–å…ˆå¯ä»¥å‘ç°, æœŸæœ›å†ä¹˜ $n!$ å°±æ˜¯å¤§å¿½æ‚  = =, æ‰€æ±‚å³ä¸ºæ‰€æœ‰èŠ‚ç‚¹æ•°ä¸º $n$ çš„äºŒå‰æ ‘, ä¸¤ä¸¤è·ç¦»ä¹‹å’Œçš„å’Œ.</p><p>æœ‰ä¸€ä¸ªæ€§è´¨, ä¸€æ¡è¾¹ $(i,\ j)$ è¢«ç»è¿‡çš„æ¬¡æ•°ä¸º $s (n - s)$, å…¶ä¸­ $s$ ä¸º $j$ å¯¹åº”å­æ ‘å¤§å°. è€ƒè™‘åˆ° $n \le 2000$, å¯ä»¥æšä¸¾ä¸€ä¸ªç‚¹, ä»¥åŠå¯¹åº”è¿™ä¸ªç‚¹å¯¹åº”å­æ ‘å¤§å°æ¥è®¡ç®—ç­”æ¡ˆ.</p><p>è®¾å½“å‰æšä¸¾åˆ°ç¬¬ $i$ ä¸ªç‚¹, å‰ $i$ ä¸ªç‚¹çš„ä½ç½®éƒ½ç¡®å®šäº†, ä¸”èŠ‚ç‚¹ $i$ æŸä¸€ä¸ªå„¿å­çš„å­æ ‘å¤§å°ä¸º $j$.</p><p>$$\sum_{i=1}^n i! \sum_{j=1}^{n-i} j(n-j) \cdot 2\ \binom{n-i}{j} j! \cdot \prod_{k=i}^{n-j-1}k$$</p><p>å†ç¨å¾®è§£é‡Šä¸€ä¸‹, å‰ $i$ ä¸ªç‚¹çš„é€‰æ‹©é¡ºåºæ˜¯ä¸€ä¸ªæ’åˆ—, $i$ åˆ°å…¶æŸä¸€ä¸ªå„¿å­çš„è¾¹è¢«ç»è¿‡ $j(n-j)$ æ¬¡.</p><p>è€ƒè™‘å¤§å°ä¸º $j$ å­æ ‘çš„å†…èŠ‚ç‚¹æ’å¸ƒæƒ…å†µ, ä¹Ÿå°±æ˜¯åœ¨å‰©ä½™ $n-i$ ä¸ªèŠ‚ç‚¹ä¸­æŒ‘å‡º $j$ ä¸ªèŠ‚ç‚¹åšä¸€ä¸ªæ’åˆ—, ç”±äºæ˜¯äºŒå‰æ ‘, æ–¹æ¡ˆæ•° $\times 2$.</p><p>å†è€ƒè™‘è¯¥å­æ ‘å¤–çš„æƒ…å†µ, å¯¹äºå‰©ä¸‹çš„ $n - j - i$ ä¸ªèŠ‚ç‚¹, ä¸èƒ½æŒ‚åœ¨è¯¥å­æ ‘å†…, ä¾æ¬¡æœ‰ $i,\ i+1,\ \ldots, n-j-1$ ç§é€‰æ‹© (å› ä¸ºæ¯æ¬¡éƒ½æ–°åŠ äº†ä¸€ä¸ªèŠ‚ç‚¹), ç”±ä¹˜æ³•åŸç†ä¹˜èµ·æ¥å°±å¥½äº†.</p><p>ä¼¼ä¹åšå®Œäº†, å…¶å®å·²ç»åšå®Œäº†, åé¢çš„ç´¯ä¹˜é¢„å¤„ç†ä¸€ä¸‹å°±å¥½äº†.</p><p>å…¶å®åé¢çš„ç´¯ä¹˜åŒ–ç®€ä¸€ä¸‹å°±æ¶ˆæ‰äº†, ä¹Ÿå°±æ˜¯</p><p>$$2\sum_{i=1}^n i!(n-i)! \sum_{j=1}^{n-i} j(n-j) \binom{n-j-1}{i-1}$$</p><p>æ€»æ„Ÿè§‰è¿™ä¸ªå¼å­æœ‰ç€ä»€ä¹ˆé«˜å¦™çš„ç»„åˆæ„ä¹‰.</p><p>æ—¶é—´å¤æ‚åº¦ $O(n^2)$.</p><h4 id="ä»£ç å®ç°-3"><a href="#ä»£ç å®ç°-3" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p>ä»£ç ä¸­ä½¿ç”¨äº† 1 å¼.</p><p>2 å¼ä»£ç ä¹Ÿäº¤åœ¨ loj ä¸Šäº†, å¸¸æ•°å°äº†ä¸€å€â€¦</p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2526</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">2005</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, Mod;</span><br><span class="line"><span class="keyword">int</span> fac[MAXN], C[MAXN][MAXN], f[MAXN][MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;Mod);</span><br><span class="line">    <span class="comment">// init</span></span><br><span class="line">    C[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        C[i][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= i; ++j) C[i][j] = (C[i<span class="number">-1</span>][j<span class="number">-1</span>] + C[i<span class="number">-1</span>][j]) % Mod;</span><br><span class="line">    &#125;</span><br><span class="line">    f[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; i; ++j) f[i][j] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &lt;= n; ++j) f[i][j] = <span class="number">1L</span>L * f[i][j<span class="number">-1</span>] * j % Mod;</span><br><span class="line">    &#125;</span><br><span class="line">    fac[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) fac[i] = <span class="number">1L</span>L * fac[i<span class="number">-1</span>] * i % Mod;</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> now = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n - i; ++j) &#123;</span><br><span class="line">            <span class="keyword">int</span> s1 = <span class="number">1L</span>L * j * (n-j) % Mod;</span><br><span class="line">            <span class="keyword">int</span> s2 = <span class="number">2L</span>L * C[n-i][j] * fac[j] % Mod;</span><br><span class="line">            now = (now + <span class="number">1L</span>L * s1 * s2 % Mod * f[i][n - j - <span class="number">1</span>] % Mod) % Mod;</span><br><span class="line">        &#125;</span><br><span class="line">        ans = (ans + <span class="number">1L</span>L * fac[i] * now % Mod) % Mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒHAOI2018ã€æŸ“è‰²"><a href="#ã€ŒHAOI2018ã€æŸ“è‰²" class="headerlink" title="ã€ŒHAOI2018ã€æŸ“è‰²"></a>ã€ŒHAOI2018ã€æŸ“è‰²</h3><h4 id="é¢˜ç›®é“¾æ¥-4"><a href="#é¢˜ç›®é“¾æ¥-4" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2527" target="_blank" rel="noopener">https://loj.ac/problem/2527</a></li></ul><h4 id="è§£é¢˜æ€è·¯-4"><a href="#è§£é¢˜æ€è·¯-4" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>å¦‚æœæƒ³åˆ°äº†äºŒé¡¹å¼åæ¼”, é‚£ä¹ˆè¿™é“é¢˜è¿˜ç®—å¥—è·¯å§â€¦</p><p><del>å¯æƒœæ²¡æœ‰, æºœäº†æºœäº†, è¿˜åœ¨åŒ–å·ç§¯ä¸Šæµªè´¹æ—¶é—´, é€€å½¹ç¨³äº†</del></p><p>è®¾ $f(x)$ è¡¨ç¤ºé’¦å®š $x$ ç§é¢œè‰²å‡ºç° $S$ æ¬¡, $g(x)$ è¡¨ç¤ºæ°å¥½ $x$ ç§é¢œè‰²å‡ºç° $S$ æ¬¡.</p><p>è®° $N = \min \{ m,\ \lfloor \dfrac{n}{S} \rfloor \}$, é‚£ä¹ˆç­”æ¡ˆå³ä¸º</p><p>$$\sum_{k=0}^N W_k \cdot g(k)$$</p><p>å…ˆè€ƒè™‘å¦‚ä½•è®¡ç®— $f(x)$, ä¹Ÿå°±æ˜¯åœ¨ $m$ ç§é¢œè‰²ä¸­æŒ‘å‡º $x$ ç§å‡ºç° $S$ æ¬¡, ä»»æ„æ’åˆ—, ä¸”ä¸ç®¡å…¶ä½™ä½ç½®çš„é¢œè‰², é‚£ä¹ˆå¯ä»¥å¾—åˆ°</p><p>$$f(x) = \binom{m}{x} \cdot \frac{n!}{(S!)^x \cdot (n-Sx)!} \cdot (m-x)^{n-Sx}$$</p><p>(ä¸­é—´éƒ¨åˆ†æ˜¯ä¸€ä¸ªå¤šé‡é›†åˆçš„æ’åˆ—æ•°, ä¸ºäº†æ–¹ä¾¿å°±æ‹†å¼€äº†)</p><p>å¯¹äº $f(x)$ å’Œ $g(x)$, æœ‰</p><p>$$f(x) = \sum_{i=x}^N \binom{i}{x} g(i)$$</p><p>äºŒé¡¹å¼åæ¼”ä¸€é€šä¹‹åå¯ä»¥å¾—åˆ°</p><p>$$g(x) = \sum_{i=x}^N (-1) ^ {i-x} \binom{i}{x} f(i)$$</p><p>æŠŠç»„åˆæ•°å±•å¼€, å¾—</p><p>$$g(x) \cdot x! = \sum_{i=x}^N \frac{(-1)^{i-x}}{(i-x)!}\ i! \cdot f(i)$$</p><p>æ¥ä¸‹æ¥, å·ç§¯ç™»åœº. è®° $h(x) = \frac{(-1)^{N-x}}{(N-x)!}$, é‚£ä¹ˆ</p><p>$$g(x) \cdot x! = \sum_{i=x}^N h(N+x-i)\ i!\cdot f(i)$$</p><p>ç”¨ NTT ä¼˜åŒ–è®¡ç®—å³å¯. æ—¶é—´å¤æ‚åº¦ $O(n \log n)$.</p><h4 id="ä»£ç å®ç°-4"><a href="#ä»£ç å®ç°-4" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2527</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXL = <span class="number">1e7</span> + <span class="number">5</span>, MAXN = <span class="number">1</span> &lt;&lt; <span class="number">19</span> | <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P = <span class="number">1004535809</span>, G = <span class="number">3</span>, iG = <span class="number">334845270</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> fac[MAXL], ifac[MAXL];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">C</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (n &lt; m)? <span class="number">0</span>: <span class="number">1L</span>L * fac[n] * ifac[n-m] % P * ifac[m] % P;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fpow</span><span class="params">(<span class="keyword">int</span> base, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (b &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>) ret = <span class="number">1L</span>L * ret * base % P;</span><br><span class="line">        base = <span class="number">1L</span>L * base * base % P, b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Poly &#123;</span><br><span class="line">    <span class="keyword">int</span> r[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; Lim, <span class="keyword">const</span> <span class="keyword">int</span>&amp; L)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; Lim; ++i) r[i] = (r[i&gt;&gt;<span class="number">1</span>] &gt;&gt; <span class="number">1</span>) | ((i &amp; <span class="number">1</span>) &lt;&lt; (L<span class="number">-1</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">NTT</span><span class="params">(<span class="keyword">int</span>* f, <span class="keyword">const</span> <span class="keyword">int</span>&amp; Lim, <span class="keyword">const</span> <span class="keyword">int</span>&amp; type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; Lim; ++i) <span class="keyword">if</span> (i &lt; r[i]) swap(f[i], f[r[i]]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> Mid = <span class="number">1</span>; Mid &lt; Lim; Mid &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> unit = fpow(type &gt; <span class="number">0</span>? G: iG, (P - <span class="number">1</span>) / (Mid &lt;&lt; <span class="number">1</span>));</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; i += Mid &lt;&lt; <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">int</span> w = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; Mid; ++j, w = <span class="number">1L</span>L * w * unit % P) &#123;</span><br><span class="line">                    <span class="keyword">int</span> f0 = f[i+j], f1 = <span class="number">1L</span>L * w * f[i+j+Mid] % P;</span><br><span class="line">                    f[i+j] = (f0 + f1) % P, f[i+j+Mid] = (f0 - f1 + P) % P;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (type &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> inv = fpow(Lim, P<span class="number">-2</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) f[i] = <span class="number">1L</span>L * f[i] * inv % P;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, S;</span><br><span class="line"><span class="keyword">int</span> A[MAXN], f[MAXN], g[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n), read(m), read(S);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= m; ++i) read(A[i]);</span><br><span class="line">    <span class="comment">// init</span></span><br><span class="line">    <span class="keyword">int</span> N = max(max(n, m), S);</span><br><span class="line">    ifac[<span class="number">0</span>] = fac[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; ++i) fac[i] = <span class="number">1L</span>L * fac[i<span class="number">-1</span>] * i % P;</span><br><span class="line">    ifac[N] = fpow(fac[N], P<span class="number">-2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = N; i; --i) ifac[i<span class="number">-1</span>] = <span class="number">1L</span>L * ifac[i] * i % P;</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    N = min(m, n / S);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= N; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> s1 = <span class="number">1L</span>L * fac[n] * fpow(ifac[S], i) % P * ifac[n - S * i] % P;</span><br><span class="line">        <span class="keyword">int</span> s2 = <span class="number">1L</span>L * fpow(m - i, n - S * i) * fac[i] % P;</span><br><span class="line">        f[i] = <span class="number">1L</span>L * C(m, i) * s1 % P * s2 % P;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= N; ++i) &#123;</span><br><span class="line">        g[i] = ifac[N - i];</span><br><span class="line">        <span class="keyword">if</span> ((N - i) &amp; <span class="number">1</span>) g[i] = P - g[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> Lim = <span class="number">1</span>, L = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (Lim &lt;= N + N) Lim &lt;&lt;= <span class="number">1</span>, ++L;</span><br><span class="line">    Poly::init(Lim, L), Poly::NTT(f, Lim, <span class="number">1</span>), Poly::NTT(g, Lim, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) g[i] = <span class="number">1L</span>L * g[i] * f[i] % P;</span><br><span class="line">    Poly::NTT(g, Lim, <span class="number">-1</span>);</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= N; ++i) ans = (ans + <span class="number">1L</span>L * g[i+N] * ifac[i] % P * A[i] % P) % P;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><hr>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;å…ˆç¥­ä¸Šå‡ºé¢˜äººé¢˜è§£.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://dy0607.github.io/%E7%9C%81%E9%80%89/oi%E5%8E%86%E7%A8%8B/2018/04/24/HAOI2018-Round1-%E8%A7%A3%E9%A2%98%E6%8A%A5%E5%91%8A.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;dy0607 çš„ HAOI2018 Round1 è§£é¢˜æŠ¥å‘Š&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç„¶è€Œæ²¡æœ‰æ‰¾åˆ° Round 2 çš„å®˜æ–¹é¢˜è§£ (&lt;/p&gt;
    
    </summary>
    
    
      <category term="é¢˜è§£" scheme="https://depletedprism.github.io/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
  </entry>
  
  <entry>
    <title>ä¹çœè”è€ƒ 2018 å¤§èµ</title>
    <link href="https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/union-2018-sol/"/>
    <id>https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/union-2018-sol/</id>
    <published>2020-03-11T03:13:32.000Z</published>
    <updated>2020-03-14T05:01:51.548Z</updated>
    
    <content type="html"><![CDATA[<hr><p>é«˜ä¸€ç©æ³¥å·´çš„æ—¶å€™é™ªç€å­¦é•¿åšè¿‡â€¦ ç„¶è€Œåªæ˜¯æš´åŠ›çš„å¿ å®é€‰æ‰‹.</p><p><del>ç»“æœç°åœ¨è¿˜æ˜¯æš´åŠ›çš„å¿ å®é€‰æ‰‹.</del></p><a id="more"></a><h3 id="ã€Œä¹çœè”è€ƒ-2018ã€ä¸€åŒæœ¨æ£‹"><a href="#ã€Œä¹çœè”è€ƒ-2018ã€ä¸€åŒæœ¨æ£‹" class="headerlink" title="ã€Œä¹çœè”è€ƒ 2018ã€ä¸€åŒæœ¨æ£‹"></a>ã€Œä¹çœè”è€ƒ 2018ã€ä¸€åŒæœ¨æ£‹</h3><h4 id="é¢˜ç›®é“¾æ¥"><a href="#é¢˜ç›®é“¾æ¥" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2471" target="_blank" rel="noopener">https://loj.ac/problem/2471</a></li></ul><h4 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>å½“å¹´çœŸæ˜¯èœå•Šâ€¦ çœ‹ä¸æ‡‚çŠ¶å‹.</p><p>è½å­çš„è§„åˆ™å¾ˆæœ‰æ„æ€, æ‰‹ç©ä»¥åå¯ä»¥å‘ç°, è½å­çš„å½¢çŠ¶æ˜¯ä¸€ä¸ªä¸Šä¸‰è§’â€¦</p><p>è€ƒè™‘åˆ° $n,\ m \le 10$, å¯ä»¥çŠ¶å‹è¡¨ç¤ºè¿™ä¸ªä¸Šä¸‰è§’çš„è½®å»“. å…·ä½“åœ°è¯´, ç”¨ä¸€æ¡åŒ…å« <code>0</code> / <code>1</code> çš„åºåˆ—è¡¨ç¤ºä¸€æ¡ä»å·¦ä¸‹è§’åˆ°å³ä¸Šè§’çš„è½®å»“çº¿. </p><p>å‡å¦‚ç”¨ <code>1</code> è¡¨ç¤ºè½®å»“çº¿ä¸­æ¨ªçº¿, ç”¨ <code>0</code> è¡¨ç¤ºç«–çº¿, é‚£ä¹ˆèµ·å§‹çŠ¶æ€å°±æ˜¯ <code>((1 &lt;&lt; m) - 1) &lt;&lt; n</code>, æœ€ç»ˆçš„çŠ¶æ€ä¸º <code>(1 &lt;&lt; m) - 1</code>. (ä»ä½ä½åˆ°é«˜ä½, ä»å·¦ä¸‹è§’åˆ°å³ä¸Šè§’)</p><p>æ­¤æ—¶æ¯è½ä¸€å­å°±æ˜¯æŠŠå½¢åŒ <code>10</code> çš„ä½ç½®æ”¹ä¸º <code>01</code>. åœ¨æ‰«æçŠ¶æ€çš„åŒæ—¶ç¡®å®šå°±å¯ä»¥ç¡®å®šè½å­ä½ç½®.</p><p>æ¥ä¸‹æ¥å°±å¾ˆå¸¸è§„äº†. è®° $f(S)$ è¡¨ç¤ºçŠ¶æ€ $S$ æœ€å¤§å¾—åˆ†å·®å€¼. è€ƒè™‘åˆ°è½¬ç§»æ¯”è¾ƒæŠ½è±¡, äºæ˜¯ç”¨è®°å¿†åŒ–æœç´¢å®ç°, å¹¶è®°å½•å½“å‰æ˜¯è½®åˆ°è°è½å­, åœ¨è½¬ç§»æ—¶å¯¹åº”å– $\max$ / $\min$ ä»¥ç¡®ä¿æ­£ç¡®æ€§.</p><h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2471</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="keyword">int</span> A[MAXN][MAXN], B[MAXN][MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> f[<span class="number">1</span> &lt;&lt; (MAXN &lt;&lt; <span class="number">1</span>)];</span><br><span class="line"><span class="keyword">bool</span> vis[<span class="number">1</span> &lt;&lt; (MAXN &lt;&lt; <span class="number">1</span>)];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> sta, <span class="keyword">int</span> s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (vis[sta]) <span class="keyword">return</span> f[sta];</span><br><span class="line">    <span class="keyword">int</span>&amp; ret = f[sta];</span><br><span class="line">    ret = s? -INF: INF;</span><br><span class="line">    <span class="keyword">int</span> x = n, y = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n + m - <span class="number">1</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((sta &gt;&gt; i) &amp; <span class="number">1</span>) ++y; <span class="keyword">else</span> --x;</span><br><span class="line">        <span class="keyword">if</span> (((sta &gt;&gt; i) &amp; <span class="number">3</span>) != <span class="number">2</span>) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> (s) ret = max(ret, dfs(sta ^ (<span class="number">3</span> &lt;&lt; i), s ^ <span class="number">1</span>) + A[x][y]);</span><br><span class="line">        <span class="keyword">else</span> ret = min(ret, dfs(sta ^ (<span class="number">3</span> &lt;&lt; i), s ^ <span class="number">1</span>) - B[x][y]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> vis[sta] = <span class="literal">true</span>, ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; ++j) <span class="built_in">scanf</span>(<span class="string">"%d"</span>, A[i] + j);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; ++j) <span class="built_in">scanf</span>(<span class="string">"%d"</span>, B[i] + j);</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    <span class="keyword">int</span> ed = (<span class="number">1</span> &lt;&lt; m) - <span class="number">1</span>;</span><br><span class="line">    vis[ed] = <span class="literal">true</span>, f[ed] = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, dfs(((<span class="number">1</span> &lt;&lt; m) - <span class="number">1</span>) &lt;&lt; n, <span class="number">1</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€Œä¹çœè”è€ƒ-2018ã€IIIDX"><a href="#ã€Œä¹çœè”è€ƒ-2018ã€IIIDX" class="headerlink" title="ã€Œä¹çœè”è€ƒ 2018ã€IIIDX"></a>ã€Œä¹çœè”è€ƒ 2018ã€IIIDX</h3><h4 id="é¢˜ç›®é“¾æ¥-1"><a href="#é¢˜ç›®é“¾æ¥-1" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2472" target="_blank" rel="noopener">https://loj.ac/problem/2472</a></li></ul><h4 id="è§£é¢˜æ€è·¯-1"><a href="#è§£é¢˜æ€è·¯-1" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>å¯ä»¥å‘ç°æ›²ç›®çš„è§£é”é¡ºåºæ„æˆäº†ä¸€ä¸ªæ ‘å½¢ç»“æ„, è¦æ±‚å½“å‰èŠ‚ç‚¹çš„æƒå€¼ $\le$ å…¶å­æ ‘å†…çš„æƒå€¼.</p><p>äºæ˜¯æœ‰ä¸€ä¸ªæœ´ç´ çš„æƒ³æ³•, å³ååºéå†è¿™æ£µæ ‘, æŠŠæƒå€¼ä»å¤§åˆ°å°ä¾æ¬¡å¡«è¿›å».</p><p>ä½†æ˜¯å­˜åœ¨ç›¸åŒæƒå€¼çš„æ—¶å€™è¿™ä¸ªè´ªå¿ƒä¼šæœ‰é—®é¢˜. ä¸ºä»€ä¹ˆ?</p><p>è€ƒè™‘ä¸€ç»„æ ·ä¾‹ from <a href="https://www.cnblogs.com/HocRiser/p/8742680.html" target="_blank" rel="noopener">HocRiser</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">4 2.0</span><br><span class="line">1 1 1 2</span><br></pre></td></tr></table></figure><p>è¿™æ ·åœ¨å¡«ä»¥ $2$ ä¸ºæ ¹çš„å­æ ‘çš„æ—¶å€™, èŠ‚ç‚¹ $4$ çš„ç‚¹æƒä¸º $2$. ä½†æ­¤æ—¶ $4$ çš„ç‚¹æƒä¸º $1$, è€ŒæŠŠæƒå€¼ $2$ ä¸¢ç»™ $3$ å¯ä»¥å¾—åˆ°æ›´ä¼˜çš„ç­”æ¡ˆâ€¦</p><p>æ¥ä¸‹æ¥è€ƒè™‘å¦‚ä½•é¿å…ç›¸ç­‰æƒå€¼çš„å½±å“.</p><p>é¦–å…ˆæœ‰ä¸€ä¸ªäº‹å®, å¯èƒ½å¡«å…¥æƒå€¼çš„èŠ‚ç‚¹ä¸€å®šå’Œå·²ç»å¡«å…¥æƒå€¼çš„èŠ‚ç‚¹ç›¸é‚».</p><p>ç°åœ¨æˆ‘ä»¬ç»´æŠ¤å‡ºèŠ‚ç‚¹ $u$ å­æ ‘å¤§å° <code>size[u]</code>. å¹¶åŠ å…¥ä¸€ä¸ª â€œé¢„çº¦â€ æ“ä½œ, ä¹Ÿå°±æ˜¯æŠŠå½“å‰å¯å¡«ä½†æœªå¡«çš„èŠ‚ç‚¹ (ä¹Ÿå°±æ˜¯å…¶çˆ¶äº²éƒ½å¡«å®Œäº†) çš„å­æ ‘å¤§å°æ”¾å…¥çº¿æ®µæ ‘ä¸­.</p><p>å°†æƒå€¼ä»å°åˆ°å¤§æ’åº, æ¯æ¬¡å¡«å…¥ä¸€ä¸ªæƒå€¼, å¤„ç†å‡ºç›¸åŒæƒå€¼æ‰€åœ¨åŒºé—´ $[L,\ R]$.</p><p>åœ¨è¯¥åŒºé—´å†…ä»åå¾€å‰æšä¸¾, è®¾å½“å‰æ˜¯ä»å‰åˆ°åç¬¬ $k$ ä¸ªç›¸ç­‰æƒå€¼, åœ¨çº¿æ®µæ ‘ä¸ŠäºŒåˆ†ä¸€ä¸ªä½ç½® $u$, å¹¶å°†å½“å‰æƒå€¼å¡«å…¥ $u$. åŒæ—¶æŠŠ $u$ çš„å­æ ‘å¤§å°ä»çº¿æ®µæ ‘ä¸­åˆ å», å†æŠŠ $u$ å„¿å­ $v$ çš„å­æ ‘å¤§å°åŠ å…¥çº¿æ®µæ ‘.</p><p>çº¿æ®µæ ‘ä¸ŠäºŒåˆ†æ—¶, æ‰¾åˆ°æ ‡å·ä»å¤§åˆ°å°ç¬¬ä¸€ä¸ªåˆæ³•èŠ‚ç‚¹ $u$, ä½¿å…¶æ»¡è¶³çº¿æ®µæ ‘ä¸Šå¤§äº $u$ æ ‡å·çš„å­æ ‘å¤§å°æ€»å’Œ $&gt; k$.</p><p>æ„Ÿæ€§è§£é‡Šä¸€ä¸‹, æ¯ä¸ªèŠ‚ç‚¹ $u$ ä¸ºå…¶å­å­™é¢„ç•™äº† <code>size[u]</code> ä¸ªä½ç½®, å¡«ç›¸åŒæƒå€¼æ—¶éœ€è¦è€ƒè™‘ â€œé¢„çº¦â€ çš„å½±å“, å¹¶åšå‡ºæœ€ä¼˜çš„é€‰æ‹©. ä¹Ÿå°±æ˜¯æŠŠé åçš„ä½ç½®, åœ¨åˆæ³•çš„æƒ…å†µä¸‹å¡«å…¥å°½é‡å°çš„æƒå€¼. çº¿æ®µæ ‘ä¸ŠäºŒåˆ†çš„è¿‡ç¨‹, å°±æ˜¯åœ¨æ»¡è¶³é™åˆ¶çš„åŒæ—¶æ‰¾åˆ°è¿™ä¸ª â€œé åçš„ä½ç½®â€.</p><p>æ—¶é—´å¤æ‚åº¦ $O(n \log n)$.</p><h4 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2472</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">5e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n; <span class="keyword">double</span> K;</span><br><span class="line"><span class="keyword">int</span> A[MAXN], Ans[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SGT &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lc (nd&lt;&lt;1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rc (nd&lt;&lt;1|1)</span></span><br><span class="line">    <span class="keyword">int</span> datSum[MAXN &lt;&lt; <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; pos, <span class="keyword">const</span> <span class="keyword">int</span>&amp; val)</span> </span>&#123;</span><br><span class="line">        datSum[nd] += val;</span><br><span class="line">        <span class="keyword">if</span> (L == R) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (pos &lt;= Mid) Mdy(lc, L, Mid, pos, val);</span><br><span class="line">        <span class="keyword">else</span> Mdy(rc, Mid+<span class="number">1</span>, R, pos, val);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Qry</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (L == R) <span class="keyword">return</span> L;</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>, d = datSum[rc];</span><br><span class="line">        <span class="keyword">if</span> (k &gt; d) <span class="keyword">return</span> Qry(lc, L, Mid, k - d);</span><br><span class="line">        <span class="keyword">return</span> Qry(rc, Mid+<span class="number">1</span>, R, k);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> lc</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> rc</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Graph &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt, to; &#125; edges[MAXN];</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], eidx, size[MAXN];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="keyword">sizeof</span> head), eidx = <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to)</span> </span>&#123;</span><br><span class="line">        edges[++eidx] = (Edge)&#123; head[from], to &#125;, head[from] = eidx;</span><br><span class="line">        size[from] += size[to];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// pre done</span></span><br><span class="line">        init();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) size[i] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i; --i) AddEdge(<span class="built_in">floor</span>(i / K), i);</span><br><span class="line">        <span class="comment">// solve</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = head[<span class="number">0</span>]; ~i; i = edges[i].nxt)</span><br><span class="line">            v = edges[i].to, SGT::Mdy(<span class="number">1</span>, <span class="number">1</span>, n, v, size[v]);</span><br><span class="line">        sort(A+<span class="number">1</span>, A+<span class="number">1</span>+n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> L = <span class="number">1</span>; L &lt;= n; ++L) &#123;</span><br><span class="line">            <span class="keyword">int</span> R = L;</span><br><span class="line">            <span class="keyword">while</span> (R &lt; n &amp;&amp; A[R+<span class="number">1</span>] == A[L]) ++R;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = R - L + <span class="number">1</span>; j; --j) &#123;</span><br><span class="line">                <span class="keyword">int</span> u = SGT::Qry(<span class="number">1</span>, <span class="number">1</span>, n, j);</span><br><span class="line">                Ans[u] = A[L], SGT::Mdy(<span class="number">1</span>, <span class="number">1</span>, n, u, -size[u]);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> v, i = head[u]; ~i; i = edges[i].nxt)</span><br><span class="line">                    v = edges[i].to, SGT::Mdy(<span class="number">1</span>, <span class="number">1</span>, n, v, size[v]);</span><br><span class="line">            &#125;</span><br><span class="line">            L = R;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// output</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) <span class="built_in">printf</span>(<span class="string">"%d%c"</span>, Ans[i], <span class="string">" \n"</span>[i == n]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%lf"</span>, &amp;n, &amp;K);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) read(A[i]);</span><br><span class="line">    Graph::solve();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€Œä¹çœè”è€ƒ-2018ã€ç§˜å¯†è¢­å‡»"><a href="#ã€Œä¹çœè”è€ƒ-2018ã€ç§˜å¯†è¢­å‡»" class="headerlink" title="ã€Œä¹çœè”è€ƒ 2018ã€ç§˜å¯†è¢­å‡»"></a>ã€Œä¹çœè”è€ƒ 2018ã€ç§˜å¯†è¢­å‡»</h3><h4 id="é¢˜ç›®é“¾æ¥-2"><a href="#é¢˜ç›®é“¾æ¥-2" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2473" target="_blank" rel="noopener">https://loj.ac/problem/2473</a></li></ul><h4 id="è§£é¢˜æ€è·¯-2"><a href="#è§£é¢˜æ€è·¯-2" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p><del>é¦–å…ˆ, æœ‰æ­£è§£ â€œ<a href="https://zhang-rq.github.io/2018/05/04/%E4%B9%9D%E7%9C%81%E8%81%94%E8%80%832018-%E7%A7%98%E5%AF%86%E8%A2%AD%E5%87%BBCoaT/" target="_blank" rel="noopener">çº¿æ®µæ ‘åˆå¹¶, æ‹‰æ ¼æœ—æ—¥æ’å€¼, ç”Ÿæˆå‡½æ•°, ä»¥åŠæ•´ä½“ DP</a>â€œ.</del></p><p>è€ƒè™‘åˆ°æœ¬é¢˜æ—¶é™ 5s, ä»¥åŠæ­£è§£ç¹æ‚å¸¸æ•°å¤§, äºæ˜¯æš´åŠ›ç¢¾æ ‡ç®—â€¦</p><p>æšä¸¾ Access Globe æ‰€æ“æ§å£«å…µæ½œå…¥çš„åŸå¸‚ $u$, è€ƒè™‘æ½œå…¥ $u$ çš„æ–¹æ¡ˆæ•°.</p><p>å¦‚æœèŠ‚ç‚¹ $u$ å¯ä»¥å¯¹ç­”æ¡ˆäº§ç”Ÿè´¡çŒ®, é‚£ä¹ˆåŒ…å« $u$ çš„è¿é€šå—å†…ä¸€å®šæœ‰ $k-1$ ä¸ªæ»¡è¶³ $d_i &gt; d_u$ çš„èŠ‚ç‚¹. æŠŠæƒå€¼å°äº $d_u$ çš„èŠ‚ç‚¹å¤§å°æ ‡è®°ä¸º $0$, æŠŠæƒå€¼å¤§äº $d_u$ çš„èŠ‚ç‚¹æ ‡è®°ä¸º $1$, åšä¸€ä¸ªç±»ä¼¼äºæ ‘å½¢èƒŒåŒ…çš„ DP å³å¯.</p><p>é‚£ä¹ˆæƒå€¼ç­‰äº $d_u$ çš„å‘¢? ä¸ºé¿å…å¯¹æŸä¸ªèŠ‚ç‚¹é‡å¤è®¡ç®—, åœ¨æƒå€¼ç›¸ç­‰çš„æ—¶å€™, ä»…è€ƒè™‘ç¼–å·å¤§äºç­‰äº (åˆ«å¿˜äº†è‡ªå·±) $u$ çš„èŠ‚ç‚¹.</p><p>å…·ä½“åœ°è¯´, è®¾ $f(i, j)$ è¡¨ç¤ºæ·±åº¦æœ€å°èŠ‚ç‚¹ä¸º $i$, å¤§å°å’Œä¸º $j$ çš„è¿é€šå—ä¸ªæ•°.</p><p>æšä¸¾æ¯æ¡è¾¹ $(u,\ v)$, è®¾ $g(i)$ è¡¨ç¤ºé€‰æ‹© $u$ å…¶ä½™èŠ‚ç‚¹, ä»¥åŠ $v$ çš„å­æ ‘å†…èŠ‚ç‚¹, å¤§å°æ€»å’Œä¸º $i$ çš„è¿é€šå—ä¸ªæ•°, æ˜¾ç„¶è½¬ç§»æ˜¯ä¸€ä¸ªå·ç§¯çš„å½¢å¼, æœ€åæŠŠ $g(i)$ ç´¯åŠ åˆ° $f(u, i)$ ä¸Šå°±å¥½äº†.</p><p>ä»¥åŠä¸€äº›å¡å¸¸çš„æ–¹æ³•.</p><ol><li>ä½¿ç”¨ SDOI 2017 è‹¹æœæ ‘ åŒæ ·çš„æŠ€å·§, DP æ•°ç»„ $f$ å¼€æˆä¸€ç»´, å‡å°‘ cache miss.</li><li>è½¬ç§»æ•°ç»„ $g$ ä½¿ç”¨ <code>long long</code>, å‡å°‘å–æ¨¡æ¬¡æ•°.</li><li>è€ƒè™‘åˆ°æ ‘æ˜¯ä¸€ä¸ªç¨€ç–å›¾, äºæ˜¯ä½¿ç”¨ <code>vector</code> å­˜å›¾, ç›¸æ¯”æ‰‹å†™é“¾è¡¨è®¿é—®åŠ å¿«.</li></ol><p><del>ç„¶åæ²¡äº†, éš¾é“è¦æŠŠ <code>g</code> çš„è½¬ç§»ç”¨ MTT ä¼˜åŒ–?</del></p><p>æ—¶é—´å¤æ‚åº¦ $O(nk(n-k))$.</p><p><del>å¦‚æœæœ‰æœºä¼š, æˆ‘ä¸€å®šä¼šå»å­¦æ­£è§£</del></p><h4 id="ä»£ç å®ç°-2"><a href="#ä»£ç å®ç°-2" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2473</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1675</span>, P = <span class="number">64123</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, K, W, T, M;</span><br><span class="line">LL g[MAXN];</span><br><span class="line"><span class="keyword">int</span> A[MAXN], V[MAXN], f[MAXN * MAXN], size[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; G[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(f + u * M, <span class="number">0</span>, T);</span><br><span class="line">    f[u * M + V[u]] = <span class="number">1</span>, size[u] = V[u];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v: G[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v == fa) <span class="keyword">continue</span>;</span><br><span class="line">        dfs(v, u);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= K &amp;&amp; j &lt;= size[u]; ++j)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt;= K &amp;&amp; k &lt;= size[v]; ++k)</span><br><span class="line">                g[j + k] += <span class="number">1L</span>L * f[u * M + j] * f[v * M + k];</span><br><span class="line">        size[u] += size[v];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= K &amp;&amp; j &lt;= size[u]; ++j)</span><br><span class="line">            f[u * M + j] = (f[u * M + j] + g[j]) % P, g[j] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n), read(K), read(W);</span><br><span class="line">    M = K + <span class="number">1</span>, T = M * <span class="keyword">sizeof</span> (<span class="keyword">int</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) read(A[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> u, v, i = <span class="number">1</span>; i &lt; n; ++i)</span><br><span class="line">        read(u), read(v), G[u].push_back(v), G[v].push_back(u);</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> cnt, u = <span class="number">1</span>; u &lt;= n; ++u) &#123;</span><br><span class="line">        cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            V[i] = (A[i] &gt; A[u] || (A[i] == A[u] &amp;&amp; i &gt;= u)), cnt += V[i];</span><br><span class="line">        <span class="keyword">if</span> (cnt &lt; K) <span class="keyword">continue</span>;</span><br><span class="line">        dfs(u, <span class="number">0</span>), ans = (ans + A[u] * f[u * M + K] % P) % P;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€Œä¹çœè”è€ƒ-2018ã€åŠˆé…"><a href="#ã€Œä¹çœè”è€ƒ-2018ã€åŠˆé…" class="headerlink" title="ã€Œä¹çœè”è€ƒ 2018ã€åŠˆé…"></a>ã€Œä¹çœè”è€ƒ 2018ã€åŠˆé…</h3><h4 id="é¢˜ç›®é“¾æ¥-3"><a href="#é¢˜ç›®é“¾æ¥-3" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2477" target="_blank" rel="noopener">https://loj.ac/problem/2477</a></li></ul><h4 id="è§£é¢˜æ€è·¯-3"><a href="#è§£é¢˜æ€è·¯-3" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>å®¹æ˜“å‘ç°, é¢˜ç›®è¦æ±‚æˆ‘ä»¬åšçš„å°±æ˜¯ä¸€ä¸ªäºŒåˆ†å›¾åŒ¹é…. è€ƒè™‘ç”¨ç½‘ç»œæµè§£å†³è¿™ä¸ªé—®é¢˜.</p><p>å¯¹äºç¬¬ä¸€é—®, ä» $1$ åˆ° $n$ ä¾æ¬¡è€ƒè™‘æ¯ä¸ªé€‰æ‰‹ $i$ çš„åŒ¹é…æƒ…å†µ.</p><p>å¦‚æœåªæœ‰ä¸€ä½é€‰æ‰‹ $i$, é‚£ä¹ˆ</p><ul><li>æ–°å»ºæºæ±‡ $S$, $T$, å…¶ä¸­ $S$ å¯¹é€‰æ‰‹ $i$ è¿è¾¹, å®¹é‡ä¸º $1$; æ¯ä½å¯¼å¸ˆ $j$ å‘ $T$ è¿è¾¹, å®¹é‡ä¸º $b_j$.</li><li>æšä¸¾é€‰æ‰‹å¿—æ„¿, $i$ å‘è¯¥æ¡£å¿—æ„¿å¯¼å¸ˆ $j$ è¿è¾¹, å®¹é‡ä¸º $1$.<ul><li>å¦‚æœæ­¤æ—¶å­˜åœ¨å¢å¹¿è·¯, é‚£ä¹ˆè¯¥é€‰æ‰‹è¢«è¯¥æ¡£å¿—æ„¿å½•å–</li><li>å¦åˆ™ç»§ç»­æšä¸¾å¿—æ„¿, ç›´åˆ°é€‰æ‰‹è¢«å½•å– / å‡ºå±€</li></ul></li></ul><p>è€ƒè™‘å…¶ä»–é€‰æ‰‹çš„å½±å“. ç”±å½•å–æ–¹æ¡ˆçš„æœ€ä¼˜æ€§å¯çŸ¥, åªæœ‰æ’åæ¯” $i$ é å‰çš„é€‰æ‰‹å¯¹ $i$ æœ‰å½±å“, é‚£ä¹ˆæ¯ä½é€‰æ‰‹ç›´æ¥åœ¨ä¸Šä¸€ä½é€‰æ‰‹çš„æ®‹é‡ç½‘ç»œä¸Šå»ºè¾¹å³å¯.</p><p>æœªè¢«æšä¸¾åˆ°çš„å¿—æ„¿å½•å–æ—¶, éœ€è¦åŠæ—¶æŠŠæ­¤æ¡£å¿—æ„¿æ‰€å»ºçš„è¾¹å›é€€æ‰, ä»¥é¿å…å¤šå‡ºç”¨ä¸åˆ°çš„åºŸè¾¹, ä»è€Œå½±å“æ—¶é—´å¤æ‚åº¦çš„æ­£ç¡®æ€§â€¦</p><p>å¯¹äºç¬¬äºŒé—®, å¯ä»¥å‘ç°ç­”æ¡ˆå¯ä»¥äºŒåˆ† â€” å¦‚æœé€‰æ‰‹åˆ°äº†ç¬¬ $1$ å, è¿˜ä¸èƒ½è¾¾åˆ°è‡ªå·±çš„è¦æ±‚, é‚£è‚¯å®šä¼šæ²®ä¸§äº†.</p><p>æˆ‘ä»¬äºŒåˆ†ä¸€ä¸ªç­”æ¡ˆ $x$, è¡¨ç¤ºé€‰æ‰‹ $i$ ä¸æ²®ä¸§æ—¶çš„ <strong>æœ€å°æ’å</strong>. <code>check</code> çš„æ—¶å€™å‰ $x-1$ åé€‰æ‰‹çš„å½•å–æƒ…å†µå¹¶ä¸ä¼šæ”¹å˜, å†æ¬¡åŸºç¡€ä¸ŠåŠ å…¥é€‰æ‰‹ $i$ çš„å‰ $s_i$ ä¸ªå¿—æ„¿, åˆ¤æ–­æ–°å›¾æ˜¯å¦å­˜åœ¨å¢å¹¿è·¯å³å¯.</p><p>æ¯æ¬¡éƒ½å»ºä¸€æ¬¡æ–°å›¾, å¹¶æŠŠå‰ $x-1$ åé€‰æ‰‹åŒ¹é…å¥½æœ‰äº›éº»çƒ¦, æ—¶é—´å¤æ‚åº¦è¿˜å¾ˆé«˜. è€ƒè™‘åˆ°è§£å†³ç¬¬ä¸€é—®æ—¶, å·²ç»æŠŠè¿™äº›åŒ¹é…æ±‚è¿‡ä¸€éäº†, æ‰€ä»¥è®°å½•é€‰æ‰‹å½•å–æƒ…å†µçš„å‰ç¼€å›¾, æ¯æ¬¡ <code>check</code> è°ƒç”¨å³å¯. å› ä¸ºç‚¹æ•°å¾ˆå°, æ‰€ä»¥å¯ä»¥ä¿è¯æ¯æ¬¡æš´åŠ›å¤åˆ¶çš„å¤æ‚åº¦.</p><p>æ—¶é—´å¤æ‚åº¦å¤§æ¦‚æ˜¯ $O(\ T(n^2m + n^2 \log n)\ )$?</p><h4 id="ä»£ç å®ç°-3"><a href="#ä»£ç å®ç°-3" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p>ç”±äºè¿™é“é¢˜çš„ç‰¹æ®Šæ€§, Dinic å½“å‰å¼§ä¼˜åŒ–å¹¶ä¸é€‚ç”¨.</p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2477</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">205</span>, MAXV = MAXN &lt;&lt; <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, C, S, T;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; A[MAXN][MAXN];</span><br><span class="line"><span class="keyword">int</span> Ans1[MAXN], Ans2[MAXN], B[MAXN], s[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> to, flow, cap;</span><br><span class="line">    Edge() &#123; &#125;</span><br><span class="line">    Edge(<span class="keyword">int</span> _v, <span class="keyword">int</span> _c): to(_v), cap(_c) &#123; flow = <span class="number">0</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Graph</span> &#123;</span></span><br><span class="line">    <span class="built_in">vector</span>&lt;Edge&gt; edges;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; G[MAXV];</span><br><span class="line">    <span class="keyword">int</span> depth[MAXV], vis[MAXV], Time;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        edges.clear();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n + m + <span class="number">1</span>; ++i) G[i].clear();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to, <span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">        edges.push_back(Edge(to, c)), edges.push_back(Edge(from, <span class="number">0</span>));</span><br><span class="line">        <span class="keyword">int</span> eidx = edges.size() - <span class="number">1</span>;</span><br><span class="line">        G[from].push_back(eidx - <span class="number">1</span>), G[to].push_back(eidx);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">DelEdge</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to)</span> </span>&#123;</span><br><span class="line">        G[from].pop_back(), G[to].pop_back();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">BFS</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; Q;</span><br><span class="line">        Q.push(S), vis[S] = ++Time, depth[S] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!Q.empty()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = Q.front(); Q.pop();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; G[u].size(); ++i) &#123;</span><br><span class="line">                <span class="keyword">const</span> Edge&amp; e = edges[G[u][i]];</span><br><span class="line">                <span class="keyword">if</span> (vis[e.to] != Time &amp;&amp; e.cap &gt; e.flow)</span><br><span class="line">                    vis[e.to] = Time, depth[e.to] = depth[u] + <span class="number">1</span>, Q.push(e.to);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> vis[T] == Time;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == T || !a) <span class="keyword">return</span> a;</span><br><span class="line">        <span class="keyword">int</span> f, flow = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; G[u].size(); ++i) &#123;</span><br><span class="line">            Edge&amp; e = edges[G[u][i]];</span><br><span class="line">            <span class="keyword">if</span> (depth[e.to] == depth[u] + <span class="number">1</span> &amp;&amp; (f = DFS(e.to, min(a, e.cap-e.flow))) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                flow += f, a -= f, e.flow += f, edges[G[u][i]^<span class="number">1</span>].flow -= f;</span><br><span class="line">                <span class="keyword">if</span> (!a) <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; G[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> Mid, <span class="keyword">const</span> <span class="keyword">int</span>&amp; u)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> Graph now;</span><br><span class="line">    now = G[Mid - <span class="number">1</span>], now.AddEdge(S, u, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= s[u]; ++j)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">size_t</span> k = <span class="number">0</span>; k &lt; A[u][j].size(); ++k) now.AddEdge(u, n + A[u][j][k], <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> now.BFS();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> Ti; read(Ti), read(C);</span><br><span class="line">    <span class="keyword">while</span> (Ti--) &#123;</span><br><span class="line">        read(n), read(m);</span><br><span class="line">        <span class="comment">// init</span></span><br><span class="line">        S = <span class="number">0</span>, T = n + m + <span class="number">1</span>;</span><br><span class="line">        G[<span class="number">0</span>].init();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= m; ++j) A[i][j].clear();</span><br><span class="line">        <span class="comment">// input</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) read(B[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> x, i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= m; ++j) read(x), A[i][x].push_back(j);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) read(s[i]);</span><br><span class="line">        <span class="comment">// solve</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) G[<span class="number">0</span>].AddEdge(n + i, T, B[i]);</span><br><span class="line">        <span class="comment">// Q1</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            Ans1[i] = <span class="number">0</span>;</span><br><span class="line">            G[i] = G[i - <span class="number">1</span>], G[i].AddEdge(S, i, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= m; ++j) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">size_t</span> k = <span class="number">0</span>; k &lt; A[i][j].size(); ++k) G[i].AddEdge(i, n + A[i][j][k], <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span> (G[i].BFS()) &#123; G[i].DFS(S, INF), Ans1[i] = j; <span class="keyword">break</span>; &#125;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">size_t</span> k = <span class="number">0</span>; k &lt; A[i][j].size(); ++k) G[i].DelEdge(i, n + A[i][j][k]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!Ans1[i]) Ans1[i] = m + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Q2</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            Ans2[i] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (s[i] &gt;= Ans1[i]) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> L = <span class="number">1</span>, R = i - <span class="number">1</span>, ans = <span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">while</span> (L &lt;= R) &#123;</span><br><span class="line">                <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">if</span> (check(Mid, i)) ans = Mid, L = Mid + <span class="number">1</span>; <span class="keyword">else</span> R = Mid - <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Ans2[i] = (ans == <span class="number">-1</span>)? i: i - ans;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// output</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) <span class="built_in">printf</span>(<span class="string">"%d%c"</span>, Ans1[i], <span class="string">" \n"</span>[i == n]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) <span class="built_in">printf</span>(<span class="string">"%d%c"</span>, Ans2[i], <span class="string">" \n"</span>[i == n]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€Œä¹çœè”è€ƒ-2018ã€æ—å…‹å¡ç‰¹æ ‘"><a href="#ã€Œä¹çœè”è€ƒ-2018ã€æ—å…‹å¡ç‰¹æ ‘" class="headerlink" title="ã€Œä¹çœè”è€ƒ 2018ã€æ—å…‹å¡ç‰¹æ ‘"></a>ã€Œä¹çœè”è€ƒ 2018ã€æ—å…‹å¡ç‰¹æ ‘</h3><p>äººç”Ÿç¬¬ä¸€é“ DP å‡¸ä¼˜åŒ–â€¦</p><h4 id="é¢˜ç›®é“¾æ¥-4"><a href="#é¢˜ç›®é“¾æ¥-4" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2478" target="_blank" rel="noopener">https://loj.ac/problem/2478</a></li></ul><h4 id="è§£é¢˜æ€è·¯-4"><a href="#è§£é¢˜æ€è·¯-4" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>é¦–å…ˆå¯¹é¢˜æ„åšä¸€æ­¥è½¬åŒ–, æ‰€æ±‚å³ä¸ºé€‰æ‹© $K+1$ æ¡ä¸ç›¸äº¤çš„é“¾, æ‰€å¾—çš„æœ€å¤§è¾¹æƒå’Œ.</p><p>æ­¤æ—¶æœ‰ä¸€ä¸ªæœ´ç´ çš„ DP, è®¾ $f(i, j, k)$ è¡¨ç¤ºä»¥èŠ‚ç‚¹ $i$ ä¸ºæ ¹çš„å­æ ‘å†…, é€‰æ‹© $j$ æ¡é“¾, ä¸”èŠ‚ç‚¹ $i$ åº¦æ•°ä¸º $k \in \{ 0,\ 1,\ 2 \}$ çš„æœ€å¤§è¾¹æƒå’Œ. (åº¦æ•°ä¸º $0$ çš„æƒ…å†µå°±æ˜¯å•ç‹¬ä¸€ä¸ªèŠ‚ç‚¹è¢«è§†ä½œä¸€æ¡é“¾äº†)</p><p>æ­¤æ—¶æšä¸¾å„¿å­å¤§åŠ›è®¨è®ºå³å¯åˆ—å‡ºè½¬ç§»â€¦ è½¬ç§»ç›¸å½“ç¹ç = =</p><p>è¿™ä¸ª DP çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(nk^2)$, çœ‹èµ·æ¥æ²¡æœ‰ä»€ä¹ˆä¼˜åŒ–çš„ä½™åœ°äº†, çœŸçš„æ˜¯è¿™æ ·å—?</p><p>é€šè¿‡æŸäº›ç¥ç§˜æ‰‹æ®µå¯ä»¥å¾—çŸ¥, é€‰æ‹© $K+1$ æ¡é“¾çš„æœ€ä¼˜è§£æ˜¯ä¸Šå‡¸çš„. æ¢å¥è¯è¯´, ä»¥é€‰æ‹©é“¾æ•° $k$ ä¸ºæ¨ªåæ ‡, æœ€å¤§è¾¹æƒå’Œä¸ºçºµåæ ‡, å¾—åˆ°çš„å‡½æ•°å›¾åƒæ˜¯ä¸Šå‡¸çš„ (å…¶å®å›¾åƒæ˜¯ä¸ªç‚¹é›†â€¦ æ„Ÿæ€§ç†è§£). å†è€…å°±æ˜¯å¯¼å‡½æ•°å•è°ƒ / å·®åˆ†å•è°ƒäº†â€¦</p><p>æ„Ÿæ€§ç†è§£ä¸€ä¸‹è¿™ä¸ªä¸Šå‡¸, åˆšå¼€å§‹é€‰æ‹©ä¸€äº›è¾¹ä½œä¸ºé“¾, å¯ä»¥æŠŠæŸäº›å¯¹ç­”æ¡ˆè´¡çŒ®è¾ƒå°æƒ…å†µçš„é¿å¼€. å½“è¦æ±‚é€‰æ‹©çš„é“¾æ•°é€æ¸å¢åŠ æ—¶, è¿™ä¸ª â€œé¿å¼€â€ çš„åº”ç”¨èŒƒå›´å°±é€æ¸ç¼©å°, è€Œä¸å¾—ä¸å‡å°ç­”æ¡ˆæ¥æ»¡è¶³é™åˆ¶.</p><p>æ¥ç€è€ƒè™‘ DP å‡¸ä¼˜åŒ–.</p><p>æˆ‘ä»¬äºŒåˆ†ä¸€ä¸ªæƒå€¼ $s$, å¹¶é™å®šæ¯æ–°å¢ä¸€æ¡é“¾, å°±åœ¨æŠŠè¾¹æƒå’Œå‡å» $s$. æ­¤æ—¶ä¸é™å®šé€‰æ‹©å¤šå°‘æ¡é“¾.</p><p>ä¸¢æ‰å¯¹é“¾ä¸ªæ•°çš„é™åˆ¶, å®¹æ˜“å¾—åˆ°ä¸€ä¸ª $O(n)$ çš„ DP:</p><p>è®¾ $f(i, j)$ è¡¨ç¤ºä»¥èŠ‚ç‚¹ $i$ ä¸ºæ ¹çš„å­æ ‘å†…, ä¸”èŠ‚ç‚¹ $i$ åº¦æ•°ä¸º $j \in \{ 0,\ 1,\ 2 \}$ çš„æœ€å¤§è¾¹æƒå’Œ, ä»¥åŠè¾¾åˆ°è¯¥è¾¹æƒå’Œæ‰€ç”¨çš„æœ€å°‘é“¾æ•°.</p><p>é¦–å…ˆæœ‰åˆå€¼</p><p>$$f(u, 0) = 0,\ f(u, 1) = 0 $$</p><p>$$f(u, 2) = \max\{ 0, -s \}$$</p><p>è®°è¾¹ $(u, v)$ è¾¹æƒä¸º $w(u, v)$, é‚£ä¹ˆè½¬ç§»ä¸º</p><p>$$f(u, 0) = \max\{ f(u, 0),\ f(u, 0) + f(v, 0) \}$$</p><p>$$f(u, 1) = \max\{ f(u, 1),\ f(u, 1) + f(v, 0),\ f(u, 0) + f(v, 1) + w(u, v) \}$$</p><p>$$f(u, 2) = \max\{ f(u, 2),\ f(u, 2) + f(v, 0),\ f(u, 1) + f(v, 1) + w(u, v) - s \}$$</p><p>ä»¥åŠä¸€ä¸ªèŠ‚ç‚¹ DP å®Œå, è¿˜éœ€è¦åˆå¹¶ç­”æ¡ˆ.</p><p>$$f(u, 0) = \max\{ f(u, 0),\ f(u, 1) - s,\ f(u, 2) \}$$</p><p>è¿™æ ·å°±èƒ½è§£é‡Šé€šäº†â€¦ åªç”¨åº¦æ•°è€ƒè™‘ <del>ä¼šå‘ç°è§£é‡Šä¸é€š</del></p><p>è¿™ä¸€æ­¥çš„ DP å°±ç›¸å½“äºæ‹¿ä¸€æ¡æ–œç‡ä¸º $s$ çš„ç›´çº¿å»åˆ‡è¿™ä¸ªå›¾åƒ, å¹¶å¾—åˆ°å‡¸åŒ…ä¸Šä¸€ç‚¹ $(k,\ f(1, 0))$. æ¥ç€æ ¹æ® $k$ å’Œ $K+1$ çš„å…³ç³»æ¥è°ƒæ•´æ–œç‡, ç›´åˆ°åŒå‡¸åŒ…äº¤ç‚¹ä¸º $(K+1,\ f(1, 0))$.</p><p>æ—¶é—´å¤æ‚åº¦ $O(n \log w)$. å…¶ä¸­ $w$ ä¸ºç­”æ¡ˆä¸Šä¸‹ç•Œä¹‹å·®.</p><h4 id="ä»£ç å®ç°-4"><a href="#ä»£ç å®ç°-4" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2478</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">3e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Item</span> &#123;</span></span><br><span class="line">    LL a; <span class="keyword">int</span> b;</span><br><span class="line">    Item(LL _a = <span class="number">0</span>, <span class="keyword">int</span> _b = <span class="number">0</span>): a(_a), b(_b) &#123; &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Item&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a &lt; rhs.a || (a == rhs.a &amp;&amp; b &gt; rhs.b);</span><br><span class="line">    &#125;</span><br><span class="line">    Item <span class="keyword">operator</span> + (<span class="keyword">const</span> Item&amp; rhs) <span class="keyword">const</span> &#123; <span class="keyword">return</span> Item(a + rhs.a, b + rhs.b); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, K;</span><br><span class="line">Item f[MAXN][<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Graph &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt, to, w; &#125; edges[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], eidx;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="keyword">sizeof</span> head), eidx = <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to, <span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">        edges[++eidx] = (Edge)&#123; head[from], to, w &#125;, head[from] = eidx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa, <span class="keyword">const</span> LL&amp; s)</span> </span>&#123;</span><br><span class="line">        f[u][<span class="number">0</span>] = f[u][<span class="number">1</span>] = Item(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        f[u][<span class="number">2</span>] = max(Item(<span class="number">0</span>, <span class="number">0</span>), Item(-s, <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = head[u]; ~i; i = edges[i].nxt) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((v = edges[i].to) == fa) <span class="keyword">continue</span>;</span><br><span class="line">            dfs(v, u, s);</span><br><span class="line">            f[u][<span class="number">2</span>] = max(f[u][<span class="number">2</span>], max(f[u][<span class="number">2</span>] + f[v][<span class="number">0</span>], f[u][<span class="number">1</span>] + f[v][<span class="number">1</span>] + Item(edges[i].w - s, <span class="number">1</span>)));</span><br><span class="line">            f[u][<span class="number">1</span>] = max(f[u][<span class="number">1</span>], max(f[u][<span class="number">1</span>] + f[v][<span class="number">0</span>], f[u][<span class="number">0</span>] + f[v][<span class="number">1</span>] + Item(edges[i].w)));</span><br><span class="line">            f[u][<span class="number">0</span>] = max(f[u][<span class="number">0</span>], f[u][<span class="number">0</span>] + f[v][<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ­¤å¤„åˆå¹¶ç­”æ¡ˆ</span></span><br><span class="line">        f[u][<span class="number">0</span>] = max(f[u][<span class="number">0</span>], max(f[u][<span class="number">1</span>] + Item(-s, <span class="number">1</span>), f[u][<span class="number">2</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// init</span></span><br><span class="line">    Graph::init();</span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n), read(K), ++K;</span><br><span class="line">    LL L = <span class="number">0</span>, R = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> u, v, w, i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        read(u), read(v), read(w);</span><br><span class="line">        L = min(L, <span class="number">-1L</span>L * w), R += max(<span class="number">0</span>, w);</span><br><span class="line">        Graph::AddEdge(u, v, w), Graph::AddEdge(v, u, w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    LL ans = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">while</span> (L &lt;= R) &#123;</span><br><span class="line">        LL Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        Graph::dfs(<span class="number">1</span>, <span class="number">0</span>, Mid);</span><br><span class="line">        <span class="keyword">if</span> (f[<span class="number">1</span>][<span class="number">0</span>].b &lt;= K) ans = Mid, R = Mid - <span class="number">1</span>; <span class="keyword">else</span> L = Mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Graph::dfs(<span class="number">1</span>, <span class="number">0</span>, ans);</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, f[<span class="number">1</span>][<span class="number">0</span>].a + ans * K);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€Œä¹çœè”è€ƒ-2018ã€åˆ¶èƒ¡çªœ"><a href="#ã€Œä¹çœè”è€ƒ-2018ã€åˆ¶èƒ¡çªœ" class="headerlink" title="ã€Œä¹çœè”è€ƒ 2018ã€åˆ¶èƒ¡çªœ"></a>ã€Œä¹çœè”è€ƒ 2018ã€åˆ¶èƒ¡çªœ</h3><h4 id="é¢˜ç›®é“¾æ¥-5"><a href="#é¢˜ç›®é“¾æ¥-5" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2479" target="_blank" rel="noopener">https://loj.ac/problem/2479</a></li></ul><h4 id="è§£é¢˜æ€è·¯-5"><a href="#è§£é¢˜æ€è·¯-5" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>æœ‰ç€å¾ˆå¤æ‚çš„åˆ†ç±»è®¨è®º, ä»¥åŠç›¸å½“ç¹ççš„ç»†èŠ‚â€¦</p><p><del>è¿˜æ˜¯ <a href="http://labelray.top/2019/03/01/%E4%B9%9D%E7%9C%81%E8%81%94%E8%80%83-2018-%E5%88%B6%E8%83%A1%E7%AA%9C/" target="_blank" rel="noopener">Labelray</a> è®²åœ°å¥½å“‡.</del></p><p>è¿˜æ˜¯æ‹¿ Labelray çš„é¢˜è§£å†å±•å¼€è¯´ä¸€ç‚¹ä¸œè¥¿.</p><p>å¯¹äº Case 2.1, æˆ‘ä¸ªäººè®¤ä¸ºæœ€ç»ˆçš„ç­”æ¡ˆåº”ä¸º</p><p>$$\sum_{i=1}^{n-1} (r_{i+1} - l_n) \cdot (l_{i+1} - l_i)$$</p><p>åŒ–ç®€ä¹‹åå¯ä»¥å¾—åˆ°</p><p>$$\sum_{i=1}^{n-1} r_{i+1} (r_{i+1}-r_i) - l_n \cdot \sum_{i=1}^{n-1} (r_{i+1} - r_i) $$</p><p>ä»¥åŠ Case 3, åœ¨æ»¡è¶³é™åˆ¶ $l_n &lt; r_{i+1} &lt; r_1 + len - 1$ æ—¶, ç›´æ¥åœ¨çº¿æ®µæ ‘ä¸ŠæŸ¥è¯¢åŒºé—´ $(l_n,\ r_1 + len - 1]$, åˆ™ä¼šç¼ºå¤±å·¦è¾¹ç•Œ.</p><p>å…·ä½“åœ°è¯´, ç”±äºä½¿ç”¨å³ç«¯ç‚¹ $r_i$ çš„å·®ä»£æ›¿å·¦ç«¯ç‚¹ $l_i$ çš„å·®, åœ¨è®¡ç®—æ—¶ä¼šæ¼æ‰ $r_i &lt; l_n &lt; r_{i+1}$ çš„æƒ…å†µ, ä½†æ­¤æ—¶å¯¹åº”å·¦è¾¹ä¸€åˆ€åˆ‡åœ¨ $(l_i, l_{i+1})$ çš„æƒ…å†µä»ç„¶åˆæ³•. äºæ˜¯åœ¨ç»Ÿè®¡ä¸­éœ€è¦åŠ å…¥ $[1,\ l_n]$ çš„æœ€å¤§ç«¯ç‚¹, åŒçº¿æ®µæ ‘æŸ¥è¯¢ç»“æœåˆå¹¶å³å¯.</p><p>æ—¶é—´å¤æ‚åº¦ $O(n \log n + q \log n)$.</p><h4 id="ä»£ç å®ç°-5"><a href="#ä»£ç å®ç°-5" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2479</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">5</span>, MAXM = <span class="number">2e5</span> + <span class="number">5</span>, LOG = <span class="number">19</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> LL <span class="title">C2</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123; <span class="keyword">return</span> <span class="number">1L</span>L * n * (n<span class="number">-1</span>) / <span class="number">2</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, q;</span><br><span class="line"><span class="keyword">char</span> S[MAXN];</span><br><span class="line"><span class="keyword">int</span> rt[MAXM], pos[MAXN], pre[LOG][MAXM];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Data</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> mx, mn; LL s1, s2;</span><br><span class="line"></span><br><span class="line">    Data() &#123; mx = -MAXN, mn = MAXN, s1 = s2 = <span class="number">0</span>; &#125;</span><br><span class="line">    Data(<span class="keyword">int</span> _mx, <span class="keyword">int</span> _mn, LL _s1, LL _s2): mx(_mx), mn(_mn), s1(_s1), s2(_s2) &#123; &#125;</span><br><span class="line"></span><br><span class="line">    Data <span class="keyword">operator</span> + (<span class="keyword">const</span> Data&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (mx == -MAXN &amp;&amp; mn == MAXN) <span class="keyword">return</span> rhs;</span><br><span class="line">        <span class="keyword">if</span> (rhs.mx == -MAXN &amp;&amp; rhs.mn == MAXN) <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">return</span> Data(rhs.mx, mn, s1 + rhs.s1 + <span class="number">1L</span>L * rhs.mn * (rhs.mn - mx),</span><br><span class="line">                s2 + rhs.s2 + (rhs.mn - mx));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SGT &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> lc, rc; Data d;</span><br><span class="line">        Node() &#123; lc = rc = <span class="number">0</span>; d = Data(); &#125;</span><br><span class="line">    &#125; dat[MAXM &lt;&lt; <span class="number">5</span>];</span><br><span class="line">    <span class="keyword">int</span> nidx;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">maintain</span><span class="params">(<span class="keyword">int</span> nd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">int</span> &amp;lc = dat[nd].lc, &amp;rc = dat[nd].rc;</span><br><span class="line">        dat[nd].d = dat[lc].d + dat[rc].d;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; pos)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (L == R) <span class="keyword">return</span> <span class="keyword">void</span>( dat[nd].d.mn = dat[nd].d.mx = pos );</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (pos &lt;= Mid) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!dat[nd].lc) dat[nd].lc = ++nidx;</span><br><span class="line">            Mdy(dat[nd].lc, L, Mid, pos);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!dat[nd].rc) dat[nd].rc = ++nidx;</span><br><span class="line">            Mdy(dat[nd].rc, Mid+<span class="number">1</span>, R, pos);</span><br><span class="line">        &#125;</span><br><span class="line">        maintain(nd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Mrg</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!x || !y) <span class="keyword">return</span> x + y;</span><br><span class="line">        <span class="keyword">int</span> nd = ++nidx;</span><br><span class="line">        dat[nd].lc = Mrg(dat[x].lc, dat[y].lc);</span><br><span class="line">        dat[nd].rc = Mrg(dat[x].rc, dat[y].rc);</span><br><span class="line">        <span class="keyword">return</span> maintain(nd), nd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">Data <span class="title">Qry</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opL, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opR)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!nd) <span class="keyword">return</span> Data();</span><br><span class="line">        <span class="keyword">if</span> (opL &lt;= L &amp;&amp; R &lt;= opR) <span class="keyword">return</span> dat[nd].d;</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (opR &lt;= Mid) <span class="keyword">return</span> Qry(dat[nd].lc, L, Mid, opL, opR);</span><br><span class="line">        <span class="keyword">if</span> (opL &gt; Mid) <span class="keyword">return</span> Qry(dat[nd].rc, Mid+<span class="number">1</span>, R, opL, opR);</span><br><span class="line">        <span class="keyword">return</span> Qry(dat[nd].lc, L, Mid, opL, opR) + Qry(dat[nd].rc, Mid+<span class="number">1</span>, R, opL, opR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">LL <span class="title">Qry</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> lgt)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> r1 = dat[nd].d.mn, ln = dat[nd].d.mx - lgt + <span class="number">1</span>;</span><br><span class="line">        Data d = Qry(nd, <span class="number">1</span>, n, <span class="number">1</span>, ln);</span><br><span class="line">        LL ret = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// Case 1</span></span><br><span class="line">        <span class="keyword">if</span> (d.mx - lgt + <span class="number">1</span> &gt;= r1) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// Case 2</span></span><br><span class="line">        <span class="keyword">if</span> (r1 &gt; ln) &#123;</span><br><span class="line">            ret += dat[nd].d.s1 - <span class="number">1L</span>L * ln * dat[nd].d.s2;</span><br><span class="line">            ret += <span class="number">1L</span>L * (r1 - ln) * (n - lgt) + C2(r1 - ln);</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Case 3</span></span><br><span class="line">        <span class="keyword">if</span> (ln &lt; r1 + lgt - <span class="number">1</span>) &#123;</span><br><span class="line">            Data p = Data(d.mx, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>) + Qry(nd, <span class="number">1</span>, n, ln + <span class="number">1</span>, r1 + lgt - <span class="number">1</span>);</span><br><span class="line">            ret += p.s1 - <span class="number">1L</span>L * ln * p.s2;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> ri = Qry(nd, <span class="number">1</span>, n, <span class="number">1</span>, r1 + lgt - <span class="number">1</span>).mx, ri1 = Qry(nd, <span class="number">1</span>, n, r1 + lgt, n).mn;</span><br><span class="line">        <span class="keyword">if</span> (ri != -MAXN &amp;&amp; ri1 != MAXN) ret += max(<span class="number">0L</span>L, <span class="number">1L</span>L * (r1 - (ri-lgt+<span class="number">1</span>)) * (ri1 - ln));</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SAM &#123;</span><br><span class="line">    <span class="keyword">int</span> ch[MAXM][<span class="number">10</span>], len[MAXM], lnk[MAXM], nidx, last;</span><br><span class="line">    <span class="keyword">int</span> cnt[MAXM], idx[MAXM];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; nidx = last = <span class="number">1</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> val, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> nd = ++nidx, p = last;</span><br><span class="line">        len[nd] = len[last] + <span class="number">1</span>, SGT::Mdy(rt[nd] = ++SGT::nidx, <span class="number">1</span>, n, i);</span><br><span class="line">        <span class="keyword">while</span> (p &amp;&amp; !ch[p][val]) ch[p][val] = nd, p = lnk[p];</span><br><span class="line">        <span class="keyword">if</span> (!p) lnk[nd] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> q = ch[p][val];</span><br><span class="line">            <span class="keyword">if</span> (len[q] == len[p] + <span class="number">1</span>) lnk[nd] = q;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">int</span> nxt = ++nidx;</span><br><span class="line">                len[nxt] = len[p] + <span class="number">1</span>, lnk[nxt] = lnk[q];</span><br><span class="line">                <span class="built_in">memcpy</span>(ch[nxt], ch[q], <span class="keyword">sizeof</span> ch[nxt]);</span><br><span class="line">                <span class="keyword">while</span> (p &amp;&amp; ch[p][val] == q) ch[p][val] = nxt, p = lnk[p];</span><br><span class="line">                lnk[nd] = lnk[q] = nxt;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        last = nd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nidx; ++i) ++cnt[len[i]];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) cnt[i] += cnt[i<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nidx; ++i) idx[cnt[len[i]]--] = i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> u, i = nidx; i &gt; <span class="number">1</span>; --i)</span><br><span class="line">            u = idx[i], rt[lnk[u]] = SGT::Mrg(rt[lnk[u]], rt[u]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nidx; ++i) pre[<span class="number">0</span>][i] = lnk[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; LOG; ++j)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nidx; ++i)</span><br><span class="line">                pre[j][i] = pre[j<span class="number">-1</span>][pre[j<span class="number">-1</span>][i]];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Jump</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">const</span> <span class="keyword">int</span>&amp; lgt)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = LOG<span class="number">-1</span>; j &gt;= <span class="number">0</span>; --j)</span><br><span class="line">            <span class="keyword">if</span> (pre[j][u] &amp;&amp; len[pre[j][u]] &gt;= lgt) u = pre[j][u];</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">LL <span class="title">Qry</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; L, <span class="keyword">const</span> <span class="keyword">int</span>&amp; R)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> u = Jump(pos[R], R - L + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> SGT::Qry(rt[u], R - L + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// init</span></span><br><span class="line">    SAM::init();</span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d%s"</span>, &amp;n, &amp;q, S+<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        SAM::insert(S[i] - <span class="string">'0'</span>, i), pos[i] = SAM::last;</span><br><span class="line">    SAM::build();</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> L, R;</span><br><span class="line">        read(L), read(R);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, C2(n - <span class="number">1</span>) - SAM::Qry(L, R));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><hr>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;é«˜ä¸€ç©æ³¥å·´çš„æ—¶å€™é™ªç€å­¦é•¿åšè¿‡â€¦ ç„¶è€Œåªæ˜¯æš´åŠ›çš„å¿ å®é€‰æ‰‹.&lt;/p&gt;
&lt;p&gt;&lt;del&gt;ç»“æœç°åœ¨è¿˜æ˜¯æš´åŠ›çš„å¿ å®é€‰æ‰‹.&lt;/del&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="é¢˜è§£" scheme="https://depletedprism.github.io/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
  </entry>
  
  <entry>
    <title>AHOI / HNOI 2017 å¤§èµ</title>
    <link href="https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/AHOI-HNOI-2017-sol/"/>
    <id>https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/AHOI-HNOI-2017-sol/</id>
    <published>2020-03-10T12:17:51.000Z</published>
    <updated>2020-03-10T16:51:48.501Z</updated>
    
    <content type="html"><![CDATA[<hr><p>å¦‚æœè¯´ â€œæˆ‘åšäº†ä¸€å¥— AHOIâ€, ææ€•å’Œ â€œæˆ‘åšäº†ä¸€å¥— HNOIâ€ ç»™äººçš„æ„Ÿè§‰ä¸å¤ªä¸€æ ·â€¦</p><p>ä½†å…¶å®æ˜¯ä¸€æ ·çš„? <del>OI ä»€ä¹ˆæ—¶å€™èƒ½å®ç°åœ°åŸŸçš„å¹³è¡¡å•Š.</del> è¿™è¾ˆå­ä¸å¯èƒ½äº†.</p><a id="more"></a><p>å…¶å®ä¸å¦‚ SDOI R2 æ¯’ç˜¤ (</p><h3 id="ã€ŒAHOI-HNOI2017ã€å•æ—‹"><a href="#ã€ŒAHOI-HNOI2017ã€å•æ—‹" class="headerlink" title="ã€ŒAHOI / HNOI2017ã€å•æ—‹"></a>ã€ŒAHOI / HNOI2017ã€å•æ—‹</h3><blockquote><p>â€œé‚ªæ¶çš„ã€Œå¡ã€å¸¦ç€ä»–çš„é‚ªæ¶çš„ã€Œå¸¸æ•°ã€æ¥ä¼å›¾æ¯ç­ H å›½.â€</p></blockquote><p>å¯ä»¥è¯´æ˜¯å¾ˆå½¢è±¡äº†.</p><h4 id="é¢˜ç›®é“¾æ¥"><a href="#é¢˜ç›®é“¾æ¥" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2018" target="_blank" rel="noopener">https://loj.ac/problem/2018</a></li></ul><h4 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>è¿™æ˜¯ä¸€é“æ€§è´¨é¢˜.</p><p>æœ¬é¢˜æœ€é‡è¦çš„æ€§è´¨å°±æ˜¯, å¦‚æœæŠŠæŸä¸ªèŠ‚ç‚¹ $u$ â€œspalyâ€ åˆ°æ ¹, é‚£ä¹ˆæ•´æ£µäºŒå‰æœç´¢æ ‘çš„å½¢æ€ä¸ä¼šå‘ç”Ÿè¾ƒå¤§æ”¹å˜.</p><p>å…·ä½“åœ°è¯´, å‡è®¾å½“å‰è¦æŠŠæœ€å°å€¼å¯¹åº”èŠ‚ç‚¹ $u$ â€œspalyâ€ åˆ°æ ¹, å®é™…ä¸Šåªåšäº†è¿™å‡ ä¸ªæ“ä½œ:</p><ol><li>$u$ çš„å³å„¿å­æ¥åˆ° $u$ çˆ¶äº² $f$ çš„å·¦å„¿å­ä¸Š.</li><li>æŠŠ $u$ è®¾æˆæ ¹, ç„¶åæŠŠåŸæ¥çš„æ ¹æ¥åˆ° $u$ çš„å³å„¿å­ä¸Š.</li></ol><p>è€ƒè™‘è¿™ä¸ªè¿‡ç¨‹ä¸­çš„èŠ‚ç‚¹æ·±åº¦å˜åŒ–, å¯ä»¥å‘ç° $u$ çš„æ·±åº¦å˜ä¸º $1$, $u$ åŸæ¥çš„å³å„¿å­æ·±åº¦ä¸å˜, å…¶ä½™ç‚¹çš„æ·±åº¦ $+1$.</p><p>é‚£ä¹ˆå¯ä»¥ç”¨ BIT ç»´æŠ¤è¿™ä¸ªæ·±åº¦äº†.</p><p>æ—¢ç„¶å…³é”®ç äº’ä¸ç›¸åŒ, é‚£æˆ‘ä»¬ç›´æ¥æŠŠå…³é”®ç ç¦»æ•£åŒ–åçš„å€¼è§†ä½œèŠ‚ç‚¹ç¼–å·, è¿™æ ·å­æ ‘å†…ç¼–å·ä¸€å®šæ˜¯è¿ç»­çš„. å› ä¸ºæ“ä½œçš„ç‰¹æ®Šæ€§: åªé€‰æ‹©æœ€å¤§å€¼å’Œæœ€å°å€¼, æ‰€ä»¥ç›´æ¥ä¿®æ”¹åˆ° 1 / n å³å¯.</p><p>å†è€ƒè™‘æ’å…¥æ“ä½œæ€ä¹ˆå®ç°. </p><p>æ³¨æ„é“æ¯æ¬¡æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹ $u$, $u$ çš„çˆ¶äº² $f$ ä¸€å®šæ˜¯ $u$ çš„å‰é©± / åç»§ä¸­æ·±åº¦è¾ƒæ·±çš„ä¸€ä¸ª, ä½¿ç”¨ STL é‡Œçš„ <code>set</code> ç›´æ¥ç»´æŠ¤å³å¯.</p><p>æ—¶é—´å¤æ‚åº¦ $O(n\log n)$.</p><p><del>æ„Ÿè°¢è¿™é“é¢˜è®©æˆ‘çŸ¥é“ spaly å¤šä¹ˆè ¢â€¦</del></p><h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p>ä»£ç å®ç°ä¸­æœ‰ä¸€äº›ç®€å•çš„æŠ€å·§â€¦</p><p>è¯¸å¦‚é¢„å…ˆåœ¨ <code>set</code> ä¸­æ’å…¥ <code>0</code>, <code>n+1</code> ä»¥é¿å…è®¨è®º, ä»¥åŠåˆ©ç”¨å¹³è¡¡æ ‘æ—‹è½¬æ—¶çš„æŠ€å·§ç®€åŒ–ä»£ç .</p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2018</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">set</span>&lt;<span class="keyword">int</span>&gt;::iterator IT;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> nB, m, ans;</span><br><span class="line"><span class="keyword">int</span> Q[MAXN], A[MAXN], B[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> BIT &#123;</span><br><span class="line">    <span class="keyword">int</span> C[MAXN];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; x)</span> </span>&#123; <span class="keyword">return</span> x &amp; -x; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Qry</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; pos)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = pos; i; i -= lowbit(i)) ret += C[i];</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; pos, <span class="keyword">const</span> <span class="keyword">int</span>&amp; val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = pos; i &lt;= nB + <span class="number">1</span>; i += lowbit(i)) C[i] += val;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; L, <span class="keyword">const</span> <span class="keyword">int</span>&amp; R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; val)</span> </span>&#123;</span><br><span class="line">        Mdy(L, val), Mdy(R+<span class="number">1</span>, -val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¶å® spaly çš„åå­—åªæ˜¯æ¥å“—ä¼—å–å® çš„</span></span><br><span class="line"><span class="keyword">namespace</span> Spaly &#123;</span><br><span class="line">    <span class="keyword">int</span> pre[MAXN], ch[<span class="number">2</span>][MAXN], root;</span><br><span class="line">    <span class="built_in">set</span>&lt;<span class="keyword">int</span>&gt; S;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; S.insert(<span class="number">0</span>), S.insert(nB + <span class="number">1</span>); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç±»ä¼¼äº splay ä¸­çš„ connect ?</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">spaly</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == root) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">int</span> fa = pre[u];</span><br><span class="line">        <span class="keyword">if</span> (w) BIT::Mdy(<span class="number">1</span>, fa, <span class="number">1</span>); <span class="keyword">else</span> BIT::Mdy(fa, nB, <span class="number">1</span>);</span><br><span class="line">        BIT::Mdy(u, u, <span class="number">1</span> - ans);</span><br><span class="line">        ch[w][fa] = ch[w ^ <span class="number">1</span>][u];</span><br><span class="line">        <span class="keyword">if</span> (ch[w][fa]) pre[ch[w][fa]] = fa;</span><br><span class="line">        ch[w ^ <span class="number">1</span>][u] = root, pre[root] = u, pre[root = u] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> u = lower_bound(B+<span class="number">1</span>, B+<span class="number">1</span>+nB, v) - B;</span><br><span class="line">        <span class="keyword">if</span> (!root) root = u, ans = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            IT ite = S.lower_bound(u), suf = ite, nxt = --ite;</span><br><span class="line">            <span class="keyword">int</span> fa = BIT::Qry(*nxt) &gt; BIT::Qry(*suf)? *nxt: *suf;</span><br><span class="line">            ans = BIT::Qry(fa) + <span class="number">1</span>, pre[u] = fa, ch[fa == *nxt][fa] = u;</span><br><span class="line">        &#125;</span><br><span class="line">        S.insert(u), BIT::Mdy(u, u, ans - BIT::Qry(u));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Nxt</span><span class="params">(<span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> u = w? *(++S.rbegin()): *(++S.begin());</span><br><span class="line">        <span class="keyword">return</span> ans = BIT::Qry(u), spaly(u, w), u;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Rmv</span><span class="params">(<span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> u = Nxt(w);</span><br><span class="line">        S.erase(u), pre[root = ch[w ^ <span class="number">1</span>][u]] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (w) BIT::Mdy(<span class="number">1</span>, u, <span class="number">-1</span>); <span class="keyword">else</span> BIT::Mdy(u, nB, <span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        read(Q[i]);</span><br><span class="line">        <span class="keyword">if</span> (Q[i] == <span class="number">1</span>) read(A[i]), B[++nB] = A[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    Spaly::init();</span><br><span class="line">    sort(B+<span class="number">1</span>, B+<span class="number">1</span>+nB);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (Q[i]) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>: Spaly::insert(A[i]); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>: Spaly::Nxt(<span class="number">0</span>); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>: Spaly::Nxt(<span class="number">1</span>); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>: Spaly::Rmv(<span class="number">0</span>); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">5</span>: Spaly::Rmv(<span class="number">1</span>); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>: <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"ERR\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒAHOI-HNOI2017ã€å½±é­”"><a href="#ã€ŒAHOI-HNOI2017ã€å½±é­”" class="headerlink" title="ã€ŒAHOI / HNOI2017ã€å½±é­”"></a>ã€ŒAHOI / HNOI2017ã€å½±é­”</h3><h4 id="é¢˜ç›®é“¾æ¥-1"><a href="#é¢˜ç›®é“¾æ¥-1" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2019" target="_blank" rel="noopener">https://loj.ac/problem/2019</a></li></ul><h4 id="è§£é¢˜æ€è·¯-1"><a href="#è§£é¢˜æ€è·¯-1" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>ç›´æ¥ç»Ÿè®¡ä¸å¥½ç»´æŠ¤, äºæ˜¯å°†æ“ä½œç¦»çº¿, æšä¸¾æ¯ä¸ªä½ç½®, ä¾æ¬¡åŠ å…¥è´¡çŒ® / å·®åˆ†ç»Ÿè®¡è´¡çŒ®.</p><p>è®° $c = \max \{ k_s \mid i &lt; s &lt; j \}$, ä¾æ¬¡è®¨è®ºä»€ä¹ˆæƒ…å†µä¸‹å¯¹ç­”æ¡ˆä¼šæœ‰ $p_1$ / $p_2$ çš„è´¡çŒ®.</p><ol><li><p>$i + 1 = j$</p><p>æ­¤æ—¶ä¸å­˜åœ¨æ­¤ $c$, å¯¹ç­”æ¡ˆæœ‰ $p_1$ çš„è´¡çŒ®.</p></li><li><p>$c \le \min \{k_i,\ k_j \}$</p><p>æ­¤æ—¶æœ‰ $p_1$ çš„è´¡çŒ®. ä½†æ˜¯ä¸å¥½ç›´æ¥ç»Ÿè®¡, äºæ˜¯è½¬åŒ–ä¸€ä¸‹, è€ƒè™‘æŸä¸ªä½ç½® $i$ å¯¹ç­”æ¡ˆæœ‰è´¡çŒ®çš„æƒ…å†µ.</p><p>å¯¹äºæ¯ä¸ªä½ç½® $i$, åˆ©ç”¨å•è°ƒæ ˆå¤„ç†å‡ºå·¦ä¾§ç¬¬ä¸€ä¸ªæ¯” $k_i$ çš„ä½ç½® $L_i$, ä»¥åŠå³ä¾§ç¬¬ä¸€ä¸ªæ¯” $k_i$ å¤§çš„ä½ç½® $R_i$. å¯ä»¥å¾—åˆ°</p><ul><li>å¦‚æœä¸€ä¸ªè¯¢é—®å®Œå…¨åŒ…å« $[L_i,\ R_i]$, é‚£ä¹ˆå¯¹ç­”æ¡ˆæœ‰ $p_1$ çš„è´¡çŒ®.</li></ul></li><li><p>$\min \{ k_i,\ k_j \} &lt; c &lt; \max \{ k_i,\ k_j \}$</p><p>æ­¤å¤„æœ‰ $p_2$ çš„è´¡çŒ®. æ²¿ç”¨ Case 2 çš„æ€è·¯. å¯ä»¥å‘ç°</p><ul><li>å¦‚æœä¸€ä¸ªåŒºé—´åŒ…å« $L_i$, é‚£ä¹ˆ $L_i$ å¯ä»¥åœ¨ $[i+1,\ R_i - 1]$ å¯¹ç­”æ¡ˆæœ‰ $p_2$ çš„è´¡çŒ®.</li><li>å¦‚æœä¸€ä¸ªåŒºé—´åŒ…å« $R_i$, é‚£ä¹ˆ $R_i$ å¯ä»¥åœ¨ $[L_i + 1,\ i-1]$ å¯¹ç­”æ¡ˆæœ‰ $p_2$ çš„è´¡çŒ®.</li></ul></li></ol><p>è¿™æ ·å°±åšå®Œäº†. å®é™…ä»£ç å®ç°å¹¶ä¸å¤æ‚â€¦</p><p>è€ƒè™‘åˆ°æ‹†æˆæ‰«æçº¿ä¹‹åä¿®æ”¹ / æŸ¥è¯¢çš„æ“ä½œæ€»å’Œè¾¾åˆ°äº† $10^6$ çš„çº§åˆ«â€¦</p><p>äºæ˜¯ä½¿ç”¨ BIT å®ç°åŒºé—´åŠ  / åŒºé—´æ±‚å’Œ, æ—¶é—´å¤æ‚åº¦ $O(n \log n)$.</p><h4 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2019</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">2e5</span> + <span class="number">5</span>, MAXM = <span class="number">5</span> * MAXN;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Ask</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> type, x, L, R, val;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Ask&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x &lt; rhs.x || (x == rhs.x &amp;&amp; type &lt; rhs.type);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; Q[MAXM];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, qidx;</span><br><span class="line"><span class="keyword">int</span> A[MAXN], p1, p2;</span><br><span class="line"><span class="keyword">int</span> Lpos[MAXN], Rpos[MAXN], stk[MAXN], top;</span><br><span class="line">LL Ans[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> BIT &#123;</span><br><span class="line">    LL C1[MAXN], C2[MAXN];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; x)</span> </span>&#123; <span class="keyword">return</span> x &amp; -x; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; pos, <span class="keyword">const</span> <span class="keyword">int</span>&amp; val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = pos; i &lt;= n; i += lowbit(i)) C1[i] += val, C2[i] += <span class="number">1L</span>L * val * pos;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; L, <span class="keyword">const</span> <span class="keyword">int</span>&amp; R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; val)</span> </span>&#123; Mdy(L, val), Mdy(R+<span class="number">1</span>, -val); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> LL <span class="title">Qry</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; pos)</span> </span>&#123;</span><br><span class="line">        LL ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = pos; i; i -= lowbit(i)) ret += C1[i] * (pos + <span class="number">1</span>) - C2[i];</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> LL <span class="title">Qry</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; L, <span class="keyword">const</span> <span class="keyword">int</span>&amp; R)</span> </span>&#123; <span class="keyword">return</span> Qry(R) - Qry(L<span class="number">-1</span>); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n), read(m), read(p1), read(p2);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) read(A[i]);</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    stk[top = <span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">while</span> (top &amp;&amp; A[stk[top]] &lt; A[i]) Rpos[stk[top--]] = i;</span><br><span class="line">        Lpos[i] = stk[top], stk[++top] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (top) Rpos[stk[top--]] = n + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; n)</span><br><span class="line">            Q[++qidx] = (Ask)&#123; <span class="number">0</span>, i + <span class="number">1</span>, i, i, p1 &#125;;</span><br><span class="line">        <span class="keyword">if</span> (Lpos[i] &gt;= <span class="number">1</span> &amp;&amp; Rpos[i] &lt;= n)</span><br><span class="line">            Q[++qidx] = (Ask)&#123; <span class="number">0</span>, Rpos[i], Lpos[i], Lpos[i], p1 &#125;;</span><br><span class="line">        <span class="keyword">if</span> (Lpos[i] &gt;= <span class="number">1</span> &amp;&amp; i + <span class="number">1</span> &lt;= Rpos[i] - <span class="number">1</span>)</span><br><span class="line">            Q[++qidx] = (Ask)&#123; <span class="number">0</span>, Lpos[i], i + <span class="number">1</span>, Rpos[i] - <span class="number">1</span>, p2 &#125;;</span><br><span class="line">        <span class="keyword">if</span> (Rpos[i] &lt;= n + <span class="number">1</span> &amp;&amp; Lpos[i] + <span class="number">1</span> &lt;= i - <span class="number">1</span>)</span><br><span class="line">            Q[++qidx] = (Ask)&#123; <span class="number">0</span>, Rpos[i], Lpos[i] + <span class="number">1</span>, i - <span class="number">1</span>, p2 &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> L, R, i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        read(L), read(R);</span><br><span class="line">        Q[++qidx] = (Ask)&#123; i, L<span class="number">-1</span>, L, R, <span class="number">-1</span> &#125;;</span><br><span class="line">        Q[++qidx] = (Ask)&#123; i, R, L, R, <span class="number">1</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(Q+<span class="number">1</span>, Q+<span class="number">1</span>+qidx);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= qidx; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (Q[i].type == <span class="number">0</span>) BIT::Mdy(Q[i].L, Q[i].R, Q[i].val);</span><br><span class="line">        <span class="keyword">else</span> Ans[Q[i].type] += Q[i].val * BIT::Qry(Q[i].L, Q[i].R);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, Ans[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒAHOI-HNOI2017ã€ç¤¼ç‰©"><a href="#ã€ŒAHOI-HNOI2017ã€ç¤¼ç‰©" class="headerlink" title="ã€ŒAHOI / HNOI2017ã€ç¤¼ç‰©"></a>ã€ŒAHOI / HNOI2017ã€ç¤¼ç‰©</h3><p>å½“å¹´å…¥é—¨å¤šé¡¹å¼çš„æ—¶å€™å†™çš„é¢˜â€¦</p><h4 id="é¢˜ç›®é“¾æ¥-2"><a href="#é¢˜ç›®é“¾æ¥-2" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2020" target="_blank" rel="noopener">https://loj.ac/problem/2020</a></li></ul><h4 id="è§£é¢˜æ€è·¯-2"><a href="#è§£é¢˜æ€è·¯-2" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>é¦–å…ˆæ—‹è½¬çš„æ“ä½œå¯ä»¥çœ‹ä½œæ˜¯åœ¨æšä¸¾ä¸€ä¸ªèµ·å§‹ç‚¹ $k$, è¶…å‡ºéƒ¨åˆ†å¤åˆ¶ä¸€é $x_i$ æ¥åˆ° $x_n$ åé¢å³å¯. æŠŠå·®å¼‚å€¼å½¢å¼åœ°å†™ä¸‹æ¥å°±æ˜¯</p><p>$$\min_{c, k} \{ \sum_{i=1}^n (x_{i+k} - y_i + c) ^ 2 \}$$</p><p>å±•å¼€, å¾—</p><p>$$\sum_{i=1}^n (x_i^2 + y_i^2) + 2c \cdot \sum_{i=1}^n (x_i - y_i) + n c^2 - 2 \sum_{i=1}^n x_{i+k} y_i$$</p><p>é™¤äº†æœ€åé¢çš„å’Œå¼, å…¶ä½™éƒ¨åˆ†ç›´æ¥ç»Ÿè®¡ / äºŒæ¬¡å‡½æ•°æå€¼å°±å¯ä»¥è§£å†³.</p><p>è€ƒè™‘æ„é€ ä¸€ä¸ªåºåˆ— $t_i = x_{n-i+1}$, é‚£ä¹ˆ</p><p>$$\sum_{i=1}^n x_{i+k} y_i = \sum_{i=1}^n t_{n-i+1+k} y_i$$</p><p>è¿™å°±æ˜¯ä¸€ä¸ªå·ç§¯çš„å½¢å¼äº†, ä½¿ç”¨ FFT / NTT ä¼˜åŒ–è¿™ä¸€è¿‡ç¨‹å³å¯.</p><p>æ—¶é—´å¤æ‚åº¦ $O(n \log n)$.</p><h4 id="ä»£ç å®ç°-2"><a href="#ä»£ç å®ç°-2" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2020</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P = <span class="number">998244353</span>, G = <span class="number">3</span>, iG = <span class="number">332748118</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fpow</span><span class="params">(<span class="keyword">int</span> base, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (b &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>) ret = <span class="number">1L</span>L * ret * base % P;</span><br><span class="line">        base = <span class="number">1L</span>L * base * base % P, b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Poly &#123;</span><br><span class="line">    <span class="keyword">int</span> r[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; Lim, <span class="keyword">const</span> <span class="keyword">int</span>&amp; L)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; Lim; ++i) r[i] = (r[i&gt;&gt;<span class="number">1</span>] &gt;&gt; <span class="number">1</span>) | ((i &amp; <span class="number">1</span>) &lt;&lt; (L<span class="number">-1</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">NTT</span><span class="params">(<span class="keyword">int</span>* f, <span class="keyword">const</span> <span class="keyword">int</span>&amp; Lim, <span class="keyword">const</span> <span class="keyword">int</span>&amp; type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; Lim; ++i) <span class="keyword">if</span> (i &lt; r[i]) swap(f[i], f[r[i]]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> Mid = <span class="number">1</span>; Mid &lt; Lim; Mid &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> unit = fpow(type &gt; <span class="number">0</span>? G: iG, (P - <span class="number">1</span>) / (Mid &lt;&lt; <span class="number">1</span>));</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; i += Mid &lt;&lt; <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">int</span> w = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; Mid; ++j, w = <span class="number">1L</span>L * w * unit % P) &#123;</span><br><span class="line">                    <span class="keyword">int</span> f0 = f[i+j], f1 = <span class="number">1L</span>L * w * f[i+j+Mid] % P;</span><br><span class="line">                    f[i+j] = (f0 + f1) % P, f[i+j+Mid] = (f0 - f1 + P) % P;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (type &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> inv = fpow(Lim, P<span class="number">-2</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) f[i] = <span class="number">1L</span>L * f[i] * inv % P;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, ans;</span><br><span class="line"><span class="keyword">int</span> a[MAXN], b[MAXN], t[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n), read(m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) read(a[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) read(b[i]);</span><br><span class="line">    <span class="comment">// calc c</span></span><br><span class="line">    <span class="keyword">int</span> B = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        ans += a[i] * a[i] + b[i] * b[i], B += a[i] - b[i];</span><br><span class="line">    <span class="keyword">int</span> c1 = <span class="built_in">floor</span>(<span class="number">-1.0</span> * B / n), c2 = <span class="built_in">ceil</span>(<span class="number">-1.0</span> * B / n);</span><br><span class="line">    ans += min(n * c1 * c1 + <span class="number">2</span> * B * c1, n * c2 * c2 + <span class="number">2</span> * B * c2);</span><br><span class="line">    <span class="comment">// polynomial</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) t[n + i] = t[i] = a[n - i + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> Lim = <span class="number">1</span>, L = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (Lim &lt;= <span class="number">2</span>*n + n) Lim &lt;&lt;= <span class="number">1</span>, ++L;</span><br><span class="line">    Poly::init(Lim, L), Poly::NTT(t, Lim, <span class="number">1</span>), Poly::NTT(b, Lim, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) t[i] = <span class="number">1L</span>L * t[i] * b[i] % P;</span><br><span class="line">    Poly::NTT(t, Lim, <span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">int</span> p2 = -P;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n + <span class="number">1</span>; i &lt;= <span class="number">2</span> * n; ++i) p2 = max(p2, <span class="number">2</span> * t[i]);</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans - p2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒAHOI-HNOI2017ã€å¤§ä½¬"><a href="#ã€ŒAHOI-HNOI2017ã€å¤§ä½¬" class="headerlink" title="ã€ŒAHOI / HNOI2017ã€å¤§ä½¬"></a>ã€ŒAHOI / HNOI2017ã€å¤§ä½¬</h3><p>å¾ˆçœŸå®çš„é¢˜é¢.</p><h4 id="é¢˜ç›®é“¾æ¥-3"><a href="#é¢˜ç›®é“¾æ¥-3" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2021" target="_blank" rel="noopener">https://loj.ac/problem/2021</a></li></ul><h4 id="è§£é¢˜æ€è·¯-3"><a href="#è§£é¢˜æ€è·¯-3" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>é¦–å…ˆæœ‰ä¸€ä¸ªæœ´ç´ çš„ DP, æŠŠèƒ½ä¸¢åˆ°çŠ¶æ€çš„éƒ½ä¸¢è¿›å»â€¦</p><p>è€ƒè™‘åˆ°æ‰“å€’å¤§ä½¬å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†, ä¹Ÿå°±æ˜¯ä¿è¯è‡ªå·±å­˜æ´», ä»¥åŠæ‘§æ¯å¤§ä½¬è‡ªä¿¡.</p><p>æ³¨æ„åˆ° â€œä¿è¯å­˜æ´»â€ è¿™ä¸€é™åˆ¶å’Œæ¯å¤©é‡‡ç”¨ä»€ä¹ˆç­–ç•¥æœ‰å…³, è€Œ â€œæ‘§æ¯è‡ªä¿¡â€ åªå’Œæ€»å¤©æ•°æœ‰å…³.</p><p>äºæ˜¯å¯ä»¥ DP å‡ºä¿è¯å­˜æ´»çš„æ¡ä»¶ä¸‹æœ€å¤§æ–—äº‰å¤©æ•°.</p><p>è®¾ $f(i, j)$ è¡¨ç¤ºç¬¬ $i$ å¤©, è‡ªä¿¡å€¼ä¸º $j$ æ—¶ç”¨äºæ‰“å€’å¤§ä½¬çš„æœ€å¤§å¤©æ•°. åˆ™æœ‰è½¬ç§»</p><p>$$f(i, j - a_i) = \max \{\ f(i-1, j) + 1\ \}$$</p><p>è¡¨ç¤ºè¿™å¤©é€‰æ‹©åŒå¤§ä½¬æ–—äº‰.</p><p>$$f(i, j - a_i + w_i) = \max \{\ f(i-1, j)\ \}$$</p><p>è¡¨ç¤ºè¿™å¤©å»åšæ°´é¢˜ <del>ç»­å‘½</del>â€¦</p><p>åœ¨å¾—åˆ°æœ€å¤§æ–—äº‰å¤©æ•° $md$ å, ç›´æ¥ BFS è®¡ç®—è¿™äº›å¤©å†…èƒ½ç§¯ç´¯çš„çš„è®½åˆºèƒ½åŠ› $F$, ä»¥åŠæ‰€ç”¨å¤©æ•° $D$.</p><p>é‚£ä¹ˆå¯¹äºä¸€ä¸ªè‡ªä¿¡å€¼ä¸º $C$ çš„å¤§ä½¬, ä¾æ¬¡æšä¸¾ â€œæ€¼å¤§ä½¬â€ çš„æ¬¡æ•°, å³ 0, 1, 2, å¹¶åˆ¤å®šå³å¯.</p><p>å¯¹äºä½¿ç”¨ä¸¤æ¬¡ â€œæ€¼å¤§ä½¬â€ æ“ä½œçš„æƒ…å†µ, åˆ©ç”¨ Two-Pointer çš„æŠ€å·§é…åˆ $F$ çš„å•è°ƒæ€§æšä¸¾å³å¯.</p><p>å…·ä½“åœ°è¯´, å½“å‰åˆæ³•çš„ä¸¤æ¬¡æ“ä½œ $i,\ j$ æ»¡è¶³ $F_i + F_j \le C$, ä¸” $C - F_i - F_j + D_i + D_j \le md$.</p><p>(æ¢è¨€ä¹‹, ä¸èƒ½ç›´æ¥æŠŠå¤§ä½¬è‡ªä¿¡å€¼å˜²è®½åˆ°è´Ÿ, ä¸”å‰©ä½™éƒ¨åˆ†å¯ä»¥è¿˜å˜´è§£å†³)</p><p>è¿™ç§å¸¦æœç´¢çš„é¢˜ç›®, æ—¶é—´å¤æ‚åº¦ä¸æƒ³åˆ†æäº†, $O(\texttt{èƒ½è¿‡})$.</p><h4 id="ä»£ç å®ç°-3"><a href="#ä»£ç å®ç°-3" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2021</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; Pii;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">105</span>, MAXM = <span class="number">1e6</span> + <span class="number">5</span>, MAXC = <span class="number">1e8</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, mc, md;</span><br><span class="line"><span class="keyword">int</span> A[MAXN], W[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> f[MAXN][MAXN];</span><br><span class="line"><span class="keyword">int</span> F[MAXM], D[MAXM], nF;</span><br><span class="line"><span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; M;</span><br><span class="line"><span class="built_in">map</span>&lt;Pii, <span class="keyword">bool</span>&gt; vis;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BFS</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> QF[MAXM], QL[MAXM], Qd[MAXM];</span><br><span class="line">    <span class="keyword">int</span> head = <span class="number">1</span>, tail = <span class="number">0</span>;</span><br><span class="line">    QF[++tail] = <span class="number">1</span>, QL[tail] = <span class="number">0</span>, Qd[tail] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (head &lt;= tail) &#123;</span><br><span class="line">        <span class="keyword">int</span> fe = QF[head], l = QL[head], d = Qd[head]; ++head;</span><br><span class="line">        <span class="keyword">if</span> (!M.count(fe)) M[fe] = d;</span><br><span class="line">        <span class="keyword">if</span> (d &gt;= md || <span class="number">1L</span>L * fe * l &gt; MAXC) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> (!vis[Pii(l+<span class="number">1</span>, fe)]) &#123;</span><br><span class="line">            QF[++tail] = fe, QL[tail] = l + <span class="number">1</span>, Qd[tail] = d + <span class="number">1</span>;</span><br><span class="line">            vis[Pii(l+<span class="number">1</span>, fe)] = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">1</span> &lt; l &amp;&amp; <span class="number">1L</span>L * fe * l &lt;= MAXC &amp;&amp; !vis[Pii(l, fe * l)]) &#123;</span><br><span class="line">            QF[++tail] = fe * l, QL[tail] = l, Qd[tail] = d + <span class="number">1</span>;</span><br><span class="line">            vis[Pii(l, fe * l)] = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n), read(m), read(mc);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) read(A[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) read(W[i]);</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = A[i]; j &lt;= mc; ++j) &#123;</span><br><span class="line">            f[i][j - A[i]] = max(f[i][j - A[i]], f[i<span class="number">-1</span>][j] + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">int</span> p = min(mc, j - A[i] + W[i]);</span><br><span class="line">            f[i][p] = max(f[i][p], f[i<span class="number">-1</span>][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= mc; ++j) md = max(md, f[i][j]);</span><br><span class="line">    BFS();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> ite = M.begin(); ite != M.end(); ++ite)</span><br><span class="line">        F[++nF] = ite-&gt;first, D[nF] = ite-&gt;second;</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">while</span> (m--) &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> C, ans;</span><br><span class="line">        read(C), ans = C &lt;= md;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nF &amp;&amp; !ans; ++i)</span><br><span class="line">            ans |= F[i] &lt;= C &amp;&amp; D[i] + C - F[i] &lt;= md;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>, i = nF; i &amp;&amp; !ans; --i)</span><br><span class="line">            <span class="keyword">while</span> (!ans &amp;&amp; j &lt;= nF &amp;&amp; F[i] + F[j] &lt;= C)</span><br><span class="line">                ans |= D[i] + D[j] + C - F[i] - F[j] &lt;= md, ++j;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒAHOI-HNOI2017ã€é˜Ÿé•¿å¿«è·‘"><a href="#ã€ŒAHOI-HNOI2017ã€é˜Ÿé•¿å¿«è·‘" class="headerlink" title="ã€ŒAHOI / HNOI2017ã€é˜Ÿé•¿å¿«è·‘"></a>ã€ŒAHOI / HNOI2017ã€é˜Ÿé•¿å¿«è·‘</h3><p>è¿™æ˜¯ä¸€é“ <del>è®¡ç®—å‡ ä½•</del> <code>nan</code> é¢˜, è‡³å°‘å½“å¹´æ˜¯è¿™æ ·.</p><h4 id="é¢˜ç›®é“¾æ¥-4"><a href="#é¢˜ç›®é“¾æ¥-4" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2022" target="_blank" rel="noopener">https://loj.ac/problem/2022</a></li></ul><h4 id="è§£é¢˜æ€è·¯-4"><a href="#è§£é¢˜æ€è·¯-4" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>ä¼¼ä¹è¿™é“é¢˜ 6-10 çš„æ•°æ®æ˜¯é”™çš„, å˜¿å˜¿.</p><p>äºæ˜¯å»å­¦ä¹ äº†æŸä¸€ç§å¹¿ä¸ºæµä¼ çš„åšæ³•, å¸Œæœ›åšæ³•ä¸å‡.</p><p>é¦–å…ˆæœ‰ä¸€æ­¥è½¬åŒ–, æ¯ä¸€ä¸ªæœºå…³, éƒ½å¯ä»¥æ ¹æ®å…¶å¯¹èµ·ç‚¹ $S$ åˆ°ç»ˆç‚¹ $T$ çš„å½±å“, çœ‹ä½œå€¾è§’ä¸º $\frac{\pi}{2}$ æˆ– $\frac{\pi}{2}$ çš„ä¸¤æ¡å°„çº¿.</p><p><del>æ„Ÿè§‰ä¸ç”»å›¾æ˜¯ä¸ä¼šæ˜ç™½çš„, é‚£ä¹ˆç¥­ä¸Š <a href="https://www.luogu.com.cn/blog/xuanmenghuolong/solution-p3725" target="_blank" rel="noopener">lb2003 çš„é¢˜è§£</a> å§</del></p><p>æ­¤æ—¶çš„æƒ…å†µå°±æ¯”è¾ƒå°‘äº†, åˆ©ç”¨ä¸¤ä¸ªå•è°ƒé˜Ÿåˆ—, ç»´æŠ¤ä¸€æ¡åˆæ³•è·¯å¾„å³å¯. ç”±ç»´æŠ¤è·¯å¾„çš„è¿‡ç¨‹å¯ä»¥å¾—çŸ¥, æ­¤æ—¶å¾—åˆ°çš„ç­”æ¡ˆä¸€å®šæ˜¯æœ€ä¼˜çš„.</p><p>æ—¶é—´å¤æ‚åº¦ $O(n)$.</p><h4 id="ä»£ç å®ç°-4"><a href="#ä»£ç å®ç°-4" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p>èƒ½ç”¨æ•´æ•°çš„åœ°æ–¹å°±ç”¨æ•´æ•°æ¥æé«˜ç²¾åº¦â€¦</p><p>å†åˆ©ç”¨å•è°ƒé˜Ÿåˆ—çš„æ—¶å€™, ä½¿ç”¨äº†ä¸€äº›æŠ€å·§æ¥ç®€åŒ–ä»£ç .</p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2022</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e6</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Geo &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> INFD = <span class="number">1e18</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Vector</span> &#123;</span></span><br><span class="line">        LL x, y;</span><br><span class="line">        Vector(LL _x = <span class="number">0</span>, LL _y = <span class="number">0</span>): x(_x), y(_y) &#123; &#125;</span><br><span class="line">        Vector <span class="keyword">operator</span> + (<span class="keyword">const</span> Vector&amp; rhs) <span class="keyword">const</span> &#123; <span class="keyword">return</span> Vector(x + rhs.x, y + rhs.y); &#125;</span><br><span class="line">        Vector <span class="keyword">operator</span> - (<span class="keyword">const</span> Vector&amp; rhs) <span class="keyword">const</span> &#123; <span class="keyword">return</span> Vector(x - rhs.x, y - rhs.y); &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">typedef</span> Vector Point;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> LL <span class="title">Dot</span><span class="params">(<span class="keyword">const</span> Vector&amp; A, <span class="keyword">const</span> Vector&amp; B)</span> </span>&#123; <span class="keyword">return</span> A.x * B.x + A.y * B.y; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> LL <span class="title">Cross</span><span class="params">(<span class="keyword">const</span> Vector&amp; A, <span class="keyword">const</span> Vector&amp; B)</span> </span>&#123; <span class="keyword">return</span> A.x * B.y - A.y * B.x; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">Length</span><span class="params">(<span class="keyword">const</span> Vector&amp; A)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">sqrt</span>(Dot(A, A)); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">angle</span><span class="params">(<span class="keyword">const</span> Vector&amp; v)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">atan2</span>(v.y, v.x); &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Geo;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(Point&amp; p)</span> </span>&#123; <span class="built_in">scanf</span>(<span class="string">"%lld%lld"</span>, &amp;p.x, &amp;p.y); &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, nA;</span><br><span class="line"><span class="keyword">double</span> theta[MAXN];</span><br><span class="line">Point A[MAXN], P[MAXN], S, T;</span><br><span class="line"><span class="keyword">int</span> Q[<span class="number">2</span>][MAXN], head[<span class="number">2</span>], tail[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">int</span> pre[MAXN], idx[MAXN], t[MAXN], type[MAXN]; <span class="comment">// 0: up, 1: down</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; x, <span class="keyword">const</span> <span class="keyword">int</span>&amp; y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> P[x].x &lt; P[y].x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n), read(T);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        read(P[i]), <span class="built_in">scanf</span>(<span class="string">"%lf"</span>, theta + i);</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    S = Point(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">double</span> angl = angle(S - P[i]), angr = angle(T - P[i]);</span><br><span class="line">        <span class="comment">// æ³¨æ„å¤„ç† angl &gt; angr çš„æƒ…å†µ</span></span><br><span class="line">        <span class="keyword">if</span> (angl &gt; angr) type[i] = !(angr &lt; theta[i] &amp;&amp; theta[i] &lt; angl);</span><br><span class="line">        <span class="keyword">else</span> type[i] = angl &lt; theta[i] &amp;&amp; theta[i] &lt; angr;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) idx[i] = i;</span><br><span class="line">    sort(idx+<span class="number">1</span>, idx+<span class="number">1</span>+n, cmp);</span><br><span class="line">    A[++nA] = S;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n &amp;&amp; P[idx[i]].x &lt; T.x; ++i)</span><br><span class="line">        <span class="keyword">if</span> (S.x &lt; P[idx[i]].x) A[++nA] = P[idx[i]], t[nA] = type[idx[i]];</span><br><span class="line">    A[++nA] = T;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> d = <span class="number">0</span>; d &lt; <span class="number">2</span>; ++d) Q[d][head[d] = tail[d] = <span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= nA; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> d = t[i], sign = (d &gt; <span class="number">0</span>? <span class="number">1</span>: <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">int</span> &amp;head0 = head[d], &amp;tail0 = tail[d], *Q0 = Q[d];</span><br><span class="line">        <span class="keyword">int</span> &amp;head1 = head[d^<span class="number">1</span>], &amp;tail1 = tail[d^<span class="number">1</span>], *Q1 = Q[d^<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (head1 &lt; tail1 &amp;&amp; Cross(A[i] - A[Q1[head1]], A[Q1[head1+<span class="number">1</span>]] - A[Q1[head1]]) * sign &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span> (head1 &lt; tail1 &amp;&amp;</span><br><span class="line">                    Cross(A[i] - A[Q1[head1]], A[Q1[head1+<span class="number">1</span>]] - A[Q1[head1]]) * sign &lt;= <span class="number">0</span>) ++head1;</span><br><span class="line">            pre[i] = Q1[head1];</span><br><span class="line">            head0 = ++tail0, Q0[tail0] = Q1[head1];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (head0 &lt; tail0 &amp;&amp;</span><br><span class="line">                    Cross(A[i] - A[Q0[tail0<span class="number">-1</span>]], A[Q0[tail0]] - A[Q0[tail0<span class="number">-1</span>]]) * sign &lt;= <span class="number">0</span>) --tail0;</span><br><span class="line">            pre[i] = Q0[tail0];</span><br><span class="line">        &#125;</span><br><span class="line">        Q0[++tail0] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">double</span> ans = <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = nA; i != <span class="number">1</span>; i = pre[i]) ans += Length(A[i] - A[pre[i]]), assert(i != <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%.10lf\n"</span>, ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒAHOI-HNOI2017ã€æŠ›ç¡¬å¸"><a href="#ã€ŒAHOI-HNOI2017ã€æŠ›ç¡¬å¸" class="headerlink" title="ã€ŒAHOI / HNOI2017ã€æŠ›ç¡¬å¸"></a>ã€ŒAHOI / HNOI2017ã€æŠ›ç¡¬å¸</h3><h4 id="é¢˜ç›®é“¾æ¥-5"><a href="#é¢˜ç›®é“¾æ¥-5" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2023" target="_blank" rel="noopener">https://loj.ac/problem/2023</a></li></ul><h4 id="è§£é¢˜æ€è·¯-5"><a href="#è§£é¢˜æ€è·¯-5" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>è¿™æ˜¯ä¸€é“ç»„åˆæ•°å­¦é¢˜. åˆ† $a = b$ å’Œ $a &gt; b$ ä¸¤ç§æƒ…å†µè®¨è®º.</p><ul><li><p>$a = b$</p><p>å…ˆè€ƒè™‘æ‰€æœ‰æƒ…å†µæ•°, å³ $2 ^ {a + b}$.</p><p>å¦‚æœæŠŠç¡¬å¸å…¨éƒ¨ç¿»è½¬, æœ€åè¾“èµ¢çš„ç»“æœå´ä¸ä¸€å®šç¿»è½¬. æ‰€ä»¥æ­¤æ—¶è¦ç»Ÿè®¡ $A$ è·èƒœçš„æƒ…å†µ, éœ€è¦å‡å»ç¿»è½¬å‰å $A$ éƒ½è¾“ç»™ $B$, ä¹Ÿå°±æ˜¯å¹³å±€çš„æ–¹æ¡ˆæ•°. é‚£ä¹ˆç­”æ¡ˆä¸º</p><p>$$\frac{1}{2}\ (\ 2 ^ {a + b} - \sum_{i=1}^a \binom{a}{i} \binom{b}{i})$$ </p><p>è€ƒè™‘å³ä¾§å’Œå¼çš„ç»„åˆæ„ä¹‰, å³ä¸¤æ¬¡åœ¨ $a$ ä¸ªç‰©å“ä¸­é€‰å‡º $i$ ä¸ª. ç­‰ä»·äºä¸€æ¬¡é€‰å‡º $i$ ä¸ª, å¦ä¸€æ¬¡é€‰å‡º $a-i$ ä¸ª. ä¹Ÿå°±æ˜¯åœ¨ $2a$ ä¸ªç‰©å“ä¸­é€‰å‡º $a$ ä¸ª. å³</p><p>$$\frac{1}{2}\ (\ 2 ^ {a + b} - \sum_{i=1}^a \binom{a}{i} \binom{a}{a-i}) = \frac{1}{2}\ (\ 2 ^ {a + b} - \binom{2a}{a})$$</p><p>å¼å­ä¸­æœ‰ä¸ª / $2$, ä½† $2$ åœ¨è¿™äº›ä¸ªæ¨¡æ•°ä¸‹ä¸å­˜åœ¨é€†å…ƒ, äºæ˜¯å¯ä»¥è®¤ä¸ºæ¨¡æ•°ä¸º $2 \times 10^k$, æœ€åç›´æ¥å°†ç»“æœ / $2$ å³å¯.</p><p>ä½†æ˜¯è¿™æ ·æœ‰äº›â€¦ è€ƒè™‘ <a href="https://zh.wikipedia.org/wiki/%E5%B8%95%E6%96%AF%E5%8D%A1%E6%B3%95%E5%89%87" target="_blank" rel="noopener">å¸•æ–¯å¡æ³•åˆ™</a>, æœ‰</p><p>$$\binom{2a}{a} = \binom{2a-1}{a-1} + \binom{2a-1}{a}$$</p><p>è€Œ $\binom{2a-1}{a-1} = \binom{2a-1}{a}$, æ‰€ä»¥ç­”æ¡ˆä¸º</p><p>$$2 ^ {a + b - 1} + \binom{2a - 1}{a - 1}$$</p><p>ä»è€Œé¿å¼€äº† / $2$ çš„æ“ä½œ.</p></li><li><p>$a &gt; b$</p><p>è¿˜æ˜¯ä»ç¿»è½¬ç¡¬å¸çš„è§’åº¦å…¥æ‰‹, è¿™æ¬¡è¦è€ƒè™‘ç¿»è½¬å‰å $A$ éƒ½è·èƒœçš„æƒ…å†µ. é‚£ä¹ˆç­”æ¡ˆä¸º</p><p>$$\frac{1}{2}\ (\ 2 ^ {a + b} + \sum_{i=0}^b \sum_{j=1}^{a-b-1} \binom{b}{i} \binom{a}{i + j})$$</p><p>æ”¹å˜æšä¸¾é¡ºåº, å¾—</p><p>$$\frac{1}{2}\ (\ 2 ^ {a + b} + \sum_{i=1}^{a-b-1}\sum_{j=0}^b \binom{b}{b-j}\binom{a}{i+j} ) = \frac{1}{2}\ (\ 2 ^ {a + b} + \sum_{i=1}^{a-b-1} \binom{a+b}{b+i} )$$</p><p>ç¨å¾®æ•´ç†ä¸€ä¸‹, å¾—</p><p>$$\frac{1}{2}\ (\ 2 ^ {a + b} + \sum_{i=1+b}^{a-1} \binom{a+b}{i} )$$</p><p>åˆ©ç”¨ä¸Šä¸€æƒ…å†µçš„å¤„ç†æ–¹æ³•å¤„ç†æ‰ / $2$ å³å¯. (å¦‚æœæŠŠå’Œå¼å¤„ç†æ‰, é‚£å°±æ˜¯åæ–‡çš„ä¼˜åŒ– 3 äº†)</p></li></ul><p>æ¨å‡ºæ¥å¼å­ä¹‹åç›´æ¥æŠ„äº†ä¸€ä»½é²æ£’æ€§è‰¯å¥½çš„æ‹“å±•å¢å¡æ–¯çš„æ¿å­ä¸Šå», å–œè·ç¬¬ä¸€ä¸ªç‚¹è·‘ 10s çš„å¥½æˆç»©.</p><p>æ¥ä¸‹æ¥çš„é—®é¢˜åœ¨äºå¦‚ä½•å¡å¸¸â€¦</p><ol><li><p>è€ƒè™‘åˆ°æ¨¡æ•°ä¸€å®šå½¢å¦‚ $10^k$, ä¹Ÿå°±æ˜¯è´¨å› æ•°ä»…åŒ…å« $2$ å’Œ $5$.</p><p>é‚£ä¹ˆæšä¸¾è´¨å› æ•°çš„è¿‡ç¨‹å¯ä»¥çœç•¥, ä¸­å›½å‰©ä½™å®šç†çš„è¿‡ç¨‹ä¹Ÿå¯ä»¥ç®€åŒ–ä¸å°‘.</p></li><li><p>åœ¨èƒ½ç”¨ <code>int</code> çš„æƒ…å†µä¸‹, é¿å…ä½¿ç”¨ <code>long long</code>.</p><p>åœ¨ç°ä»£è¯„æµ‹æœºä¸‹æ•ˆæœå¹¶ä¸æ˜¾è‘—â€¦</p></li><li><p>è€ƒè™‘åˆ°ç»„åˆæ•°å…·æœ‰å¯¹ç§°æ€§, è®¡ç®—ç»„åˆæ•°åªéœ€è¦ç®—ä¸€åŠå³å¯, å¸¸æ•°å‡åŠ.</p><p>å…·ä½“å®ç°çš„æ—¶å€™, éœ€è¦è®¨è®º $a + b$ å¥‡å¶æ€§æ¥é¿å…å°‘åŠ ä¸€é¡¹çš„éº»çƒ¦.</p></li><li><p>é¢„å¤„ç†ä¸€ä¸ª â€œä¼ªé˜¶ä¹˜â€, å³åœ¨é˜¶ä¹˜ä¸­é™¤å» $2$ / $5$ çš„å€æ•°, ç”¨äºä¼˜åŒ–æ‹“å±• Lucas è®¡ç®—.</p><p>æ­¤å¤„ä¼˜åŒ–æœ€ä¸ºæ˜æ˜¾.</p></li></ol><p>è¿˜æœ‰ä¸€ä¸ªå°åœ°æ–¹å°±æ˜¯ $2^9 = 512$, è¿œå°äº $5^9 = 1953125$, å¼€åœ¨ä¸€èµ·å¯¹ç¼“å­˜ä¸å‹å¥½â€¦</p><p>ä¸è¿‡å¯ä»¥ç®€åŒ–ä»£ç  doge</p><h4 id="ä»£ç å®ç°-5"><a href="#ä»£ç å®ç°-5" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2023</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXL = <span class="number">25</span>, MAXN = <span class="number">2e6</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">exgcd</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span>&amp; x, <span class="keyword">int</span>&amp; y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!b) x = <span class="number">1</span>, y = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> exgcd(b, a % b, y, x), y -= a / b * x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">inv</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; n, <span class="keyword">const</span> <span class="keyword">int</span>&amp; m)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> x, y;</span><br><span class="line">    <span class="keyword">return</span> exgcd(n % m, m, x, y), (x % m + m) % m;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fpow</span><span class="params">(LL base, LL b, <span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (b &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>) ret = ret * base % m;</span><br><span class="line">        base = base * base % m, b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> Ctl[MAXL];</span><br><span class="line"><span class="keyword">int</span> M[MAXL], pow2[MAXL], pow5[MAXL], fac[<span class="number">2</span>][MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">calc</span><span class="params">(LL n, <span class="keyword">int</span> d, <span class="keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!n) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// "ä¼ªé˜¶ä¹˜" ä½¿ç”¨</span></span><br><span class="line">    <span class="keyword">int</span> s = fpow(fac[d == <span class="number">5</span>][p - <span class="number">1</span>], n / p, p);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1L</span>L * s * fac[d == <span class="number">5</span>][n % p] % p * calc(n / d, d, p) % p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">MultiLucas</span><span class="params">(LL n, LL m, <span class="keyword">int</span> d, <span class="keyword">int</span> p, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> c = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (LL i = n; i; i /= d) c += i / d;</span><br><span class="line">    <span class="keyword">for</span> (LL i = m; i; i /= d) c -= i / d;</span><br><span class="line">    <span class="keyword">for</span> (LL i = n-m; i; i /= d) c -= i / d;</span><br><span class="line">    <span class="comment">// è¿™é‡Œä¹Ÿæ˜¯ä¼˜åŒ–</span></span><br><span class="line">    <span class="keyword">if</span> (c &gt;= k) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1L</span>L * fpow(d, c, p) * calc(n, d, p) % p *</span><br><span class="line">        inv(calc(m, d, p), p) % p * inv(calc(n-m, d, p), p) % p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ExLucas</span><span class="params">(LL n, LL m, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> &amp;fact1 = pow2[k], &amp;fact2 = pow5[k];</span><br><span class="line">    <span class="keyword">int</span> a1 = MultiLucas(n, m, <span class="number">2</span>, fact1, k), a2 = MultiLucas(n, m, <span class="number">5</span>, fact2, k);</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">1L</span>L * inv(fact2, fact1) * fact2 % M[k] * a1 % M[k];</span><br><span class="line">    ret = (ret + <span class="number">1L</span>L * inv(fact1, fact2) * fact1 % M[k] * a2 % M[k]) % M[k];</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// init</span></span><br><span class="line">    fac[<span class="number">0</span>][<span class="number">0</span>] = fac[<span class="number">1</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">512</span>; ++i) <span class="comment">// 2 ^ 9</span></span><br><span class="line">        fac[<span class="number">0</span>][i] = (i % <span class="number">2</span> == <span class="number">0</span>)? fac[<span class="number">0</span>][i<span class="number">-1</span>]: <span class="number">1L</span>L * i * fac[<span class="number">0</span>][i<span class="number">-1</span>] % <span class="number">512</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">1953125</span>; ++i) <span class="comment">// 5 ^ 9</span></span><br><span class="line">        fac[<span class="number">1</span>][i] = (i % <span class="number">5</span> == <span class="number">0</span>)? fac[<span class="number">1</span>][i<span class="number">-1</span>]: <span class="number">1L</span>L * i * fac[<span class="number">1</span>][i<span class="number">-1</span>] % <span class="number">1953125</span>;</span><br><span class="line">    pow2[<span class="number">0</span>] = pow5[<span class="number">0</span>] = M[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">9</span>; ++i)</span><br><span class="line">        M[i] = M[i<span class="number">-1</span>] * <span class="number">10</span>, pow2[i] = pow2[i<span class="number">-1</span>] * <span class="number">2</span>, pow5[i] = pow5[i<span class="number">-1</span>] * <span class="number">5</span>;</span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    LL a, b; <span class="keyword">int</span> K;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%lld%lld%d"</span>, &amp;a, &amp;b, &amp;K) != EOF) &#123;</span><br><span class="line">        <span class="comment">// solve</span></span><br><span class="line">        <span class="keyword">int</span> Mod = M[K], ans = fpow(<span class="number">2</span>, a + b - <span class="number">1</span>, Mod);</span><br><span class="line">        <span class="keyword">if</span> (a == b) ans = (ans - ExLucas(a + a - <span class="number">1</span>, a - <span class="number">1</span>, K) + Mod) % Mod;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (LL i = (a + b) / <span class="number">2</span> + <span class="number">1</span>; i &lt; a; ++i)</span><br><span class="line">                ans = (ans + ExLucas(a + b, i, K)) % Mod;</span><br><span class="line">            <span class="keyword">if</span> ((a + b) % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line">                ans = (ans + ExLucas(a + b - <span class="number">1</span>, (a + b) / <span class="number">2</span>, K)) % Mod;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// output</span></span><br><span class="line">        <span class="built_in">sprintf</span>(Ctl, <span class="string">"%%0%dd\n"</span>, K), <span class="built_in">printf</span>(Ctl, ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><hr>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;å¦‚æœè¯´ â€œæˆ‘åšäº†ä¸€å¥— AHOIâ€, ææ€•å’Œ â€œæˆ‘åšäº†ä¸€å¥— HNOIâ€ ç»™äººçš„æ„Ÿè§‰ä¸å¤ªä¸€æ ·â€¦&lt;/p&gt;
&lt;p&gt;ä½†å…¶å®æ˜¯ä¸€æ ·çš„? &lt;del&gt;OI ä»€ä¹ˆæ—¶å€™èƒ½å®ç°åœ°åŸŸçš„å¹³è¡¡å•Š.&lt;/del&gt; è¿™è¾ˆå­ä¸å¯èƒ½äº†.&lt;/p&gt;
    
    </summary>
    
    
      <category term="é¢˜è§£" scheme="https://depletedprism.github.io/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
  </entry>
  
  <entry>
    <title>SDOI 2017 Round 2 å¤§èµ</title>
    <link href="https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/SDOI-2017-R2-sol/"/>
    <id>https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/SDOI-2017-R2-sol/</id>
    <published>2020-03-08T13:24:57.000Z</published>
    <updated>2020-03-10T12:03:24.517Z</updated>
    
    <content type="html"><![CDATA[<hr><div style="text-align:center;"><img src="/images/SDOI-2017-sol/SDOI.jpg"> </div><p><em><p style="text-align:center;">å›¾æº <a href="https://www.cnblogs.com/zzqsblog/p/7523003.html" target="_blank" rel="noopener">ZZQâ€™s Blog</a>, è‡³å°‘æˆ‘æ˜¯ä»é‚£é‡Œæ‰¾åˆ°çš„</p></em></p><p>è¿™ Round 2 ä¹Ÿå¤ªæ¯’ç˜¤äº† = =</p><a id="more"></a><p>ä¹… ç­‰ äº†.</p><h3 id="ã€ŒSDOI2017ã€é¾™ä¸åœ°ä¸‹åŸ"><a href="#ã€ŒSDOI2017ã€é¾™ä¸åœ°ä¸‹åŸ" class="headerlink" title="ã€ŒSDOI2017ã€é¾™ä¸åœ°ä¸‹åŸ"></a>ã€ŒSDOI2017ã€é¾™ä¸åœ°ä¸‹åŸ</h3><p>éªŒé¢˜äººåœ¨å¤šæµ‹çš„æƒ…å†µä¸‹æ€»ç®—æ˜¯å†™äº†åè¡Œä»£ç ?</p><h4 id="é¢˜ç›®é“¾æ¥"><a href="#é¢˜ç›®é“¾æ¥" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2267" target="_blank" rel="noopener">https://loj.ac/problem/2267</a></li></ul><h4 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>é¦–å…ˆæœ‰ä¸€ä¸ªå¤šé¡¹å¼åšæ³•.</p><p>æ„é€ ä¸€ä¸ªç”Ÿæˆå‡½æ•° $g(x)$, å…¶ $k$ æ¬¡é¡¹ç³»æ•°è¡¨ç¤ºæ·ä¸€æ¬¡éª°å­é€ æˆä¼¤å®³ $k$ çš„æ¦‚ç‡, åˆ™</p><p>$$g(x) = \sum_{k=0}^{X-1} \frac{1}{X} x^k$$</p><p>é‚£ä¹ˆ $g(x)^Y$ çš„ $A_i$ åˆ° $B_i$ æ¬¡é¡¹å’Œå³ä¸ºç­”æ¡ˆ.</p><p>å¯¹äºè¿™ä¸ªå¤šé¡¹å¼å¹‚å‡½æ•°çš„è®¡ç®—, å¯ä»¥ç”¨å¸¦å¤§å¸¸æ•°çš„ $O(n \log n)$ å¤šé¡¹å¼ $\exp$ , æˆ–è€…æœ´ç´ å¿«é€Ÿå¹‚ $O(n \log ^2 n)$.</p><p>ä½†æ˜¯æœ‰ç²¾å·§çš„åšæ³•, æ­¤å¤„ç›´æ¥æŠŠç‚¹å€¼åš $Y$ æ¬¡å¹‚å°±å¥½äº†.</p><p>å½“å¹´è€ƒåœº AC ä¼¼ä¹æœ‰æ›´ä¸ºç²¾å·§çš„ä¼˜åŒ–æ–¹æ³•, å¥½åƒ myy çš„è®ºæ–‡ &lt;å†æ¢å¿«é€Ÿå‚…é‡Œå¶å˜æ¢&gt; é‡Œæœ‰æ¶‰åŠ, <del>ä»¥åå†è¯´ä»¥åå†è¯´</del></p><p>å¯¹äºå¤§æ•°æ® <del>å¦‚æœé—®ä»€ä¹ˆæ˜¯å¤§æ•°æ®, é‚£å°±æ˜¯ FFT è·‘ä¸è¿‡çš„æ•°æ®</del>, åˆ™è¦ç”¨åˆ° <a href="https://zh.wikipedia.org/wiki/%E4%B8%AD%E5%BF%83%E6%9E%81%E9%99%90%E5%AE%9A%E7%90%86#%E6%9E%97%E5%BE%B7%E4%BC%AF%E6%A0%BC%EF%BC%8D%E5%88%97%E7%BB%B4%E5%AE%9A%E7%90%86" target="_blank" rel="noopener">ä¸­å¿ƒæé™å®šç†</a>.</p><p>è®° $\zeta_{n} = \dfrac{\bar X - \mu}{\sigma / \sqrt n} = \dfrac{\sum\limits_{i=1}^n X_i - n \mu}{\sqrt {n \sigma ^2 }}$, æ ¹æ®ä¸­å¿ƒæé™å®šç†, å½“ $n \rightarrow \infty$ æ—¶, è®¤ä¸ºå…¶æ»¡è¶³æ­£æ€åˆ†å¸ƒ $N(0, 1)$.</p><p>è€Œæ­£æ€åˆ†å¸ƒ $N(\mu, \sigma^2)$ çš„æ¦‚ç‡å¯†åº¦å‡½æ•°ä¸º</p><p>$$f(x) = \frac{1}{\sqrt{ 2 \sigma^2 \pi }} e ^{ -\frac {(x-\mu)^2}{2 \sigma ^2} }$$</p><p>å¯¹äº $N(0, 1)$, å¸¦è¿›å»å¯å¾—</p><p>$$f(x) = \frac{1}{\sqrt{ 2 \pi}} e ^{ -\frac{x^2}{2} }$$</p><p>å…·ä½“åº”ç”¨åˆ°è¿™é“é¢˜ä¸­, ç”¨è‡ªé€‚åº” Simpson è®¡ç®—</p><p>$$\int _a^b f(x)\ dx$$</p><p>å°±å¥½äº†, å…¶ä¸­ $a = \dfrac{A_i - Y \mu}{\sqrt{ Y \sigma ^2 }},\ b = \dfrac{B_i - Y\mu}{\sqrt{ Y \sigma ^ 2}}$.</p><h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p>å°±è¿™æ ·å§ = =, åªèƒ½æµä¸‹æ²¡æœ‰æ•°ç†åŸºç¡€çš„çœ¼æ³ª.</p><p>è‡³ä»Šä¸çŸ¥é“ä¸ºä»€ä¹ˆç›´æ¥å¤§åŠ› Simpson $[L, R]$ ä¼šæŒ‚, å–ç«¯ç‚¹åšå·®å°±å¯¹äº† = =</p><p>å¯èƒ½æ˜¯å› ä¸º $L$ æ­£è´Ÿæ€§çš„é—®é¢˜?</p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2267</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">262145</span> &lt;&lt; <span class="number">1</span>, MAXM = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> PI = <span class="built_in">acos</span>(<span class="number">-1.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Complex</span> &#123;</span></span><br><span class="line">    <span class="keyword">double</span> x, y;</span><br><span class="line">    Complex(<span class="keyword">double</span> _x = <span class="number">0.0</span>, <span class="keyword">double</span> _y = <span class="number">0.0</span>): x(_x), y(_y) &#123; &#125;</span><br><span class="line">    Complex <span class="keyword">operator</span> + (<span class="keyword">const</span> Complex&amp; rhs) <span class="keyword">const</span> &#123; <span class="keyword">return</span> Complex(x + rhs.x, y + rhs.y); &#125;</span><br><span class="line">    Complex <span class="keyword">operator</span> - (<span class="keyword">const</span> Complex&amp; rhs) <span class="keyword">const</span> &#123; <span class="keyword">return</span> Complex(x - rhs.x, y - rhs.y); &#125;</span><br><span class="line">    Complex <span class="keyword">operator</span> * (<span class="keyword">const</span> Complex&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Complex(x * rhs.x - y * rhs.y, x * rhs.y + y * rhs.x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">Complex <span class="title">fpow</span><span class="params">(Complex base, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="function">Complex <span class="title">ret</span><span class="params">(<span class="number">1.0</span>, <span class="number">0.0</span>)</span></span>;</span><br><span class="line">    <span class="keyword">while</span> (b &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>) ret = ret * base;</span><br><span class="line">        base = base * base, b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Poly &#123;</span><br><span class="line">    <span class="keyword">int</span> r[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; Lim, <span class="keyword">const</span> <span class="keyword">int</span>&amp; L)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; Lim; ++i) r[i] = (r[i&gt;&gt;<span class="number">1</span>] &gt;&gt; <span class="number">1</span>) | ((i &amp; <span class="number">1</span>) &lt;&lt; (L<span class="number">-1</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">FFT</span><span class="params">(Complex* f, <span class="keyword">int</span> Lim, <span class="keyword">int</span> type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; Lim; ++i) <span class="keyword">if</span> (i &lt; r[i]) swap(f[i], f[r[i]]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> Mid = <span class="number">1</span>; Mid &lt; Lim; Mid &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="function">Complex <span class="title">unit</span><span class="params">(<span class="built_in">cos</span>(PI / Mid), type * <span class="built_in">sin</span>(PI / Mid))</span></span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; i += (Mid &lt;&lt; <span class="number">1</span>)) &#123;</span><br><span class="line">                <span class="function">Complex <span class="title">w</span><span class="params">(<span class="number">1.0</span>, <span class="number">0.0</span>)</span></span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; Mid; ++j, w = w * unit) &#123;</span><br><span class="line">                    Complex f0 = f[i+j], f1 = w * f[i+j+Mid];</span><br><span class="line">                    f[i+j] = f0 + f1, f[i+j+Mid] = f0 - f1;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (type &lt; <span class="number">0</span>) <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) f[i].x /= Lim;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> X, Y;</span><br><span class="line"><span class="keyword">int</span> A[MAXM], B[MAXM];</span><br><span class="line">Complex g[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">f</span><span class="params">(<span class="keyword">const</span> <span class="keyword">double</span>&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">double</span> frac = <span class="number">1.0</span> / <span class="built_in">sqrt</span>(<span class="number">2.0</span> * PI);</span><br><span class="line">    <span class="keyword">return</span> frac * <span class="built_in">exp</span>(x * x / <span class="number">-2.0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">simpson</span><span class="params">(<span class="keyword">const</span> <span class="keyword">double</span>&amp; L, <span class="keyword">const</span> <span class="keyword">double</span>&amp; R)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (R - L) / <span class="number">6.0</span> * (f(L) + f(R) + <span class="number">4.0</span> * f((L + R) / <span class="number">2.0</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">asr</span><span class="params">(<span class="keyword">double</span> L, <span class="keyword">double</span> R, <span class="keyword">const</span> <span class="keyword">double</span>&amp; eps, <span class="keyword">double</span> ans)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> Mid = (L + R) / <span class="number">2.0</span>;</span><br><span class="line">    <span class="keyword">double</span> fl = simpson(L, Mid), fr = simpson(Mid, R);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">fabs</span>(fl + fr - ans) &lt; <span class="number">15</span> * eps) <span class="keyword">return</span> fl + fr + (fl + fr - ans) / <span class="number">15</span>;</span><br><span class="line">    <span class="keyword">return</span> asr(L, Mid, eps / <span class="number">2.0</span>, fl) + asr(Mid, R, eps / <span class="number">2.0</span>, fr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> Ti;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;Ti);</span><br><span class="line">    <span class="keyword">while</span> (Ti--) &#123;</span><br><span class="line">        <span class="comment">// init</span></span><br><span class="line">        <span class="built_in">memset</span>(g, <span class="number">0</span>, <span class="keyword">sizeof</span> g);</span><br><span class="line">        <span class="comment">// input</span></span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;X, &amp;Y);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAXM; ++i) <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, A+i, B+i);</span><br><span class="line">        <span class="comment">// solve</span></span><br><span class="line">        <span class="keyword">if</span> (X * Y &lt; MAXN) &#123;</span><br><span class="line">            <span class="keyword">int</span> Lim = <span class="number">1</span>, L = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (Lim &lt;= X * Y) Lim &lt;&lt;= <span class="number">1</span>, ++L;</span><br><span class="line">            Poly::init(Lim, L);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; X; ++i) g[i].x = <span class="number">1.0</span> / X;</span><br><span class="line">            Poly::FFT(g, Lim, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) g[i] = fpow(g[i], Y);</span><br><span class="line">            Poly::FFT(g, Lim, <span class="number">-1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAXM; ++i) &#123;</span><br><span class="line">                <span class="keyword">double</span> ans = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = A[i]; j &lt;= B[i]; ++j) ans += g[j].x;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"%.6lf\n"</span>, ans);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">double</span> mu = (X - <span class="number">1.0</span>) / <span class="number">2.0</span>, sigma2 = (X * X - <span class="number">1.0</span>) / <span class="number">12.0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAXM; ++i) &#123;</span><br><span class="line">                <span class="keyword">double</span> L = (A[i] - Y * mu) / <span class="built_in">sqrt</span>(Y * sigma2),</span><br><span class="line">                       R = (B[i] - Y * mu) / <span class="built_in">sqrt</span>(Y * sigma2);</span><br><span class="line">                <span class="comment">// printf("%.7lf\n", asr(L, R, 1e-9, simpson(L, R)));</span></span><br><span class="line">                <span class="comment">// å¦‚æœä½¿ç”¨ä»¥ä¸Šå†™æ³•, æŸäº›ç­”æ¡ˆä¸º 1.0 çš„æƒ…å†µ, ç®—å‡ºæ¥æ˜¯ 0.0 = =</span></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"%.7lf\n"</span>, asr(<span class="number">0</span>, R, <span class="number">1e-9</span>, simpson(<span class="number">0</span>, R)) - asr(<span class="number">0</span>, L, <span class="number">1e-9</span>, simpson(<span class="number">0</span>, L)));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒSDOI2017ã€è‹¹æœæ ‘"><a href="#ã€ŒSDOI2017ã€è‹¹æœæ ‘" class="headerlink" title="ã€ŒSDOI2017ã€è‹¹æœæ ‘"></a>ã€ŒSDOI2017ã€è‹¹æœæ ‘</h3><h4 id="é¢˜ç›®é“¾æ¥-1"><a href="#é¢˜ç›®é“¾æ¥-1" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2268" target="_blank" rel="noopener">https://loj.ac/problem/2268</a></li></ul><h4 id="è§£é¢˜æ€è·¯-1"><a href="#è§£é¢˜æ€è·¯-1" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>è§‚å¯Ÿé¢˜æ„å¯ä»¥å‘ç°, å…³äº $k$ çš„é™å®šå¯ä»¥çœ‹ä½œå…è´¹å–ä¸€æ¡ä»æ ¹å¼€å§‹çš„é“¾, å†å– $k$ ä¸ªç‰©å“, å–å„¿å­å¿…é¡»å–è‡³å°‘ä¸€ä¸ªçˆ¶äº²çš„æ ‘å½¢ä¾èµ–èƒŒåŒ…. æ£˜æ‰‹çš„åœ°æ–¹åœ¨äºé“¾çš„å¤„ç†.</p><p>è€ƒè™‘æ€ä¹ˆæŠŠé“¾å¹²æ‰. å¯ä»¥å‘ç°, æ ‘ä¸Šç‚¹æƒéƒ½æ˜¯æ­£çš„, å¦‚æœå–ä¸€æ¡é“¾, é‚£ä¹ˆä¸€å®šä»æ ¹ä¸€ç›´å–åˆ°å¶å­. æ‰€ä»¥å¯ä»¥æšä¸¾å¶å­, æŠŠæ ‘åˆ†æˆé“¾å·¦åŠéƒ¨åˆ†å’Œå³åŠéƒ¨åˆ†.</p><p>å†çœ‹ä¸€éæ ‘çš„ç»“æ„, å®é™…ä¸ŠæŠŠæ ‘åˆ†æˆäº† 3 éƒ¨åˆ†</p><ol><li>é“¾ä¸Šå…è´¹å–çš„éƒ¨åˆ†</li><li>é“¾å·¦è¾¹ä»˜è´¹å–çš„éƒ¨åˆ† (æˆ‘ä»¬æŠŠé“¾ä¸Šä»˜è´¹å–çš„éƒ¨åˆ†å½’åˆ°è¿™é‡Œ)</li><li>é“¾å³è¾¹ä»˜è´¹å–çš„éƒ¨åˆ†</li></ol><p>æ‰€ä»¥è®¾ $f(i, j)$ è¡¨ç¤ºç¬¬ $i$ ä¸ªèŠ‚ç‚¹, ä½“ç§¯ä¸º $j$ çš„æœ€å¤§æ”¶ç›Š, ä¹Ÿå°±æ˜¯åœ¨è®¡ç®—ç¬¬ 2 éƒ¨åˆ†çš„ç­”æ¡ˆ.</p><p>ç±»ä¼¼åœ°, è®¾ $g(i, j)$ è¡¨ç¤º DFS åºç¿»è½¬å, ç¬¬ $i$ ä¸ªèŠ‚ç‚¹, ä½“ç§¯ä¸º $j$ çš„æœ€å¤§æ”¶ç›Š, ä¹Ÿå°±æ˜¯åœ¨è®¡ç®—ç¬¬ 3 éƒ¨åˆ†çš„ç­”æ¡ˆ.</p><p>æ ‘ä¸Šä¾èµ–çš„å…³ç³»ä¸å¥½å¤„ç†, è€ƒè™‘å°†æ¯ä¸ªç‰©å“æ•° $a_i &gt; 1$ èŠ‚ç‚¹æ‹†å¼€, æ‹†æˆä¸€ä¸ªç‰©å“æ•°ä¸º $1$ çš„èŠ‚ç‚¹ç•™åœ¨åŸæ¥çš„ä½ç½®, ä»¥åŠä¸€ä¸ªç‰©å“æ•°ä¸º $a_i - 1$ çš„èŠ‚ç‚¹æŒ‚åœ¨å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹æ—.</p><p>(å®é™…ä¸Šå»ºå›¾çš„æ—¶å€™å¹¶ä¸å¿…è¦æŠŠè¿™ä¸ªç‚¹çœŸçš„æ‹†å¼€, åœ¨è½¬ç§»çš„æ—¶å€™é¢å¤–åˆ¤æ–­å°±å¥½äº†).</p><p>æœ€åæšä¸¾å¶å­, ç´¯åŠ ç¬¬ 1 éƒ¨åˆ†, æŠŠå¦å¤–ä¸¤éƒ¨åˆ†æ‹¼èµ·æ¥å³å¯. (ä¹Ÿå°±æ˜¯ $f(i, j) + g(i, j-k)$)</p><p>æ³¨æ„åˆ°å¯¹äºæ¯ä¸ªèŠ‚ç‚¹çš„è½¬ç§», å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¤šé‡èƒŒåŒ…, ä½¿ç”¨å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–å³å¯.</p><p>æ—¶é—´å¤æ‚åº¦ $O(Qnk)$.</p><h4 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p>å®ç°å‚è€ƒäº† <a href="https://www.cnblogs.com/clrs97/p/7842530.html" target="_blank" rel="noopener">Claris</a>.</p><p>æœ‰äº›å¡å¸¸, éœ€è¦æŠŠ DP çš„äºŒç»´æ•°ç»„å¼€æˆä¸€ç»´, å¢åŠ ç¼“å­˜å‘½ä¸­ç‡.</p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2268</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">2e4</span> + <span class="number">5</span>, MAXK = <span class="number">5e5</span> + <span class="number">5</span>, MAXM = <span class="number">2</span> * MAXK + <span class="number">25e6</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, K, M, ans;</span><br><span class="line"><span class="keyword">int</span> pre[MAXN], A[MAXN], V[MAXN];</span><br><span class="line"><span class="keyword">int</span> f[MAXM], g[MAXM];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span>* F, <span class="keyword">const</span> <span class="keyword">int</span>&amp; a, <span class="keyword">const</span> <span class="keyword">int</span>&amp; v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> Q[MAXK], W[MAXK], head, tail;</span><br><span class="line">    Q[head = <span class="number">1</span>] = tail = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>; i &lt;= K; ++i, j += v) &#123;</span><br><span class="line">        F[i] -= j;</span><br><span class="line">        <span class="keyword">while</span> (head &lt;= tail &amp;&amp; F[Q[tail]] &lt; F[i]) --tail;</span><br><span class="line">        Q[++tail] = i;</span><br><span class="line">        <span class="keyword">while</span> (head &lt;= tail &amp;&amp; i - Q[head] &gt; a) ++head;</span><br><span class="line">        W[i] = F[Q[head]] + j;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memcpy</span>(F, W, M * <span class="keyword">sizeof</span> (<span class="keyword">int</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Graph &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt, to; &#125; edges[MAXN];</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], eidx;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; <span class="built_in">memset</span>(head, <span class="number">-1</span>, (n + <span class="number">1</span>) * <span class="keyword">sizeof</span> (<span class="keyword">int</span>)), eidx = <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to)</span> </span>&#123;</span><br><span class="line">        edges[++eidx] = (Edge)&#123; head[from], to &#125;;</span><br><span class="line">        head[from] = eidx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs0</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (A[u]) solve(f + M * u, A[u], V[u]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; ~i; i = edges[i].nxt) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edges[i].to;</span><br><span class="line">            <span class="built_in">memcpy</span>(f + M * v, f + M * u, M * <span class="keyword">sizeof</span> (<span class="keyword">int</span>));</span><br><span class="line">            dfs0(v);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= K; ++j)</span><br><span class="line">                f[M * u + j] = max(f[M * u + j], f[M * v + j - <span class="number">1</span>] + V[v]);</span><br><span class="line">            <span class="comment">// "è‡³å°‘å–ä¸€ä¸ªçˆ¶èŠ‚ç‚¹çš„ç‰©å“" çš„é™åˆ¶å°±ä½“ç°åœ¨è¿™é‡Œäº†, g(i, j) åŒç†</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; ~i; i = edges[i].nxt) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edges[i].to;</span><br><span class="line">            <span class="built_in">memcpy</span>(g + M * v, g + M * u, M * <span class="keyword">sizeof</span> (<span class="keyword">int</span>));</span><br><span class="line">            dfs1(v, s + V[u]);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= K; ++j)</span><br><span class="line">                g[M * u + j] = max(g[M * u + j], g[M * v + j - <span class="number">1</span>] + V[v]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (head[u] == <span class="number">-1</span>) <span class="comment">// leaf</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= K; ++j)</span><br><span class="line">                ans = max(ans, V[u] + s + f[M * u + j] + g[M * u + K - j]);</span><br><span class="line">        <span class="keyword">if</span> (A[u]) solve(g + M * u, A[u], V[u]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> Ti; read(Ti);</span><br><span class="line">    <span class="keyword">while</span> (Ti--) &#123;</span><br><span class="line">        <span class="comment">// input</span></span><br><span class="line">        read(n), read(K);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            read(pre[i]), read(A[i]), read(V[i]), --A[i];</span><br><span class="line">        <span class="comment">// init</span></span><br><span class="line">        ans = <span class="number">0</span>, M = K + <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">memset</span>(f + M, <span class="number">0</span>, M * <span class="keyword">sizeof</span> (<span class="keyword">int</span>));</span><br><span class="line">        <span class="built_in">memset</span>(g + M, <span class="number">0</span>, M * <span class="keyword">sizeof</span> (<span class="keyword">int</span>));</span><br><span class="line">        <span class="comment">// solve</span></span><br><span class="line">        Graph::init();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) Graph::AddEdge(pre[i], i);</span><br><span class="line">        Graph::dfs0(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">// å¯¹äº "DFS ç¿»è½¬", åç€å»ºå›¾å³å¯</span></span><br><span class="line">        Graph::init();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &gt;= <span class="number">2</span>; --i) Graph::AddEdge(pre[i], i);</span><br><span class="line">        Graph::dfs1(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">// output</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒSDOI2017ã€åˆ‡æ ‘æ¸¸æˆ"><a href="#ã€ŒSDOI2017ã€åˆ‡æ ‘æ¸¸æˆ" class="headerlink" title="ã€ŒSDOI2017ã€åˆ‡æ ‘æ¸¸æˆ"></a>ã€ŒSDOI2017ã€åˆ‡æ ‘æ¸¸æˆ</h3><h4 id="é¢˜ç›®é“¾æ¥-2"><a href="#é¢˜ç›®é“¾æ¥-2" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2269" target="_blank" rel="noopener">https://loj.ac/problem/2269</a></li></ul><h4 id="è§£é¢˜æ€è·¯-2"><a href="#è§£é¢˜æ€è·¯-2" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>å…ˆç¥­ä¸Š <a href="http://immortalco.blog.uoj.ac/blog/2625" target="_blank" rel="noopener">çŒ«é”Ÿçš„è§£é¢˜æŠ¥å‘Š</a>.</p><p>ç„¶åå°±æ˜¯åŠ¨æ€ DP äº†.</p><p>æ­¤å¤„ä¿¡æ¯ä»å…·æœ‰å¯å‡æ€§, ç»´æŠ¤æ•°é 0 éƒ¨åˆ†çš„ç§¯, ä»¥åŠä¹˜ç§¯ä¸­ 0 çš„ä¸ªæ•°å³å¯äº†.</p><p>è½å®åˆ°ä»£ç ä¸­å°±æ˜¯é‚£ä¸ª <code>Num</code> äº†.</p><p>è¿˜æœ‰ä¸ªå¯ä»¥å€Ÿé‰´çš„ Trick å°±æ˜¯åŒ–ç®€çŸ©é˜µå‡å°å¸¸æ•°äº†. ç›´æ¥æ¬æ¥ immortalCO çš„å…¬å¼.</p><p>$$\begin{pmatrix} \underline{a_1} &amp; \underline{b_1} &amp; 0 \\ 0 &amp; 1 &amp; 0 \\ \underline{c_1} &amp; \underline{d_1} &amp; 1 \end{pmatrix} \times \begin{pmatrix} \underline{a_2} &amp; \underline{b_2} &amp; 0 \\ 0 &amp; 1 &amp; 0 \\ \underline{c_2} &amp; \underline{d_2} &amp; 1 \end{pmatrix} = \begin{pmatrix} \underline{a_1 a_2} &amp; \underline{b_1 + a_1 b_2} &amp; 0 \\ 0 &amp; 1 &amp; 0 \\ \underline{a_2 c_1 + c_2} &amp; \underline{b_2 c_1 + d_1 + d_2} &amp; 1 \end{pmatrix}$$</p><p>è¿ç”¨è¿™ä¸ª Trick çš„æ—¶å€™, éœ€è¦é¢å¤–æ³¨æ„çŸ©é˜µçš„è¿ç®—é¡ºåº.</p><p>åŠ¨æ€ DP é‡‡ç”¨æ ‘é“¾å‰–åˆ†å®ç°, æ—¶é—´å¤æ‚åº¦ $O(n\log ^ 3 n)$.</p><p><del>æœ€è¿‘ä¸€ç¾¤æ¯’ç˜¤çœ‹ç€è¿™ä¸ª log^3 ä¸çˆ½, çœ‹æ¥è¦å»å­¦ DDP çš„ LCT å®ç°äº†</del></p><h4 id="ä»£ç å®ç°-2"><a href="#ä»£ç å®ç°-2" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2269</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read; <span class="keyword">using</span> IO::Gc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">3e4</span>+<span class="number">5</span>, MAXM = <span class="number">128</span>, P = <span class="number">10007</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">FWT</span><span class="params">(<span class="keyword">int</span>* f, <span class="keyword">int</span> Lim, <span class="keyword">int</span> type)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> LL inv2 = <span class="number">5004</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>, Mid = <span class="number">2</span>; Mid &lt;= Lim; Mid &lt;&lt;= <span class="number">1</span>, k &lt;&lt;= <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; i += Mid)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; k; ++j) &#123;</span><br><span class="line">                <span class="keyword">int</span> f0 = f[i+j], f1 = f[i+j+k];</span><br><span class="line">                f[i+j] = (f0 + f1) % P, f[i+j+k] = (f0 - f1 + P) % P;</span><br><span class="line">                <span class="keyword">if</span> (type == <span class="number">-1</span>) f[i+j] = inv2 * f[i+j] % P, f[i+j+k] = inv2 * f[i+j+k] % P;</span><br><span class="line">            &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, q;</span><br><span class="line"><span class="keyword">int</span> E[MAXM][MAXM], V[MAXN], inv[P];</span><br><span class="line"><span class="keyword">int</span> f[MAXN][MAXM], g[MAXN][MAXM], lg[MAXN][MAXM];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Num</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> x, c;</span><br><span class="line">    Num() &#123; x = c = <span class="number">0</span>; &#125;</span><br><span class="line">    Num(<span class="keyword">int</span> _x): x((_x == <span class="number">0</span>)? <span class="number">1</span>: _x), c(_x == <span class="number">0</span>) &#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">val</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> c? <span class="number">0</span>: x; &#125;</span><br><span class="line">    Num&amp; <span class="keyword">operator</span>*= (<span class="keyword">const</span> <span class="keyword">int</span>&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (rhs != <span class="number">0</span>) x = <span class="number">1L</span>L * x * rhs % P; <span class="keyword">else</span> ++c;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Num&amp; <span class="keyword">operator</span>/= (<span class="keyword">const</span> <span class="keyword">int</span>&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (rhs != <span class="number">0</span>) x = <span class="number">1L</span>L * x * inv[rhs] % P; <span class="keyword">else</span> --c;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; lf[MAXN][MAXM];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Graph &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt, to; &#125; edges[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], eidx;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="keyword">sizeof</span> head), eidx = <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to)</span> </span>&#123;</span><br><span class="line">        edges[++eidx] = (Edge)&#123; head[from], to &#125;;</span><br><span class="line">        head[from] = eidx;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> HLD &#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> Graph;</span><br><span class="line">    <span class="keyword">int</span> son[MAXN], pre[MAXN], depth[MAXN], size[MAXN];</span><br><span class="line">    <span class="keyword">int</span> dfn[MAXN], Ed[MAXN], rnk[MAXN], topfa[MAXN], dfs_clock;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa)</span> </span>&#123;</span><br><span class="line">        depth[u] = depth[fa] + <span class="number">1</span>;</span><br><span class="line">        size[u] = <span class="number">1</span>, son[u] = <span class="number">-1</span>, pre[u] = fa;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; ++j) f[u][j] = E[V[u]][j];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = head[u]; ~i; i = edges[i].nxt) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((v = edges[i].to) == fa) <span class="keyword">continue</span>;</span><br><span class="line">            dfs1(v, u), size[u] += size[v];</span><br><span class="line">            <span class="keyword">if</span> (son[u] == <span class="number">-1</span> || size[v] &gt; size[son[u]]) son[u] = v;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; ++j) &#123;</span><br><span class="line">                f[u][j] = (f[u][j] + <span class="number">1L</span>L * f[u][j] * f[v][j] % P) % P;</span><br><span class="line">                g[u][j] = (g[u][j] + g[v][j]) % P;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; ++j) g[u][j] = (g[u][j] + f[u][j]) % P;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> top)</span> </span>&#123;</span><br><span class="line">        topfa[u] = top;</span><br><span class="line">        dfn[u] = ++dfs_clock, rnk[dfs_clock] = u, Ed[top] = dfs_clock;</span><br><span class="line">        <span class="keyword">if</span> (~son[u]) dfs2(son[u], top);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; ++j) lf[u][j] = Num(E[<span class="number">0</span>][j]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = head[u]; ~i; i = edges[i].nxt) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((v = edges[i].to) == pre[u] || v == son[u]) <span class="keyword">continue</span>;</span><br><span class="line">            dfs2(v, v);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; ++j)</span><br><span class="line">                lf[u][j] *= (<span class="number">1</span> + f[v][j]) % P, lg[u][j] = (lg[u][j] + g[v][j]) % P;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> rt = <span class="number">1</span>)</span> </span>&#123; dfs1(rt, <span class="number">0</span>), dfs2(rt, rt); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> A[MAXM], B[MAXM], C[MAXM], D[MAXM];</span><br><span class="line">    Node() &#123; <span class="built_in">memset</span>(<span class="keyword">this</span>, <span class="number">0</span>, <span class="keyword">sizeof</span> *<span class="keyword">this</span>); &#125;</span><br><span class="line">    Node <span class="keyword">operator</span> * (<span class="keyword">const</span> Node&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">        Node ret;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; ++i) &#123;</span><br><span class="line">            ret.A[i] = <span class="number">1L</span>L * A[i] * rhs.A[i] % P;</span><br><span class="line">            ret.B[i] = (<span class="number">1L</span>L * A[i] * rhs.B[i] % P + B[i]) % P;</span><br><span class="line">            ret.C[i] = (<span class="number">1L</span>L * rhs.A[i] * C[i] % P + rhs.C[i]) % P;</span><br><span class="line">            ret.D[i] = (<span class="number">1L</span>L * C[i] * rhs.B[i] % P + rhs.D[i] + D[i]) % P;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SGT &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lc (nd&lt;&lt;1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rc (nd&lt;&lt;1|1)</span></span><br><span class="line">    Node dat[MAXN &lt;&lt; <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">maintain</span><span class="params">(<span class="keyword">int</span> nd)</span> </span>&#123; dat[nd] = dat[rc] * dat[lc]; &#125;</span><br><span class="line">    <span class="comment">// æ³¨æ„ maintain åˆå¹¶ä¸¤çŸ©é˜µçš„é¡ºåº</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; ++i) &#123;</span><br><span class="line">            <span class="keyword">int</span> a = <span class="number">1L</span>L * lf[u][i].val() * E[V[u]][i] % P;</span><br><span class="line">            dat[nd].A[i] = dat[nd].B[i] = dat[nd].C[i] = a;</span><br><span class="line">            dat[nd].D[i] = (a + lg[u][i]) % P;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (L == R) <span class="keyword">return</span> newnode(nd, HLD::rnk[L]);</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        build(lc, L, Mid), build(rc, Mid+<span class="number">1</span>, R);</span><br><span class="line">        maintain(nd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; pos)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (L == R) <span class="keyword">return</span> newnode(nd, HLD::rnk[L]);</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (pos &lt;= Mid) Mdy(lc, L, Mid, pos);</span><br><span class="line">        <span class="keyword">else</span> Mdy(rc, Mid+<span class="number">1</span>, R, pos);</span><br><span class="line">        maintain(nd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">Node <span class="title">Qry</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opL, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opR)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (opL &lt;= L &amp;&amp; R &lt;= opR) <span class="keyword">return</span> dat[nd];</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (opR &lt;= Mid) <span class="keyword">return</span> Qry(lc, L, Mid, opL, opR);</span><br><span class="line">        <span class="keyword">if</span> (opL &gt; Mid) <span class="keyword">return</span> Qry(rc, Mid+<span class="number">1</span>, R, opL, opR);</span><br><span class="line">        <span class="keyword">return</span> Qry(rc, Mid+<span class="number">1</span>, R, opL, opR) * Qry(lc, L, Mid, opL, opR);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> lc</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> rc</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> t1[MAXN], t2[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> HLD &#123;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Qry</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">        Node res = SGT::Qry(<span class="number">1</span>, <span class="number">1</span>, n, dfn[u], Ed[u]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; ++i) t1[i] = res.C[i], t2[i] = res.D[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        V[u] = val;</span><br><span class="line">        <span class="keyword">while</span> (u &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> fa = pre[topfa[u]];</span><br><span class="line">            Qry(topfa[u]);</span><br><span class="line">            <span class="keyword">if</span> (fa) <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; ++i)</span><br><span class="line">                lf[fa][i] /= (t1[i] + <span class="number">1</span>) % P, lg[fa][i] = (lg[fa][i] - t2[i] + P) % P;</span><br><span class="line">            SGT::Mdy(<span class="number">1</span>, <span class="number">1</span>, n, dfn[u]);</span><br><span class="line">            Qry(topfa[u]);</span><br><span class="line">            <span class="keyword">if</span> (fa) <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; ++i)</span><br><span class="line">                lf[fa][i] *= (t1[i] + <span class="number">1</span>) % P, lg[fa][i] = (lg[fa][i] + t2[i]) % P;</span><br><span class="line">            u = fa;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// init</span></span><br><span class="line">    Graph::init();</span><br><span class="line">    inv[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt; P; ++i) inv[i] = <span class="number">1L</span>L * (P - P / i) * inv[P % i] % P;</span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n), read(m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) read(V[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> u, v, i = <span class="number">1</span>; i &lt; n; ++i)</span><br><span class="line">        read(u), read(v), Graph::AddEdge(u, v), Graph::AddEdge(v, u);</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; ++i) E[i][i] = <span class="number">1</span>, FWT(E[i], m, <span class="number">1</span>);</span><br><span class="line">    HLD::solve(), SGT::build(<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    read(q);</span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> opt, x, y;</span><br><span class="line">        opt = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isspace</span>(opt)) opt = Gc();</span><br><span class="line">        read(x);</span><br><span class="line">        <span class="keyword">switch</span> (opt) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'C'</span>: read(y), HLD::Mdy(x, y); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'Q'</span>: HLD::Qry(<span class="number">1</span>), FWT(t2, m, <span class="number">-1</span>), <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, t2[x]); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>: <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"ERR\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒSDOI2017ã€å¤©æ‰é»‘å®¢"><a href="#ã€ŒSDOI2017ã€å¤©æ‰é»‘å®¢" class="headerlink" title="ã€ŒSDOI2017ã€å¤©æ‰é»‘å®¢"></a>ã€ŒSDOI2017ã€å¤©æ‰é»‘å®¢</h3><h4 id="é¢˜ç›®é“¾æ¥-3"><a href="#é¢˜ç›®é“¾æ¥-3" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2270" target="_blank" rel="noopener">https://loj.ac/problem/2270</a></li></ul><h4 id="è§£é¢˜æ€è·¯-3"><a href="#è§£é¢˜æ€è·¯-3" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>å¦‚æœæŠŠè¾¹çœ‹ä½œç‚¹, å®¹æ˜“å¾—åˆ°è¿™æ ·ä¸€ä¸ªåšæ³•:</p><ol><li>æšä¸¾è¾¹, å‡è®¾å½“å‰æšä¸¾åˆ°çš„è¾¹ä¸º $(a, b)$.</li><li>æ‰¾åˆ°å½¢å¦‚ $(b, c)$ çš„è¾¹, ä¸¤è€…ä¹‹é—´è¿è¾¹, è¾¹æƒä¸ºä¸¤è€… LCP, ä¹Ÿå°±æ˜¯ Trie æ ‘ä¸Š LCA åˆ°æ ¹çš„è·ç¦».</li><li>è·‘ Dijkstra, å¯¹äºæ¯ä¸ªç‚¹ $u$, æ‰¾åˆ°å½¢å¦‚ $(a, u)$ çš„è¾¹æ›´æ–°ç­”æ¡ˆ.</li></ol><p>ä½†æ˜¯è¿™ä¸ªç®—æ³•æœ‰ä¸€ä¸ªæ˜æ˜¾çš„é—®é¢˜, é‡åˆ°åŸå›¾ä¸­ç‚¹æ•°åº¦æ•°å¾ˆå¤§çš„æƒ…å†µå°±ä¼šè¿å¾ˆå¤šè¾¹â€¦</p><p>è€ƒè™‘å¦‚ä½•ä¼˜åŒ–è¿™ä¸ªè¿‡ç¨‹. </p><p>å¯¹äº Trie ä¸Šä¸€ä¸ªèŠ‚ç‚¹ $u$, å°† $u$ å‘¨å›´ä¸€åœˆèŠ‚ç‚¹æŒ‰ DFS åºæ’åº, ç±»ä¼¼äºåç¼€æ•°ç»„, è®¾ $h_i = \operatorname{LCP}(s_i, s_{i+1})$, é‚£ä¹ˆ</p><p>$$\operatorname{LCP}(s_L,\ s_R) = \min \{ h_j \mid L \le j \le R \}$$</p><p>åˆ©ç”¨åç¼€æ•°ç»„ä¸­å¸¸è§å¥—è·¯, å¯ä»¥åˆ©ç”¨å•è°ƒæ ˆæ±‚å‡º LCP ä¸º $h_i$ çš„ä¸€æ®µåŒºé—´, ç„¶åç‚¹å‘åŒºé—´è¿è¾¹, åŒºé—´å‘ç‚¹è¿è¾¹å³å¯. åˆ©ç”¨çº¿æ®µæ ‘ä¼˜åŒ–å»ºå›¾å³å¯.</p><p>ä½†æ˜¯æœ‰æ›´åŠ ç®€ä¾¿çš„åŠæ³•. è¿˜æ˜¯å¼•ç”¨ <a href="https://www.cnblogs.com/clrs97/p/7833797.html" target="_blank" rel="noopener">Claris çš„åšå®¢</a>:</p><blockquote><p>æšä¸¾æ¯ä¸ª $h_i$ ä½œä¸ºåˆ†ç•Œçº¿ï¼Œé‚£ä¹ˆæ–°å›¾ä¸­ä¸¤ä¾§çš„ç‚¹å‡å¯ä»¥é€šè¿‡ä¸è¶…è¿‡ $h_i$ çš„ä»£ä»·äº’ç›¸è®¿é—®.</p><p>å»ºç«‹ä¸€æ’å‰ç¼€è™šç‚¹å’Œåç¼€è™šç‚¹ç„¶åå¯¹åº”å‰åç¼€ä¹‹é—´è¿è¾¹å³å¯.</p></blockquote><p>å…·ä½“åœ°è¯´, å‰ç¼€å…¥ç‚¹ <code>prei</code> å’Œå‰ç¼€å‡ºç‚¹ <code>preo</code> ä¹‹é—´è¾¹æƒåˆ†åˆ«ä¸º $0$, æ¯ä¸ª <code>prei[i]</code> å‘ <code>preo[i+1]</code> è¿è¾¹, æƒå€¼ä¸º $h_i$.</p><p>è¿™æ ·è¿è¾¹å°±ä»¥è¾ƒå°çš„ä»£ä»·åšäº†ç­‰æ•ˆçš„äº‹æƒ…. åç¼€åŒç†.</p><p>å¯èƒ½è¿˜æ˜¯æœ‰äº›æŠ½è±¡, ä¸è¿‡åœ¨ä»£ç å®ç°é‡Œè¿˜æ˜¯å¾ˆæ¸…æ™°çš„. ä»¥åŠä¸€äº›å…¥ç‚¹å‡ºç‚¹çš„ç»†èŠ‚ä¹Ÿä½“ç°åœ¨ä»£ç é‡Œ.</p><p>æ—¶é—´å¤æ‚åº¦ $O(m \log m)$.</p><h4 id="ä»£ç å®ç°-3"><a href="#ä»£ç å®ç°-3" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p>ä½ é—®æˆ‘ä¸ºä»€ä¹ˆæ‰§æ„å†™æ ‘å‰–æ±‚ LCAâ€¦ è¿™â€¦ æˆ‘è¦æ˜¯ä¼šå€å¢æˆ‘ä¸å°±å†™å€å¢äº†å— = =</p><p>ä»¥åŠè¾¹æ‹†ä¸ºç‚¹æ—¶, å¹¶ä¸éœ€è¦é¢å¤–æ–°å¢ä¸€æ¡è¾¹è®°å½•åˆå§‹è¾¹æƒ, ç›´æ¥è§†ä½œç‚¹æƒåœ¨è·‘ Dijkstra çš„è¿‡ç¨‹ä¸­æ›´æ–°å³å¯.</p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2270</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;climits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; Pii;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">5e4</span> + <span class="number">5</span>, MAXK = <span class="number">2e4</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXV = MAXN * <span class="number">10</span>, MAXE = <span class="number">1e6</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, K, uidx;</span><br><span class="line"><span class="keyword">int</span> U[MAXN], D[MAXN], Ans[MAXN];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; In[MAXN], Out[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Graph &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt, to, w; &#125; edges[MAXE];</span><br><span class="line">    <span class="keyword">int</span> head[MAXV], eidx;</span><br><span class="line">    <span class="keyword">int</span> dist[MAXV], val[MAXV];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="keyword">sizeof</span> head), eidx = <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to, <span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">        edges[++eidx] = (Edge)&#123; head[from], to, w &#125;, head[from] = eidx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Dijkstra</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        priority_queue&lt;Pii, <span class="built_in">vector</span>&lt;Pii&gt;, greater&lt;Pii&gt; &gt; PQ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= uidx; ++i) dist[i] = INT_MAX;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            <span class="keyword">if</span> (U[i] == <span class="number">1</span>) PQ.push(Pii(dist[i] = val[i], i));</span><br><span class="line">        <span class="keyword">while</span> (!PQ.empty()) &#123;</span><br><span class="line">            <span class="keyword">int</span> d = PQ.top().first, u = PQ.top().second; PQ.pop();</span><br><span class="line">            <span class="keyword">if</span> (d != dist[u]) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; ~i; i = edges[i].nxt) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = edges[i].to;</span><br><span class="line">                <span class="keyword">if</span> (dist[v] &gt; val[v] + dist[u] + edges[i].w)</span><br><span class="line">                    PQ.push(Pii(dist[v] = val[v] + dist[u] + edges[i].w, v));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> u = <span class="number">2</span>; u &lt;= n; ++u) &#123;</span><br><span class="line">            Ans[u] = INT_MAX;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; In[u].size(); ++i)</span><br><span class="line">                Ans[u] = min(Ans[u], Graph::dist[In[u][i]]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> HLD &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt, to; &#125; edges[MAXK];</span><br><span class="line">    <span class="keyword">int</span> head[MAXK], eidx;</span><br><span class="line">    <span class="keyword">int</span> depth[MAXK], pre[MAXK], son[MAXK], size[MAXK];</span><br><span class="line">    <span class="keyword">int</span> topfa[MAXK], dfn[MAXK], dfs_clock;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="keyword">sizeof</span> head), eidx = <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to)</span> </span>&#123;</span><br><span class="line">        edges[++eidx] = (Edge)&#123; head[from], to &#125;, head[from] = eidx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa)</span> </span>&#123;</span><br><span class="line">        depth[u] = depth[fa] + <span class="number">1</span>;</span><br><span class="line">        son[u] = <span class="number">-1</span>, size[u] = <span class="number">1</span>, pre[u] = fa;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = head[u]; ~i; i = edges[i].nxt) &#123;</span><br><span class="line">            dfs1(v = edges[i].to, u), size[u] += size[v];</span><br><span class="line">            <span class="keyword">if</span> (son[u] == <span class="number">-1</span> || size[son[u]] &lt; size[v]) son[u] = v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> top)</span> </span>&#123;</span><br><span class="line">        topfa[u] = top, dfn[u] = ++dfs_clock;</span><br><span class="line">        <span class="keyword">if</span> (~son[u]) dfs2(son[u], top);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = head[u]; ~i; i = edges[i].nxt)</span><br><span class="line">            <span class="keyword">if</span> ((v = edges[i].to) != son[u]) dfs2(v, v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> rt = <span class="number">1</span>)</span> </span>&#123;</span><br><span class="line">        depth[<span class="number">0</span>] = <span class="number">-1</span>, dfs1(rt, <span class="number">0</span>), dfs2(rt, rt);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (topfa[u] != topfa[v]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (depth[topfa[u]] &lt; depth[topfa[v]]) swap(u, v);</span><br><span class="line">            u = pre[topfa[u]];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> depth[u] &gt; depth[v]? v: u;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Abs</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123; <span class="keyword">return</span> x &lt; <span class="number">0</span>? -x: x; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; x, <span class="keyword">const</span> <span class="keyword">int</span>&amp; y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dfn[D[Abs(x)]] &lt; dfn[D[Abs(y)]];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> preo[MAXN], prei[MAXN], sufi[MAXN], sufo[MAXN], q[MAXN];</span><br><span class="line">        <span class="keyword">int</span> nq = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; In[u].size(); ++i) q[++nq] = In[u][i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; Out[u].size(); ++i) q[++nq] = -Out[u][i];</span><br><span class="line">        <span class="comment">// åŒºåˆ†å‡ºå…¥ç‚¹å’Œå‡ºç‚¹</span></span><br><span class="line">        sort(q+<span class="number">1</span>, q+<span class="number">1</span>+nq, cmp);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nq; ++i) &#123;</span><br><span class="line">            preo[i] = ++uidx, prei[i] = ++uidx, sufo[i] = ++uidx, sufi[i] = ++uidx;</span><br><span class="line">            <span class="keyword">if</span> (i &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                Graph::AddEdge(preo[i<span class="number">-1</span>], preo[i], <span class="number">0</span>), Graph::AddEdge(prei[i<span class="number">-1</span>], prei[i], <span class="number">0</span>);</span><br><span class="line">                Graph::AddEdge(sufo[i], sufo[i<span class="number">-1</span>], <span class="number">0</span>), Graph::AddEdge(sufi[i], sufi[i<span class="number">-1</span>], <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (q[i] &gt; <span class="number">0</span>)</span><br><span class="line">                Graph::AddEdge(q[i], prei[i], <span class="number">0</span>), Graph::AddEdge(q[i], sufi[i], <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                q[i] = -q[i], Graph::AddEdge(preo[i], q[i], <span class="number">0</span>), Graph::AddEdge(sufo[i], q[i], <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; nq; ++i) &#123;</span><br><span class="line">            <span class="keyword">int</span> lca = LCA(D[q[i]], D[q[i + <span class="number">1</span>]]);</span><br><span class="line">            Graph::AddEdge(prei[i], preo[i + <span class="number">1</span>], depth[lca]);</span><br><span class="line">            Graph::AddEdge(sufi[i + <span class="number">1</span>], sufo[i], depth[lca]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> Ti; read(Ti);</span><br><span class="line">    <span class="keyword">while</span> (Ti--) &#123;</span><br><span class="line">        <span class="comment">// init</span></span><br><span class="line">        Graph::init(), HLD::init();</span><br><span class="line">        <span class="comment">// input</span></span><br><span class="line">        read(n), read(m), read(K); uidx = m;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">            read(U[i]), read(v), read(Graph::val[i]), read(D[i]);</span><br><span class="line">            In[v].push_back(i), Out[U[i]].push_back(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> u, v, w, i = <span class="number">1</span>; i &lt; K; ++i)</span><br><span class="line">            read(u), read(v), read(w), HLD::AddEdge(u, v);</span><br><span class="line">        <span class="comment">// solve</span></span><br><span class="line">        HLD::solve();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) HLD::build(i);</span><br><span class="line">        Graph::Dijkstra();</span><br><span class="line">        <span class="comment">// output</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, Ans[i]);</span><br><span class="line">        <span class="comment">// clear</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) Graph::val[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) In[i].clear(), Out[i].clear();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒSDOI2017ã€é—å¿˜çš„é›†åˆ"><a href="#ã€ŒSDOI2017ã€é—å¿˜çš„é›†åˆ" class="headerlink" title="ã€ŒSDOI2017ã€é—å¿˜çš„é›†åˆ"></a>ã€ŒSDOI2017ã€é—å¿˜çš„é›†åˆ</h3><h4 id="é¢˜ç›®é“¾æ¥-4"><a href="#é¢˜ç›®é“¾æ¥-4" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/submission/759802" target="_blank" rel="noopener">https://loj.ac/submission/759802</a></li></ul><h4 id="è§£é¢˜æ€è·¯-4"><a href="#è§£é¢˜æ€è·¯-4" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>å¦‚æœæŠŠæ‰€æ±‚å’Œå·²çŸ¥äº¤æ¢, é‚£ä¹ˆè¿™é“é¢˜å°±æ˜¯ä¸€é“ç”Ÿæˆå‡½æ•°å¥—è·¯é¢˜äº†.</p><p>è®¾åºåˆ— $a_i$ è¡¨ç¤ºå…ƒç´  $i$ æ˜¯å¦å­˜åœ¨äºé›†åˆ $S$ ä¸­. é‚£ä¹ˆå– $S$ ä¸­å…ƒç´ ä¹‹å’Œçš„æ–¹æ¡ˆæ•°çš„ç”Ÿæˆå‡½æ•°ä¸º</p><p>$$F(x) = \prod_{i \in S} (\sum_{k=0}^{\infty} x^{ki}) = \prod_{i \in S} \frac{1}{1 - x^i} = \prod_{i=1}^n (\frac{1}{1 - x^i} ) ^ {a_i}$$</p><p>çœ‹åˆ°ä¹˜ç§¯ä¸çˆ½. ä¸¤è¾¹åŒæ—¶å– $\ln$, å¾—</p><p>$$- \ln F(x) = \sum_{i=1}^n a_i \ln (1-x^i)$$</p><p>è®° $g(x) = \ln (1-x^i)$, é‚£ä¹ˆå¯¹ $g(x)$ æ±‚å¯¼å¾—åˆ°</p><p><del>è¿™ä¸ªæŠ€å·§ä¼¼ä¹å«åš â€œ<a href="https://zh.wikipedia.org/wiki/%E5%AF%B9%E6%95%B0%E5%BE%AE%E5%88%86%E6%B3%95" target="_blank" rel="noopener">å¯¹æ•°å¾®åˆ†æ³•</a>â€œ?</del></p><p>$$\frac{(1 - x^i)â€™}{1 - x^i} = \frac{-i x^{i-1}}{1 - x^i} = gâ€™(x)$$</p><p>ç”±å¹¿ä¹‰äºŒé¡¹å¼å®šç†, å¾—</p><p>$$-ix^{i-1} \sum_{k=0}^{\infty} x ^{ki} = -\sum_{k=0}^{\infty} i x^{ki +i-1} = gâ€™(x)$$</p><p>å†ç§¯åˆ†, å¾—</p><p>$$-\sum_{k=0} ^ {\infty} \frac{i}{ki + i} x^{ki + i} = -\sum_{k=1}^{\infty} \frac{1}{k} x ^ {ki} = g(x) $$</p><p>æ‰€ä»¥æˆ‘ä»¬å°±å¾—åˆ°äº†</p><p>$$g(x) = \ln (1 - x^i) = -\sum_{k=1}^{\infty} \frac{1}{k} x^{ki}$$</p><p>ä»£å…¥åŸå¼, å¯ä»¥å¾—åˆ°</p><p>$$\ln F(x) = \sum_{i=1}^n a_i \sum_{k=1}^{\infty} \frac{1}{k} x^{ki}$$</p><p>è®¾ $T = ki$, å¹¶äº¤æ¢æšä¸¾é¡ºåº, å¾—</p><p>$$\ln F(x) = \sum_{T=1}^\infty (\sum_{d \mid T} a_d \frac{d}{T} ) x^T$$</p><p>è‡³æ­¤, è¿™é“é¢˜å°±åšå®Œäº†. å¯¹ç»™å®šçš„ $F(x)$ æ±‚ $\ln$ åè«æ¯”ä¹Œæ–¯åæ¼”å³å¯.</p><p>æ­¤å¤„å¹¶ä¸éœ€è¦ç­›å‡ºæ¥ $\mu$ ä¹‹å $O(\sqrt n)$ æšä¸¾çº¦æ•°â€¦ ç›´æ¥åˆ©ç”¨ <a href="http://vfleaking.blog.uoj.ac/blog/87" target="_blank" rel="noopener">VFleaKing åæ¼”è¯¾ä»¶</a> é‡Œçš„æŠ€å·§å³å¯.</p><p>æ—¶é—´å¤æ‚åº¦ $O(n\log n)$.</p><p>å…¶å®æ•´ä¸ªè¿‡ç¨‹å«åš â€œEuler Transformâ€? ç±»ä¼¼çš„æŠ€å·§ä¹Ÿåœ¨ <a href="https://www.luogu.com.cn/problem/P4389" target="_blank" rel="noopener">Luogu P4389 ä»˜å…¬ä¸»çš„èƒŒåŒ…</a> ç”¨åˆ°è¿‡.</p><h4 id="ä»£ç å®ç°-4"><a href="#ä»£ç å®ç°-4" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p>å…ˆæ»šè¿‡å»å­¦äº† MTT æ‰å†™äº†è¿™é“é¢˜ = =</p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2271</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">19</span>, M = (<span class="number">1</span> &lt;&lt; <span class="number">15</span>) - <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> PI = <span class="built_in">acos</span>(<span class="number">-1.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Complex</span> &#123;</span></span><br><span class="line">    <span class="keyword">double</span> x, y;</span><br><span class="line">    Complex(<span class="keyword">double</span> _x = <span class="number">0.0</span>, <span class="keyword">double</span> _y = <span class="number">0.0</span>): x(_x), y(_y) &#123; &#125;</span><br><span class="line">    Complex <span class="keyword">operator</span> + (<span class="keyword">const</span> Complex&amp; rhs) <span class="keyword">const</span> &#123; <span class="keyword">return</span> Complex(x + rhs.x, y + rhs.y); &#125;</span><br><span class="line">    Complex <span class="keyword">operator</span> - (<span class="keyword">const</span> Complex&amp; rhs) <span class="keyword">const</span> &#123; <span class="keyword">return</span> Complex(x - rhs.x, y - rhs.y); &#125;</span><br><span class="line">    Complex <span class="keyword">operator</span> * (<span class="keyword">const</span> Complex&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Complex(x * rhs.x - y * rhs.y, x * rhs.y + y * rhs.x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Complex <span class="title">conj</span><span class="params">(<span class="keyword">const</span> Complex&amp; p)</span> </span>&#123; <span class="keyword">return</span> Complex(p.x, -p.y); &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> P;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fpow</span><span class="params">(<span class="keyword">int</span> base, <span class="keyword">int</span> b, <span class="keyword">int</span> m = P)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (b &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>) ret = <span class="number">1L</span>L * ret * base % m;</span><br><span class="line">        base = <span class="number">1L</span>L * base * base % m, b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret % m;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Poly &#123;</span><br><span class="line">    <span class="keyword">int</span> r[MAXN];</span><br><span class="line">    Complex W[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; Lim, <span class="keyword">const</span> <span class="keyword">int</span>&amp; L)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; Lim; ++i) r[i] = (r[i&gt;&gt;<span class="number">1</span>] &gt;&gt; <span class="number">1</span>) | ((i &amp; <span class="number">1</span>) &lt;&lt; (L<span class="number">-1</span>));</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) W[i] = Complex(<span class="built_in">cos</span>(PI / Lim * i), <span class="built_in">sin</span>(PI / Lim * i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">FFT</span><span class="params">(Complex* f, <span class="keyword">const</span> <span class="keyword">int</span>&amp; Lim)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; Lim; ++i) <span class="keyword">if</span> (i &lt; r[i]) swap(f[i], f[r[i]]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> Mid = <span class="number">1</span>; Mid &lt; Lim; Mid &lt;&lt;= <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; i += Mid &lt;&lt; <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; Mid; ++j) &#123;</span><br><span class="line">                    Complex f0 = f[i+j], f1 = W[<span class="number">1L</span>L * j * Lim / Mid] * f[i+j+Mid];</span><br><span class="line">                    f[i+j] = f0 + f1, f[i+j+Mid] = f0 - f1;</span><br><span class="line">                &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">MTT</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>* f, <span class="keyword">const</span> <span class="keyword">int</span>* g, <span class="keyword">int</span> Lim, <span class="keyword">int</span>* h)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> Complex A[MAXN], B[MAXN];</span><br><span class="line">        <span class="keyword">static</span> Complex dfta[MAXN], dftb[MAXN], dftc[MAXN], dftd[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) A[i] = Complex(f[i] &amp; M, f[i] &gt;&gt; <span class="number">15</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) B[i] = Complex(g[i] &amp; M, g[i] &gt;&gt; <span class="number">15</span>);</span><br><span class="line">        FFT(A, Lim), FFT(B, Lim);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) &#123;</span><br><span class="line">            <span class="keyword">int</span> j = (Lim - i) &amp; (Lim - <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">static</span> Complex da, db, dc, dd;</span><br><span class="line">            da = (A[i] + conj(A[j])) * Complex(<span class="number">0.5</span>, <span class="number">0.0</span>);</span><br><span class="line">            db = (A[i] - conj(A[j])) * Complex(<span class="number">0.0</span>, <span class="number">-0.5</span>);</span><br><span class="line">            dc = (B[i] + conj(B[j])) * Complex(<span class="number">0.5</span>, <span class="number">0.0</span>);</span><br><span class="line">            dd = (B[i] - conj(B[j])) * Complex(<span class="number">0.0</span>, <span class="number">-0.5</span>);</span><br><span class="line">            dfta[j] = da * dc, dftb[j] = da * dd;</span><br><span class="line">            dftc[j] = db * dc, dftd[j] = db * dd;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) A[i] = dfta[i] + dftb[i] * Complex(<span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) B[i] = dftc[i] + dftd[i] * Complex(<span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">        FFT(A, Lim), FFT(B, Lim);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) &#123;</span><br><span class="line">            <span class="keyword">int</span> da = LL(A[i].x / Lim + <span class="number">0.5</span>) % P, db = LL(A[i].y / Lim + <span class="number">0.5</span>) % P;</span><br><span class="line">            <span class="keyword">int</span> dc = LL(B[i].x / Lim + <span class="number">0.5</span>) % P, dd = LL(B[i].y / Lim + <span class="number">0.5</span>) % P;</span><br><span class="line">            h[i] = (da + (LL(db + dc) &lt;&lt; <span class="number">15</span>) + (LL(dd) &lt;&lt; <span class="number">30</span>)) % P;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Inv</span><span class="params">(<span class="keyword">int</span>* f, <span class="keyword">int</span>* g, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> A[MAXN], B[MAXN], ab[MAXN], abb[MAXN];</span><br><span class="line">        g[<span class="number">0</span>] = fpow(f[<span class="number">0</span>], P<span class="number">-2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> L = <span class="number">0</span>, Lim = <span class="number">1</span>, Mid = <span class="number">2</span>; Mid &lt; <span class="number">2</span>*n; Mid &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span> (Lim &lt; <span class="number">2</span>*Mid) Lim &lt;&lt;= <span class="number">1</span>, ++L;</span><br><span class="line">            init(Lim, L);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Mid; ++i) A[i] = f[i], B[i] = g[i];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = Mid; i &lt; Lim; ++i) A[i] = B[i] = <span class="number">0</span>;</span><br><span class="line">            MTT(A, B, Lim, ab), MTT(ab, B, Lim, abb);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i)</span><br><span class="line">                g[i] = ((B[i] + B[i]) % P - abb[i] + P) % P;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = min(n, Mid); i &lt; Lim; ++i) g[i] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Der</span><span class="params">(<span class="keyword">int</span>* f, <span class="keyword">int</span>* g, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) g[i<span class="number">-1</span>] = <span class="number">1L</span>L * i * f[i] % P;</span><br><span class="line">        g[n - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Int</span><span class="params">(<span class="keyword">int</span>* f, <span class="keyword">int</span>* g, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        g[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) g[i] = <span class="number">1L</span>L * fpow(i, P<span class="number">-2</span>) * f[i<span class="number">-1</span>] % P;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Ln</span><span class="params">(<span class="keyword">int</span>* f, <span class="keyword">int</span>* g, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> df[MAXN], invf[MAXN];</span><br><span class="line">        Der(f, df, n), Inv(f, invf, n);</span><br><span class="line">        <span class="keyword">int</span> Lim = <span class="number">1</span>, L = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (Lim &lt; <span class="number">2</span>*n) Lim &lt;&lt;= <span class="number">1</span>, ++L;</span><br><span class="line">        init(Lim, L);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &lt; Lim; ++i) df[i] = invf[i] = <span class="number">0</span>;</span><br><span class="line">        MTT(df, invf, Lim, invf), Int(invf, g, n);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">int</span> Ans[MAXN], nA;</span><br><span class="line"><span class="keyword">int</span> f[MAXN], lnf[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n), read(P), ++n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) read(f[i]);</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    f[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    Poly::Ln(f, lnf, n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) lnf[i] = <span class="number">1L</span>L * i * lnf[i] % P;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i + i; j &lt; n; j += i) lnf[j] = (lnf[j] - lnf[i] + P) % P;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) <span class="keyword">if</span> (lnf[i]) Ans[++nA] = i;</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, nA);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nA; ++i) <span class="built_in">printf</span>(<span class="string">"%d%c"</span>, Ans[i], <span class="string">" \n"</span>[i==nA]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒSDOI2017ã€æ–‡æœ¬æ ¡æ­£"><a href="#ã€ŒSDOI2017ã€æ–‡æœ¬æ ¡æ­£" class="headerlink" title="ã€ŒSDOI2017ã€æ–‡æœ¬æ ¡æ­£"></a>ã€ŒSDOI2017ã€æ–‡æœ¬æ ¡æ­£</h3><h4 id="é¢˜ç›®é“¾æ¥-5"><a href="#é¢˜ç›®é“¾æ¥-5" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2272" target="_blank" rel="noopener">https://loj.ac/problem/2272</a></li></ul><h4 id="è§£é¢˜æ€è·¯-5"><a href="#è§£é¢˜æ€è·¯-5" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>ä¸€é“æ¯’ç˜¤çš„å­—ç¬¦ä¸²åŒ¹é…é¢˜.</p><p>å‡è®¾ä¸² $T$ è¢«æ‹†åˆ†ä¸ºå½¢å¦‚ ABC çš„ä¸‰æ®µ, æœ‰ä¸€ä¸ªå¤§åŠ›åŒ¹é…çš„æ€è·¯, å³æšä¸¾ $3!$ ç§æƒ…å†µ, ä¾æ¬¡åˆ¤å®šå³å¯.</p><ol><li><p>ABC</p><p>ç›´æ¥ç”¨å“ˆå¸Œåˆ¤æ–­ä¸¤ä¸²æ˜¯å¦ç›¸ç­‰å³å¯â€¦</p></li><li><p>CAB, BCA</p><p>ä»¥ CAB ä¸ºä¾‹, æ³¨æ„åˆ° AB åœ¨ $T$ ä¸­æ˜¯è¿ç»­çš„ä¸€æ®µ, æšä¸¾ AB å’Œ C çš„æ–­ç‚¹, ç”¨å“ˆå¸Œåˆ¤æ–­æ˜¯å¦å’Œ $S$ ä¸­å¯¹åº”ä¸€æ®µç›¸ç­‰å³å¯.</p><p>BCA åŒç†.</p></li><li><p>CBA</p><p>å¼€ å§‹ äº†.</p><p>æˆ‘ä»¬å…ˆæŠŠ $T$ å€’è¿‡æ¥å†æ’å…¥ $S$, å¾—åˆ°ä¸€ä¸ªæ–°ä¸² $S_1 T_n S_2 T_{n-1} \cdots S_n T_1$, é‚£ä¹ˆ CBA çš„åˆ¤æ–­å°±æ˜¯åœ¨åˆ¤æ–­å¾—åˆ°çš„æ–°ä¸²æ˜¯å¦å¯ä»¥è¢«æ‹†æˆ 3 ä¸ªå¶å›æ–‡ä¸².</p><p>å¯ä»¥åœ¨æ–°ä¸²ä¸Šæšä¸¾ä¸€ä¸ªæ‹†åˆ†ç‚¹, ç°åœ¨çš„é—®é¢˜å°±æ˜¯: åˆ¤æ–­åç¼€æ˜¯å¦æ„æˆä¸€ä¸ªåŒå›æ–‡ä¸².</p><p>æœ‰ä¸€ä¸ªæ¥è‡ª <wc2017 é‡‘ç­–="" å­—ç¬¦ä¸²ç®—æ³•é€‰è®²=""> çš„ç»“è®º</wc2017></p><blockquote><p>å¦‚æœ $s = ab$, $a$, $b$ éƒ½æ˜¯å›æ–‡ä¸², åˆ™ç§° $s$ æ˜¯ä¸€ä¸ªåŒå›æ–‡ä¸².</p><p>å¦‚æœ $s$ æ˜¯ä¸€ä¸ªåŒå›æ–‡ä¸², åˆ™å­˜åœ¨ä¸€ç§æ‹†åˆ†æ–¹æ³• $s = ab$, ä½¿å¾— $a$ æ˜¯ $s$ çš„æœ€é•¿å›æ–‡å‰ç¼€, æˆ–è€… $b$ æ˜¯ $s$ çš„æœ€é•¿å›æ–‡åç¼€.</p></blockquote><p>æ‰€ä»¥å¯ä»¥ç”¨ Manacher å¤„ç†å‡º</p><ol><li><p>å½“å‰æ‹†åˆ†ç‚¹å‘å³å»¶ä¼¸çš„æœ€é•¿å›æ–‡ä¸²çš„ç»“æŸä½ç½®, ä¹Ÿå°±æ˜¯æœ€é•¿å›æ–‡å‰ç¼€, ä»£ç ä¸­ä¸º <code>Rpos[i]</code>.</p></li><li><p>èƒ½å¤Ÿåˆ°è¾¾æ–°ä¸²ç»“å°¾çš„å›æ–‡ä¸­å¿ƒé›†åˆ, ä¹Ÿå°±æ˜¯æœ€é•¿å›æ–‡åç¼€, æ‰“æ ‡è®°åä¸¢åˆ°é˜Ÿåˆ—é‡Œ.</p></li></ol><p>å‡è®¾å½“å‰æšä¸¾åˆ°çš„æ–­ç‚¹ä¸º $i$, è‹¥ $i$ ä½ç½®å‰æ˜¯ä¸€ä¸ªå¶å›æ–‡ä¸², ä¾æ¬¡ç”¨æœ€é•¿å›æ–‡å‰ç¼€å’Œæœ€é•¿å›æ–‡åç¼€åˆ¤æ–­ $i$ ä½ç½®åæ˜¯å¦æ»¡è¶³é™åˆ¶å³å¯.</p></li><li><p>BAC, ACB</p><p>ä»¥ BAC ä¸ºä¾‹, å¦‚æœæšä¸¾ C çš„ä½ç½®, åˆ©ç”¨ä¸Šé¢çš„ç»éªŒ, å‰©ä¸‹çš„éƒ¨åˆ†å°±æ˜¯ä¸€ä¸ªåˆ¤æ–­åŒå›æ–‡ä¸²çš„é—®é¢˜â€¦</p><p>ä½†æ˜¯æœ‰ç®€å•ä¸€äº›çš„åŠæ³•.</p><p>å›å¿† Case 3 å¤„ç†é—®é¢˜çš„è¿‡ç¨‹, Manacher å…¶å®åœ¨åšä¸€ä¸ªæœ€å¤§åŒ¹é…, ä¹Ÿå°±æ˜¯è¯´, æ­¤å¤„ BA ä¸¤ä¸²ä¸€å®šæœ‰ä¸€è€…æ˜¯é•¿åº¦æœ€å¤§çš„, åˆ©ç”¨ KMP å®Œæˆè¿™ä¸ªæœ€å¤§åŒ¹é…å³å¯. å‰©ä¸‹éƒ¨åˆ†åˆ©ç”¨å“ˆå¸Œåˆ¤æ–­å°±å¥½äº†.</p><p>é‚£ä¹ˆå¯¹äº ACB çš„æƒ…å†µ, çœŸçš„æ˜¯å­—é¢æ„æ€ä¸Šå€’è¿‡æ¥å°±å¯ä»¥äº†, æ³¨æ„æœ€åçš„ç­”æ¡ˆ, å…ˆå‰çš„å“ˆå¸Œå€¼ä¹Ÿè¦ç¿»è½¬. å½“ç„¶å†å†™ä¸€éä¹Ÿæ˜¯å¯ä»¥çš„, æœ‰å¸¸æ•°ä¸Šçš„ä¼˜åŠ¿.</p></li></ol><p>æ—¶é—´å¤æ‚åº¦ $O(n)$.</p><p>è€ƒåœºä¸Šæˆ‘å½“ç„¶æ˜¯é€‰æ‹© $O(n^2)$ çš„æš´åŠ›åŒ¹é… = =.</p><h4 id="ä»£ç å®ç°-5"><a href="#ä»£ç å®ç°-5" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2272</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; Pii;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e6</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line">Pii Ans[<span class="number">3</span>];</span><br><span class="line"><span class="keyword">int</span> S[MAXN], T[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒæ¨¡æ•° Hash ...</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Hash</span> &#123;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> P1 = <span class="number">998244353</span>, P2 = <span class="number">1e9</span>+<span class="number">7</span>, B = <span class="number">19260817</span>;</span><br><span class="line">    <span class="keyword">int</span> H1, H2;</span><br><span class="line"></span><br><span class="line">    Hash(<span class="keyword">int</span> _H1 = <span class="number">0</span>, <span class="keyword">int</span> _H2 = <span class="number">0</span>): H1(_H1), H2(_H2) &#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; ch)</span> </span>&#123;</span><br><span class="line">        H1 = (<span class="number">1L</span>L * H1 * B % P1 + ch) % P1, H2 = (<span class="number">1L</span>L * H2 * B % P2 + ch) % P2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Hash <span class="keyword">operator</span> + (<span class="keyword">const</span> Hash&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Hash((H1 + rhs.H1) % P1, (H2 + rhs.H2) % P2);</span><br><span class="line">    &#125;</span><br><span class="line">    Hash <span class="keyword">operator</span> - (<span class="keyword">const</span> Hash&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Hash((H1 - rhs.H1 + P1) % P1, (H2 - rhs.H2 + P2) % P2);</span><br><span class="line">    &#125;</span><br><span class="line">    Hash <span class="keyword">operator</span> * (<span class="keyword">const</span> Hash&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Hash(<span class="number">1L</span>L * H1 * rhs.H1 % P1, <span class="number">1L</span>L * H2 * rhs.H2 % P2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>== (<span class="keyword">const</span> Hash&amp; rhs) <span class="keyword">const</span> &#123; <span class="keyword">return</span> H1 == rhs.H1 &amp;&amp; H2 == rhs.H2; &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>!= (<span class="keyword">const</span> Hash&amp; rhs) <span class="keyword">const</span> &#123; <span class="keyword">return</span> !(*<span class="keyword">this</span> == rhs); &#125;</span><br><span class="line">&#125; A[MAXN], B[MAXN], powB[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Hash <span class="title">Part</span><span class="params">(Hash* H, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123; <span class="keyword">return</span> H[R] - H[L<span class="number">-1</span>] * powB[R-L+<span class="number">1</span>]; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">ABC</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (A[n] != B[n]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> Ans[<span class="number">0</span>] = Pii(<span class="number">1</span>, <span class="number">1</span>), Ans[<span class="number">1</span>] = Pii(<span class="number">2</span>, <span class="number">2</span>), Ans[<span class="number">2</span>] = Pii(<span class="number">3</span>, n), <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">CAB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">3</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="keyword">if</span> (Part(A, <span class="number">1</span>, n - i + <span class="number">1</span>) == Part(B, i, n)</span><br><span class="line">                &amp;&amp; Part(A, n - i + <span class="number">2</span>, n) == Part(B, <span class="number">1</span>, i - <span class="number">1</span>)) &#123;</span><br><span class="line">            Ans[<span class="number">0</span>] = Pii(i, n), Ans[<span class="number">1</span>] = Pii(<span class="number">1</span>, <span class="number">1</span>), Ans[<span class="number">2</span>] = Pii(<span class="number">2</span>, i<span class="number">-1</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">BCA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n - <span class="number">2</span>; ++i)</span><br><span class="line">        <span class="keyword">if</span> (Part(A, <span class="number">1</span>, n - i) == Part(B, i + <span class="number">1</span>, n)</span><br><span class="line">                &amp;&amp; Part(A, n - i + <span class="number">1</span>, n) == Part(B, <span class="number">1</span>, i)) &#123;</span><br><span class="line">            Ans[<span class="number">0</span>] = Pii(i + <span class="number">1</span>, i + <span class="number">1</span>), Ans[<span class="number">1</span>] = Pii(i + <span class="number">2</span>, n), Ans[<span class="number">2</span>] = Pii(<span class="number">1</span>, i);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> MaxR[MAXN &lt;&lt; <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ©ç”¨å›æ–‡åŠå¾„åˆ¤æ–­å›æ–‡ä¸²</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">isP</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; L, <span class="keyword">const</span> <span class="keyword">int</span>&amp; R)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (L &gt; R) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">return</span> Mid - L + <span class="number">1</span> &lt;= MaxR[Mid];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åˆ¤æ–­åŒå›æ–‡ä¸², å…¶å®åªåˆ¤å®šäº†é•¿åº¦...</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">isDP</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; L, <span class="keyword">const</span> <span class="keyword">int</span>&amp; R)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> L &lt; R &amp;&amp; (R - L) % <span class="number">4</span> == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">CBA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> C[MAXN &lt;&lt; <span class="number">1</span>], D[MAXN &lt;&lt; <span class="number">2</span>], nD, nC;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> Rpos[MAXN &lt;&lt; <span class="number">1</span>], Q[MAXN &lt;&lt; <span class="number">2</span>], head, tail;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">bool</span> vis[MAXN &lt;&lt; <span class="number">2</span>];</span><br><span class="line">    <span class="comment">// C tansform</span></span><br><span class="line">    nD = nC = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) C[++nC] = S[i], C[++nC] = T[n - i + <span class="number">1</span>];</span><br><span class="line">    <span class="comment">// Manacher</span></span><br><span class="line">    D[<span class="number">0</span>] = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nC; ++i) D[++nD] = C[i], D[++nD] = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= nD; i += <span class="number">2</span>) vis[i] = <span class="literal">false</span>, Rpos[i] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> Mid = <span class="number">0</span>, mx = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= nD; ++i) &#123;</span><br><span class="line">        MaxR[i] = (i &lt; mx)? min(MaxR[Mid * <span class="number">2</span> - i], mx - i): <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &gt;= MaxR[i] &amp;&amp; D[i + MaxR[i]] == D[i - MaxR[i]]) ++MaxR[i];</span><br><span class="line">        <span class="keyword">if</span> (mx &lt; i + MaxR[i]) mx = i + MaxR[i], Mid = i;</span><br><span class="line">        Rpos[i - MaxR[i] + <span class="number">1</span>] = max(Rpos[i - MaxR[i] + <span class="number">1</span>], i + MaxR[i] - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (i + MaxR[i] - <span class="number">1</span> == nD) vis[i - MaxR[i] + <span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Judge</span></span><br><span class="line">    Q[head = <span class="number">1</span>] = tail = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= nD; i += <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="comment">// æ³¨æ„æ­¤å¤„çš„æ›´æ–°</span></span><br><span class="line">        Rpos[i] = max(Rpos[i], Rpos[i - <span class="number">2</span>] - <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">if</span> (vis[i]) Q[++tail] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// i æ˜¯æ–­ç‚¹, çœŸçš„æ˜¯æ–­ç‚¹, æ¢è¨€ä¹‹, D[i] = -1</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">4</span>; i &lt;= nD; i += <span class="number">4</span>) <span class="keyword">if</span> (isP(<span class="number">0</span>, i)) &#123;</span><br><span class="line">        <span class="keyword">while</span> (head &lt;= tail &amp;&amp; Q[head] &lt; i) ++head;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> Algt, Clgt;</span><br><span class="line">        <span class="keyword">bool</span> flag = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (isDP(i, Rpos[i]) &amp;&amp; isDP(Rpos[i], nD) &amp;&amp; isP(Rpos[i], nD))</span><br><span class="line">            flag = <span class="literal">true</span>, Algt = i / <span class="number">4</span>, Clgt = (nD - Rpos[i]) / <span class="number">4</span>;</span><br><span class="line">        <span class="keyword">if</span> (!flag &amp;&amp; isDP(Q[head], nD) &amp;&amp; isDP(i, Q[head]) &amp;&amp; isP(i, Q[head]))</span><br><span class="line">            flag = <span class="literal">true</span>, Algt = i / <span class="number">4</span>, Clgt = (nD - Q[head]) / <span class="number">4</span>;</span><br><span class="line">        <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">            Ans[<span class="number">0</span>] = Pii(n - Algt + <span class="number">1</span>, n);</span><br><span class="line">            Ans[<span class="number">1</span>] = Pii(Clgt + <span class="number">1</span>, n - Algt), Ans[<span class="number">2</span>] = Pii(<span class="number">1</span>, Clgt);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> Sfail[MAXN], Tfail[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="comment">// KMP</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">getFail</span><span class="params">(<span class="keyword">int</span>* P, <span class="keyword">int</span>* fail)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> j = fail[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">while</span> (j &amp;&amp; P[i] != P[j + <span class="number">1</span>]) j = fail[j];</span><br><span class="line">        fail[i] = (j += P[i] == P[j + <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">BAC</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> Climit = n + <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// æ³¨æ„è¦è®© C åŒ¹é…ä¸Š</span></span><br><span class="line">    <span class="keyword">while</span> (Climit &gt; <span class="number">1</span> &amp;&amp; S[Climit - <span class="number">1</span>] == T[Climit - <span class="number">1</span>]) --Climit;</span><br><span class="line">    <span class="keyword">int</span> ptrS = <span class="number">0</span>, ptrT = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">while</span> (ptrS &amp;&amp; S[ptrS+<span class="number">1</span>] != T[i]) ptrS = Sfail[ptrS];</span><br><span class="line">        <span class="keyword">if</span> (S[ptrS + <span class="number">1</span>] == T[i]) ++ptrS;</span><br><span class="line">        <span class="keyword">while</span> (ptrT &amp;&amp; T[ptrT+<span class="number">1</span>] != S[i]) ptrT = Tfail[ptrT];</span><br><span class="line">        <span class="keyword">if</span> (T[ptrT + <span class="number">1</span>] == S[i]) ++ptrT;</span><br><span class="line">        <span class="keyword">if</span> (i + <span class="number">1</span> &lt; Climit) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> (Part(A, ptrS+<span class="number">1</span>, i) == Part(B, <span class="number">1</span>, i - ptrS)) &#123;</span><br><span class="line">            Ans[<span class="number">0</span>] = Pii(i - ptrS + <span class="number">1</span>, i);</span><br><span class="line">            Ans[<span class="number">1</span>] = Pii(<span class="number">1</span>, i - ptrS), Ans[<span class="number">2</span>] = Pii(i + <span class="number">1</span>, n);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Part(A, <span class="number">1</span>, i - ptrT) == Part(B, ptrT + <span class="number">1</span>, i)) &#123;</span><br><span class="line">            Ans[<span class="number">0</span>] = Pii(ptrT + <span class="number">1</span>, i);</span><br><span class="line">            Ans[<span class="number">1</span>] = Pii(<span class="number">1</span>, ptrT), Ans[<span class="number">2</span>] = Pii(i + <span class="number">1</span>, n);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">ACB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> Alimit = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (Alimit &lt; n &amp;&amp; S[Alimit + <span class="number">1</span>] == T[Alimit + <span class="number">1</span>]) ++Alimit;</span><br><span class="line">    <span class="keyword">int</span> ptrS = n+<span class="number">1</span>, ptrT = n+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &gt;= <span class="number">1</span>; --i) &#123;</span><br><span class="line">        <span class="keyword">while</span> (ptrS != n+<span class="number">1</span> &amp;&amp; S[ptrS<span class="number">-1</span>] != T[i]) ptrS = n - Sfail[n-ptrS+<span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (S[ptrS - <span class="number">1</span>] == T[i]) --ptrS;</span><br><span class="line">        <span class="keyword">while</span> (ptrT != n+<span class="number">1</span> &amp;&amp; T[ptrT<span class="number">-1</span>] != S[i]) ptrT = n - Tfail[n-ptrT+<span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (T[ptrT - <span class="number">1</span>] == S[i]) --ptrT;</span><br><span class="line">        <span class="keyword">if</span> (i - <span class="number">1</span> &gt; Alimit) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> (Part(A, i, ptrS - <span class="number">1</span>) == Part(B, i + n - ptrS + <span class="number">1</span>, n)) &#123;</span><br><span class="line">            Ans[<span class="number">0</span>] = Pii(<span class="number">1</span>, i - <span class="number">1</span>), Ans[<span class="number">1</span>] = Pii(i + n - ptrS + <span class="number">1</span>, n);</span><br><span class="line">            Ans[<span class="number">2</span>] = Pii(i, i + n - ptrS);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Part(A, i + n - ptrT + <span class="number">1</span>, n) == Part(B, i, ptrT - <span class="number">1</span>)) &#123;</span><br><span class="line">            Ans[<span class="number">0</span>] = Pii(<span class="number">1</span>, i - <span class="number">1</span>), Ans[<span class="number">1</span>] = Pii(ptrT, n);</span><br><span class="line">            Ans[<span class="number">2</span>] = Pii(i, ptrT - <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> Ti; read(Ti);</span><br><span class="line">    <span class="comment">// init</span></span><br><span class="line">    powB[<span class="number">0</span>] = Hash(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; MAXN; ++i) powB[i] = powB[i<span class="number">-1</span>] * Hash(Hash::B, Hash::B);</span><br><span class="line">    <span class="keyword">while</span> (Ti--) &#123;</span><br><span class="line">        <span class="comment">// input</span></span><br><span class="line">        read(n), read(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) read(S[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) read(T[i]);</span><br><span class="line">        <span class="comment">// solve &amp; output</span></span><br><span class="line">        getFail(S, Sfail), getFail(T, Tfail);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            A[i] = A[i<span class="number">-1</span>], A[i].insert(S[i]), B[i] = B[i<span class="number">-1</span>], B[i].insert(T[i]);</span><br><span class="line">        <span class="keyword">if</span> (ABC() || CAB() || BCA() || CBA() || BAC() || ACB()) &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">"YES"</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++i) <span class="built_in">printf</span>(<span class="string">"%d %d\n"</span>, Ans[i].first, Ans[i].second);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">"NO"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h3><p>æœ¬æ¥æƒ³ç®€å•åœ°å†™å†™, åæ¥å‘ç°è‡ªå·±è¨€ç®€æ„èµ…çš„èƒ½åŠ›ä¸è¶³ = =</p><p>ä»¥åå°½é‡å°‘å†™ä¸€ç‚¹åºŸè¯å§.</p><hr>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;div style=&quot;text-align:center;&quot;&gt;&lt;img src=&quot;/images/SDOI-2017-sol/SDOI.jpg&quot;&gt; &lt;/div&gt;

&lt;p&gt;&lt;em&gt;&lt;p style=&quot;text-align:center;&quot;&gt;å›¾æº &lt;a href=&quot;https://www.cnblogs.com/zzqsblog/p/7523003.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ZZQâ€™s Blog&lt;/a&gt;, è‡³å°‘æˆ‘æ˜¯ä»é‚£é‡Œæ‰¾åˆ°çš„&lt;/p&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;è¿™ Round 2 ä¹Ÿå¤ªæ¯’ç˜¤äº† = =&lt;/p&gt;
    
    </summary>
    
    
      <category term="é¢˜è§£" scheme="https://depletedprism.github.io/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
  </entry>
  
  <entry>
    <title>SDOI 2017 Round 1 å¤§èµ</title>
    <link href="https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/SDOI-2017-R1-sol/"/>
    <id>https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/SDOI-2017-R1-sol/</id>
    <published>2020-03-06T08:17:15.000Z</published>
    <updated>2020-03-09T05:04:29.739Z</updated>
    
    <content type="html"><![CDATA[<hr><p>è€ƒè™‘åˆ°å†™è¯¦è§£æœ‰ç‚¹èŠ±æ—¶é—´, ä¸å†™åˆå®¹æ˜“å¿˜ = =, é‚£å°±å†™ä¸ªå¤§æ¦‚å§.</p><p>SD ä¸¤è½®çœé€‰ (å¯èƒ½?) ä¼šæ¯”è¾ƒç§‘å­¦ä¸€ç‚¹å§</p><a id="more"></a><p>ä¸è¦å› ä¸º Round 1 è€Œé”™æ€ª SDOI.</p><h3 id="ã€ŒSDOI2017ã€æ•°å­—è¡¨æ ¼"><a href="#ã€ŒSDOI2017ã€æ•°å­—è¡¨æ ¼" class="headerlink" title="ã€ŒSDOI2017ã€æ•°å­—è¡¨æ ¼"></a>ã€ŒSDOI2017ã€æ•°å­—è¡¨æ ¼</h3><h4 id="é¢˜æ„ç®€è¿°"><a href="#é¢˜æ„ç®€è¿°" class="headerlink" title="é¢˜æ„ç®€è¿°"></a>é¢˜æ„ç®€è¿°</h4><p>æ±‚</p><p>$$\prod_{i=1}^n \prod_{j=1}^m f( \gcd(i, j) ) \mod 10^9 + 7$$</p><p>å…¶ä¸­ $f(n)$ ä¸ºæ–æ³¢é‚£å¥‘æ•°åˆ—æ•°åˆ—ç¬¬ $n$ é¡¹, $1 \le n,m \le 10^6$, å¤šç»„æµ‹è¯•æ•°æ®, $1 \le T \le 1000$.</p><h4 id="é¢˜ç›®é“¾æ¥"><a href="#é¢˜ç›®é“¾æ¥" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2000" target="_blank" rel="noopener">https://loj.ac/problem/2000</a></li></ul><p>çœ‹åˆ° $\gcd$ ä¸å¦‚æ¥åæ¼”ä¸€æ³¢. ä¸å¦¨ä»¤ $n \le m$.</p><p>æšä¸¾çº¦æ•°å¹¶æ•´ç†, æœ‰</p><p>$$\prod_{i=1}^n \prod_{j=1}^m \prod_{d = 1}^n f(d) [\gcd(i, j) = d]$$</p><p>$$\prod_{d=1}^n f(d) ^ {\sum\limits_{i=1}^n \sum\limits_{j=1}^m{\gcd(i, j) = d}}$$</p><p>ç”±è«æ¯”ä¹Œæ–¯åæ¼”çš„å¥—è·¯, å¾—</p><p>$$\prod_{d=1}^n f(d) ^ {\sum\limits_{T=1}^{\lfloor \frac{n}{d} \rfloor} \mu (T) \lfloor \frac{n}{Td} \rfloor \lfloor \frac{m}{Td} \rfloor}$$</p><p>$$\prod_{T=1}^n (\prod_{d\mid T} f(d) ^ {\mu (\frac{T}{d})}) ^ {\lfloor \frac{n}{T} \rfloor \lfloor \frac{m}{T} \rfloor}$$</p><p>è®¾ $g(T) = \prod_{d\mid T} f(d) ^ {\mu (\frac{T}{d})}$, åˆ™æ‰€æ±‚å³ä¸º</p><p>$$\prod_{T=1}^n g(T) ^ {\lfloor \frac{n}{T} \rfloor \lfloor \frac{m}{T} \rfloor}$$</p><p>è€ƒè™‘è®¡ç®— $g(T)$. å¯ä»¥å‘ç°, ç”±äº $\mu(n)$ å–å€¼åªæœ‰ $0, -1, 1$, è®¡ç®— $g(T)$ å¯ä»¥é€šè¿‡æšä¸¾å€æ•°ç®€å•åœ°å®ç°. æ—¶é—´å¤æ‚åº¦ $O(n \ln n)$.</p><p>é…åˆå‰ç¼€ç§¯å’Œæ•°è®ºåˆ†å—å³å¯, æ³¨æ„å¿«é€Ÿå¹‚æ—¶é—´å¤æ‚åº¦ $O(\log b)$.</p><p>æ—¶é—´å¤æ‚åº¦ $O(n \log P + n \ln n + T \cdot n \sqrt n \log P)$.</p><h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2000</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e6</span>+<span class="number">5</span>, P = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fpow</span><span class="params">(<span class="keyword">int</span> base, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (b &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>) ret = <span class="number">1L</span>L * ret * base % P;</span><br><span class="line">        base = <span class="number">1L</span>L * base * base % P, b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> notPrime[MAXN];</span><br><span class="line"><span class="keyword">int</span> Prime[MAXN], tot;</span><br><span class="line"><span class="keyword">int</span> mu[MAXN], invf[MAXN], f[MAXN], g[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">EulerSieve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    notPrime[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">    g[<span class="number">0</span>] = g[<span class="number">1</span>] = invf[<span class="number">1</span>] = f[<span class="number">1</span>] = mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt; MAXN; ++i) &#123;</span><br><span class="line">        g[i] = <span class="number">1</span>;</span><br><span class="line">        f[i] = (f[i<span class="number">-1</span>] + f[i<span class="number">-2</span>]) % P;</span><br><span class="line">        invf[i] = fpow(f[i], P<span class="number">-2</span>);</span><br><span class="line">        <span class="keyword">if</span> (!notPrime[i]) Prime[++tot] = i, mu[i] = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= tot &amp;&amp; i*Prime[j] &lt; MAXN; ++j) &#123;</span><br><span class="line">            notPrime[i*Prime[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % Prime[j] == <span class="number">0</span>) &#123; mu[i*Prime[j]] = <span class="number">0</span>; <span class="keyword">break</span>; &#125;</span><br><span class="line">            mu[i*Prime[j]] = -mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; MAXN; ++i) <span class="keyword">if</span> (mu[i] != <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &lt; MAXN; j += i)</span><br><span class="line">            g[j] = <span class="number">1L</span>L * g[j] * (mu[i] == <span class="number">1</span>? f[j / i]: invf[j / i]) % P;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt; MAXN; ++i) g[i] = <span class="number">1L</span>L * g[i] * g[i<span class="number">-1</span>] % P;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    EulerSieve();</span><br><span class="line">    <span class="keyword">int</span> T; read(T);</span><br><span class="line">    <span class="keyword">while</span> (T--) &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> n, m;</span><br><span class="line">        read(n), read(m);</span><br><span class="line">        <span class="keyword">if</span> (n &gt; m) swap(n, m);</span><br><span class="line">        <span class="keyword">int</span> ans = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> R, L = <span class="number">1</span>; L &lt;= n; L = R + <span class="number">1</span>) &#123;</span><br><span class="line">            R = min(n / (n / L), m / (m / L));</span><br><span class="line">            <span class="keyword">int</span> s = <span class="number">1L</span>L * g[R] * fpow(g[L<span class="number">-1</span>], P<span class="number">-2</span>) % P;</span><br><span class="line">            ans = <span class="number">1L</span>L * ans * fpow(s, <span class="number">1L</span>L * (n / L) * (m / L) % (P<span class="number">-1</span>)) % P;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒSDOI2017ã€æ ‘ç‚¹æ¶‚è‰²"><a href="#ã€ŒSDOI2017ã€æ ‘ç‚¹æ¶‚è‰²" class="headerlink" title="ã€ŒSDOI2017ã€æ ‘ç‚¹æ¶‚è‰²"></a>ã€ŒSDOI2017ã€æ ‘ç‚¹æ¶‚è‰²</h3><h4 id="é¢˜ç›®é“¾æ¥-1"><a href="#é¢˜ç›®é“¾æ¥-1" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2001" target="_blank" rel="noopener">https://loj.ac/problem/2001</a></li></ul><h4 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>è§‚å¯Ÿæ“ä½œ 1, ä»¥åŠåˆå§‹é¢œè‰²éƒ½ä¸ç›¸åŒ, å¯ä»¥å‘ç°æ¯æ¬¡æŠŠä¸€æ¡ä»æ ¹èŠ‚ç‚¹å¼€å§‹çš„é“¾æŸ“æˆæ–°é¢œè‰²çš„æ“ä½œç±»ä¼¼ä¸ LCT ä¸­çš„ <code>access</code>. å¦åŠ è€ƒè™‘å¯ä»¥å‘ç°, æŸä¸ªèŠ‚ç‚¹ $u$ åˆ°æ ¹èŠ‚ç‚¹çš„é¢œè‰²æ•°, å°±æ˜¯åœ¨ LCT ä¸Šç»è¿‡è™šè¾¹çš„ä¸ªæ•° + 1. (å‡è®¾åˆå§‹çŠ¶æ€ä¸­, æ ‘ä¸Šçš„è¾¹åœ¨ LCT ä¸Šéƒ½æ˜¯è™šè¾¹)</p><p>æ ¹æ®è¿™ä¸ªæ€è·¯, æ“ä½œ 2 å¯ä»¥ç®€å•è®¡ç®—, ä¹Ÿå°±æ˜¯ <code>dist(u) + dist(v) - 2 * dist(LCA) + 1</code>. (æ­¤å¤„ç”¨ <code>dist</code> æŒ‡ä»£å½“å‰èŠ‚ç‚¹åˆ°æ ¹çš„é¢œè‰²æ•°, å› ä¸º LCA è¢«å‡ä¸¤æ¬¡æ‰€ä»¥ç­”æ¡ˆ + 1)</p><p>é‚£ä¹ˆæ“ä½œ 3 å‘¢? å›æƒ³ LCT ç»´æŠ¤å­æ ‘ä¿¡æ¯çš„è¿‡ç¨‹, ä½“ç°åœ¨è¿™é“é¢˜ä¸­ä¹Ÿå°±æ˜¯åœ¨æ›´æ”¹ â€œå®å„¿å­â€ å’Œ â€œè™šå„¿å­â€ å­æ ‘çš„ä¿¡æ¯, æ¢è¨€ä¹‹, å­æ ‘å†…åŠ å‡, ç„¶åç»´æŠ¤æœ€å€¼å°±å¥½äº†. å¯ä»¥è®¡ç®—å‡º DFS åºåä½¿ç”¨çº¿æ®µæ ‘ç»´æŠ¤.</p><p>å®ç°ä¸­åœ¨å»ºæ ‘çš„æ—¶å€™ç›´æ¥ä½¿ç”¨æ·±åº¦ä½œä¸ºåˆå§‹æœ€å€¼, ä»¥åŠ <code>access</code> ä¿®æ”¹çš„æ—¶å€™éœ€è¦ <code>findroot</code> ä¸€ä¸‹æ‰¾åˆ°å®é™…å­æ ‘çš„æ ¹å†ä¿®æ”¹.</p><p>æ—¶é—´å¤æ‚åº¦ $O(m \log ^2 n)$, <del>æœ€è¿‘ä¸€ç¾¤æ¯’ç˜¤å¡æ ‘å‰–, ä¸æ•¢å†æœ‰ log^3 äº†</del></p><h4 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2001</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span>+<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Graph &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt, to; &#125; edges[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], eidx;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="keyword">sizeof</span> head), eidx = <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to)</span> </span>&#123;</span><br><span class="line">        edges[++eidx] = (Edge)&#123; head[from], to &#125;;</span><br><span class="line">        head[from] = eidx;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> LCT &#123;</span><br><span class="line">    <span class="keyword">int</span> ch[<span class="number">2</span>][MAXN], pre[MAXN];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">which</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; u)</span> </span>&#123; <span class="keyword">return</span> pre[u]? ch[<span class="number">1</span>][pre[u]] == u: <span class="number">0</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">nroot</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; u)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pre[u]? ch[<span class="number">0</span>][pre[u]] == u || ch[<span class="number">1</span>][pre[u]] == u: <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; u)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> fa = pre[u], w = which(u);</span><br><span class="line">        pre[u] = pre[fa];</span><br><span class="line">        <span class="keyword">if</span> (nroot(fa)) ch[which(fa)][pre[fa]] = u;</span><br><span class="line">        ch[w][fa] = ch[w^<span class="number">1</span>][u];</span><br><span class="line">        <span class="keyword">if</span> (ch[w^<span class="number">1</span>][u]) pre[ch[w^<span class="number">1</span>][u]] = fa;</span><br><span class="line">        ch[w^<span class="number">1</span>][u] = fa, pre[fa] = u;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">splay</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; u)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (nroot(u)) &#123;</span><br><span class="line">            <span class="keyword">int</span> fa = pre[u];</span><br><span class="line">            <span class="keyword">if</span> (nroot(fa)) which(fa) == which(u)? rotate(fa): rotate(u);</span><br><span class="line">            rotate(u);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> HLD &#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> Graph;</span><br><span class="line">    <span class="keyword">int</span> size[MAXN], son[MAXN], depth[MAXN], pre[MAXN];</span><br><span class="line">    <span class="keyword">int</span> topfa[MAXN], dfn[MAXN], rnk[MAXN], dfs_clock;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa)</span> </span>&#123;</span><br><span class="line">        depth[u] = depth[fa] + <span class="number">1</span>;</span><br><span class="line">        size[u] = <span class="number">1</span>, son[u] = <span class="number">-1</span>, LCT::pre[u] = pre[u] = fa;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = head[u]; ~i; i = edges[i].nxt) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((v = edges[i].to) == fa) <span class="keyword">continue</span>;</span><br><span class="line">            dfs1(v, u), size[u] += size[v];</span><br><span class="line">            <span class="keyword">if</span> (son[u] == <span class="number">-1</span> || size[v] &gt; size[son[u]]) son[u] = v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> top)</span> </span>&#123;</span><br><span class="line">        topfa[u] = top;</span><br><span class="line">        dfn[u] = ++dfs_clock, rnk[dfs_clock] = u;</span><br><span class="line">        <span class="keyword">if</span> (~son[u]) dfs2(son[u], top);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = head[u]; ~i; i = edges[i].nxt)</span><br><span class="line">            <span class="keyword">if</span> ((v = edges[i].to) != pre[u] &amp;&amp; v != son[u]) dfs2(v, v);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (topfa[u] != topfa[v]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (depth[topfa[u]] &lt; depth[topfa[v]]) swap(u, v);</span><br><span class="line">            u = pre[topfa[u]];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> depth[u] &gt; depth[v]? v: u;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> root = <span class="number">1</span>)</span> </span>&#123; dfs1(root, <span class="number">0</span>), dfs2(root, root); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SGT &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lc (nd&lt;&lt;1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rc (nd&lt;&lt;1|1)</span></span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> HLD;</span><br><span class="line">    <span class="keyword">int</span> datMax[MAXN &lt;&lt; <span class="number">2</span>], tagAdd[MAXN &lt;&lt; <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">maintain</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; nd)</span> </span>&#123;</span><br><span class="line">        datMax[nd] = max(datMax[lc], datMax[rc]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; nd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!tagAdd[nd]) <span class="keyword">return</span>;</span><br><span class="line">        tagAdd[lc] += tagAdd[nd], datMax[lc] += tagAdd[nd];</span><br><span class="line">        tagAdd[rc] += tagAdd[nd], datMax[rc] += tagAdd[nd];</span><br><span class="line">        tagAdd[nd] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (L == R) <span class="keyword">return</span> <span class="keyword">void</span>( datMax[nd] = depth[rnk[L]] );</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        build(lc, L, Mid), build(rc, Mid+<span class="number">1</span>, R);</span><br><span class="line">        maintain(nd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opL, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opR, <span class="keyword">const</span> <span class="keyword">int</span>&amp; val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (opL &lt;= L &amp;&amp; R &lt;= opR) <span class="keyword">return</span> datMax[nd] += val, <span class="keyword">void</span>( tagAdd[nd] += val );</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        pushdown(nd);</span><br><span class="line">        <span class="keyword">if</span> (opL &lt;= Mid) Mdy(lc, L, Mid, opL, opR, val);</span><br><span class="line">        <span class="keyword">if</span> (opR &gt; Mid) Mdy(rc, Mid+<span class="number">1</span>, R, opL, opR, val);</span><br><span class="line">        maintain(nd);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; u, <span class="keyword">const</span> <span class="keyword">int</span>&amp; val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Mdy(<span class="number">1</span>, <span class="number">1</span>, n, dfn[u], dfn[u] + size[u] - <span class="number">1</span>, val);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Qry</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opL, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opR)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (opL &lt;= L &amp;&amp; R &lt;= opR) <span class="keyword">return</span> datMax[nd];</span><br><span class="line">        pushdown(nd);</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>, ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (opL &lt;= Mid) ret = max(ret, Qry(lc, L, Mid, opL, opR));</span><br><span class="line">        <span class="keyword">if</span> (opR &gt; Mid) ret = max(ret, Qry(rc, Mid+<span class="number">1</span>, R, opL, opR));</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Qry</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; u)</span> </span>&#123; <span class="keyword">return</span> Qry(<span class="number">1</span>, <span class="number">1</span>, n, dfn[u], dfn[u]); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Sub</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; u)</span> </span>&#123; <span class="keyword">return</span> Qry(<span class="number">1</span>, <span class="number">1</span>, n, dfn[u], dfn[u] + size[u] - <span class="number">1</span>); &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> lc</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> rc</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> LCT &#123;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">findroot</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (ch[<span class="number">0</span>][u]) u = ch[<span class="number">0</span>][u];</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">access</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v = <span class="number">0</span>; u; v = u, u = pre[u]) &#123;</span><br><span class="line">            splay(u);</span><br><span class="line">            <span class="keyword">if</span> (ch[<span class="number">1</span>][u]) SGT::Mdy(findroot(ch[<span class="number">1</span>][u]), <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (v) SGT::Mdy(findroot(v), <span class="number">-1</span>);</span><br><span class="line">            ch[<span class="number">1</span>][u] = v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// init</span></span><br><span class="line">    Graph::init();</span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n), read(m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> u, v, i = <span class="number">1</span>; i &lt; n; ++i)</span><br><span class="line">        read(u), read(v), Graph::AddEdge(u, v), Graph::AddEdge(v, u);</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    HLD::solve(), SGT::build(<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">while</span> (m--) &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> opt, x, y;</span><br><span class="line">        read(opt), read(x);</span><br><span class="line">        <span class="keyword">switch</span> (opt) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>: LCT::access(x); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>: read(y), <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, SGT::Qry(x) + SGT::Qry(y) - <span class="number">2</span> * SGT::Qry(HLD::LCA(x, y)) + <span class="number">1</span>); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>: <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, SGT::Sub(x)); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>: <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"ERR\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒSDOI2017ã€åºåˆ—è®¡æ•°"><a href="#ã€ŒSDOI2017ã€åºåˆ—è®¡æ•°" class="headerlink" title="ã€ŒSDOI2017ã€åºåˆ—è®¡æ•°"></a>ã€ŒSDOI2017ã€åºåˆ—è®¡æ•°</h3><p>é«˜ä¸€åˆšå­¦çŸ©é˜µå¿«é€Ÿå¹‚çš„æ—¶å€™æ•´å¤©å†™æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ n å€ç»éªŒ = =</p><p>ç„¶åæŸæ¬¡å­¦é•¿æµ‹è¯•, å‡ºäº†ä¸€ä¸ªçŸ©é˜µå¿«é€Ÿå¹‚, å·®ç‚¹å°± A äº†, å¯æƒœçŸ©é˜µå†™åäº†â€¦</p><p>å†ç„¶åå°±æ²¡ç‹¬ç«‹å†™å‡ºè¿‡çŸ©é˜µå¿«é€Ÿå¹‚çš„é¢˜äº†, å‡„æƒ¨ = =</p><h4 id="é¢˜ç›®é“¾æ¥-2"><a href="#é¢˜ç›®é“¾æ¥-2" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2002" target="_blank" rel="noopener">https://loj.ac/problem/2002</a></li></ul><h4 id="è§£é¢˜æ€è·¯-1"><a href="#è§£é¢˜æ€è·¯-1" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>è¦æ±‚å’Œæ˜¯ $p$ çš„å€æ•°, é‚£ä¹ˆæ˜¾ç„¶æ˜¯æ¨¡ $p$ æ„ä¹‰ä¸‹ä¸º $0$ äº†. è€ƒè™‘åˆ°è‡³å°‘æœ‰ä¸€ä¸ªæ•°ä¸ºè´¨æ•°çš„é™åˆ¶å¯ä»¥é€šè¿‡å‡æ³•åŸç†è§£å†³, å³è®¡ç®—ä¸€éæ‰€æœ‰æ•°çš„æ–¹æ¡ˆæ•°, å†å‡å»åªç”¨åˆæ•°çš„ç­”æ¡ˆ.</p><p>å®¹æ˜“æƒ³åˆ°ä¸€ä¸ªæš´åŠ› DP:</p><p>è®¾ $f(i, j)$ è¡¨ç¤ºé€‰ $i$ ä¸ªæ•°, åŠ èµ·æ¥æ¨¡ $p$ ä¸º $j$ çš„æ–¹æ¡ˆæ•°. åˆ™</p><p>$$f(i, j) = \sum_k f(i-1, (j - k)\mod p)$$</p><p>æ¯æ¬¡é€‰æ‹©æ»¡è¶³é™åˆ¶çš„ $k$ å°±å¥½äº†.</p><p>è§‚å¯Ÿåˆ° DP ä¸­æ¯æ¬¡è½¬ç§»éƒ½æ˜¯ä¸€æ ·çš„, è€ƒè™‘ç”¨çŸ©é˜µå¿«é€Ÿå¹‚ä¼˜åŒ–.</p><p>å®¹æ˜“æƒ³åˆ° $O(mp)$ çš„æ„é€ çŸ©é˜µæ–¹æ³•, è€ƒè™‘åœ¨æ¨¡ $p$ æ„ä¹‰ä¸‹, çŸ©é˜µä¸­æŸä¸€åˆ— (æˆ–è€…æ˜¯æŸä¸€è¡Œ) æ˜¯å¾ªç¯çš„, äºæ˜¯å¯ä»¥åœ¨ $O(m + p^2)$ çš„æ—¶é—´å†…æ„é€ .</p><p>å…·ä½“å®ç°çš„æ—¶å€™æœ‰ä¸€äº›ç»†èŠ‚, è¿˜æ˜¯å‚è€ƒä»£ç å®ç°å§.</p><p>æ—¶é—´å¤æ‚åº¦ $O(m + p^2 + p^3 \log n)$.</p><h4 id="ä»£ç å®ç°-2"><a href="#ä»£ç å®ç°-2" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p>è¿™é“é¢˜ä¸­, ä¸¤ä¸ªçŸ©é˜µç›¸ä¹˜å¯ä»¥é€šè¿‡æŸäº›æ–¹æ³•ä¼˜åŒ–åˆ° $O(p^2)$, ç ”ç©¶ä¸æ‡‚, $O(p^3)$ å…»è€â€¦</p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2002</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">2e7</span>+<span class="number">5</span>, MAXP = <span class="number">105</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MOD = <span class="number">20170408</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, p;</span><br><span class="line"><span class="keyword">int</span> f[MAXP], g[MAXP];</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> notPrime[MAXM];</span><br><span class="line"><span class="keyword">int</span> Prime[MAXM], tot;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">EulerSieve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    notPrime[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!notPrime[i]) Prime[++tot] = i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= tot &amp;&amp; i*Prime[j] &lt;= m; ++j) &#123;</span><br><span class="line">            notPrime[i*Prime[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % Prime[j] == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Matrix</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> g[MAXP][MAXP];</span><br><span class="line"></span><br><span class="line">    Matrix() &#123; <span class="built_in">memset</span>(g, <span class="number">0</span>, <span class="keyword">sizeof</span> g); &#125;</span><br><span class="line"></span><br><span class="line">    Matrix <span class="keyword">operator</span> * (<span class="keyword">const</span> Matrix&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">        Matrix ret;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; p; ++i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; p; ++k)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; p; ++j)</span><br><span class="line">                    ret.g[i][j] = (ret.g[i][j] + <span class="number">1L</span>L * g[i][k] * rhs.g[k][j] % MOD) % MOD;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; p; ++i) g[i][i] = <span class="number">1</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">Matrix <span class="title">fpow</span><span class="params">(Matrix base, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    Matrix ret; ret.init();</span><br><span class="line">    <span class="keyword">while</span> (b &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>) ret = ret * base;</span><br><span class="line">        base = base * base, b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Part1</span><span class="params">()</span> </span>&#123; <span class="comment">// æ‰€æœ‰æ•°éƒ¨åˆ†</span></span><br><span class="line">    Matrix base;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) ++f[i % p];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) ++base.g[(-i % p + p) % p][<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; p; ++j)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; p; ++i) base.g[i][j] = base.g[(i - <span class="number">1</span> + p) % p][j<span class="number">-1</span>];</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    Matrix Ans = fpow(base, n - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; p; ++i)</span><br><span class="line">        ret = (ret + <span class="number">1L</span>L * f[i] * Ans.g[i][<span class="number">0</span>] % MOD) % MOD;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Part2</span><span class="params">()</span> </span>&#123; <span class="comment">// åˆæ•°éƒ¨åˆ†</span></span><br><span class="line">    Matrix base;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) <span class="keyword">if</span> (notPrime[i]) ++g[i % p];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) <span class="keyword">if</span> (notPrime[i]) ++base.g[(-i % p + p) % p][<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; p; ++j)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; p; ++i) base.g[i][j] = base.g[(i - <span class="number">1</span> + p) % p][j<span class="number">-1</span>];</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    Matrix Ans = fpow(base, n - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; p; ++i)</span><br><span class="line">        ret = (ret + <span class="number">1L</span>L * g[i] * Ans.g[i][<span class="number">0</span>] % MOD) % MOD;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;n, &amp;m, &amp;p);</span><br><span class="line">    EulerSieve();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, (Part1() - Part2() + MOD) % MOD);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒSDOI2017ã€æ–°ç”Ÿèˆä¼š"><a href="#ã€ŒSDOI2017ã€æ–°ç”Ÿèˆä¼š" class="headerlink" title="ã€ŒSDOI2017ã€æ–°ç”Ÿèˆä¼š"></a>ã€ŒSDOI2017ã€æ–°ç”Ÿèˆä¼š</h3><h4 id="é¢˜ç›®é“¾æ¥-3"><a href="#é¢˜ç›®é“¾æ¥-3" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2003" target="_blank" rel="noopener">https://loj.ac/problem/2003</a></li></ul><h4 id="è§£é¢˜æ€è·¯-2"><a href="#è§£é¢˜æ€è·¯-2" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>çœ‹åˆ°å¼å­ä¹‹åå®¹æ˜“è”æƒ³åˆ° 0/1 åˆ†æ•°è§„åˆ’. æ‰€ä»¥ç›´æ¥è€ƒè™‘äºŒåˆ†ç­”æ¡ˆ.</p><p>å‡è®¾å½“å‰ç­”æ¡ˆ $\ge x$, ä¹Ÿå°±æ˜¯</p><p>$$C = \frac{ \sum a_iâ€™ }{ \sum b_iâ€™ } \ge x$$</p><p>è¿›ä¸€æ­¥è½¬åŒ–,å¾—</p><p>$$\sum (a_iâ€™ - b_iâ€™ x) \ge 0$$</p><p>ç„¶åå°±å¯ä»¥ç”¨äºŒåˆ†å›¾æœ€å¤§åŒ¹é…è§£å†³äº†. å…·ä½“åœ°è¯´, äºŒåˆ†å›¾å†…ä¸¤ä¸¤è¾¹æƒ $w_{i, j} = a_{i, j} - b_{i, j} x$, å¦‚æœæœ€å¤§æƒåŒ¹é… $\ge 0$ åˆ™å½“å‰äºŒåˆ†åˆ°çš„ $x$ åˆæ³•.</p><p>äºŒåˆ†å›¾æœ€å¤§æƒåŒ¹é…éƒ¨åˆ†é‡‡ç”¨ KM ç®—æ³•, æ—¶é—´å¤æ‚åº¦ $O(n^3 \log w)$. å…¶ä¸­ $w$ ä¸ºæƒå€¼ä¸Šç•Œ.</p><p>çªç„¶æœ‰ä¸€ç§å·¥ç¨‹ç•Œå¾ˆå–œæ¬¢ KM ç®—æ³•çš„é”™è§‰.</p><h4 id="ä»£ç å®ç°-3"><a href="#ä»£ç å®ç°-3" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p>å¬è¯´å†™è´¹ç”¨æµæœ‰ç‚¹å¡å¸¸? æˆ‘è¿™ä¸€ä¸ªå†™ KM çš„å“ªçŸ¥é“å•Š = =</p><p>ä»¥åŠäºŒåˆ†çš„æ—¶å€™ä¸è¦ç©å¼„ <code>eps</code>, å› ä¸ºäºŒåˆ†è¾¹ç•Œå†™æŒ‚è°ƒäº†å¥½ä¹….png</p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2003</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">105</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> EPS = <span class="number">1e-7</span>, INFD = <span class="number">1e18</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">dcmp</span><span class="params">(<span class="keyword">const</span> <span class="keyword">double</span>&amp; p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">fabs</span>(p) &lt; EPS)? <span class="number">0</span>: (p &lt; <span class="number">0</span>? <span class="number">-1</span>: <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">int</span> A[MAXN][MAXN], B[MAXN][MAXN];</span><br><span class="line"><span class="keyword">double</span> W[MAXN][MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> KM &#123;</span><br><span class="line">    <span class="keyword">int</span> S[MAXN], T[MAXN], Time;</span><br><span class="line">    <span class="keyword">int</span> left[MAXN];</span><br><span class="line">    <span class="keyword">double</span> Lx[MAXN], Ly[MAXN], slack[MAXN];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">        S[u] = Time;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v = <span class="number">1</span>; v &lt;= n; ++v) <span class="keyword">if</span> (T[v] != Time) &#123;</span><br><span class="line">            <span class="keyword">double</span> d = Lx[u] + Ly[v] - W[u][v];</span><br><span class="line">            <span class="keyword">if</span> (dcmp(d) == <span class="number">0</span>) &#123;</span><br><span class="line">                T[v] = Time;</span><br><span class="line">                <span class="keyword">if</span> (left[v] == <span class="number">-1</span> || dfs(left[v])) <span class="keyword">return</span> left[v] = u, <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> slack[v] = min(d, slack[v]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">double</span> a = INFD;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; ++j)</span><br><span class="line">            <span class="keyword">if</span> (T[j] != Time) a = min(a, slack[j]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (S[i] == Time) Lx[i] -= a;</span><br><span class="line">            <span class="keyword">if</span> (T[i] == Time) Ly[i] += a; <span class="keyword">else</span> slack[i] -= a;</span><br><span class="line">            <span class="comment">// æŸç¯‡è®² KM ç®—æ³•çš„ CSDN åšå®¢è¿™é‡Œæ›´æ–° slack çš„æ—¶å€™å†™æŒ‚äº† = =</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">KM</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            left[i] = <span class="number">-1</span>, Lx[i] = *max_element(W[i]+<span class="number">1</span>, W[i]+<span class="number">1</span>+n), Ly[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> u = <span class="number">1</span>; u &lt;= n; ++u) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) slack[i] = INFD;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                ++Time;</span><br><span class="line">                <span class="keyword">if</span> (!dfs(u)) update(); <span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">double</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> u = <span class="number">1</span>; u &lt;= n; ++u) <span class="keyword">if</span> (~left[u]) ret += W[left[u]][u];</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">const</span> <span class="keyword">double</span>&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) W[i][j] = A[i][j] - x * B[i][j];</span><br><span class="line">    <span class="keyword">return</span> dcmp(KM::KM()) &gt;= <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) read(A[i][j]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) read(B[i][j]);</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    <span class="keyword">double</span> L = <span class="number">0.0</span>, R = <span class="number">1e6</span>;</span><br><span class="line">    <span class="keyword">while</span> (dcmp(R - L) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">double</span> Mid = (L + R) / <span class="number">2.0</span>;</span><br><span class="line">        <span class="keyword">if</span> (check(Mid)) L = Mid; <span class="keyword">else</span> R = Mid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%.6lf\n"</span>, L);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒSDOI2017ã€ç¡¬å¸æ¸¸æˆ"><a href="#ã€ŒSDOI2017ã€ç¡¬å¸æ¸¸æˆ" class="headerlink" title="ã€ŒSDOI2017ã€ç¡¬å¸æ¸¸æˆ"></a>ã€ŒSDOI2017ã€ç¡¬å¸æ¸¸æˆ</h3><blockquote><p>å­—ç¬¦ä¸²é¢˜å•Š, å­¦æé«˜çš„æ—¶å€™ç”¨å“ˆå¸Œ, å­¦çœé€‰çš„æ—¶å€™ç”¨ SAM å°±å¤Ÿäº†.</p></blockquote><p>ä¸çŸ¥é“ä»å“ªé‡Œå¬æ¥è¿™å¥å±è¯ = =</p><h4 id="é¢˜ç›®é“¾æ¥-4"><a href="#é¢˜ç›®é“¾æ¥-4" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2004" target="_blank" rel="noopener">https://loj.ac/problem/2004</a></li></ul><h4 id="è§£é¢˜æ€è·¯-3"><a href="#è§£é¢˜æ€è·¯-3" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p><del>è¿˜æ˜¯ <a href="https://www.cnblogs.com/CQzhangyu/p/7054998.html" target="_blank" rel="noopener">CQzhangyu</a> è®²å¾—å¥½.</del></p><h4 id="ä»£ç å®ç°-4"><a href="#ä»£ç å®ç°-4" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p><code>0.5 ^ 300 = 4.909093465297727e-91</code></p><p><code>2.0 ^ 300 = 2.037035976334486e+90</code></p><p>ä½ å«æˆ‘ç”¨å“ªä¸ªâ€¦</p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2004</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">305</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> EPS = <span class="number">1e-9</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">dcmp</span><span class="params">(<span class="keyword">const</span> <span class="keyword">double</span>&amp; p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">fabs</span>(p) &lt; EPS)? <span class="number">0</span>: (p &lt; <span class="number">0</span>? <span class="number">-1</span>: <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="keyword">char</span> S[MAXN][MAXN];</span><br><span class="line"><span class="keyword">double</span> pow2[MAXN], A[MAXN][MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> AC &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXN = ::MAXN * ::MAXN;</span><br><span class="line">    <span class="keyword">int</span> ch[<span class="number">2</span>][MAXN], fail[MAXN], nidx;</span><br><span class="line">    <span class="keyword">int</span> len[MAXN], pos[MAXN];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; nidx = <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">val</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>&amp; c)</span> </span>&#123; <span class="keyword">return</span> c == <span class="string">'H'</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">char</span>* S, <span class="keyword">const</span> <span class="keyword">int</span>&amp; idx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> u = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">            <span class="keyword">int</span> c = val(S[i]);</span><br><span class="line">            <span class="keyword">if</span> (!ch[c][u]) ch[c][u] = ++nidx;</span><br><span class="line">            u = ch[c][u];</span><br><span class="line">        &#125;</span><br><span class="line">        pos[idx] = u;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getFail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; Q;</span><br><span class="line">        fail[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> c = <span class="number">0</span>; c &lt; <span class="number">2</span>; ++c) &#123;</span><br><span class="line">            <span class="keyword">int</span>&amp; v = ch[c][<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span> (v) Q.push(v), fail[v] = <span class="number">1</span>; <span class="keyword">else</span> v = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (!Q.empty()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = Q.front(); Q.pop();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> c = <span class="number">0</span>; c &lt; <span class="number">2</span>; ++c) &#123;</span><br><span class="line">                <span class="keyword">int</span>&amp; v = ch[c][u];</span><br><span class="line">                <span class="keyword">if</span> (v) Q.push(v), fail[v] = ch[c][fail[u]];</span><br><span class="line">                <span class="keyword">else</span> v = ch[c][fail[u]];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        pow2[<span class="number">0</span>] = <span class="number">1.0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) pow2[i] = pow2[i<span class="number">-1</span>] * <span class="number">0.5</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> u = <span class="number">1</span>, j = <span class="number">1</span>; j &lt;= m; ++j)</span><br><span class="line">                u = ch[val(S[i][j])][u], len[u] = j;</span><br><span class="line">            A[i][n + <span class="number">1</span>] = -pow2[m];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; ++j)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> u = pos[j]; u &gt; <span class="number">1</span>; u = fail[u])</span><br><span class="line">                    <span class="keyword">if</span> (len[u]) A[i][j] += pow2[m - len[u]];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> u = <span class="number">1</span>, j = <span class="number">1</span>; j &lt;= m; ++j)</span><br><span class="line">                u = ch[val(S[i][j])][u], len[u] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) A[n + <span class="number">1</span>][i] = <span class="number">1</span>;</span><br><span class="line">        A[n + <span class="number">1</span>][n + <span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Gauss</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n + <span class="number">1</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> r = i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i+<span class="number">1</span>; j &lt;= n + <span class="number">1</span>; ++j)</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">fabs</span>(A[j][i]) &gt; <span class="built_in">fabs</span>(A[r][i])) r = j;</span><br><span class="line">        <span class="comment">// assert(dcmp(A[r][i]) != 0);</span></span><br><span class="line">        <span class="keyword">if</span> (r != i) swap(A[r], A[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n + <span class="number">1</span>; ++j) <span class="keyword">if</span> (i != j) &#123;</span><br><span class="line">            <span class="keyword">double</span> d = A[j][i] / A[i][i];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = i; k &lt;= n + <span class="number">2</span>; ++k) A[j][k] -= d * A[i][k];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n + <span class="number">1</span>; ++i)</span><br><span class="line">        <span class="keyword">if</span> (dcmp(A[i][i]) != <span class="number">0</span>) A[i][n + <span class="number">2</span>] /= A[i][i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    AC::init();</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%s"</span>, S[i] + <span class="number">1</span>), AC::insert(S[i], i);</span><br><span class="line">    AC::getFail(), AC::build();</span><br><span class="line">    Gauss();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) <span class="built_in">printf</span>(<span class="string">"%.7lf\n"</span>, A[i][n + <span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒSDOI2017ã€ç›¸å…³åˆ†æ"><a href="#ã€ŒSDOI2017ã€ç›¸å…³åˆ†æ" class="headerlink" title="ã€ŒSDOI2017ã€ç›¸å…³åˆ†æ"></a>ã€ŒSDOI2017ã€ç›¸å…³åˆ†æ</h3><p>ä¹‹å‰å¬ lxl è®²æ´›è°·ç½‘è¯¾çš„æ—¶å€™çœ‹ä»–åæ§½è¿‡ SDOI â€œé‚£ä¸ªæ— èŠçš„ä¸œè¥¿â€, å¤§æ¦‚æ˜¯æŒ‡çš„è¿™ä¸ªå§ (</p><p><del>çš„ç¡®æŒºæ— èŠçš„ = =</del></p><h4 id="é¢˜ç›®é“¾æ¥-5"><a href="#é¢˜ç›®é“¾æ¥-5" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2005" target="_blank" rel="noopener">https://loj.ac/problem/2005</a></li></ul><h4 id="è§£é¢˜æ€è·¯-4"><a href="#è§£é¢˜æ€è·¯-4" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>è¯»è¿‡é«˜ä¸­å¿…ä¿®è¯¾æœ¬çš„ (å¿˜äº†æ˜¯å“ªæœ¬äº† = =) éƒ½çŸ¥é“, è¯¢é—®çš„ $\hat a$ å¯ä»¥å±•å¼€, å½“ç„¶ä¸çŸ¥é“è¿™ä¸ªå¼å­ä¹Ÿæ˜¯å¯æ¨çš„â€¦</p><p>$$\hat a = \frac{\sum\limits_{i = L} ^ R (x_i - \bar{x})(y_i - \bar{y})}{\sum\limits_{i = L} ^ R (x_i - \bar{x}) ^ 2} = \frac{ \sum\limits_{i=L}^R x_i y_i - n \bar x \bar y }{\sum\limits_{i=L}^R x_i^2 - n \bar x^2}$$</p><p>å¯¹äºè¯¢é—®, ç›´æ¥ç”¨çº¿æ®µæ ‘ç»´æŠ¤ $\sum {x_i},\ \sum {y_i},\ \sum x_i y_i,\ \sum x_i ^ 2$ å°±å¯ä»¥å›ç­”äº†.</p><p>åŒºé—´åŠ â€¦ æŠŠè¿™å‡ ä¸ªä¸œè¥¿åŠ èµ·æ¥å†å±•å¼€å°±å¥½äº†.</p><p>$$\sum_{i=L}^R (x_i + S) = \sum_{i=L}^R x_i + (R-L+1) \cdot S$$</p><p>$$\sum_{i=L}^R (y_i + T) = \sum_{i=L}^R y_i + (R-L+1) \cdot T$$</p><p>$$\sum_{i=L}^R (x_i + S) (y_i + T) = \sum_{i=L}^R x_i y_i + T \sum_{i=L}^R x_i + S \sum_{i=L}^R y_i + (R-L+1) \cdot ST$$</p><p>$$\sum_{i=L}^R (x_i + S) ^ 2 = \sum_{i=L}^R x_i^2 + 2S \sum_{i=L}^R x_i + (R-L+1) \cdot S^2$$</p><p>åŒºé—´èµ‹å€¼â€¦ æ³¨æ„æ‰€èµ‹å€¼å…·æœ‰ç‰¹æ®Šæ€§, ä¹Ÿå°±æ˜¯ç¬¬ $i$ ä¸ªä½ç½®æ”¹æˆ $i$, ç„¶åå†è·‘ä¸€éåŒºé—´åŠ çš„æ“ä½œå°±å¥½äº†.</p><p><del>çœ‹é”™æ¡ä»¶å¤šæ¨äº†ä¸€å€çš„å¼å­, äººæ²¡äº†</del></p><h4 id="ä»£ç å®ç°-5"><a href="#ä»£ç å®ç°-5" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p>çº¿æ®µæ ‘çš„ç»†èŠ‚æ— éæ˜¯ä¼ æ ‡è®°çš„æ—¶å€™å®¹æ˜“æŒ‚â€¦ ç„¶åå°±å–œé—»ä¹è§åœ°æŒ‚äº†.</p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2005</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> EPS = <span class="number">1e-9</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">dcmp</span><span class="params">(<span class="keyword">const</span> <span class="keyword">double</span>&amp; p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">fabs</span>(p) &lt; EPS)? <span class="number">0</span>: (p &lt; <span class="number">0</span>? <span class="number">-1</span>: <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">s0</span><span class="params">(<span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123; <span class="keyword">return</span> R - L + <span class="number">1</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">s1</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123; <span class="keyword">return</span> n / <span class="number">2.0</span> * (n + <span class="number">1</span>); &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">s1</span><span class="params">(<span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123; <span class="keyword">return</span> s1(R) - s1(L - <span class="number">1</span>); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">s2</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123; <span class="keyword">return</span> n / <span class="number">6.0</span> * (n + <span class="number">1</span>) * (<span class="number">2</span> * n + <span class="number">1</span>); &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">s2</span><span class="params">(<span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123; <span class="keyword">return</span> s2(R) - s2(L - <span class="number">1</span>); &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="keyword">int</span> X[MAXN], Y[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SGT &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lc (nd&lt;&lt;1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rc (nd&lt;&lt;1|1)</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">        <span class="keyword">double</span> x, x2, y, xy;</span><br><span class="line">        Node() &#123; x = y = xy = <span class="number">0</span>; &#125;</span><br><span class="line">        Node(<span class="keyword">double</span> _x, <span class="keyword">double</span> _x2, <span class="keyword">double</span> _y, <span class="keyword">double</span> _xy): x(_x), x2(_x2), y(_y), xy(_xy) &#123; &#125;</span><br><span class="line">        Node <span class="keyword">operator</span> + (<span class="keyword">const</span> Node&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Node(x + rhs.x, x2 + rhs.x2, y + rhs.y, xy + rhs.xy);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">calc</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; L, <span class="keyword">const</span> <span class="keyword">int</span>&amp; R)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (xy - x / s0(L, R) * y) / (x2 - x / s0(L, R) * x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; dat[MAXN &lt;&lt; <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">double</span> tagAddX[MAXN &lt;&lt; <span class="number">2</span>], tagAddY[MAXN &lt;&lt; <span class="number">2</span>]; <span class="keyword">bool</span> tagSet[MAXN &lt;&lt; <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">maintain</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; nd)</span> </span>&#123; dat[nd] = dat[lc] + dat[rc]; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushAdd</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; nd, <span class="keyword">const</span> <span class="keyword">int</span>&amp; L, <span class="keyword">const</span> <span class="keyword">int</span>&amp; R, <span class="keyword">const</span> <span class="keyword">double</span>&amp; S, <span class="keyword">const</span> <span class="keyword">double</span>&amp; T)</span> </span>&#123;</span><br><span class="line">        dat[nd].x2 += <span class="number">2.0</span> * S * dat[nd].x + s0(L, R) * S * S;</span><br><span class="line">        dat[nd].xy += T * dat[nd].x + S * dat[nd].y + s0(L, R) * S * T;</span><br><span class="line">        dat[nd].x += s0(L, R) * S;</span><br><span class="line">        dat[nd].y += s0(L, R) * T;</span><br><span class="line">        tagAddX[nd] += S, tagAddY[nd] += T;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushSet</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; nd, <span class="keyword">const</span> <span class="keyword">int</span>&amp; L, <span class="keyword">const</span> <span class="keyword">int</span>&amp; R)</span> </span>&#123;</span><br><span class="line">        dat[nd].y = dat[nd].x = s1(L, R);</span><br><span class="line">        dat[nd].x2 = dat[nd].xy = s2(L, R);</span><br><span class="line">        tagSet[nd] = <span class="literal">true</span>, tagAddX[nd] = tagAddY[nd] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; nd, <span class="keyword">const</span> <span class="keyword">int</span>&amp; L, <span class="keyword">const</span> <span class="keyword">int</span>&amp; R)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (tagSet[nd]) &#123;</span><br><span class="line">            pushSet(lc, L, Mid), pushSet(rc, Mid+<span class="number">1</span>, R);</span><br><span class="line">            tagSet[nd] = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (dcmp(tagAddX[nd]) || dcmp(tagAddY[nd])) &#123;</span><br><span class="line">            pushAdd(lc, L, Mid, tagAddX[nd], tagAddY[nd]);</span><br><span class="line">            pushAdd(rc, Mid+<span class="number">1</span>, R, tagAddX[nd], tagAddY[nd]);</span><br><span class="line">            tagAddX[nd] = tagAddY[nd] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (L == R) <span class="keyword">return</span> <span class="keyword">void</span>( dat[nd] = Node(X[L], <span class="number">1.0</span> * X[L] * X[L], Y[L], <span class="number">1.0</span> * X[L] * Y[L]) );</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        build(lc, L, Mid), build(rc, Mid+<span class="number">1</span>, R);</span><br><span class="line">        maintain(nd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opL, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opR, <span class="keyword">const</span> <span class="keyword">double</span>&amp; S, <span class="keyword">const</span> <span class="keyword">double</span>&amp; T)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (opL &lt;= L &amp;&amp; R &lt;= opR) <span class="keyword">return</span> pushAdd(nd, L, R, S, T);</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        pushdown(nd, L, R);</span><br><span class="line">        <span class="keyword">if</span> (opL &lt;= Mid) Add(lc, L, Mid, opL, opR, S, T);</span><br><span class="line">        <span class="keyword">if</span> (opR &gt; Mid) Add(rc, Mid+<span class="number">1</span>, R, opL, opR, S, T);</span><br><span class="line">        maintain(nd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opL, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opR, <span class="keyword">const</span> <span class="keyword">double</span>&amp; S, <span class="keyword">const</span> <span class="keyword">double</span>&amp; T)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (opL &lt;= L &amp;&amp; R &lt;= opR) <span class="keyword">return</span> pushSet(nd, L, R), pushAdd(nd, L, R, S, T);</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        pushdown(nd, L, R);</span><br><span class="line">        <span class="keyword">if</span> (opL &lt;= Mid) Mdy(lc, L, Mid, opL, opR, S, T);</span><br><span class="line">        <span class="keyword">if</span> (opR &gt; Mid) Mdy(rc, Mid+<span class="number">1</span>, R, opL, opR, S, T);</span><br><span class="line">        maintain(nd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">Node <span class="title">Qry</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opL, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opR)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (opL &lt;= L &amp;&amp; R &lt;= opR) <span class="keyword">return</span> dat[nd];</span><br><span class="line">        pushdown(nd, L, R);</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (opR &lt;= Mid) <span class="keyword">return</span> Qry(lc, L, Mid, opL, opR);</span><br><span class="line">        <span class="keyword">if</span> (opL &gt; Mid) <span class="keyword">return</span> Qry(rc, Mid+<span class="number">1</span>, R, opL, opR);</span><br><span class="line">        <span class="keyword">return</span> Qry(lc, L, Mid, opL, opR) + Qry(rc, Mid+<span class="number">1</span>, R, opL, opR);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> lc</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> rc</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n), read(m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) read(X[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) read(Y[i]);</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    SGT::build(<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">while</span> (m--) &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> opt, L, R, S, T;</span><br><span class="line">        <span class="keyword">static</span> SGT::Node Ans;</span><br><span class="line">        read(opt), read(L), read(R);</span><br><span class="line">        <span class="keyword">switch</span> (opt) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>: <span class="built_in">printf</span>(<span class="string">"%.8lf\n"</span>, SGT::Qry(<span class="number">1</span>, <span class="number">1</span>, n, L, R).calc(L, R)); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>: read(S), read(T), SGT::Add(<span class="number">1</span>, <span class="number">1</span>, n, L, R, S, T); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>: read(S), read(T), SGT::Mdy(<span class="number">1</span>, <span class="number">1</span>, n, L, R, S, T); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>: <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"ERR\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><hr>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;è€ƒè™‘åˆ°å†™è¯¦è§£æœ‰ç‚¹èŠ±æ—¶é—´, ä¸å†™åˆå®¹æ˜“å¿˜ = =, é‚£å°±å†™ä¸ªå¤§æ¦‚å§.&lt;/p&gt;
&lt;p&gt;SD ä¸¤è½®çœé€‰ (å¯èƒ½?) ä¼šæ¯”è¾ƒç§‘å­¦ä¸€ç‚¹å§&lt;/p&gt;
    
    </summary>
    
    
      <category term="é¢˜è§£" scheme="https://depletedprism.github.io/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
  </entry>
  
  <entry>
    <title>HAOI 2017 å¤§èµ</title>
    <link href="https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/HAOI-2017-sol/"/>
    <id>https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/HAOI-2017-sol/</id>
    <published>2020-03-01T11:37:35.000Z</published>
    <updated>2020-03-13T05:41:27.411Z</updated>
    
    <content type="html"><![CDATA[<hr><p>HAOI 2017 çš„ç¥ç§˜å¼±çœçœé€‰éš¾åº¦.</p><a id="more"></a><p>2017 å¹´çš„ HAOI (å¤§æ¦‚? ) æ˜¯ä¸€å¤©ä¸¤è¯•, ä¸Šåˆä¸‰é¢˜ä¸‹åˆä¸¤é¢˜, äºæ˜¯åªæœ‰ 5 é“é¢˜äº†.</p><p>å½“å¹´è¿˜æœ‰å­¦é•¿è¾›é…¸çš„æ•…äº‹â€¦</p><h3 id="ã€ŒHAOI2017ã€æ–°å‹åŸå¸‚åŒ–"><a href="#ã€ŒHAOI2017ã€æ–°å‹åŸå¸‚åŒ–" class="headerlink" title="ã€ŒHAOI2017ã€æ–°å‹åŸå¸‚åŒ–"></a>ã€ŒHAOI2017ã€æ–°å‹åŸå¸‚åŒ–</h3><h4 id="é¢˜ç›®é“¾æ¥"><a href="#é¢˜ç›®é“¾æ¥" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2276" target="_blank" rel="noopener">https://loj.ac/problem/2276</a></li></ul><h4 id="é¢˜æ„ç®€è¿°"><a href="#é¢˜æ„ç®€è¿°" class="headerlink" title="é¢˜æ„ç®€è¿°"></a>é¢˜æ„ç®€è¿°</h4><p>ç»™å®šä¸€å¼ å›¾, ç‚¹æ•°ä¸º $n$, ç»™å®š $m$ æ¡è¾¹ <strong>ä¸è¿</strong>, æ»¡è¶³å›¾å¯è¢«åˆ†æˆä¸è¶…è¿‡ä¸¤ä¸ªå®Œå…¨å›¾.</p><p>ç°åœ¨è¦åŠ å…¥ä¸€æ¡åŸå…ˆä¸å­˜åœ¨çš„è¾¹, ä½¿å¾—åŠ å…¥è¿™æ¡è¾¹å, å›¾çš„æœ€å¤§å›¢å¤§å°è‡³å°‘æ¯”åŸå›¾æœ€å¤§å›¢å¤§å°è‡³å°‘å¢åŠ  $1$.</p><p>æ±‚æ‰€æœ‰æ»¡è¶³è¯¥æ€§è´¨çš„è¾¹.</p><p>å…¶ä¸­, $1 \le n \le 10^4,\ 0 \le m \le \min \{ 1.5 \times 10^5, \frac{1}{2} n (n+1) \}$.</p><h4 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>é¦–å…ˆå¯ä»¥å‘ç°, ç»™å®šçš„å›¾, ä¹Ÿå°±æ˜¯ç»™å®šçš„ä¸è¿æ¥çš„è¾¹, æ„æˆä¸€å¼ äºŒåˆ†å›¾.</p><p>è€ƒè™‘äºŒåˆ†å›¾çš„ä¸€äº›æ€§è´¨:</p><ol><li>å›¾çš„æœ€å¤§å›¢ = è¡¥å›¾çš„æœ€å¤§ç‹¬ç«‹é›†</li><li>äºŒåˆ†å›¾æœ€å¤§ç‹¬ç«‹é›† = ç‚¹æ•° - äºŒåˆ†å›¾æœ€å°ç‚¹è¦†ç›–</li><li>äºŒåˆ†å›¾æœ€å°ç‚¹è¦†ç›– = äºŒåˆ†å›¾æœ€å¤§åŒ¹é…</li></ol><p>å³ä½¿æ²¡æœ‰çœ‹å‡ºç»™å®šå›¾ä¸ºäºŒåˆ†å›¾, ç”±æ€§è´¨ 1 ä¹Ÿå®¹æ˜“æ„Ÿæ€§ç†è§£äº†.</p><p>æ ¹æ®è¿™äº›æ€§è´¨, å®¹æ˜“å‘ç°æˆ‘ä»¬ç›´æ¥ç”¨ç½‘ç»œæµè·‘äºŒåˆ†å›¾, é‚£ä¹ˆæ‰€æ±‚è¾¹å°±æ˜¯äºŒåˆ†å›¾åŒ¹é…ä¸­çš„å¿…ç»è¾¹.</p><p>åˆæœ‰ä¸€äº›ç»“è®º:</p><ol><li>äºŒåˆ†å›¾åŒ¹é…å¿…ç»è¾¹åœ¨ç½‘ç»œä¸­æµé‡ä¸º $1$, ä¸”ä¸¤ç«¯ç‚¹åœ¨ <strong>æ®‹é‡ç½‘ç»œ</strong> ä¸­å±äº <strong>ä¸åŒ</strong> çš„å¼ºè¿é€šåˆ†é‡.</li><li>äºŒåˆ†å›¾åŒ¹é…å¯è¡Œè¾¹åœ¨ç½‘ç»œä¸­æµé‡ä¸º $1$, ä¸”ä¸¤ç«¯ç‚¹åœ¨ <strong>æ®‹é‡ç½‘ç»œ</strong> ä¸­å±äº <strong>ç›¸åŒ</strong> çš„å¼ºè¿é€šåˆ†é‡.</li></ol><p>æ‰€ä»¥, å…ˆå°†äºŒåˆ†å›¾é»‘ç™½æŸ“è‰², å»ºå›¾è·‘äºŒåˆ†å›¾æœ€å¤§åŒ¹é…, ç„¶ååœ¨æ®‹é‡ç½‘ç»œä¸Šè·‘å¼ºè¿é€šåˆ†é‡, æœ€åä¾æ¬¡åˆ¤æ–­ç»™å®šè¾¹æ˜¯å¦æ»¡è¶³æ¡ä»¶å°±å¥½äº†.</p><p>æ—¶é—´å¤æ‚åº¦ä¸º $O(n + n \sqrt m + n + m + m \log m) = O(n \sqrt m)$.</p><p><del>çœ‹æ¥äºŒåˆ†å›¾ &amp; ç½‘ç»œæµçš„é‚£ä¸€å¥—ä¸œè¥¿åˆå¿˜äº†, è¯¥å›å»çœ‹çœ‹äº†</del></p><h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2276</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; Pii;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e4</span>+<span class="number">5</span>, MAXM = <span class="number">15e4</span>+<span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXV = MAXN, MAXE = MAXN * <span class="number">2</span> + MAXM, INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, S, T;</span><br><span class="line">Pii E[MAXM];</span><br><span class="line"><span class="keyword">int</span> id[MAXM], col[MAXN];</span><br><span class="line"><span class="built_in">vector</span>&lt;Pii&gt; Ans;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Graph &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt, to; &#125; edges[MAXM &lt;&lt; <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], eidx;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="keyword">sizeof</span> head), eidx = <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to)</span> </span>&#123;</span><br><span class="line">        edges[++eidx] = (Edge)&#123; head[from], to &#125;;</span><br><span class="line">        head[from] = eidx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = head[u]; ~i; i = edges[i].nxt) &#123;</span><br><span class="line">            <span class="keyword">if</span> (col[v = edges[i].to] != <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">            col[v] = <span class="number">3</span> - col[u], dfs(v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Dinic &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt, to, cap, flow; &#125; edges[MAXE &lt;&lt; <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> head[MAXV], cur[MAXV], depth[MAXV], vis[MAXV], Time, eidx;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="keyword">sizeof</span> head), eidx = <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to, <span class="keyword">int</span> cap)</span> </span>&#123;</span><br><span class="line">        edges[++eidx] = (Edge)&#123; head[from], to, cap, <span class="number">0</span> &#125;;</span><br><span class="line">        head[from] = eidx;</span><br><span class="line">        edges[++eidx] = (Edge)&#123; head[to], from, <span class="number">0</span>, <span class="number">0</span> &#125;;</span><br><span class="line">        head[to] = eidx;</span><br><span class="line">        <span class="keyword">return</span> eidx - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">BFS</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; Q;</span><br><span class="line">        Q.push(S);</span><br><span class="line">        vis[S] = ++Time, depth[S] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!Q.empty()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = Q.front(); Q.pop();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; ~i; i = edges[i].nxt) &#123;</span><br><span class="line">                <span class="keyword">const</span> Edge&amp; e = edges[i];</span><br><span class="line">                <span class="keyword">if</span> (vis[e.to] != Time &amp;&amp; e.cap &gt; e.flow)</span><br><span class="line">                    vis[e.to] = Time, depth[e.to] = depth[u] + <span class="number">1</span>, Q.push(e.to);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> vis[T] == Time;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == T || !a) <span class="keyword">return</span> a;</span><br><span class="line">        <span class="keyword">int</span> f, flow = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span>&amp; i = cur[u]; ~i; i = edges[i].nxt) &#123;</span><br><span class="line">            Edge&amp; e = edges[i];</span><br><span class="line">            <span class="keyword">if</span> (depth[e.to] == depth[u] + <span class="number">1</span> &amp;&amp; (f = DFS(e.to, min(a, e.cap - e.flow))) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                flow += f, a -= f, e.flow += f, edges[i^<span class="number">1</span>].flow -= f;</span><br><span class="line">                <span class="keyword">if</span> (!a) <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Maxflow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> flow = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (BFS()) <span class="built_in">memcpy</span>(cur, head, <span class="keyword">sizeof</span> cur), flow += DFS(S, INF);</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SCC &#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> Dinic;</span><br><span class="line">    <span class="keyword">int</span> dfn[MAXV], low[MAXV], SCCidx[MAXV], SCCcnt, dfs_clock;</span><br><span class="line">    <span class="keyword">int</span> stk[MAXV], top;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">tarjan</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">        low[u] = dfn[u] = ++dfs_clock, stk[++top] = u;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = head[u]; ~i; i = edges[i].nxt) &#123;</span><br><span class="line">            <span class="comment">// æ®‹é‡</span></span><br><span class="line">            <span class="keyword">if</span> (edges[i].flow == edges[i].cap) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span> (!dfn[v = edges[i].to]) &#123;</span><br><span class="line">                tarjan(v);</span><br><span class="line">                low[u] = min(low[u], low[v]);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!SCCidx[v]) low[u] = min(low[u], dfn[v]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (low[u] == dfn[u]) &#123;</span><br><span class="line">            ++SCCcnt;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">int</span> x = stk[top--];</span><br><span class="line">                SCCidx[x] = SCCcnt;</span><br><span class="line">                <span class="keyword">if</span> (u == x) <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> u = <span class="number">1</span>; u &lt;= n + <span class="number">2</span>; ++u) <span class="keyword">if</span> (!dfn[u]) tarjan(u);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">            <span class="keyword">const</span> <span class="keyword">int</span> &amp;u = E[i].first, &amp;v = E[i].second;</span><br><span class="line">            <span class="keyword">if</span> (SCCidx[u] == SCCidx[v] || edges[id[i]].flow &lt; <span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">            Ans.push_back(E[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// init</span></span><br><span class="line">    Graph::init(), Dinic::init();</span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n), read(m);</span><br><span class="line">    S = n + <span class="number">1</span>, T = n + <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> u, v, i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        read(u), read(v);</span><br><span class="line">        <span class="keyword">if</span> (u &gt; v) swap(u, v);</span><br><span class="line">        E[i] = Pii(u, v);</span><br><span class="line">        Graph::AddEdge(u, v), Graph::AddEdge(v, u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> u = <span class="number">1</span>; u &lt;= n; ++u)</span><br><span class="line">        <span class="keyword">if</span> (col[u] == <span class="number">0</span>) col[u] = <span class="number">1</span>, Graph::dfs(u);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">int</span> &amp;u = E[i].first, &amp;v = E[i].second;</span><br><span class="line">        <span class="keyword">if</span> (col[u] == <span class="number">1</span>) id[i] = Dinic::AddEdge(u, v, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (col[u] == <span class="number">2</span>) id[i] = Dinic::AddEdge(v, u, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> u = <span class="number">1</span>; u &lt;= n; ++u) &#123;</span><br><span class="line">        <span class="keyword">if</span> (col[u] == <span class="number">1</span>) Dinic::AddEdge(S, u, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (col[u] == <span class="number">2</span>) Dinic::AddEdge(u, T, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    Dinic::Maxflow();</span><br><span class="line">    SCC::solve();</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lu\n"</span>, Ans.size());</span><br><span class="line">    sort(Ans.begin(), Ans.end());</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; Ans.size(); ++i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d %d\n"</span>, Ans[i].first, Ans[i].second);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒHAOI2017ã€æ–¹æ¡ˆæ•°"><a href="#ã€ŒHAOI2017ã€æ–¹æ¡ˆæ•°" class="headerlink" title="ã€ŒHAOI2017ã€æ–¹æ¡ˆæ•°"></a>ã€ŒHAOI2017ã€æ–¹æ¡ˆæ•°</h3><p><del>æ—¢ç„¶æœ‰ä¸œæ–¹çš„ç¥ç§˜åŠ›é‡, é‚£ä¹ˆä¸ºä»€ä¹ˆç­”æ¡ˆå¯¹ 998244353 å–æ¨¡â€¦</del></p><h4 id="é¢˜ç›®é“¾æ¥-1"><a href="#é¢˜ç›®é“¾æ¥-1" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2277" target="_blank" rel="noopener">https://loj.ac/problem/2277</a></li></ul><h4 id="è§£é¢˜æ€è·¯-1"><a href="#è§£é¢˜æ€è·¯-1" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p><del>å®¹æ˜“çœ‹å‡ºæ¥è¿™é¢˜æ˜¯è®¡æ•° DP + å®¹æ–¥.</del></p><p>å…ˆè€ƒè™‘æ²¡æœ‰éšœç¢æ€ä¹ˆåš.</p><p>å¯ä»¥å‘ç°ä¸€ä¸ªæ€§è´¨: åˆ°è¾¾æŸä¸€ä¸ªç‚¹ $(x,\ y,\ z)$ çš„æ–¹æ¡ˆæ•°, åªå’Œæ¯ä¸ªåæ ‡åœ¨äºŒè¿›åˆ¶è¡¨ç¤ºä¸­ $1$ çš„ä¸ªæ•°æœ‰å…³.</p><p>è®¾ $f(x,\ y,\ z)$ è¡¨ç¤ºæŸä¸ªåæ ‡ä¸­ $1$ çš„ä¸ªæ•°åˆ†åˆ«ä¸º $x,\ y,\ z$, é‚£ä¹ˆå¯ä»¥å†™å‡ºè½¬ç§»:</p><p>$$f(x,\ y,\ z) = \sum_{i=1}^x \binom{x}{i} f(x - i,\ y,\ z) + \sum_{j=1}^y \binom{y}{j} f(x,\ y - j,\ z) \\ + \sum_{k=1}^z \binom{z}{k} f(x,\ y,\ z - k)$$</p><p>é‚£ä¹ˆ $f(x,\ y,\ z)$ å¯ä»¥åœ¨ $O(\log^ 3 n)$ çš„æ—¶é—´å†…è®¡ç®—. <del>å¬è¯´æ•°æ®å¼±, è¿™æ ·å°±æœ‰ 80 pts?</del></p><p>è€ƒè™‘åŠ ä¸Šéšœç¢æ€ä¹ˆåš.</p><p>è®¾ $g(i)$ è¡¨ç¤ºä»å‡ºå‘ç‚¹åˆ°ç¬¬ $i$ ä¸ªéšœç¢çš„æ–¹æ¡ˆæ•°. å¦‚æœä¸è€ƒè™‘å…¶ä»–éšœç¢çš„å½±å“, é‚£ä¹ˆç›´æ¥ä» $f(x,\ y,\ z)$ è½¬ç§»å°±å¥½äº†. å¦‚æœè€ƒè™‘, åˆ™éœ€è¦å‡å» $O \rightarrow j \rightarrow i$ çš„æ–¹æ¡ˆæ•°, å…¶ä¸­ $O \rightarrow j$ å°±æ˜¯ $g(j)$, $j \rightarrow i$ å¯ä»¥é€šè¿‡ $f(x,\ y,\ z)$ è®¡ç®—.</p><p>å½¢å¼åŒ–ä¸€ç‚¹, å³</p><p>$$g(i) = f(x,\ y,\ z) - \sum_{j} g(j) \cdot f(xâ€™, yâ€™, zâ€™)$$</p><p>å…¶ä¸­çš„ç»†èŠ‚å‚è€ƒä»£ç å®ç°.</p><p>å°†ç»ˆç‚¹ $(n,\ m,\ r)$ åŠ å…¥éšœç¢ç‚¹, åˆ™ $g(o)$ å³ä¸ºç­”æ¡ˆ.</p><p>æ—¶é—´å¤æ‚åº¦ $O(\log^3 n + o \log o + o^2) = O(o^2)$. <del>o &lt;= 1e4 å½“ç„¶æ˜¯æŒ‰ä¿¡ä»°è·‘.</del></p><p>ä¸ºäº†ä¾¿äºå®ç°ä»¥åŠæ–¹ä¾¿è®¡ç®—, å°†æ‰€æœ‰éšœç¢ç‚¹æŒ‰åæ ‡ä¾æ¬¡ä»å°åˆ°å¤§æ’åº. å¹¶é€šè¿‡é¢„å¤„ç†åŠ é€Ÿç»Ÿè®¡æŸä¸ªæ•°äºŒè¿›åˆ¶ä¸‹ $1$ çš„ä¸ªæ•°.</p><p><del>æ„Ÿè§‰ä»¥åå†™ DP è¿˜æ˜¯å‘ç°ä»€ä¹ˆæ€§è´¨å°±å†™å†™æ–¹ç¨‹è¯•è¯•â€¦ ä¸‡ä¸€å°±å¯¹äº†å‘¢â€¦</del></p><h4 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p>ç”±äºå®ç°çš„é—®é¢˜, æ‰€ä»¥æˆ‘çš„ä»£ç è·‘å¾—å¾ˆæ»¡, ç”¨æ—¶æˆåŠŸ loj å€’æ•°ç¬¬ä¸€.</p><p>ä»¥åŠè¿™é¢˜æ•°æ®æ¯”è¾ƒå¼±, æ¯æ¬¡åªè®°å½•å’Œ $(n,\ m,\ r)$ æœ‰å…³çš„éšœç¢, å°±å¯ä»¥è·‘å¾—é£å¿«.</p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2277</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">61</span>, BASE = (<span class="number">1</span> &lt;&lt; <span class="number">16</span>) - <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXO = <span class="number">1e4</span>+<span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P = <span class="number">998244353</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">pls</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; a, <span class="keyword">const</span> <span class="keyword">int</span>&amp; b)</span> </span>&#123; <span class="keyword">return</span> (a + b &lt; P)? a + b: a + b - P; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">mns</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; a, <span class="keyword">const</span> <span class="keyword">int</span>&amp; b)</span> </span>&#123; <span class="keyword">return</span> (a - b &gt;= <span class="number">0</span>)? a - b: a - b + P; &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Item</span> &#123;</span></span><br><span class="line">    LL x, y, z;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Item&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (x == rhs.x)? ((y == rhs.y)? z &lt; rhs.z: y &lt; rhs.y): x &lt; rhs.x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; A[MAXO];</span><br><span class="line"></span><br><span class="line">LL n, m, r, o;</span><br><span class="line"><span class="keyword">int</span> Bit[BASE + <span class="number">1</span>];</span><br><span class="line"><span class="keyword">int</span> C[MAXN][MAXN], f[MAXN][MAXN][MAXN], g[MAXO];</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡é¢„å¤„ç†, è®¡ç®—ä¸€ä¸ª long long èŒƒå›´æ•°çš„ popcount</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> LL <span class="title">lowbit</span><span class="params">(<span class="keyword">const</span> LL&amp; x)</span> </span>&#123; <span class="keyword">return</span> x &amp; -x; &#125;</span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">int</span> __brute_popcount(LL x) &#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (x &gt; <span class="number">0</span>) ++ret, x -= lowbit(x);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯ä»¥å°†å…¶æ‹†ä¸º 4 ä¸ªå°äº BASE çš„éƒ¨åˆ†ç»Ÿè®¡</span></span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">int</span> __block_popcount(<span class="keyword">const</span> LL&amp; x) &#123;</span><br><span class="line">    <span class="keyword">return</span> Bit[x &amp; BASE] + Bit[(x &gt;&gt; <span class="number">16</span>) &amp; BASE] + Bit[(x &gt;&gt; <span class="number">32</span>) &amp; BASE] + Bit[(x &gt;&gt; <span class="number">48</span>) &amp; BASE];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// init</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= BASE; ++i) Bit[i] = __brute_popcount(i);</span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n), read(m), read(r);</span><br><span class="line">    read(o);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= o; ++i) read(A[i].x), read(A[i].y), read(A[i].z);</span><br><span class="line">    A[++o] = (Item)&#123; n, m, r &#125;;</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    C[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; MAXN; ++i) &#123;</span><br><span class="line">        C[i][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= i; ++j) C[i][j] = (C[i<span class="number">-1</span>][j] + C[i<span class="number">-1</span>][j<span class="number">-1</span>]) % P;</span><br><span class="line">    &#125;</span><br><span class="line">    f[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; MAXN; ++x)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; MAXN; ++y)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> z = <span class="number">0</span>; z &lt; MAXN; ++z) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= x; ++i)</span><br><span class="line">                    f[x][y][z] = pls(f[x][y][z], <span class="number">1L</span>L * f[x-i][y][z] * C[x][i] % P);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= y; ++j)</span><br><span class="line">                    f[x][y][z] = pls(f[x][y][z], <span class="number">1L</span>L * f[x][y-j][z] * C[y][j] % P);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>; k &lt;= z; ++k)</span><br><span class="line">                    f[x][y][z] = pls(f[x][y][z], <span class="number">1L</span>L * f[x][y][z-k] * C[z][k] % P);</span><br><span class="line">            &#125;</span><br><span class="line">    sort(A+<span class="number">1</span>, A+<span class="number">1</span>+o);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= o; ++i) &#123;</span><br><span class="line">        <span class="keyword">const</span> Item&amp; now = A[i];</span><br><span class="line">        g[i] = f[__block_popcount(now.x)][__block_popcount(now.y)][__block_popcount(now.z)];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; i; ++j) &#123;</span><br><span class="line">            <span class="keyword">const</span> Item&amp; nxt = A[j];</span><br><span class="line">            <span class="keyword">if</span> ((nxt.x &amp; now.x) != nxt.x || (nxt.y &amp; now.y) != nxt.y || (nxt.z &amp; now.z) != nxt.z) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> x = __block_popcount(now.x ^ nxt.x), y = __block_popcount(now.y ^ nxt.y),</span><br><span class="line">                z = __block_popcount(now.z ^ nxt.z);</span><br><span class="line">            g[i] = mns(g[i], <span class="number">1L</span>L * f[x][y][z] * g[j] % P);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, g[o]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒHAOI2017ã€å­—ç¬¦ä¸²"><a href="#ã€ŒHAOI2017ã€å­—ç¬¦ä¸²" class="headerlink" title="ã€ŒHAOI2017ã€å­—ç¬¦ä¸²"></a>ã€ŒHAOI2017ã€å­—ç¬¦ä¸²</h3><p>å¥½ä¹…æ²¡å†™ AC è‡ªåŠ¨æœºäº†, çœ‹åˆ°è¿™é“é¢˜äººæ²¡äº† = =</p><h4 id="é¢˜ç›®é“¾æ¥-2"><a href="#é¢˜ç›®é“¾æ¥-2" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2278" target="_blank" rel="noopener">https://loj.ac/problem/2278</a></li></ul><h4 id="è§£é¢˜æ€è·¯-2"><a href="#è§£é¢˜æ€è·¯-2" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>é¢˜ç›®ä¸­å°†æ–‡æœ¬ä¸² $S$ å’Œå¤šä¸ªæ¨¡å¼ä¸² $p_i$ åŒ¹é…, å®¹æ˜“æƒ³åˆ° AC è‡ªåŠ¨æœº.</p><p><em>ä»¥ä¸‹æ¶‰åŠåˆ°åä¸²çš„ä½ç½®, éƒ½æ˜¯ä»¥åŸä¸²ä½ç½®ä¸ºå‡†</em></p><p>è€ƒè™‘é¢˜æ„ä¸­çš„åŒ¹é…æ˜¯ä»€ä¹ˆæ„æ€. ä¹Ÿå°±æ˜¯ä¸¤ä¸ªå¤±é…ä½ç½®é—´éš” $k+1$. æ¢è¨€ä¹‹, å‡è®¾ $S$ åŒ¹é…åˆ°äº†ä½ç½® $i$, é‚£ä¹ˆè®© $S$ ä»¥ $i+k+1$ ç»“å°¾çš„åä¸²åŒ¹é…åˆ°å½“å‰èŠ‚ç‚¹å¯¹åº”æ¨¡å¼ä¸² $p$ çš„åä¸²å°±å¯ä»¥äº†.</p><p>è¿™æ ·ä¸å¥½ç»Ÿè®¡, æˆ‘ä»¬å»ºå‡º fail æ ‘, å¹¶åœ¨ fail æ ‘ä¸Šç»Ÿè®¡.</p><p>å¯¹äº AC è‡ªåŠ¨æœºçš„æŸä¸ªèŠ‚ç‚¹ $u$, å‡è®¾ $S$ åˆ°è¾¾ $u$ æ—¶åŒæŸä¸ªæ¨¡å¼ä¸² $p$ åŒ¹é…åˆ°ä½ç½® $i$, æˆ‘ä»¬è¦åœ¨ $u$ åœ¨å­æ ‘ä¸­æ‰¾åˆ°æŸä¸ªèŠ‚ç‚¹ $v$, è®¾ $v$ ä¸Š $S$ åŒ¹é…åˆ°ç¬¬ $j$ ä¸ªä½ç½®, åˆ™ä½ç½® $j + k + 1$ å¯¹åº”èŠ‚ç‚¹, è¦åœ¨ $p$ çš„åä¸²ç¬¬ $i + k + 1$ ä½å¯¹åº”èŠ‚ç‚¹çš„ fail æ ‘å†…, è¯¢é—®è¿™æ ·çš„ $v$ çš„ä¸ªæ•°.</p><p><del>è¿™æ®µè¯è™½ç„¶ä¸»è¯­æ··ä¹±, ä½†æ˜¯å¾ˆé‡è¦.</del></p><p>è¿™å°±æ˜¯ä¸€ä¸ªæ ‘ä¸Šæ•°ç‚¹çš„é—®é¢˜äº†, å¯ä»¥ä½¿ç”¨æ ‘çŠ¶æ•°ç»„ä»¥åŠå·®åˆ†è§£å†³.</p><p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜, æ¯æ¬¡è®¡ç®— $S$ ä¸Šä½ç½® $i$ ä»¥åŠ $i + k + 1$ çš„åŒ¹é…æ—¶, å¦‚æœä½ç½® $i + k$ åŒ¹é…, é‚£ä¹ˆä¼šç®—é‡, éœ€è¦å•ç‹¬è®¡ç®—è¿™éƒ¨åˆ†çš„è´¡çŒ®æ¥å»é‡.</p><p>äºæ˜¯å¯ä»¥å¾—åˆ°ç®—æ³•æµç¨‹:</p><p>å¯¹æ‰€æœ‰ $p_i$ çš„æ­£åä¸²å»º AC è‡ªåŠ¨æœº, æŠŠ $S$ æ­£åä¸¤æ¬¡ä¸¢åˆ° AC è‡ªåŠ¨æœºä¸ŠåŒ¹é…; å»º fail æ ‘, è®°å½• $p_i$ å’Œ $S$ å¯¹ç­”æ¡ˆçš„å½±å“, ä¹Ÿå°±æ˜¯ä¿®æ”¹å’ŒæŸ¥è¯¢æ“ä½œ, å¹¶æŒ‚åœ¨ fail æ ‘å¯¹åº”èŠ‚ç‚¹ä¸Š; æ ‘ä¸Šå·®åˆ†ç»Ÿè®¡å­æ ‘ä¿¡æ¯å³å¯. å› ä¸ºè¦å»é‡, ä½¿ç”¨ä¸¤ä¸ª BIT ç»Ÿè®¡.</p><p>æ³¨æ„ç‰¹åˆ¤ $p$ é•¿åº¦å°äºç­‰äº $k$ çš„æƒ…å†µ, å¦‚æœä¸ç‰¹åˆ¤åªæœ‰ 20 pts = =</p><h4 id="ä»£ç å®ç°-2"><a href="#ä»£ç å®ç°-2" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p>æˆ‘ä¹Ÿæƒ³çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘çš„å¸¸æ•°é‚£ä¹ˆå¤§, __stdcall è·‘å¾—é‚£ä¹ˆå¿«.</p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2278</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">4e5</span>+<span class="number">5</span>, SIGMA = <span class="number">95</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Ask</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> type, idx, nd;</span><br><span class="line">    Ask(<span class="keyword">int</span> <span class="keyword">_t</span>, <span class="keyword">int</span> _i, <span class="keyword">int</span> _n): type(<span class="keyword">_t</span>), idx(_i), nd(_n) &#123; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, K;</span><br><span class="line"><span class="keyword">char</span> S[MAXN], P[MAXN];</span><br><span class="line"><span class="keyword">int</span> pos[<span class="number">2</span>][MAXN], dfn[MAXN], size[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> Ans[MAXN];</span><br><span class="line"><span class="built_in">vector</span>&lt;Ask&gt; Q[MAXN], M[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Graph &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt, to; &#125; edges[MAXN];</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], eidx, dfs_clock;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="keyword">sizeof</span> head), eidx = <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to)</span> </span>&#123;</span><br><span class="line">        edges[++eidx] = (Edge)&#123; head[from], to &#125;;</span><br><span class="line">        head[from] = eidx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">        size[u] = <span class="number">1</span>, dfn[u] = ++dfs_clock;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = head[u]; ~i; i = edges[i].nxt)</span><br><span class="line">            dfs(v = edges[i].to), size[u] += size[v];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> AC &#123;</span><br><span class="line">    <span class="keyword">int</span> ch[SIGMA][MAXN], fail[MAXN], nidx;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; nidx = <span class="number">1</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">insert</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> &amp; u, <span class="keyword">const</span> <span class="keyword">int</span>&amp; v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ch[v][u]? ch[v][u]: (ch[v][u] = ++nidx);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getFail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; Q;</span><br><span class="line">        fail[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> c = <span class="number">0</span>; c &lt; SIGMA; ++c) &#123;</span><br><span class="line">            <span class="keyword">int</span>&amp; v = ch[c][<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span> (v) Q.push(v), fail[v] = <span class="number">1</span>; <span class="keyword">else</span> v = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (!Q.empty()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = Q.front(); Q.pop();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> c = <span class="number">0</span>; c &lt; SIGMA; ++c) &#123;</span><br><span class="line">                <span class="keyword">int</span>&amp; v = ch[c][u];</span><br><span class="line">                <span class="keyword">if</span> (v) Q.push(v), fail[v] = ch[c][fail[u]];</span><br><span class="line">                <span class="keyword">else</span> v = ch[c][fail[u]];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= AC::nidx; ++i) Graph::AddEdge(fail[i], i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BIT</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> C[MAXN];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; x)</span> </span>&#123; <span class="keyword">return</span> x &amp; -x; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; d, <span class="keyword">const</span> <span class="keyword">int</span>&amp; val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = d; i &lt;= Graph::dfs_clock; i += lowbit(i)) C[i] += val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Qry</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; d)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = d; i; i -= lowbit(i)) ret += C[i];</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Qry</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; L, <span class="keyword">const</span> <span class="keyword">int</span>&amp; R)</span> </span>&#123; <span class="keyword">return</span> Qry(R) - Qry(L<span class="number">-1</span>); &#125;</span><br><span class="line">&#125; T[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> Graph;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; Q[u].size(); ++i) &#123;</span><br><span class="line">        <span class="keyword">const</span> Ask&amp; q = Q[u][i];</span><br><span class="line">        Ans[q.idx] -= q.type * T[q.type &lt; <span class="number">0</span>].Qry(dfn[q.nd], dfn[q.nd] + size[q.nd] - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; M[u].size(); ++i) &#123;</span><br><span class="line">        <span class="keyword">const</span> Ask&amp; m = M[u][i];</span><br><span class="line">        T[m.type &lt; <span class="number">0</span>].Mdy(dfn[m.nd], <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; ~i; i = edges[i].nxt) solve(edges[i].to);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; Q[u].size(); ++i) &#123;</span><br><span class="line">        <span class="keyword">const</span> Ask&amp; q = Q[u][i];</span><br><span class="line">        Ans[q.idx] += q.type * T[q.type &lt; <span class="number">0</span>].Qry(dfn[q.nd], dfn[q.nd] + size[q.nd] - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">val</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>&amp; c)</span> </span>&#123; <span class="keyword">return</span> c - <span class="number">33</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// init</span></span><br><span class="line">    AC::init(), Graph::init();</span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%s%d"</span>, &amp;K, S + <span class="number">1</span>, &amp;n);</span><br><span class="line">    <span class="keyword">int</span> Slgt = (<span class="keyword">int</span>) <span class="built_in">strlen</span>(S + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%s"</span>, P + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">int</span> Plgt = (<span class="keyword">int</span>) <span class="built_in">strlen</span>(P + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 80pts = =</span></span><br><span class="line">        <span class="keyword">if</span> (Plgt &lt;= K) &#123; Ans[j] = Slgt - Plgt + <span class="number">1</span>; <span class="keyword">continue</span>; &#125;</span><br><span class="line">        <span class="comment">// AC-automaton</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> u = <span class="number">1</span>, i = <span class="number">1</span>; i &lt;= Plgt; ++i) pos[<span class="number">0</span>][i] = u = AC::insert(u, val(P[i]));</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> u = <span class="number">1</span>, i = Plgt; i &gt;= <span class="number">1</span>; --i) pos[<span class="number">1</span>][i] = u = AC::insert(u, val(P[i]));</span><br><span class="line">        <span class="comment">// maintain</span></span><br><span class="line">        pos[<span class="number">0</span>][<span class="number">0</span>] = pos[<span class="number">1</span>][Plgt + <span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= Plgt - K; ++i)</span><br><span class="line">            Q[pos[<span class="number">0</span>][i]].push_back(Ask(<span class="number">1</span>, j, pos[<span class="number">1</span>][i + K + <span class="number">1</span>]));</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= Plgt - K; ++i)</span><br><span class="line">            Q[pos[<span class="number">0</span>][i]].push_back(Ask(<span class="number">-1</span>, j, pos[<span class="number">1</span>][i + K]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    AC::getFail(), Graph::dfs(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// match</span></span><br><span class="line">    pos[<span class="number">0</span>][<span class="number">0</span>] = pos[<span class="number">1</span>][Slgt + <span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= Slgt; ++i) pos[<span class="number">0</span>][i] = AC::ch[val(S[i])][pos[<span class="number">0</span>][i - <span class="number">1</span>]];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = Slgt; i &gt;= <span class="number">1</span>; --i) pos[<span class="number">1</span>][i] = AC::ch[val(S[i])][pos[<span class="number">1</span>][i + <span class="number">1</span>]];</span><br><span class="line">    <span class="comment">// maintain</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= Slgt - K; ++i)</span><br><span class="line">        M[pos[<span class="number">0</span>][i]].push_back(Ask(<span class="number">1</span>, <span class="number">0</span>, pos[<span class="number">1</span>][i + K + <span class="number">1</span>]));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= Slgt - K; ++i)</span><br><span class="line">        M[pos[<span class="number">0</span>][i]].push_back(Ask(<span class="number">-1</span>, <span class="number">0</span>, pos[<span class="number">1</span>][i + K]));</span><br><span class="line">    solve(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, Ans[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒHAOI2017ã€å…«çºµå…«æ¨ª"><a href="#ã€ŒHAOI2017ã€å…«çºµå…«æ¨ª" class="headerlink" title="ã€ŒHAOI2017ã€å…«çºµå…«æ¨ª"></a>ã€ŒHAOI2017ã€å…«çºµå…«æ¨ª</h3><p>åœ¨å­¦çº¿æ®µæ ‘åˆ†æ²»çš„æ—¶å€™, çœ‹åˆ°è¿™é“é¢˜æ˜¯ HAOI å°±æ²¡æœ‰å†™, äºæ˜¯å»å†™äº† <a href="http://codeforces.com/problemset/problem/938/G" target="_blank" rel="noopener">CF938G Shortest Path Queries</a>.</p><p>çœ‹åˆ°é¢˜ç›®å, ???. ä¸è¿‡é‚£åœº EDU æ˜¯ 18 å¹´çš„â€¦ ä¼°è®¡æ˜¯æ’ idea äº† = =</p><h4 id="é¢˜ç›®é“¾æ¥-3"><a href="#é¢˜ç›®é“¾æ¥-3" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2312" target="_blank" rel="noopener">https://loj.ac/problem/2312</a></li></ul><h4 id="è§£é¢˜æ€è·¯-3"><a href="#è§£é¢˜æ€è·¯-3" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>é‚£ä¹ˆè¿™é“é¢˜çš„æ€è·¯å°±å¾ˆæ˜¾ç„¶äº†, é‡‡ç”¨çº¿æ®µæ ‘åˆ†æ²», å¯¹æ—¶é—´å»ºçº¿æ®µæ ‘, æŠŠè¾¹çš„ç¼–å·æŒ‚åœ¨å¯¹åº”çš„èŠ‚ç‚¹ä¸Š.</p><p>ç„¶åè€ƒè™‘å¦‚ä½•è®¡ç®—ç­”æ¡ˆ. ç”±äºè¿™å¼ å›¾æ˜¯è¿é€šçš„, è€ƒè™‘å›¾ä¸Šçš„ç¯, å®¹æ˜“å‘ç°å¯ä»¥æ„é€ å‡ºä¸€æ¡ä» $1$ å¼€å§‹åˆå›åˆ° $1$ çš„è·¯å¾„, ä½¿å¾—ä»…æœ‰ç¯ä¸Šçš„è·¯å¾„ç»è¿‡å¥‡æ•°æ¬¡.</p><p>é‚£ä¹ˆå¯ä»¥è®°å½•ç¯ä¸Šçš„è·¯å¾„å¼‚æˆ–å€¼, å¹¶æŸ¥è¯¢å…¶ä¸­å¯ä»¥å¼‚æˆ–åˆ°çš„æœ€å¤§å€¼. å¯ä»¥ä½¿ç”¨å¹¶æŸ¥é›†ä»¥åŠçº¿æ€§åŸºå®Œæˆ.</p><p>ä¸è¿‡è¿™å±‘é¢˜ä¸­æƒå€¼äºŒè¿›åˆ¶ä½æ•°æ˜¯ $10^3$ çº§åˆ«çš„, ä½¿ç”¨ <code>bitset</code> å³å¯. è€ƒè™‘åˆ°ä¸Šé¢éƒ½æ˜¯ä¸€äº›å¥—è·¯æ€§çš„ä¸œè¥¿, äºæ˜¯è¿™é“é¢˜çš„éš¾ç‚¹å°±æ˜¯ç”¨ <code>bitset</code> æ¨¡æ‹Ÿäº†. = =</p><p>æ—¶é—´å¤æ‚åº¦å¤§æ¦‚æ˜¯ $O(q \frac{len}{w} \log q \log n)$ ?</p><h4 id="ä»£ç å®ç°-3"><a href="#ä»£ç å®ç°-3" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p>ä¼¼ä¹ä¸ç”¨å†™å¸¦æ’¤é”€çº¿æ€§åŸº? å·æ‡’æ¯æ¬¡ç›´æ¥å¤§åŠ›å¤åˆ¶å½“å‰çº¿æ€§åŸºåˆ°çº¿æ®µæ ‘ä¸‹ä¸€èŠ‚ç‚¹â€¦</p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2312</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bitset&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">505</span>, MAXM = <span class="number">2005</span>, MAXL = <span class="number">1005</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Stk</span> &#123;</span> <span class="keyword">int</span> fu, fv, size; &#125; stk[MAXM];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Modify</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> u, v, L, R; <span class="built_in">bitset</span>&lt;MAXL&gt; w;</span><br><span class="line">&#125; M[MAXM];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, q, top;</span><br><span class="line"><span class="keyword">char</span> str[MAXL];</span><br><span class="line"></span><br><span class="line"><span class="built_in">bitset</span>&lt;MAXL&gt; fix(<span class="keyword">char</span>* S) &#123;</span><br><span class="line">    <span class="built_in">bitset</span>&lt;MAXL&gt; ret;</span><br><span class="line">    <span class="keyword">int</span> lgt = (<span class="keyword">int</span>) <span class="built_in">strlen</span>(S);</span><br><span class="line">    reverse(S, S + lgt);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lgt; ++i) ret[i] = S[i] - <span class="string">'0'</span>;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LinerBasis</span> &#123;</span></span><br><span class="line">    <span class="built_in">bitset</span>&lt;MAXL&gt; A[MAXL];</span><br><span class="line"></span><br><span class="line">    LinerBasis() &#123; <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAXL; ++i) A[i].reset(); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="built_in">bitset</span>&lt;MAXL&gt; x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = MAXL<span class="number">-1</span>; i &gt;= <span class="number">0</span>; --i) <span class="keyword">if</span> (x[i]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!A[i].any()) &#123; A[i] = x; <span class="keyword">break</span>; &#125;</span><br><span class="line">            x ^= A[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Qry</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// max xor</span></span><br><span class="line">        <span class="built_in">bitset</span>&lt;MAXL&gt; ret; ret.reset();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = MAXL<span class="number">-1</span>; i &gt;= <span class="number">0</span>; --i) <span class="keyword">if</span> (!ret[i]) ret ^= A[i];</span><br><span class="line">        <span class="comment">// output</span></span><br><span class="line">        <span class="keyword">int</span> i = MAXL<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &gt; <span class="number">0</span> &amp;&amp; !ret[i]) --i;</span><br><span class="line">        <span class="keyword">while</span> (i &gt;= <span class="number">0</span>) <span class="built_in">putchar</span>(ret[i--] + <span class="string">'0'</span>);</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">'\n'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> DSU &#123;</span><br><span class="line">    <span class="keyword">int</span> fa[MAXN], size[MAXN];</span><br><span class="line">    <span class="built_in">bitset</span>&lt;MAXL&gt; dist[MAXN];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) fa[i] = i, size[i] = <span class="number">1</span>, dist[i].reset();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">findfa</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (u != fa[u]) u = fa[u];</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">inline</span> <span class="built_in">bitset</span>&lt;MAXL&gt; findist(<span class="keyword">int</span> u) &#123;</span><br><span class="line">        <span class="built_in">bitset</span>&lt;MAXL&gt; ret; ret.reset();</span><br><span class="line">        <span class="keyword">while</span> (u != fa[u]) ret ^= dist[u], u = fa[u];</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SGT &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lc (nd&lt;&lt;1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rc (nd&lt;&lt;1|1)</span></span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> DSU;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; dat[MAXM &lt;&lt; <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opL, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opR, <span class="keyword">const</span> <span class="keyword">int</span>&amp; idx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (opL &lt;= L &amp;&amp; R &lt;= opR) <span class="keyword">return</span> <span class="keyword">void</span>( dat[nd].push_back(idx) );</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (opL &lt;= Mid) Mdy(lc, L, Mid, opL, opR, idx);</span><br><span class="line">        <span class="keyword">if</span> (opR &gt; Mid) Mdy(rc, Mid+<span class="number">1</span>, R, opL, opR, idx);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Divide</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, LinerBasis S)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (L &gt; R) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">int</span> k = top;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; dat[nd].size(); ++i) &#123;</span><br><span class="line">            <span class="keyword">const</span> <span class="keyword">int</span>&amp; idx = dat[nd][i];</span><br><span class="line">            <span class="keyword">int</span> fu = findfa(M[idx].u), fv = findfa(M[idx].v);</span><br><span class="line">            <span class="built_in">bitset</span>&lt;MAXL&gt; w = M[idx].w ^ findist(M[idx].u) ^ findist(M[idx].v);</span><br><span class="line">            <span class="keyword">if</span> (fu == fv) S.insert(w);</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (size[fu] &lt; size[fv]) swap(fu, fv);</span><br><span class="line">                fa[fv] = fu, size[fu] += size[fv], dist[fv] = w;</span><br><span class="line">                stk[++top] = (Stk)&#123; fu, fv, size[fv] &#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (L == R) S.Qry();</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">            Divide(lc, L, Mid, S), Divide(rc, Mid+<span class="number">1</span>, R, S);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (top &gt; k) &#123;</span><br><span class="line">            Stk u = stk[top--];</span><br><span class="line">            dist[u.fv].reset(), fa[u.fv] = u.fv, size[u.fu] -= u.size;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> lc</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> rc</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;n, &amp;m, &amp;q);</span><br><span class="line">    LinerBasis S;</span><br><span class="line">    DSU::init();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> u, v, i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d%s"</span>, &amp;u, &amp;v, str);</span><br><span class="line">        <span class="keyword">using</span> <span class="keyword">namespace</span> DSU;</span><br><span class="line">        <span class="keyword">int</span> fu = findfa(u), fv = findfa(v);</span><br><span class="line">        <span class="built_in">bitset</span>&lt;MAXL&gt; w = fix(str) ^ findist(u) ^ findist(v);</span><br><span class="line">        <span class="keyword">if</span> (fu == fv) S.insert(w);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (size[fu] &lt; size[fv]) swap(fu, fv);</span><br><span class="line">            fa[fv] = fu, size[fu] += size[fv], dist[fv] = w;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    S.Qry();</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    <span class="comment">// æŒ‡å®šç¼–å·å°±å¾ˆéš¾å— = =</span></span><br><span class="line">    <span class="keyword">int</span> idx = <span class="number">0</span>, ex = <span class="number">550</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= q; ++i) &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> x, y, k; <span class="keyword">static</span> <span class="keyword">char</span> opt[<span class="number">16</span>];</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%s"</span>, opt);</span><br><span class="line">        <span class="keyword">switch</span> (opt[<span class="number">1</span>]) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'d'</span>:</span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">"%d%d%s"</span>, &amp;x, &amp;y, str);</span><br><span class="line">                M[++idx] = (Modify)&#123; x, y, i, <span class="number">-1</span>, fix(str) &#125;;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'a'</span>: <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;k), M[k].R = i - <span class="number">1</span>; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'h'</span>:</span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">"%d%s"</span>, &amp;k, str);</span><br><span class="line">                M[++ex] = M[k];</span><br><span class="line">                M[ex].R = i - <span class="number">1</span>, M[k].L = i, M[k].w = fix(str);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>: <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"ERR\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= idx; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (M[i].R == <span class="number">-1</span>) M[i].R = q;</span><br><span class="line">        <span class="keyword">if</span> (M[i].L &lt;= M[i].R) SGT::Mdy(<span class="number">1</span>, <span class="number">1</span>, q, M[i].L, M[i].R, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">551</span>; i &lt;= ex; ++i)</span><br><span class="line">        <span class="keyword">if</span> (M[i].L &lt;= M[i].R) SGT::Mdy(<span class="number">1</span>, <span class="number">1</span>, q, M[i].L, M[i].R, i);</span><br><span class="line">    <span class="comment">// DSU::init();</span></span><br><span class="line">    SGT::Divide(<span class="number">1</span>, <span class="number">1</span>, q, S);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ã€ŒHAOI2017ã€ä¾›ç»™ä¾§æ”¹é©"><a href="#ã€ŒHAOI2017ã€ä¾›ç»™ä¾§æ”¹é©" class="headerlink" title="ã€ŒHAOI2017ã€ä¾›ç»™ä¾§æ”¹é©"></a>ã€ŒHAOI2017ã€ä¾›ç»™ä¾§æ”¹é©</h3><p>å‡ºé¢˜äººç»ˆäºæ‰¿è®¤æ•°æ®æ˜¯ä»–ç”¨è„šéšçš„äº†.</p><h4 id="é¢˜ç›®é“¾æ¥-4"><a href="#é¢˜ç›®é“¾æ¥-4" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><ul><li><a href="https://loj.ac/problem/2313" target="_blank" rel="noopener">https://loj.ac/problem/2313</a></li></ul><h4 id="è§£é¢˜æ€è·¯-4"><a href="#è§£é¢˜æ€è·¯-4" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p><del>æ ¹æ®é¢˜ç›®ä¸­ â€œä¸² S ä¸­çš„æ¯ä¸€ä½éƒ½æ˜¯åœ¨ 0 å’Œ 1 ä¹‹é—´éšæœºäº§ç”Ÿçš„â€ å¯ä»¥çŒœæµ‹, è¿™é“é¢˜é€‚åˆçæ.</del></p><p>æ—¢ç„¶æ•°æ®éšæœº, é‚£ä¹ˆå¾ˆå¤šä¸å¯¹åŠ²çš„ç®—æ³•å°±å¯ä»¥æ‹¿è¿‡æ¥ç”¨äº†.</p><p><del>ä¼¼ä¹å¯ä»¥ç›´æ¥çŒœæœ€é•¿ LCP é•¿åº¦ç„¶åå¤§åŠ›æšä¸¾?</del></p><p>è¿˜æ˜¯è€ƒè™‘ä¸€ç§çœ‹èµ·æ¥å¯¹åŠ²çš„åšæ³•, å…ˆå»ºå‡ºåŸä¸²çš„åç¼€æ ‘. è¿™é‡Œé‡‡ç”¨å¯¹åä¸²å»º SAM, åç¼€é“¾æ¥å°±æ˜¯åŸä¸²çš„åç¼€æ ‘äº†.</p><p>å°†æ‰€æœ‰è¯¢é—®ç¦»çº¿, æŒ‰ $R$ ä»å°åˆ°å¤§æ’åº, æ‰«æ $S$ çš„æ¯ä¸€ä½, æ¯æ¬¡åœ¨åç¼€æ ‘ä¸Šæ›´æ–°ä¸€æ¡é“¾, åœ¨åç¼€æ ‘ä¸Šç»´æŠ¤æœ€é•¿ LCP å¤§å° <code>MaxLCP</code>, ä»¥åŠèŠ‚ç‚¹å’Œå‰ç¼€é•¿åº¦å¯¹åº”åˆ° $S$ ä¸Šçš„æœ€é åä½ç½®, åˆ†åˆ«è®°ä½œ <code>idx[u]</code> å’Œ <code>Lidx[l]</code>.</p><p>å¦‚æœå½“å‰æ‰«æä½ç½®åŒ…å«äº†æŸä¸ªè¯¢é—®çš„åŒºé—´, å°±æŠŠè¿™ä¸ªè¯¢é—®æ‹¿å‡ºæ¥è®¡ç®—ç­”æ¡ˆ. ä»å¤§åˆ°å°æšä¸¾æœ€é•¿ LCP é•¿åº¦, å¦‚æœå½“å‰é•¿åº¦ $i$ å¯¹åº”çš„ <code>Lidx[i]</code> æ¯”è®°å½•çš„ä¸Šä¸€æ¬¡æ›´æ–°ä½ç½® <code>lst</code> è¦å¤§å°±æ›´æ–°ç­”æ¡ˆ.</p><p>ç”±äºç­”æ¡ˆçš„å•è°ƒæ€§, ä¹Ÿå°±æ˜¯ $[L,\ R]$ çš„ç­”æ¡ˆä¸€å®šå¤§äºç­‰äº $[L+1,\ R],\ \ldots,\ [R-1,\ R]$, æ‰€ä»¥åˆ†å—è®¡ç®—çš„æ­£ç¡®æ€§å¯ä»¥å¾—åˆ°ä¿è¯.</p><p>æ—¶é—´å¤æ‚åº¦ $O(\texttt{ç„å­¦})$.</p><h4 id="ä»£ç å®ç°-4"><a href="#ä»£ç å®ç°-4" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOJ #2313</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span>+<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Ask</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> idx, L, R;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Ask&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> R &lt; rhs.R || (R == rhs.R &amp;&amp; L &lt; rhs.L);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; Q[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, q;</span><br><span class="line"><span class="keyword">char</span> S[MAXN];</span><br><span class="line"><span class="keyword">int</span> pos[MAXN], Ans[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SAM &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXN = ::MAXN &lt;&lt; <span class="number">1</span>, SIGMA = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> ch[SIGMA][MAXN], lnk[MAXN], len[MAXN], nidx, last;</span><br><span class="line">    <span class="keyword">int</span> idx[MAXN], Lidx[MAXN], MaxLCP;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; nidx = last = <span class="number">1</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> nd = ++nidx, p = last;</span><br><span class="line">        len[nd] = len[last] + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (p &amp;&amp; !ch[val][p]) ch[val][p] = nd, p = lnk[p];</span><br><span class="line">        <span class="keyword">if</span> (!p) lnk[nd] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> q = ch[val][p];</span><br><span class="line">            <span class="keyword">if</span> (len[q] == len[p] + <span class="number">1</span>) lnk[nd] = q;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">int</span> nxt = ++nidx;</span><br><span class="line">                len[nxt] = len[p] + <span class="number">1</span>, lnk[nxt] = lnk[q];</span><br><span class="line">                ch[<span class="number">0</span>][nxt] = ch[<span class="number">0</span>][q], ch[<span class="number">1</span>][nxt] = ch[<span class="number">1</span>][q];</span><br><span class="line">                <span class="keyword">while</span> (p &amp;&amp; ch[val][p] == q) ch[val][p] = nxt, p = lnk[p];</span><br><span class="line">                lnk[q] = lnk[nd] = nxt;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> last = nd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Upd</span><span class="params">(<span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> u = pos[R]; u &gt; <span class="number">1</span>; u = lnk[u]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (idx[u]) &#123;</span><br><span class="line">                MaxLCP = max(MaxLCP, len[u]);</span><br><span class="line">                Lidx[len[u]] = max(Lidx[len[u]], idx[u]);</span><br><span class="line">            &#125;</span><br><span class="line">            idx[u] = max(idx[u], R);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Qry</span><span class="params">(<span class="keyword">int</span> L)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> lst = L - <span class="number">1</span>, i = MaxLCP; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            <span class="keyword">if</span> (lst &lt; Lidx[i]) ret += i * (Lidx[i] - lst), lst = Lidx[i];</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// init</span></span><br><span class="line">    SAM::init();</span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d%s"</span>, &amp;n, &amp;q, S+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> L, R, i = <span class="number">1</span>; i &lt;= q; ++i)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;L, &amp;R), Q[i] = (Ask)&#123; i, L, R &#125;;</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i; --i) pos[i] = SAM::insert(S[i] - <span class="string">'0'</span>);</span><br><span class="line">    sort(Q+<span class="number">1</span>, Q+<span class="number">1</span>+q);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> idx = <span class="number">1</span>, i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        SAM::Upd(i);</span><br><span class="line">        <span class="keyword">while</span> (idx &lt;= q &amp;&amp; Q[idx].R &lt;= i)</span><br><span class="line">            Ans[Q[idx].idx] = SAM::Qry(Q[idx].L), ++idx;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= q; ++i) <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, Ans[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><hr>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;HAOI 2017 çš„ç¥ç§˜å¼±çœçœé€‰éš¾åº¦.&lt;/p&gt;
    
    </summary>
    
    
      <category term="é¢˜è§£" scheme="https://depletedprism.github.io/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
  </entry>
  
  <entry>
    <title>ã€ŒLuogu P2664ã€æ ‘ä¸Šæ¸¸æˆ</title>
    <link href="https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/oj/luogu-P2664/"/>
    <id>https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/oj/luogu-P2664/</id>
    <published>2020-02-28T13:40:09.000Z</published>
    <updated>2020-02-28T16:20:10.434Z</updated>
    
    <content type="html"><![CDATA[<hr><ul><li>é¢˜ç›®é“¾æ¥: <a href="https://www.luogu.com.cn/problem/P2664" target="_blank" rel="noopener">https://www.luogu.com.cn/problem/P2664</a></li></ul><p>è¿™æ˜¯ä¸€é“ç‚¹åˆ†æ²»å¥½é¢˜, è‡³å°‘æˆ‘ç°åœ¨è¿™ä¹ˆè®¤ä¸º. = =</p><a id="more"></a><h4 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h4><ol><li>ç‚¹åˆ†æ²»</li></ol><h4 id="é¢˜ç›®æ€è·¯"><a href="#é¢˜ç›®æ€è·¯" class="headerlink" title="é¢˜ç›®æ€è·¯"></a>é¢˜ç›®æ€è·¯</h4><p>è€ƒè™‘ç‚¹åˆ†æ²». <del>è™½ç„¶éš”å£ O(n) åšæ³•åˆå¤§åˆåœ†ä½†æ˜¯ä¸ç®¡</del></p><blockquote><p>ç‚¹åˆ†æ²»åœ¨å¤„ç†æ ‘ä¸Šè·¯å¾„ä¿¡æ¯çš„æ—¶å€™, æŠŠè·¯å¾„åˆ†ä¸ºä¸¤ç±»: ä¸€ç±»ä¸ç»è¿‡æ ¹èŠ‚ç‚¹, ä¸€ç±»ç»è¿‡. åè€…ä¸ºä¸€ç«¯ç‚¹æ˜¯æ ¹èŠ‚ç‚¹çš„è·¯å¾„, æˆ–è€…å¯ä»¥çœ‹ä½œä¸¤æ¡ç«¯ç‚¹ä¸ºæ ¹èŠ‚ç‚¹çš„è·¯å¾„æ‹¼æ¥è€Œæ¥.</p><p>æ‰€ä»¥å¯ä»¥ä¾æ¬¡éå†å­æ ‘, æ¯æ¬¡å•ç‹¬è€ƒè™‘å­æ ‘ä¸­çš„ä¿¡æ¯å’Œå…¶ä»–å­æ ‘ä¿¡æ¯ä¹‹é—´çš„å½±å“, ä»è€Œæ›´æ–°ç­”æ¡ˆ.</p></blockquote><p>åœ¨å¤„ç†è¿™é“é¢˜çš„æ—¶å€™æˆ‘ä»¬æ²¿ç”¨è¿™ä¸ªæ€è·¯. ä¹Ÿå°±æ˜¯è¯´, ä¸Šé¢æ˜¯ä¸¤æ®µåºŸè¯, å’Œè¿™é¢˜æ¯«æ— å…³ç³».</p><p>ä¸ºäº†è¡¨è¿°æ–¹ä¾¿, è®° <code>C[u]</code> ä¸ºèŠ‚ç‚¹ $u$ çš„é¢œè‰², <code>size[u]</code> ä¸ºèŠ‚ç‚¹ $u$ çš„å­æ ‘å¤§å°.</p><p>å¯ä»¥è§‚å¯Ÿåˆ°ä¸€ä¸ªäº‹å®, å•ç‹¬è€ƒè™‘æ ¹èŠ‚ç‚¹ $root$ ä¸€ä¸ªå­æ ‘ä¸­çš„æŸä¸€ä¸ªèŠ‚ç‚¹ $u$, ($u$ æ»¡è¶³åœ¨ $root$ åˆ° $u$ çš„è·¯å¾„ä¸­ <code>C[u]</code> ç¬¬ä¸€æ¬¡å‡ºç°), é‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹ $u$ å¯ä»¥å¯¹å…¶ä»–å­æ ‘ä¸­çš„èŠ‚ç‚¹ $v$, ($v$ æ»¡è¶³ $v$ åˆ° $root$ è·¯å¾„ä¸Šä¸åŒ…å« <code>C[u]</code>, æœ‰ <code>size[u]</code> çš„è´¡çŒ®.</p><p>æ­£ç¡®æ€§æ˜¾ç„¶. å•ç‹¬è€ƒè™‘æ¯ä¸ªé¢œè‰²çš„è´¡çŒ®, å› ä¸º $u$ çš„é¢œè‰²åªåœ¨ $u,\ v$ è·¯å¾„ä¸Šå‡ºç°è¿‡ä¸€æ¬¡, æ‰€ä»¥ $u$ çš„å­æ ‘éƒ½å¯ä»¥åŒ $v$ æ„æˆä¸€ä¸ªç‚¹å¯¹, $u$ çš„é¢œè‰²å¯¹ $v$ åšä¸€æ¬¡è´¡çŒ®, å…± <code>size[u]</code>.</p><p>è€ƒè™‘å¦‚ä½•åœ¨ç‚¹åˆ†æ²»çš„è¿‡ç¨‹ä¸­ç»´æŠ¤è¿™ä¸ªä¸œè¥¿.</p><p>å…ˆç»´æŠ¤æ»¡è¶³ä»¥ä¸Šæ¡ä»¶ $u$ çš„å­æ ‘å¤§å°å’Œ, (ä¹Ÿå°±æ˜¯ $u$ æ»¡è¶³ $root$ åˆ° $u$ çš„è·¯å¾„ä¸­ (ä¸åŒ…æ‹¬ $root$), $u$ çš„é¢œè‰²ç¬¬ä¸€æ¬¡å‡ºç°), ä»¥é¢œè‰²ä¸ºä¸‹æ ‡, è®°ä½œ $\operatorname{W}(c) = \sum\limits_{\operatorname{C}(u) = c} \operatorname{size}(u)$.</p><p>å¹¶è®° <code>tot</code> ä¸ºæ‰€æœ‰ <code>W[c]</code> çš„å’Œ.</p><ul><li><p>å¯¹äºæ ¹èŠ‚ç‚¹, è‡ªèº«çš„é¢œè‰²å¯ä»¥ç»™è‡ªå·± <code>size[root]</code> çš„è´¡çŒ®, å…¶ä»–èŠ‚ç‚¹å¯ä»¥ç»™æ ¹èŠ‚ç‚¹ <code>tot - W[C[root]]</code> çš„è´¡çŒ®.</p><p>å…¶å®å¾ˆå¥½ç†è§£, å› ä¸ºè‡ªå·±çš„é¢œè‰²å·²ç»è®¡ç®—è¿‡äº†, è‡ªç„¶å‡æ‰å°±å¥½äº†.</p></li><li><p>å¯¹äºä»¥ $u$ ä¸ºæ ¹å­æ ‘ä¸­çš„ç‚¹ $v$, è€ƒè™‘å…¶ä»–å­æ ‘å¯¹è¯¥å­æ ‘çš„å½±å“.</p><p> è®° <code>num</code> ä¸º $v$ åˆ° $root$ è·¯å¾„ (ä¸åŒ…æ‹¬ $root$) ä¸Šçš„é¢œè‰²æ•°é‡.</p><p> æ²¿è·¯æ›´æ–° <code>num</code>, <code>tot</code> çš„å€¼: é‡åˆ°æ–°é¢œè‰², å°† <code>tot</code> å‡å» <code>W[C[v]]</code>, å¹¶å°† <code>num</code> å¢åŠ  1.</p><p> é‚£ä¹ˆå¯¹ $v$ çš„è´¡çŒ®ä¸º <code>tot + (size[root] - size[u]) * num</code>.</p><p> ä¹Ÿå°±æ˜¯æ»¡è¶³å¼€å§‹æ‰€è¯´çš„æ¡ä»¶çš„å…¶ä»–å­æ ‘ä¸­çš„ç‚¹, å¯¹ $v$ çš„ç­”æ¡ˆåšè´¡çŒ®; ä»¥åŠå…¶ä»–å­æ ‘ä¸­çš„ç‚¹ç»è¿‡ <code>num</code> ä¸ªç‚¹æ¥åˆ° $v$, å¯¹ $v$ çš„ç­”æ¡ˆåšè´¡çŒ®.</p><p> æ³¨æ„å›æº¯çš„æ—¶å€™æŠŠæ”¹å˜çš„ <code>tot</code> ä»¥åŠ <code>num</code> æ”¹å›æ¥. = =</p></li></ul><p>é‚£ä¹ˆ, ä¸ºä»€ä¹ˆä¸ä¼šç®—é‡å‘¢?</p><p><del>å®é™…ä¸Šè®¡ç®—è´¡çŒ®çš„æ–¹å¼, æ¯ä¸€æ­¥éƒ½å¯¹åº”æ ‘ä¸Šä¸åŒå½¢å¼çš„è·¯å¾„, ç»†èŠ‚ç•™ç»™è¯»è€…æ€è€ƒ.</del></p><p>å¯¹äºæ ¹èŠ‚ç‚¹çš„ç»Ÿè®¡, è€ƒè™‘çš„æ˜¯å½“å‰åˆ†æ²»èŒƒå›´å†…çš„å­æ ‘å¯¹å…¶çš„è´¡çŒ®; å¯¹äºå­æ ‘ä¸­èŠ‚ç‚¹çš„ç»Ÿè®¡, è€ƒè™‘çš„æ˜¯å…¶ä»–å­æ ‘å¯¹å…¶çš„å½±å“, è€Œä¸è€ƒè™‘å­æ ‘å†…éƒ¨çš„è´¡çŒ®, ä¸¤è€…äº’ä¸å½±å“.</p><p>ç»¼ä¸Š, å¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„ç®—æ³•æµç¨‹:</p><ol><li><p>ä»¥å½“å‰é‡å¿ƒä¸ºæ ¹, DFS æ•´æ£µæ ‘, ç»´æŠ¤ <code>size[u]</code>, <code>W[c]</code>.</p></li><li><p>ç»´æŠ¤æ ¹èŠ‚ç‚¹çš„ç­”æ¡ˆ, <code>Ans[root] += tot - W[C[root]] + size[root]</code>.</p></li><li><p>éå†æ ¹èŠ‚ç‚¹å­æ ‘, å°†å½“å‰èŠ‚ç‚¹çš„è´¡çŒ®å‡å», è®¡ç®—å½“å‰å­æ ‘ç­”æ¡ˆ, <code>Ans[v] += tot + (size[root] - size[v]) * num</code>, å†åŠ å›å½“å‰èŠ‚ç‚¹è´¡çŒ®.</p></li><li><p>æ¸…ç©ºè®°å½•çš„ä¿¡æ¯.</p></li></ol><h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Luogu P2664</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span>+<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">int</span> C[MAXN];</span><br><span class="line">LL Ans[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Graph &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt, to; &#125; edges[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], eidx;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="keyword">sizeof</span> head), eidx = <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to)</span> </span>&#123;</span><br><span class="line">        edges[++eidx] = (Edge)&#123; head[from], to &#125;;</span><br><span class="line">        head[from] = eidx;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> TreeDivide &#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> Graph;</span><br><span class="line">    <span class="keyword">bool</span> vis[MAXN];</span><br><span class="line">    <span class="keyword">int</span> cnt[MAXN], num;</span><br><span class="line">    LL W[MAXN], tot, Y;</span><br><span class="line">    <span class="keyword">int</span> Balance[MAXN], size[MAXN], subsize, ct;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; x)</span> </span>&#123; subsize = x, Balance[ct = <span class="number">0</span>] = MAXN; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">findCt</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa)</span> </span>&#123;</span><br><span class="line">        Balance[u] = <span class="number">0</span>, size[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = head[u]; ~i; i = edges[i].nxt) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((v = edges[i].to) == fa || vis[v]) <span class="keyword">continue</span>;</span><br><span class="line">            findCt(v, u), size[u] += size[v];</span><br><span class="line">            Balance[u] = max(Balance[u], size[v]);</span><br><span class="line">        &#125;</span><br><span class="line">        Balance[u] = max(Balance[u], subsize - size[u]);</span><br><span class="line">        <span class="keyword">if</span> (Balance[u] &lt; Balance[ct]) ct = u;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Step 1</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa)</span> </span>&#123;</span><br><span class="line">        ++cnt[C[u]], size[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = head[u]; ~i; i = edges[i].nxt) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((v = edges[i].to) == fa || vis[v]) <span class="keyword">continue</span>;</span><br><span class="line">            dfs(v, u), size[u] += size[v];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (cnt[C[u]] == <span class="number">1</span>) tot += size[u], W[C[u]] += size[u];</span><br><span class="line">        --cnt[C[u]];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Step 3</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">subDfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa)</span> </span>&#123;</span><br><span class="line">        ++cnt[C[u]];</span><br><span class="line">        <span class="keyword">if</span> (cnt[C[u]] == <span class="number">1</span>) tot -= W[C[u]], ++num;</span><br><span class="line">        Ans[u] += tot + Y * num;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = head[u]; ~i; i = edges[i].nxt)</span><br><span class="line">            <span class="keyword">if</span> ((v = edges[i].to) != fa &amp;&amp; !vis[v]) subDfs(v, u);</span><br><span class="line">        <span class="keyword">if</span> (cnt[C[u]] == <span class="number">1</span>) tot += W[C[u]], --num;</span><br><span class="line">        --cnt[C[u]];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Step 2 --&gt; 3</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa, <span class="keyword">const</span> <span class="keyword">int</span>&amp; type)</span> </span>&#123;</span><br><span class="line">        ++cnt[C[u]];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = head[u]; ~i; i = edges[i].nxt)</span><br><span class="line">            <span class="keyword">if</span> ((v = edges[i].to) != fa &amp;&amp; !vis[v]) Mdy(v, u, type);</span><br><span class="line">        <span class="keyword">if</span> (cnt[C[u]] == <span class="number">1</span>) tot += <span class="number">1L</span>L * type * size[u], W[C[u]] += <span class="number">1L</span>L * type * size[u];</span><br><span class="line">        --cnt[C[u]];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Step 4</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa)</span> </span>&#123;</span><br><span class="line">        W[C[u]] = cnt[C[u]] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = head[u]; ~i; i = edges[i].nxt)</span><br><span class="line">            <span class="keyword">if</span> ((v = edges[i].to) != fa &amp;&amp; !vis[v]) clear(v, u);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Divide</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">        vis[u] = <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">// now</span></span><br><span class="line">        <span class="comment">// Step 1</span></span><br><span class="line">        dfs(u, <span class="number">-1</span>);</span><br><span class="line">        <span class="comment">// Step 2</span></span><br><span class="line">        Ans[u] += tot - W[C[u]] + size[u];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = head[u]; ~i; i = edges[i].nxt) &#123;</span><br><span class="line">            <span class="keyword">if</span> (vis[v = edges[i].to]) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="comment">// Step 2 --&gt; 3</span></span><br><span class="line">            ++cnt[C[u]], tot -= size[v], W[C[u]] -= size[v];</span><br><span class="line">            Mdy(v, u, <span class="number">-1</span>);</span><br><span class="line">            <span class="comment">// Step 3</span></span><br><span class="line">            --cnt[C[u]], Y = size[u] - size[v];</span><br><span class="line">            subDfs(v, u);</span><br><span class="line">            ++cnt[C[u]], tot += size[v], W[C[u]] += size[v];</span><br><span class="line">            Mdy(v, u, <span class="number">1</span>);</span><br><span class="line">            --cnt[C[u]];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Step 4</span></span><br><span class="line">        num = tot = <span class="number">0</span>, clear(u, <span class="number">-1</span>);</span><br><span class="line">        <span class="comment">// nxt</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = head[u]; ~i; i = edges[i].nxt) &#123;</span><br><span class="line">            <span class="keyword">if</span> (vis[v = edges[i].to]) <span class="keyword">continue</span>;</span><br><span class="line">            init(size[v]), findCt(v, <span class="number">-1</span>), Divide(ct);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123; init(n), findCt(<span class="number">1</span>, <span class="number">-1</span>), Divide(ct); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// init</span></span><br><span class="line">    Graph::init();</span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) read(C[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> u, v, i = <span class="number">1</span>; i &lt; n; ++i)</span><br><span class="line">        read(u), read(v), Graph::AddEdge(u, v), Graph::AddEdge(v, u);</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    TreeDivide::solve();</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, Ans[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h4><ul><li>Treeloveswater, æ´›è°·é¢˜è§£, <a href="https://www.luogu.com.cn/blog/user24559/solution-p2664" target="_blank" rel="noopener">https://www.luogu.com.cn/blog/user24559/solution-p2664</a></li></ul><hr>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;é¢˜ç›®é“¾æ¥: &lt;a href=&quot;https://www.luogu.com.cn/problem/P2664&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.luogu.com.cn/problem/P2664&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™æ˜¯ä¸€é“ç‚¹åˆ†æ²»å¥½é¢˜, è‡³å°‘æˆ‘ç°åœ¨è¿™ä¹ˆè®¤ä¸º. = =&lt;/p&gt;
    
    </summary>
    
    
      <category term="é¢˜è§£" scheme="https://depletedprism.github.io/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="Graph" scheme="https://depletedprism.github.io/tags/Graph/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŒNOI2018ã€å± é¾™å‹‡å£« é¢˜è§£</title>
    <link href="https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/oj/luogu-P4774/"/>
    <id>https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/oj/luogu-P4774/</id>
    <published>2020-02-27T13:11:04.000Z</published>
    <updated>2020-02-28T05:42:17.294Z</updated>
    
    <content type="html"><![CDATA[<hr><blockquote><p>NOI åˆä¸æ€ä¹ˆè€ƒæ•°è®ºé¢˜.</p><p>from æŸç¥ä»™</p></blockquote><ul><li>é¢˜ç›®é“¾æ¥: <a href="https://www.luogu.com.cn/problem/P4774" target="_blank" rel="noopener">https://www.luogu.com.cn/problem/P4774</a></li></ul><p><del>æœ€è¿‘å¥½é¢“å•Š = =, å†™é¢˜åˆä¸æƒ³è‡ªå·±å†™, å­¦ä¸œè¥¿åˆä¸èƒ½é™ä¸‹æ¥å¥½å¥½å­¦</del></p><p>è¿™æ˜¯ä¸€é“æ‹“å±•ä¸­å›½å‰©ä½™å®šç†çš„æ¨¡æ¿é¢˜, ç”±æ­¤å‘ç°ä¹‹å‰å­¦çš„ Ex CRT å¾ˆå‡, æ‰€ä»¥æ¥æ•´ç†ä¸€ä¸‹.</p><a id="more"></a><p>è¿™è¿˜æ˜¯ä¸€é“é˜…è¯»ç†è§£é¢˜ = =.</p><h4 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h4><ol><li>åŸºç¡€æ•°è®º</li><li>æ‹“å±•ä¸­å›½å‰©ä½™å®šç†</li></ol><h4 id="é¢˜ç›®æ€è·¯"><a href="#é¢˜ç›®æ€è·¯" class="headerlink" title="é¢˜ç›®æ€è·¯"></a>é¢˜ç›®æ€è·¯</h4><p>è®°å¯¹ç¬¬ $i$ ä¸ªå·¨é¾™ä½¿ç”¨å‰‘çš„æ”»å‡»åŠ›ä¸º $A_i$.</p><p>å®¹æ˜“å‘ç°, $A_i$ çš„å€¼å…¶å®å¾ˆå¥½ç¡®å®š, ç›´æ¥åœ¨ <code>multiset</code> ä¸ŠäºŒåˆ†å³å¯. é‚£ä¹ˆ, ç°åœ¨çš„é—®é¢˜ä¸º</p><p>ç»™å®š $a_i,\ A_i,\ p_i$, æœ‰</p><p>$$<br>\begin{equation}<br>\left \{<br>    \begin{array}{ccc} a_1 - A_1 x &amp;\equiv &amp; 0 \pmod {p_1} \\ a_2 - A_2 x &amp;\equiv &amp; 0 \pmod {p_2} \\ &amp;\vdots&amp; \\ a_n - A_n x &amp;\equiv &amp; 0 \pmod {p_n} \end{array}<br>\right.<br>\end{equation}<br>$$</p><p>æ±‚æ»¡è¶³æ¡ä»¶çš„æœ€å° $x$, å…¶ä¸­ $p_i$ ä¸ä¸€å®šä¸ºäº’è´¨.</p><p>å…¶å®è¿™åªæ˜¯ä¸€ä¸ª Ex CRT, æŠŠå¼å­ç¨å¾®è½¬æ¢ä¸€ä¸‹, å¾—</p><p>$$x \equiv a_i \cdot A_i^{-1} \pmod {p_i}$$</p><p>è¿™å°±å’Œæ¨¡æ¿é¢˜å®Œå…¨ä¸€æ ·äº†, æ³¨æ„åˆ° $p_i$ å¹¶ä¸æ˜¯è´¨æ•°, æ±‚ä¹˜æ³•é€†å…ƒçš„æ—¶å€™è·‘ exgcd å°±å¥½äº†. å¦å¤–ä¼šå‡ºç°æ— è§£çš„æƒ…å†µ, åœ¨ä¸‹æ–‡ä¼šç»†è°ˆ.</p><p>ç°åœ¨é—®é¢˜å·²ç»è§£å†³äº†å¤§åŠ, ä½†æ˜¯æœ‰ä¸€äº›ç‰¹åˆ¤ä¸èƒ½å¿½ç•¥.</p><p>é¦–å…ˆè€ƒè™‘æ— è§£. ä¸€ç•ªåˆ†æä¹‹åå¯ä»¥å‘ç°, æ— è§£æœ‰ä¸¤ç§æƒ…å†µ:</p><ul><li><p>åŒ–ç®€åŒä½™å¼æ—¶æ— è§£</p><p>è€ƒè™‘åŒ–ç®€çš„è¿‡ç¨‹, æˆ‘ä»¬æŠŠ $A_i x \equiv a_i \pmod {p_i}$ åŒ–æˆä¸å®šæ–¹ç¨‹çš„å½¢å¼, å³</p><p>$$A_i x + y p_i = a_i$$</p><p>æ ¹æ®è£´èœ€å®šç†, è¯¥æ–¹ç¨‹æœ‰è§£éœ€è¦æ»¡è¶³ $\gcd(A_i,\ p_i) \mid a_i$, å¦åˆ™æ— è§£.</p><p>è™½ç„¶æ— è§£çš„æƒ…å†µå·²ç»è§£å†³äº†, ä¸å¦¨é¡ºæ°´æ¨èˆŸ, æŠŠåŒ–ç®€çš„è¿‡ç¨‹å†™å®Œ.</p><p>è®° $g = \gcd(A_i,\ p_i)$, äºæ˜¯ä¸¤è¾¹åŒé™¤ $g$, æœ‰</p><p>$$\frac{A_i}{g} x + \frac{p_i}{g} y = \frac{a_i}{g}$$</p><p>è®° $A_i^{-1}$ ä¸ºæ¨¡ $p_i$ æ„ä¹‰ä¸‹çš„é€†å…ƒ, æ•´ç†, å¾—</p><p>$$x \equiv \frac{a_i}{g}\cdot A_i^{-1}\pmod{ \frac{p_i}{g} }$$</p></li><li><p>åˆå¹¶åŒä½™å¼æ—¶æ— è§£</p><p>è€ƒè™‘ä¸¤åŒä½™å¼è½¬æ¢ä¸ºä¸å®šæ–¹ç¨‹åç›¸å‡, å’Œä¸Šä¸€æƒ…å†µåŒç†.</p></li></ul><p>å…¶æ¬¡è€ƒè™‘é¢˜ç›®çš„ç‰¹æ®Šæ€§è´¨.</p><p>ç‰¹æ€§ 2 æ²¡ä»€ä¹ˆå¥½è¯´çš„, å’Œæ–‡æœ«æç¤º â€œä½ æ‰€ç”¨åˆ°çš„ä¸­é—´ç»“æœå¯èƒ½å¾ˆå¤§ï¼Œæ³¨æ„ä¿å­˜ä¸­é—´ç»“æœçš„å˜é‡ç±»å‹â€ ä¸€æ ·, è¦æ³¨æ„æ¯ä¸ªåŒä½™æ–¹ç¨‹æ¨¡æ•°çš„æ•°é‡çº§éƒ½åœ¨ $10^{12}$, å»ºè®®ä½¿ç”¨ <code>long long</code> ä»¥åŠé¾Ÿé€Ÿä¹˜.</p><p>è€ƒè™‘ç‰¹æ€§ 1 çš„åä¾‹, ä¹Ÿå°±æ˜¯ $a_i &gt; p_i$, ä¼šå¯¹ä»¥ä¸Šçš„è¿‡ç¨‹äº§ç”Ÿä»€ä¹ˆå½±å“.</p><p>å¦‚æœå­˜åœ¨ä¸€ä¸ª $x$, æ»¡è¶³ $A_i x = a_i - p_i$, ä¾ç„¶æ»¡è¶³ $A_i x \equiv a_i \pmod {p_i}$, ä½†æ˜¾ç„¶ä¸æ»¡è¶³é¢˜æ„ = =</p><p>å¹¸è¿çš„æ˜¯, ä¸æ»¡è¶³ç‰¹æ€§ 1 çš„æ•°æ®ç‚¹å¦å¤–æ»¡è¶³ $p_i = 1$, æ­¤æ—¶ç­”æ¡ˆå°±æ˜¯</p><p>$$\max _{i = 1} ^n \{\ \lceil \dfrac{a_i}{A_i} \rceil\ \}$$</p><p><del>æ”¾åˆ°é¢˜ç›®èƒŒæ™¯é‡Œå°±æ˜¯ä¸€ç›´ç , ä¸€ç›´ç </del></p><p>é‚£ä¹ˆè¿™é“é¢˜å°±åšå®Œäº† = =.</p><p>æ¯”è¾ƒè‰¯å¿ƒçš„æ˜¯, å¤§æ ·ä¾‹ (from loj) å­˜åœ¨éƒ¨åˆ†æ•°æ®æ»¡è¶³è¿™å‡ ä¸ªç‰¹æ®Šæ€§è´¨.</p><p>ä½œä¸º Day2 T1 (åº”è¯¥? ) ç®—æ˜¯é€æ¸©æš–å§, ä½†å¯¹äºæˆ‘è¿™ç§èƒŒæ¿é€‰æ‰‹ä¸€å‘ 15 pts è¿˜æ˜¯ç®—äº† = =.</p><h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Luogu P4774</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">multiset</span>&lt;LL&gt;::iterator IT;</span><br><span class="line"><span class="comment">// å‡†å¤‡è¿æ¥ CCF çš„çœé€‰äº† = =</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span>+<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> LL <span class="title">smul</span><span class="params">(LL base, LL b, LL m)</span> </span>&#123;</span><br><span class="line">    LL ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (b &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>) ret = (ret + base) % m;</span><br><span class="line">        base = (base + base) % m, b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">exgcd</span><span class="params">(LL a, LL b, LL&amp; d, LL&amp; x, LL&amp; y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!b) d = a, x = <span class="number">1</span>, y = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> exgcd(b, a % b, d, y, x), y -= a / b * x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="built_in">multiset</span>&lt;LL&gt; S;</span><br><span class="line">LL A[MAXN], a[MAXN], p[MAXN], w[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function">LL <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// pre done</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">static</span> LL x, d, y;</span><br><span class="line">        exgcd(A[i], p[i], d, x, y);</span><br><span class="line">        <span class="keyword">if</span> (a[i] % d != <span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        p[i] /= d;</span><br><span class="line">        A[i] = smul(a[i] / d, (x % p[i] + p[i]) % p[i], p[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// extra CRT</span></span><br><span class="line">    LL ret = A[<span class="number">1</span>], M = p[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">static</span> LL x, y, c, d, mod;</span><br><span class="line">        c = ((A[i] - ret) % p[i] + p[i]) % p[i];</span><br><span class="line">        exgcd(M, p[i], d, x, y);</span><br><span class="line">        <span class="keyword">if</span> (c % d != <span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        mod = p[i] / d, x = smul(x, c / d, mod);</span><br><span class="line">        ret += x * M, M *= mod, ret = (ret % M + M) % M;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">LL <span class="title">p1solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    LL ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        ret = max(ret, (a[i] + A[i] - <span class="number">1</span>) / A[i]);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> Ti; read(Ti);</span><br><span class="line">    <span class="keyword">while</span> (Ti--) &#123;</span><br><span class="line">        <span class="comment">// init</span></span><br><span class="line">        S.clear();</span><br><span class="line">        <span class="keyword">bool</span> p1 = <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">// input</span></span><br><span class="line">        read(n), read(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) read(a[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) read(p[i]), p1 &amp;= p[i] == <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) read(w[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> x, i = <span class="number">1</span>; i &lt;= m; ++i) read(x), S.insert(x);</span><br><span class="line">        <span class="comment">// pre done</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            IT ite = (a[i] &lt; *S.begin())? S.begin(): (--S.upper_bound(a[i]));</span><br><span class="line">            A[i] = *ite;</span><br><span class="line">            S.erase(ite), S.insert(w[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// output</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, p1? p1solve(): solve());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;NOI åˆä¸æ€ä¹ˆè€ƒæ•°è®ºé¢˜.&lt;/p&gt;
&lt;p&gt;from æŸç¥ä»™&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;é¢˜ç›®é“¾æ¥: &lt;a href=&quot;https://www.luogu.com.cn/problem/P4774&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.luogu.com.cn/problem/P4774&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;del&gt;æœ€è¿‘å¥½é¢“å•Š = =, å†™é¢˜åˆä¸æƒ³è‡ªå·±å†™, å­¦ä¸œè¥¿åˆä¸èƒ½é™ä¸‹æ¥å¥½å¥½å­¦&lt;/del&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ä¸€é“æ‹“å±•ä¸­å›½å‰©ä½™å®šç†çš„æ¨¡æ¿é¢˜, ç”±æ­¤å‘ç°ä¹‹å‰å­¦çš„ Ex CRT å¾ˆå‡, æ‰€ä»¥æ¥æ•´ç†ä¸€ä¸‹.&lt;/p&gt;
    
    </summary>
    
    
      <category term="é¢˜è§£" scheme="https://depletedprism.github.io/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="Number Theory" scheme="https://depletedprism.github.io/tags/Number-Theory/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŒUVa-10572ã€Black &amp; White é¢˜è§£</title>
    <link href="https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/oj/UVA-10572/"/>
    <id>https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/oj/UVA-10572/</id>
    <published>2020-02-24T12:27:59.000Z</published>
    <updated>2020-03-13T05:41:27.411Z</updated>
    
    <content type="html"><![CDATA[<hr><blockquote><p>æœ€åä¸€æ­¥åˆ¤æ–­æœ€ä¸ºå…³é”®, ä¹Ÿæœ€å®¹æ˜“æƒ³é”™â€¦ è¯·è¯»è€…æ€è€ƒå¦‚ä½•åŒºåˆ†è¿™ä¸¤ç§æƒ…å†µ.</p></blockquote><ul><li>é¢˜ç›®é“¾æ¥: <a href="https://vjudge.net/problem/UVA-10572" target="_blank" rel="noopener">https://vjudge.net/problem/UVA-10572</a></li></ul><p><em>ç”±äºæŸäº›åŸå› , é“¾æ¥æŒ‡å‘çš„å…¶å®æ˜¯ vjudge</em></p><p><del>æ¯’ç˜¤å•Š!</del></p><p>å…¶å®æ˜¯å¸¸è§„çš„æ’å¤´ DP ç»´æŠ¤æ£‹ç›˜æ ¼è¿é€šæ€§çš„é—®é¢˜, ç¬¬ä¸€æ¬¡è§æ„Ÿè§‰å¾ˆæ–°é²œ, ç„¶åâ€¦ å°±è‡ªé—­äº†. = =</p><a id="more"></a><h4 id="é¢˜ç›®å¤§æ„"><a href="#é¢˜ç›®å¤§æ„" class="headerlink" title="é¢˜ç›®å¤§æ„"></a>é¢˜ç›®å¤§æ„</h4><p>ç»™å®šä¸€ä¸ªéƒ¨åˆ†é»‘ç™½æŸ“è‰²çš„ $n \times m$ æ£‹ç›˜, ç°åœ¨ç»™å‡ºä¸¤ç§é™åˆ¶</p><ol><li>ä»»æ„ $2 \times 2$ çš„ç½‘æ ¼ä¸ä¼šå…¨é»‘æˆ–è€…å…¨ç™½.</li><li><strong>æ‰€æœ‰é»‘æ ¼å››è¿é€š, æ‰€æœ‰ç™½æ ¼å››è¿é€š</strong>.</li></ol><p>ç°åœ¨è¦æŠŠæ‰€æœ‰çš„æ£‹ç›˜æŸ“è‰², æ±‚æ»¡è¶³ä»¥ä¸Šé™åˆ¶çš„æ–¹æ¡ˆæ•°.</p><h4 id="é¢˜ç›®æ€è·¯"><a href="#é¢˜ç›®æ€è·¯" class="headerlink" title="é¢˜ç›®æ€è·¯"></a>é¢˜ç›®æ€è·¯</h4><p>å®¹æ˜“å‘ç°è¿™æ˜¯ä¸€é“æ’å¤´ DP / è½®å»“çº¿ DP, æˆ‘ä»¬ä¾æ¬¡è€ƒè™‘ä¸¤ç§é™åˆ¶.</p><p>å¯¹äºé¢˜ç›®ç»™å®šçš„é¢œè‰², å®¹æ˜“å‘ç°è¿™ä¸ªé™åˆ¶å¾ˆå¥½å¤„ç†, åªä¸è¿‡æ˜¯åœ¨å·²æŸ“è‰²ä½ç½®æŒ‰ç…§ç»™å®šé¢œè‰²è½¬ç§».</p><p>å¯¹äºç¬¬ä¸€ç§é™åˆ¶, å®¹æ˜“å‘ç°åªç”¨è®°å½• â€œå½“å‰è½¬ç§»ä½ç½®â€ çš„å·¦ä¸Šæ£‹ç›˜çš„é¢œè‰²å³å¯. è¿™æ ·è½¬ç§»çš„æ—¶å€™, æŠ›å¼ƒæ‰å¼•èµ·å†²çªçš„é¢œè‰²å°±å¥½äº†.</p><p>å¯¹äºç¬¬äºŒç§é™åˆ¶, åˆ™éœ€è¦è€ƒè™‘æ¯ä¸ªç‚¹çš„è¿é€šæƒ…å†µ. è€ƒè™‘åœ¨è½®å»“çº¿æ­¥æ­¥æ¨è¿›çš„è¿‡ç¨‹ä¸­, åˆšå¼€å§‹ä¸è¿é€šçš„åŒºåŸŸå¯èƒ½åœ¨æŸå¤„å¾—åˆ°è¿é€š, æ‰€ä»¥åœ¨è½¬ç§»å½“å‰çŠ¶æ€æ—¶, æ˜¾ç„¶ä¸èƒ½åœ¨è¦æ±‚å½“å‰è½®å»“çº¿ä¸€ç›´ä¿æŒä¸¤ç§é¢œè‰²å››è¿é€šçš„çŠ¶æ€.</p><p><del>ä¸€å¼€å§‹æ²¡çœ‹åˆ°ç¬¬äºŒç§é™åˆ¶, æ•´ä¸ªäººå‚»æ‰äº†</del></p><p>é‚£æ€ä¹ˆåŠå‘¢? è€ƒè™‘åŠ ä¸€äº›çŠ¶æ€, è®°å½•å½“å‰è½®å»“çº¿ä¸Šæ¯ä¸ªä½ç½®æ‰€å±çš„è¿é€šåˆ†é‡ç¼–å·. æš‚ä¸”ä¸è€ƒè™‘å¦‚ä½•è®°å½•è¿™ä¸ªç¼–å·, å…ˆæ¥è€ƒè™‘è®°å½•ä¹‹åå¦‚ä½•è½¬ç§», ä»¥åŠæ­£ç¡®æ€§.</p><p>æ²¿ç”¨æ™®é€šçš„æ’å¤´ DP æ€è·¯, å¯¹äºå½“å‰çŠ¶æ€, æšä¸¾å½“å‰ä½ç½®è¦æ”¾ç½®çš„é¢œè‰², æ’é™¤æ‰å·²æœ‰é¢œè‰², ä»¥åŠ $2 \times 2$ æ–¹æ ¼çš„é™åˆ¶. æ–°åŠ å…¥æ£‹ç›˜æ ¼çš„è¿é€šåˆ†é‡ç¼–å·å‘¢? æœ‰ä¸¤ç§æƒ…å†µ:</p><ol><li><p>å½“å‰æ£‹ç›˜æ ¼é¢œè‰²å’Œå·¦ä¾§ / ä¸Šæ–¹æ£‹ç›˜æ ¼é¢œè‰²ç›¸åŒ</p><p>æ­¤ç§æƒ…å†µå¯ä»¥é€šè¿‡å¯¹è¿é€šåˆ†é‡ç¼–å·è¿›è¡Œç®€å•åˆå¹¶è§£å†³.</p></li><li><p>å½“å‰æ£‹ç›˜æ ¼é¢œè‰²å’Œ<strong>ä¸Šæ–¹</strong>æ£‹ç›˜æ ¼é¢œè‰²<strong>ä¸åŒ</strong></p><p>é‡ç‚¹è€ƒè™‘è¿™ä¸ªæƒ…å†µ. ä¸ºä»€ä¹ˆè¦é‡ç‚¹åˆ†æ? å› ä¸ºå½“å‰æ£‹ç›˜æ ¼ä½ç½®ä¸Šæ–¹çš„æ£‹ç›˜æ ¼å³å°†ç¦»å¼€è½®å»“çº¿, ä»¥åå°±è€ƒè™‘ä¸åˆ°äº†, ä½†æ˜¯é¢˜ç›®è¦æ±‚é¢œè‰²å„è‡ªæ˜¯å››è¿é€šçš„. å¦‚æœç›´æ¥æŠŠå¥¹æŠ›å¼ƒ, é‚£ä¹ˆå°±â€¦ äººæ²¡äº†. = =</p><p>ç»è¿‡æ€è€ƒå¯ä»¥å¾—å‡º, åœ¨è½®å»“çº¿ä¸Šè¿˜å­˜åœ¨ä¸Šæ–¹æ£‹ç›˜æ ¼æ‰€å¯¹åº”çš„è¿é€šåˆ†é‡å°±ä¸éœ€è¦é¢å¤–è€ƒè™‘è¿™ä¸€ç‚¹äº†, å³, å¯ä»¥ç›´æ¥æŠŠè¿™ä¸ªçŠ¶æ€æ‰”æ‰.</p><p>æ­¤æ—¶æˆ‘ä»¬åœ¨çŠ¶æ€ä¸­è®°å½•é»‘ç™½ä¸¤è‰²è¿é€šåˆ†é‡ä¸ªæ•°, å¹¶å¼•å…¥ â€œé’¦å®šé€‰æ‹©é¢œè‰²â€. è¿™æ ·, è½¬ç§»å¦‚ä¸‹:</p><ul><li><p>å¦‚æœä¸Šæ–¹æ£‹ç›˜æ ¼é¢œè‰²æ‰€å±çš„è¿é€šåˆ†é‡ä¸ªæ•° $&gt; 1$, è¯´æ˜ä»¥åæ²¡æœ‰æœºä¼šå†æŠŠè¿™äº›è¿é€šåˆ†é‡è¿æ¥èµ·æ¥äº†, æ”¾å¼ƒå§</p></li><li><p>å¦‚æœä¸Šæ–¹æ£‹ç›˜æ ¼é¢œè‰²æ‰€å±çš„è¿é€šåˆ†é‡æ»¡è¶³é¢˜ç›®é™åˆ¶, é‚£ä¹ˆæŠŠå‰©ä¸‹çš„æ‰€æœ‰æ ¼å­æ¶‚æ»¡, æ¶‚æˆå½“å‰æ£‹ç›˜æ ¼é¢œè‰²å°±å¥½äº†.</p><p>æ³¨æ„åˆ°è¿™æ ·åšçš„æ¡ä»¶ä¸º, å‰©ä¸‹æœªå¡«æ»¡çš„è¡Œæ•°å°äº $2$, å¦åˆ™ç›´æ¥å¡«æ»¡æ— æ³•æ»¡è¶³é™åˆ¶ 1.</p></li></ul></li></ol><p>ç°åœ¨å†æ¥è€ƒè™‘å¦‚ä½•è®°å½•è¿é€šåˆ†é‡çš„ç¼–å·. å¸¸ç”¨çš„æ–¹æ³•æœ‰: æœ€å°è¡¨ç¤ºæ³•, ä»¥åŠå¹¿ä¹‰æ‹¬å·æ³•. è¿™é‡Œåªè€ƒè™‘æœ€å°è¡¨ç¤ºæ³•, è™½ç„¶å¦ä¸€ç§æ–¹æ³•æ›´å¿«ä¸€ç‚¹â€¦</p><p>æ‰€è°“ â€œæœ€å°è¡¨ç¤ºæ³•â€, å°±æ˜¯ç”¨å­—å…¸åºæœ€å°çš„æ–¹æ³•æŠŠæ‰€æœ‰è¿é€šåˆ†é‡é‡æ ‡å·, ç„¶åæ²¡äº†. æ³¨æ„æ¯æ¬¡éƒ½è¦æŠŠçŠ¶æ€è¿™æ ·æ•´ç†ä¸€ä¸‹.</p><h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p>å‚è€ƒäº†åˆ˜æ±ä½³å…ˆç”Ÿçš„å®ç°â€¦</p><p>æ¯•ç«Ÿå¾ˆå°‘æœ‰é‚£æ ·æ¸…æ™°çš„ä»£ç å’Œå®Œæ•´çš„æ³¨é‡Šäº†. = =</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UVA-10572</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">8</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> ch[] = &#123; <span class="string">'o'</span>, <span class="string">'#'</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, exist;</span><br><span class="line"><span class="built_in">map</span>&lt;<span class="keyword">unsigned</span>, <span class="keyword">int</span>&gt; f[MAXN][MAXN][<span class="number">2</span>];</span><br><span class="line"><span class="keyword">char</span> G[MAXN][MAXN+<span class="number">1</span>], Ans[MAXN][MAXN], Now[MAXN][MAXN];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">State</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> c[MAXN], g[MAXN], cnt[<span class="number">2</span>], UL, tot;</span><br><span class="line"></span><br><span class="line">    State() &#123; <span class="built_in">memset</span>(<span class="keyword">this</span>, <span class="number">0</span>, <span class="keyword">sizeof</span> *<span class="keyword">this</span>); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æœ€å°è¡¨ç¤ºæ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Normalize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> rep[MAXN + <span class="number">1</span>];</span><br><span class="line">        <span class="built_in">memset</span>(rep, <span class="number">-1</span>, <span class="keyword">sizeof</span> rep);</span><br><span class="line">        tot = cnt[<span class="number">0</span>] = cnt[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (rep[g[i]] &lt; <span class="number">0</span>) rep[g[i]] = tot++, ++cnt[c[i]];</span><br><span class="line">            g[i] = rep[g[i]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå¹¶: æŠŠ from å¯¹åº”çš„è¿é€šåˆ†é‡ç¼–å·æ”¹ä¸º to</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span> to, <span class="keyword">int</span> from)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (from == to) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; ++i) <span class="keyword">if</span> (g[i] == from) g[i] = to;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¼–ç : æœ€å¤§å€¼ + 1 = 16 ^ m = 2 ^ (4 * 8) = 2 ^ 32, æ­£å¥½ unsigned int</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">unsigned</span> <span class="title">encode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">unsigned</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; ++i) ret = ret * <span class="number">16</span> + c[i] * <span class="number">8</span> + g[i];</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> row, <span class="keyword">int</span> col, State&amp; S, <span class="keyword">int</span> limit)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (col == m) ++row, col = <span class="number">0</span>;</span><br><span class="line">    S.Normalize();</span><br><span class="line">    <span class="keyword">if</span> (row == n) &#123;</span><br><span class="line">        <span class="keyword">if</span> (S.cnt[<span class="number">0</span>] &gt; <span class="number">1</span> || S.cnt[<span class="number">1</span>] &gt; <span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// è®°å½•æ–¹æ¡ˆ</span></span><br><span class="line">        <span class="keyword">if</span> (!exist) &#123;</span><br><span class="line">            exist = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; ++j) Ans[i][j] = Now[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¸€ä¸ªå‰ªæ: å¦‚æœå·¦è¾¹é¢œè‰²å’Œä¸Šæ–¹é¢œè‰²ä¸åŒ, é‚£ä¹ˆå·¦ä¸Šè§’çš„é¢œè‰²å°±ä¸é‡è¦äº†</span></span><br><span class="line">    <span class="keyword">if</span> (row &gt; <span class="number">0</span> &amp;&amp; col &gt; <span class="number">0</span> &amp;&amp; S.c[col] != S.c[col<span class="number">-1</span>]) S.UL = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> key;</span><br><span class="line">    <span class="comment">// åªåœ¨ä¸é’¦å®šé¢œè‰²çš„æƒ…å†µä¸‹è®°å¿†åŒ–</span></span><br><span class="line">    <span class="keyword">if</span> (limit &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        key = S.encode();</span><br><span class="line">        <span class="keyword">if</span> (f[row][col][S.UL].count(key) &gt; <span class="number">0</span>) <span class="keyword">return</span> f[row][col][S.UL][key];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> t = <span class="number">0</span>; t &lt; <span class="number">2</span>; ++t) &#123;</span><br><span class="line">        <span class="comment">// é’¦å®šé¢œè‰² / é™åˆ¶ 0</span></span><br><span class="line">        <span class="keyword">if</span> (limit == (t ^ <span class="number">1</span>) || G[row][col] == ch[t ^ <span class="number">1</span>]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="comment">// é™åˆ¶ 1</span></span><br><span class="line">        <span class="keyword">if</span> (row &gt; <span class="number">0</span> &amp;&amp; col &gt; <span class="number">0</span> &amp;&amp; S.UL == t &amp;&amp; S.c[col] == t &amp;&amp; S.c[col<span class="number">-1</span>] == t) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="comment">// æ–°çš„çŠ¶æ€ !</span></span><br><span class="line">        State T = S;</span><br><span class="line">        T.c[col] = t, T.UL = S.c[col];</span><br><span class="line">        <span class="comment">// é€šè¿‡è€ƒè™‘å·¦ä¾§å’Œä¸Šæ–¹çŠ¶æ€, æ¥åˆå¹¶ä¸€äº›è¿é€šåˆ†é‡</span></span><br><span class="line">        T.g[col] = (row &gt; <span class="number">0</span> &amp;&amp; S.c[col] == t)? S.g[col]: S.tot;</span><br><span class="line">        <span class="keyword">if</span> (col &gt; <span class="number">0</span> &amp;&amp; T.c[col<span class="number">-1</span>] == t) T.merge(T.g[col<span class="number">-1</span>], T.g[col]);</span><br><span class="line">        Now[row][col] = ch[t];</span><br><span class="line">        <span class="keyword">if</span> (row &gt; <span class="number">0</span> &amp;&amp; S.c[col] == (t ^ <span class="number">1</span>)) &#123;</span><br><span class="line">            <span class="keyword">bool</span> none = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m &amp;&amp; none; ++i)</span><br><span class="line">                <span class="keyword">if</span> (T.g[i] == S.g[col]) none = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (none) &#123;</span><br><span class="line">                <span class="comment">// æ³¨æ„è·³è½¬é€»è¾‘: è¿™äº›æ¡ä»¶æ»¡è¶³ / ä¸æ»¡è¶³, ç›´æ¥å‘ä¸‹ä¸€é¢œè‰²è¿›è¡Œ</span></span><br><span class="line">                <span class="keyword">if</span> (S.cnt[t ^ <span class="number">1</span>] &gt; <span class="number">1</span> || n - row &gt; <span class="number">2</span>) <span class="keyword">continue</span>;</span><br><span class="line">                ret += dfs(row, col + <span class="number">1</span>, T, t);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ret += dfs(row, col + <span class="number">1</span>, T, limit);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (limit &lt; <span class="number">0</span>) f[row][col][S.UL][key] = ret;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> Ti;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;Ti);</span><br><span class="line">    <span class="keyword">while</span> (Ti--) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">        <span class="comment">// init</span></span><br><span class="line">        exist = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; ++j)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">2</span>; ++k) f[i][j][k].clear();</span><br><span class="line">        <span class="comment">// input</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) <span class="built_in">scanf</span>(<span class="string">"%s"</span>, G[i]);</span><br><span class="line">        <span class="comment">// dp</span></span><br><span class="line">        State none; none.Normalize();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, dfs(<span class="number">0</span>, <span class="number">0</span>, none, <span class="number">-1</span>));</span><br><span class="line">        <span class="comment">// output</span></span><br><span class="line">        <span class="keyword">if</span> (exist) <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i, <span class="built_in">putchar</span>(<span class="string">'\n'</span>))</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; ++j) <span class="built_in">putchar</span>(Ans[i][j]);</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">'\n'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h4><p>åœ¨ é™ˆä¸¹ç¦ &lt;åŸºäºè¿é€šæ€§çŠ¶æ€å‹ç¼©çš„åŠ¨æ€è§„åˆ’é—®é¢˜&gt; å¯¹è¿™ä¸€ç±»é—®é¢˜æœ‰ç›¸å½“è¯¦å°½çš„è®²è§£, å¤´ç–¼çœ‹ä¸æ‡‚, ä»¥åå†è¯´äº† <del>å’•å’•å’•</del></p><hr>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;æœ€åä¸€æ­¥åˆ¤æ–­æœ€ä¸ºå…³é”®, ä¹Ÿæœ€å®¹æ˜“æƒ³é”™â€¦ è¯·è¯»è€…æ€è€ƒå¦‚ä½•åŒºåˆ†è¿™ä¸¤ç§æƒ…å†µ.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;é¢˜ç›®é“¾æ¥: &lt;a href=&quot;https://vjudge.net/problem/UVA-10572&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://vjudge.net/problem/UVA-10572&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;em&gt;ç”±äºæŸäº›åŸå› , é“¾æ¥æŒ‡å‘çš„å…¶å®æ˜¯ vjudge&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;del&gt;æ¯’ç˜¤å•Š!&lt;/del&gt;&lt;/p&gt;
&lt;p&gt;å…¶å®æ˜¯å¸¸è§„çš„æ’å¤´ DP ç»´æŠ¤æ£‹ç›˜æ ¼è¿é€šæ€§çš„é—®é¢˜, ç¬¬ä¸€æ¬¡è§æ„Ÿè§‰å¾ˆæ–°é²œ, ç„¶åâ€¦ å°±è‡ªé—­äº†. = =&lt;/p&gt;
    
    </summary>
    
    
      <category term="é¢˜è§£" scheme="https://depletedprism.github.io/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="Dynamic Programing" scheme="https://depletedprism.github.io/tags/Dynamic-Programing/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŒJSOI2018ã€æˆ˜äº‰ é¢˜è§£</title>
    <link href="https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/oj/luogu-P4557/"/>
    <id>https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/oj/luogu-P4557/</id>
    <published>2020-02-20T04:51:21.000Z</published>
    <updated>2020-02-20T06:00:09.784Z</updated>
    
    <content type="html"><![CDATA[<hr><ul><li>é¢˜ç›®é“¾æ¥: <a href="https://www.luogu.com.cn/problem/P4557" target="_blank" rel="noopener">https://www.luogu.com.cn/problem/P4557</a></li></ul><p>è¿™æ˜¯ä¸€é“ <del>ä¹æ¡å¯æ€œ</del> è®¡ç®—å‡ ä½•é¢˜, åœ¨æ€è·¯ä¸Šä¸ç®—å›°éš¾ä½†æ˜¯æœ‰ä¸€äº›ç»†èŠ‚å€¼å¾—ç•™å¿µ.</p><a id="more"></a><h4 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h4><ol><li>äºŒç»´å‡¸åŒ…</li><li>é—µå¯å¤«æ–¯åŸºå’Œ</li></ol><h4 id="é¢˜ç›®å¤§æ„"><a href="#é¢˜ç›®å¤§æ„" class="headerlink" title="é¢˜ç›®å¤§æ„"></a>é¢˜ç›®å¤§æ„</h4><p>ç»™å®šä¸¤ä¸ªå¤§å°åˆ†åˆ«ä¸º $n,\ m$ çš„ç‚¹é›†, $q$ æ¬¡è¯¢é—®, æ¯æ¬¡ç»™å‡ºä¸€ä¸ªåç§»å‘é‡ $\vec{v}$, é—®å°†ç¬¬äºŒä¸ªç‚¹é›†çš„æ‰€æœ‰ç‚¹æŒ‰è¿™ä¸ªå‘é‡åç§»å, æ˜¯å¦å­˜åœ¨ä¸€ä¸ªç‚¹, åœ¨å¦ä¸€ç‚¹é›†çš„å‡¸åŒ…å†….</p><p>å…¶ä¸­ $3 \le n, m \le 10^5,\ q \le 10^5$</p><h4 id="é¢˜ç›®æ€è·¯"><a href="#é¢˜ç›®æ€è·¯" class="headerlink" title="é¢˜ç›®æ€è·¯"></a>é¢˜ç›®æ€è·¯</h4><p>è€ƒè™‘æœ€ç®€å•çš„æ€è·¯, æ¯æ¬¡ç›´æ¥å°†ç¬¬äºŒä¸ªç‚¹é›†æš´åŠ›å¹³ç§», æ±‚å‡¸åŒ…, åˆ¤æ–­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªç‚¹åœ¨å¦ä¸€ä¸ªå‡¸åŒ…å†….</p><p>æ—¶é—´å¤æ‚åº¦ $O(n \log n + q (m \log m + n m)\,)$, æœŸæœ›å¾—åˆ† 40 pts.</p><p>å¦‚æœå†åŠ ä¸€äº›æŠ€å·§, å¤§æ¦‚æ˜¯ $O(n \log n + m\log m + q(n\log m + m\log n))\,)$, æœŸæœ›å¾—åˆ† 40 pts, å¹¶æ²¡æœ‰æœ¬è´¨åŒºåˆ«â€¦</p><p>æ¢ä¸€ç§æ€è·¯, è€ƒè™‘é€ æˆå†²çªçš„å‘é‡èŒƒå›´, å®¹æ˜“å¾—åˆ°è¿™æ ·çš„å¼å­</p><p>$$\exists \ \vec{v},\ \text{s.t.}\ b + \vec{v} = a\ (a \in A, b \in B)$$</p><p>é‚£ä¹ˆå°±å¯ä»¥å¾—åˆ° $\vec{v}$ çš„èŒƒå›´</p><p>$$\vec{v} = a - b\ (a \in A, b \in B)$$</p><p>æŠŠ $B$ ä¸­ç‚¹çš„æ¨ªçºµåæ ‡å–å, å°±å¾—åˆ°äº†é—µå¯å¤«æ–¯åŸºå’Œçš„å½¢å¼.</p><p>è€ƒè™‘åˆ°ä¸¤ä¸ªå‡¸åŒ…çš„é—µå¯å¤«æ–¯åŸºå’Œä¸­çš„è¾¹éƒ½ç”±ä¸¤ä¸ªå‡¸åŒ…ä¸­çš„è¾¹æ„æˆ, è€Œå‡¸åŒ…ä¸Šçš„è¾¹å…·æœ‰å•è°ƒæ€§, ç›´æ¥ä»¥ç±»ä¼¼äºåˆå¹¶ä¸¤ä¸ªæœ‰åºè¡¨çš„æ–¹å¼è¿›è¡Œåˆå¹¶å°±å¥½äº†, è¿™æ ·åˆå¹¶å‡ºæ¥çš„é—µå¯å¤«æ–¯åŸºå’Œä¹Ÿæ˜¯ä¸ªå‡¸åŒ….</p><p>å¦‚ä½•ç»Ÿè®¡ç­”æ¡ˆå‘¢? ç›´æ¥åˆ¤æ–­åç§»å‘é‡æ˜¯å¦åœ¨é—µå¯å¤«æ–¯åŸºå’Œä¸­çš„æ—¶é—´å¤æ‚åº¦æ˜¯ $O(n)$ çš„, å¯ä»¥æ‹¿åˆ° 70 pts çš„å¥½æˆç»©.<br>è€ƒè™‘æŠŠä¸€ä¸ªå‡¸åŒ…è½¬åŒ–ä¸ºä¸€ç‚¹åˆ°å…¶ä»–ç‚¹çš„å‘é‡çš„å½¢å¼, è¿™æ ·åˆ¤æ–­ä¸€ä¸ªå‘é‡æ˜¯å¦åœ¨å‡¸åŒ…å†…å¯ä»¥æ ¹æ®å‡¸åŒ…çš„å•è°ƒæ€§, é€šè¿‡äºŒåˆ†æŸ¥æ‰¾è§£å†³.</p><h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p>å¦‚æœç»†èŠ‚æ˜ç¡®äº†, å…¶å®ä»£ç ä¸éš¾å†™â€¦</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Luogu P4557</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span>+<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Geo &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Vector</span> &#123;</span></span><br><span class="line">        LL x, y;</span><br><span class="line">        Vector(LL _x = <span class="number">0</span>, LL _y = <span class="number">0</span>): x(_x), y(_y) &#123; &#125;</span><br><span class="line"></span><br><span class="line">        Vector <span class="keyword">operator</span> + (<span class="keyword">const</span> Vector&amp; rhs) <span class="keyword">const</span> &#123; <span class="keyword">return</span> Vector(x + rhs.x, y + rhs.y); &#125;</span><br><span class="line">        Vector <span class="keyword">operator</span> - (<span class="keyword">const</span> Vector&amp; rhs) <span class="keyword">const</span> &#123; <span class="keyword">return</span> Vector(x - rhs.x, y - rhs.y); &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">typedef</span> Vector Point;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Point&amp; A, <span class="keyword">const</span> Point&amp; B) &#123;</span><br><span class="line">        <span class="keyword">return</span> A.x &lt; B.x || (A.x == B.x &amp;&amp; A.y &lt; B.y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>== (<span class="keyword">const</span> Point&amp; A, <span class="keyword">const</span> Point&amp; B) &#123; <span class="keyword">return</span> !(A &lt; B) &amp;&amp; !(B &lt; A); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> LL <span class="title">Dot</span><span class="params">(<span class="keyword">const</span> Vector&amp; A, <span class="keyword">const</span> Vector&amp; B)</span> </span>&#123; <span class="keyword">return</span> A.x * B.x + A.y * B.y; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> LL <span class="title">Cross</span><span class="params">(<span class="keyword">const</span> Vector&amp; A, <span class="keyword">const</span> Vector&amp; B)</span> </span>&#123; <span class="keyword">return</span> A.x * B.y - A.y * B.x; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">ConvexHull</span><span class="params">(Point* P, <span class="keyword">int</span> n, Point* ch)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> m = <span class="number">0</span>;</span><br><span class="line">        sort(P, P+n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            <span class="keyword">while</span> (m &gt; <span class="number">1</span> &amp;&amp; Cross(ch[m<span class="number">-1</span>] - ch[m<span class="number">-2</span>], P[i] - ch[m<span class="number">-2</span>]) &lt;= <span class="number">0</span>) --m;</span><br><span class="line">            ch[m++] = P[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> k = m;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n<span class="number">-2</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">            <span class="keyword">while</span> (m &gt; k &amp;&amp; Cross(ch[m<span class="number">-1</span>] - ch[m<span class="number">-2</span>], P[i] - ch[m<span class="number">-2</span>]) &lt;= <span class="number">0</span>) --m;</span><br><span class="line">            ch[m++] = P[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> m - (n &gt; <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Geo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, pidx, K;</span><br><span class="line">Point poly[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line">Vector v1[MAXN], v2[MAXN];</span><br><span class="line">Point P1[MAXN], P2[MAXN], ch1[MAXN], ch2[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šä¿—åœ°è¯´, å‡¸åŒ…ä¸Šçš„è¾¹, åœ¨å³ä¾§çš„è¾¹æ€»æ˜¯åœ¨å·¦ä¾§çš„è¾¹çš„ "å·¦ä¾§"</span></span><br><span class="line"><span class="comment">// è¿˜è¦è€ƒè™‘å‘é‡çš„æ¨¡é•¿, å¯èƒ½å¤ªé•¿å°±å†²å‡ºå»äº†...</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(<span class="keyword">const</span> Point&amp; A, <span class="keyword">const</span> Point&amp; B)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Cross(A, B) &gt; <span class="number">0</span> || (Cross(A, B) == <span class="number">0</span> &amp;&amp; Dot(A, A) &lt; Dot(B, B));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">inPoly</span><span class="params">(<span class="keyword">const</span> Vector&amp; v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (Cross(v, poly[<span class="number">0</span>]) &gt; <span class="number">0</span> || Cross(v, poly[pidx<span class="number">-1</span>]) &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> pos = lower_bound(poly, poly+pidx, v, cmp) - poly - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> Cross(v - poly[pos], poly[(pos+<span class="number">1</span>)%pidx] - poly[pos]) &lt;= <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    <span class="comment">// freopen("input.in", "r", stdin);</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n), read(m), read(K);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> x, y, i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">        read(x), read(y), P1[i] = Point(x, y);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> x, y, i = <span class="number">0</span>; i &lt; m; ++i)</span><br><span class="line">        read(x), read(y), P2[i] = Point(-x, -y);</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    n = ConvexHull(P1, n, ch1);</span><br><span class="line">    m = ConvexHull(P2, m, ch2);</span><br><span class="line">    <span class="comment">// å°†å‡¸åŒ…çš„ç‚¹é›†è½¬åŒ–ä¸ºè¾¹é›†, ä»¥å‘é‡çš„å½¢å¼ä½“ç°</span></span><br><span class="line">    ch1[n] = ch1[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) v1[i] = ch1[i+<span class="number">1</span>] - ch1[i];</span><br><span class="line">    ch2[m] = ch2[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; ++i) v2[i] = ch2[i+<span class="number">1</span>] - ch2[i];</span><br><span class="line">    <span class="comment">// Minkowski Sum</span></span><br><span class="line">    <span class="comment">// åˆå¹¶ä¸¤ä¸ªå‡¸åŒ…, ç”±äºå‡¸åŒ…å•è°ƒæ€§, ç±»ä¼¼äºåˆå¹¶ä¸¤ä¸ªæœ‰åºè¡¨</span></span><br><span class="line">    poly[pidx++] = ch1[<span class="number">0</span>] + ch2[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">int</span> p = <span class="number">0</span>, q = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (p &lt; n &amp;&amp; q &lt; m) &#123;</span><br><span class="line">        <span class="keyword">if</span> (Cross(v1[p], v2[q]) &gt;= <span class="number">0</span>)</span><br><span class="line">            poly[pidx] = poly[pidx<span class="number">-1</span>] + v1[p++], ++pidx;</span><br><span class="line">        <span class="keyword">else</span> poly[pidx] = poly[pidx<span class="number">-1</span>] + v2[q++], ++pidx;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (p &lt; n) poly[pidx] = poly[pidx<span class="number">-1</span>] + v1[p++], ++pidx;</span><br><span class="line">    <span class="keyword">while</span> (q &lt; m) poly[pidx] = poly[pidx<span class="number">-1</span>] + v2[q++], ++pidx;</span><br><span class="line">    <span class="keyword">while</span> (pidx &gt; <span class="number">1</span> &amp;&amp;</span><br><span class="line">        Cross(poly[pidx<span class="number">-1</span>] - poly[pidx<span class="number">-2</span>], poly[<span class="number">0</span>] - poly[pidx<span class="number">-2</span>]) &lt;= <span class="number">0</span>) --pidx;</span><br><span class="line">    <span class="comment">// å°†é—µå¯å¤«æ–¯åŸºå’Œçš„ç‚¹é›†è½¬åŒ–ä¸ºç”±ä¸€ç‚¹æŒ‡å‘å…¶ä»–ç‚¹çš„å‘é‡</span></span><br><span class="line">    Point o = poly[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pidx; ++i) poly[i] = poly[i] - o;</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">while</span> (K--) &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> x, y;</span><br><span class="line">        read(x), read(y), <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, inPoly(Vector(x, y) - o));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;é¢˜ç›®é“¾æ¥: &lt;a href=&quot;https://www.luogu.com.cn/problem/P4557&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.luogu.com.cn/problem/P4557&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™æ˜¯ä¸€é“ &lt;del&gt;ä¹æ¡å¯æ€œ&lt;/del&gt; è®¡ç®—å‡ ä½•é¢˜, åœ¨æ€è·¯ä¸Šä¸ç®—å›°éš¾ä½†æ˜¯æœ‰ä¸€äº›ç»†èŠ‚å€¼å¾—ç•™å¿µ.&lt;/p&gt;
    
    </summary>
    
    
      <category term="é¢˜è§£" scheme="https://depletedprism.github.io/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="Geometry" scheme="https://depletedprism.github.io/tags/Geometry/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€äº›ç®€å•çš„ååºç»´æŠ¤é—®é¢˜</title>
    <link href="https://depletedprism.github.io/%E7%AC%94%E8%AE%B0/simple-partial-order/"/>
    <id>https://depletedprism.github.io/%E7%AC%94%E8%AE%B0/simple-partial-order/</id>
    <published>2020-02-14T15:15:28.000Z</published>
    <updated>2020-02-27T14:58:56.925Z</updated>
    
    <content type="html"><![CDATA[<hr><h2 id="ç»¼è¿°"><a href="#ç»¼è¿°" class="headerlink" title="ç»¼è¿°"></a>ç»¼è¿°</h2><p>æ‹œè¯»äº†æ¯’ç˜¤çš„æ•°æ®ç»“æ„è¯¾ä»¶, æ·±å—å¯å‘, <del>ç”šæ˜¯è°”è°”, å½“å³æ„Ÿè§‰è‡ªå·±ä¹‹å‰ä¸€ç›´åœ¨ç©æ³¥å·´</del>.</p><p>åˆå­¦æ•°æ®ç»“æ„, æ³è¯·æŒ‡æ­£.</p><a id="more"></a><h3 id="ä»€ä¹ˆæ˜¯ååº"><a href="#ä»€ä¹ˆæ˜¯ååº" class="headerlink" title="ä»€ä¹ˆæ˜¯ååº"></a>ä»€ä¹ˆæ˜¯ååº</h3><p><em>å…¶å®è¿™ä¸€ç‚¹ä¹Ÿä¸é‡è¦</em></p><p>å¯¹äºä¸€ä¸ªéç©ºé›†ä¸Šçš„äºŒå…ƒå…³ç³», å¦‚æœå…¶æ»¡è¶³<strong>è‡ªåæ€§</strong>, <strong>åå¯¹ç§°æ€§</strong>, <strong>ä¼ é€’æ€§</strong>, é‚£ä¹ˆç§°è¿™ä¸ªäºŒå…ƒå…³ç³»å°±æ˜¯è¿™ä¸ªé›†åˆä¸Šçš„ååº.</p><p>ä¸€ä¸ªç®€å•çš„ä¾‹å­: å®æ•°é›†ä¸Šçš„å°äºç­‰äºå…³ç³»æ˜¯ä¸€ä¸ªååºå…³ç³».</p><h3 id="ååºç»´æŠ¤"><a href="#ååºç»´æŠ¤" class="headerlink" title="ååºç»´æŠ¤"></a>ååºç»´æŠ¤</h3><p>ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªå…·æœ‰å¾ˆå¤šå±æ€§çš„å…ƒç´ , æ¯”å¦‚æœ‰ $a_i, b_i, c_i, \ldots$</p><p>æ¥ä¸‹æ¥å¯¹æ¯ä¸ªå±æ€§ç»™å‡ºä¸€äº›é™åˆ¶, å¯¹æ»¡è¶³è¿™äº›é™åˆ¶çš„å…ƒç´ è¿›è¡Œä¸€äº›æ“ä½œ, åƒ $L_1 \leq a_i \leq R_1, L_2 \leq b_i \leq R_2, L_3 \leq c_i \leq R_3, \ldots$</p><p>è¿™å°±æ˜¯åœ¨ç»´æŠ¤ååºäº†, æœ‰æ—¶å€™ä¹ŸæŠŠ â€œå±æ€§â€ ç§°ä½œ â€œç»´åº¦â€.</p><h2 id="ä¸€äº›ç»´æŠ¤æ–¹æ³•-amp-ä¾‹é¢˜"><a href="#ä¸€äº›ç»´æŠ¤æ–¹æ³•-amp-ä¾‹é¢˜" class="headerlink" title="ä¸€äº›ç»´æŠ¤æ–¹æ³• &amp; ä¾‹é¢˜"></a>ä¸€äº›ç»´æŠ¤æ–¹æ³• &amp; ä¾‹é¢˜</h2><blockquote><p>åæ­£æˆ‘ä¹‹å‰æ˜¯å…ˆæ¨å‡ºä¸€ä¸ª poly log çš„æ•°æ®ç»“æ„åšæ³•</p><p>ç„¶åæƒ³åŠæ³•å» logï¼Œåˆ°ä¸€ä¸ªå¯ä»¥æ¥å—çš„å¤æ‚åº¦</p><p>from lxl æŸæ¬¡æ´›è°·ç½‘è¯¾</p></blockquote><p>å…ˆæ˜¯ä¸¤ä¸ªç¦»çº¿æ–¹æ³•.</p><h3 id="CDQ-åˆ†æ²»"><a href="#CDQ-åˆ†æ²»" class="headerlink" title="CDQ åˆ†æ²»"></a>CDQ åˆ†æ²»</h3><p>å¼ºçƒˆæ¨è <a href="https://www.cnblogs.com/mlystdcall/p/6219421.html" target="_blank" rel="noopener">__stdcall çš„ CDQ åˆ†æ²»æ•™ç¨‹</a>.</p><p>ç®€å•æ¥è¯´, CDQ åˆ†æ²»åšäº†è¿™æ ·ä¸€ä»¶äº‹æƒ…: æŠŠæ“ä½œç¦»çº¿ä¸‹æ¥, åˆ†æˆä¸¤éƒ¨åˆ†, é€’å½’è§£å†³; è€ƒè™‘æŠŠè¿™ä¸¤éƒ¨åˆ†åˆå¹¶, å°±è¦è€ƒè™‘å·¦åŠéƒ¨åˆ†æ“ä½œå¯¹å³åŠéƒ¨åˆ†çš„å½±å“, ç„¶ååˆå¹¶.</p><h4 id="Luogu-P3810ã€æ¨¡æ¿ã€‘ä¸‰ç»´ååº"><a href="#Luogu-P3810ã€æ¨¡æ¿ã€‘ä¸‰ç»´ååº" class="headerlink" title="Luogu P3810ã€æ¨¡æ¿ã€‘ä¸‰ç»´ååº"></a>Luogu P3810ã€æ¨¡æ¿ã€‘ä¸‰ç»´ååº</h4><ul><li>é¢˜ç›®é“¾æ¥: <a href="https://www.luogu.com.cn/problem/P3810" target="_blank" rel="noopener">https://www.luogu.com.cn/problem/P3810</a></li></ul><p>æ˜¯ä¸€é“ç»å…¸é¢˜, è€ƒè™‘ CDQ åˆ†æ²», å…ˆå°†ç¬¬ä¸€ç»´æ’åº, CDQ åˆ†æ²»è¿‡ç¨‹ä¸­æŒ‰ç¬¬äºŒç»´æ’åº, ä½¿ç”¨æ ‘çŠ¶æ•°ç»„ç»Ÿè®¡ç¬¬ä¸‰ç»´ç­”æ¡ˆ.</p><p>æœ‰ä¸€ä¸ªç»†èŠ‚: å¯èƒ½å­˜åœ¨ç›¸åŒå…ƒç´ , æŒ‰é¢˜æ„æ¥è®²è¿™äº›å®Œå…¨ç›¸åŒçš„å…ƒç´ äº’ç›¸æœ‰è´¡çŒ®, ä½†æ˜¯åœ¨ CDQ åˆ†æ²»çš„è¿‡ç¨‹ä¸­åªèƒ½ç»Ÿè®¡å·¦åŠéƒ¨åˆ†å¯¹å³åŠéƒ¨åˆ†çš„è´¡çŒ®, æ‰€ä»¥éœ€è¦å»é‡, å¯¹é‡å¤ä¸åŒæ¬¡æ•°çš„å…ƒç´ ç»™å®šä¸€ä¸ªä¸åŒçš„æƒå€¼.</p><p>æ—¶é—´å¤æ‚åº¦: $O (n\log n \log k)$</p><p><strong>ä»£ç å®ç°</strong></p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Luogu P3810</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span>+<span class="number">5</span>, MAXM = <span class="number">2e5</span>+<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Item</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> idx, a, b, c, w;</span><br><span class="line">    Item(<span class="keyword">int</span> _i = <span class="number">0</span>, <span class="keyword">int</span> _a = <span class="number">0</span>, <span class="keyword">int</span> _b = <span class="number">0</span>, <span class="keyword">int</span> _c = <span class="number">0</span>, <span class="keyword">int</span> _w = <span class="number">0</span>):</span><br><span class="line">        idx(_i), a(_a), b(_b), c(_c), w(_w) &#123; &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Item&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (a == rhs.a)? ((b == rhs.b)? c &lt; rhs.c: b &lt; rhs.b): a &lt; rhs.a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>== (<span class="keyword">const</span> Item&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> !(*<span class="keyword">this</span> &lt; rhs) &amp;&amp; !(rhs &lt; *<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; A[MAXN], tmp[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, nA, K;</span><br><span class="line"><span class="keyword">int</span> Ans[MAXN], f[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> BIT &#123;</span><br><span class="line">    <span class="keyword">int</span> C[MAXM];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123; <span class="keyword">return</span> x &amp; -x; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; pos, <span class="keyword">const</span> <span class="keyword">int</span>&amp; d)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = pos; i &lt;= K; i += lowbit(i)) C[i] += d;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Qry</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; pos)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = pos; i; i -= lowbit(i)) ret += C[i];</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CDQ</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; L, <span class="keyword">const</span> <span class="keyword">int</span>&amp; R)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (L &gt;= R) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>, p = L, q = Mid+<span class="number">1</span>;</span><br><span class="line">    CDQ(L, Mid), CDQ(Mid+<span class="number">1</span>, R);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = L; i &lt;= R; ++i) &#123;</span><br><span class="line">        <span class="comment">// åœ¨å³åŠéƒ¨åˆ†æ’æ»¡æ—¶ç§»åŠ¨å·¦åŠéƒ¨åˆ†</span></span><br><span class="line">        <span class="keyword">if</span> ((p &lt;= Mid &amp;&amp; A[p].b &lt;= A[q].b) || q &gt; R)</span><br><span class="line">            BIT::Mdy(A[p].c, A[p].w), tmp[i] = A[p++];</span><br><span class="line">        <span class="keyword">else</span> Ans[A[q].idx] += BIT::Qry(A[q].c), tmp[i] = A[q++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ¸…ç©ºæ ‘çŠ¶æ•°ç»„</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = L; i &lt;= Mid; ++i) BIT::Mdy(A[i].c, -A[i].w);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = L; i &lt;= R; ++i) A[i] = tmp[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n), read(K);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> a, b, c, i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        read(a), read(b), read(c), A[i] = Item(i, a, b, c, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    sort(A+<span class="number">1</span>, A+<span class="number">1</span>+n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> j = i;</span><br><span class="line">        <span class="keyword">while</span> (j &lt; n &amp;&amp; A[i] == A[j+<span class="number">1</span>]) ++j;</span><br><span class="line">        A[++nA] = A[i], A[nA].w = j - i + <span class="number">1</span>;</span><br><span class="line">        i = j;</span><br><span class="line">    &#125;</span><br><span class="line">    CDQ(<span class="number">1</span>, nA);</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nA; ++i) f[Ans[A[i].idx] + A[i].w] += A[i].w;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, f[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h4 id="Luogu-P3374ã€æ¨¡æ¿ã€‘æ ‘çŠ¶æ•°ç»„-1"><a href="#Luogu-P3374ã€æ¨¡æ¿ã€‘æ ‘çŠ¶æ•°ç»„-1" class="headerlink" title="Luogu P3374ã€æ¨¡æ¿ã€‘æ ‘çŠ¶æ•°ç»„ 1"></a>Luogu P3374ã€æ¨¡æ¿ã€‘æ ‘çŠ¶æ•°ç»„ 1</h4><blockquote><p>CDQ åˆ†æ²»å¯ä»¥é¡¶æ›¿å¤æ‚çš„é«˜çº§æ•°æ®ç»“æ„.</p></blockquote><ul><li>é¢˜ç›®é“¾æ¥: <a href="https://www.luogu.com.cn/problem/P3374" target="_blank" rel="noopener">https://www.luogu.com.cn/problem/P3374</a></li></ul><p>æˆ‘ä»¬å¯ä»¥æŠŠåˆå§‹å€¼çœ‹ä½œåœ¨ $0$ çš„åŸºç¡€ä¸Šå•ç‚¹ä¿®æ”¹, æŠŠæŸ¥è¯¢çœ‹ä½œä¸¤æ¬¡è¯¢é—®å‰ç¼€å’Œ, è¿™æ ·æ¯ä¸ªæ“ä½œæœ‰æ—¶é—´, å¯¹åº”æ“ä½œä½ç½®, æƒå€¼ä¸‰ä¸ªå±æ€§.</p><p>æ—¶é—´è¿™ä¸€ç»´æŒ‰ç»™å®šé¡ºåºæœ‰åº, CDQ åˆ†æ²»è¿‡ç¨‹ä¸­æŒ‰æ“ä½œä½ç½®ç»´æŠ¤æƒå€¼å’Œå³å¯, æ³¨æ„åœ¨æ“ä½œä½ç½®ç›¸åŒæ—¶, æŒ‰ç…§å…ˆä¿®æ”¹åæŸ¥è¯¢çš„é¡ºåºç»Ÿè®¡.</p><p><strong>ä»£ç å®ç°</strong></p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Luogu P3374</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc(); </span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">500005</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Ask</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> opt, pos; LL val;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Ask&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pos &lt; rhs.pos || (pos == rhs.pos &amp;&amp; opt &lt; rhs.opt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; Q[MAXN * <span class="number">3</span>], tmp[MAXN * <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, qidx, aidx;</span><br><span class="line">LL A[MAXN], Ans[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CDQ</span><span class="params">(<span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (L == R) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">    CDQ(L, Mid), CDQ(Mid+<span class="number">1</span>, R);</span><br><span class="line">    LL sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> p = L, q = Mid+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = L; i &lt;= R; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> ((p &lt;= Mid &amp;&amp; Q[p] &lt; Q[q]) || q &gt; R) &#123;</span><br><span class="line">        <span class="keyword">if</span> (Q[p].opt == <span class="number">1</span>) sum += Q[p].val;</span><br><span class="line">        tmp[i] = Q[p++];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (Q[q].opt == <span class="number">2</span>) Ans[Q[q].val] -= sum;</span><br><span class="line">        <span class="keyword">if</span> (Q[q].opt == <span class="number">3</span>) Ans[Q[q].val] += sum;</span><br><span class="line">        tmp[i] = Q[q++];</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = L; i &lt;= R; ++i) Q[i] = tmp[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    read(n), read(m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        read(A[i]);</span><br><span class="line">        Q[++qidx] = (Ask)&#123; <span class="number">1</span>, i, A[i] &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> opt, L, R; LL val;</span><br><span class="line">        read(opt); read(L);</span><br><span class="line">        <span class="keyword">switch</span> (opt) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                read(val);</span><br><span class="line">                Q[++qidx] = (Ask)&#123; opt, L, val &#125;;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                read(R);</span><br><span class="line">                Q[++qidx] = (Ask)&#123; opt, L<span class="number">-1</span>, ++aidx &#125;;</span><br><span class="line">                Q[++qidx] = (Ask)&#123; opt+<span class="number">1</span>, R, aidx &#125;;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>: <span class="built_in">puts</span>(<span class="string">"ERROR"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    CDQ(<span class="number">1</span>, qidx);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= aidx; ++i) <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, Ans[i]);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h4 id="HDU-5126-stars"><a href="#HDU-5126-stars" class="headerlink" title="HDU 5126 stars"></a>HDU 5126 stars</h4><ul><li>é¢˜ç›®é“¾æ¥: <a href="http://acm.hdu.edu.cn/showproblem.php?pid=5126" target="_blank" rel="noopener">http://acm.hdu.edu.cn/showproblem.php?pid=5126</a></li></ul><p>å¯¹äºå››ç»´çš„æƒ…å†µ, CDQ åˆ†æ²»å¯ä»¥åµŒå¥—ä½¿ç”¨. <del>ä½†æ˜¯ CDQ å¥— CDQ å¥— CDQâ€¦ å°±å’Œæ ‘å¥—æ ‘å¥—æ ‘â€¦ ä¸€æ ·æ²¡ç”¨, ä¸å¦‚ç›´æ¥å†™ bitset</del></p><p>è¿™æ˜¯ä¸€ä¸ªä¸‰ç»´æ•°ç‚¹é—®é¢˜, å› ä¸ºè¦è€ƒè™‘æ“ä½œæ—¶é—´çš„å½±å“å°±æ˜¯å››ç»´ååºäº†, åœ¨æ­¤æˆ‘ä½¿ç”¨ CDQ å¥— CDQ è§£å†³.</p><p>è¿˜æ˜¯å‚è€ƒ <a href="https://www.cnblogs.com/mlystdcall/p/6232324.html" target="_blank" rel="noopener">__stdcall çš„ CDQ å¥— CDQ æ•™ç¨‹</a>, æŠŠç¬¬äºŒç»´æŒ‰å·¦å³ä¸¤éƒ¨åˆ†é‡æ ‡å·, ä¾æ­¤ä¸ºæ ¹æ®ç»Ÿè®¡ç­”æ¡ˆ.</p><p>ç©ºé—´å†…æ•°ç‚¹å¯ä»¿ç…§å¹³é¢å†…æ•°ç‚¹çš„æ€è·¯, ç»Ÿè®¡å‰ç¼€å’ŒæŒ‰åæ ‡ç‚¹å®¹æ–¥è®¡ç®—å°±å¥½äº†.</p><p>æ—¶é—´å¤æ‚åº¦å¤§æ¦‚æ˜¯ $O(n \log ^3 n)$</p><p><strong>ä»£ç å®ç°</strong></p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HDU 5126</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">5e5</span>+<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Ask</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> opt, idx, x, y, z, part;</span><br><span class="line">&#125; Q[MAXN], tmp2d[MAXN], tmp3d[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, qidx, aidx;</span><br><span class="line"><span class="keyword">int</span> A[MAXN], B[MAXN &lt;&lt; <span class="number">1</span>], nB;</span><br><span class="line"><span class="keyword">int</span> Ans[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> BIT &#123;</span><br><span class="line">    <span class="keyword">int</span> C[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123; <span class="keyword">return</span> x &amp; -x; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; pos, <span class="keyword">const</span> <span class="keyword">int</span>&amp; val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = pos; i &lt;= nB; i += lowbit(i)) C[i] += val;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Qry</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; pos)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = pos; i; i -= lowbit(i)) ret += C[i];</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CDQ3d</span><span class="params">(<span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (L &gt;= R) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>, p = L, q = Mid+<span class="number">1</span>;</span><br><span class="line">    CDQ3d(L, Mid), CDQ3d(Mid+<span class="number">1</span>, R);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = L; i &lt;= R; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((p &lt;= Mid &amp;&amp; tmp2d[p].y &lt;= tmp2d[q].y) || q &gt; R) &#123;</span><br><span class="line">            <span class="comment">// åªè€ƒè™‘ä¸¤æ¬¡å½’å¹¶éƒ½æ’å¸ƒåœ¨å·¦åŠéƒ¨åˆ†çš„å…ƒç´ çš„è´¡çŒ®</span></span><br><span class="line">            <span class="keyword">if</span> (tmp2d[p].opt == <span class="number">0</span> &amp;&amp; tmp2d[p].part == <span class="number">0</span>)</span><br><span class="line">                BIT::Mdy(tmp2d[p].z, <span class="number">1</span>);</span><br><span class="line">            tmp3d[i] = tmp2d[p++];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// åªç»Ÿè®¡ä¸¤æ¬¡å½’å¹¶éƒ½æ’å¸ƒåœ¨å³åŠéƒ¨åˆ†çš„å…ƒç´ çš„ç­”æ¡ˆ</span></span><br><span class="line">            <span class="keyword">if</span> (tmp2d[q].opt != <span class="number">0</span> &amp;&amp; tmp2d[q].part == <span class="number">1</span>)</span><br><span class="line">                Ans[tmp2d[q].idx] += tmp2d[q].opt * BIT::Qry(tmp2d[q].z);</span><br><span class="line">            tmp3d[i] = tmp2d[q++];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = L; i &lt;= Mid; ++i)</span><br><span class="line">        <span class="keyword">if</span> (tmp2d[i].opt == <span class="number">0</span> &amp;&amp; tmp2d[i].part == <span class="number">0</span>)</span><br><span class="line">            BIT::Mdy(tmp2d[i].z, <span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = L; i &lt;= R; ++i) tmp2d[i] = tmp3d[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CDQ2d</span><span class="params">(<span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (L &gt;= R) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>, p = L, q = Mid+<span class="number">1</span>;</span><br><span class="line">    CDQ2d(L, Mid), CDQ2d(Mid+<span class="number">1</span>, R);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = L; i &lt;= R; ++i) &#123;</span><br><span class="line">        <span class="comment">// é‡æ ‡å·: å·¦åŠéƒ¨åˆ†æ ‡ä¸º 0, å³åŠéƒ¨åˆ†æ ‡ä¸º 1</span></span><br><span class="line">        <span class="keyword">if</span> ((p &lt;= Mid &amp;&amp; Q[p].x &lt;= Q[q].x) || q &gt; R) &#123;</span><br><span class="line">            Q[p].part = <span class="number">0</span>;</span><br><span class="line">            tmp2d[i] = Q[p++];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Q[q].part = <span class="number">1</span>;</span><br><span class="line">            tmp2d[i] = Q[q++];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = L; i &lt;= R; ++i) Q[i] = tmp2d[i];</span><br><span class="line">    CDQ3d(L, R);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> Ti; read(Ti);</span><br><span class="line">    <span class="keyword">while</span> (Ti--) &#123;</span><br><span class="line">        <span class="comment">// init</span></span><br><span class="line">        qidx = nB = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// input</span></span><br><span class="line">        read(n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">static</span> <span class="keyword">int</span> opt, x1, y1, z1, x2, y2, z2;</span><br><span class="line">            read(opt), read(x1), read(y1), read(z1);</span><br><span class="line">            <span class="keyword">switch</span> (opt) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    Q[++qidx] = (Ask)&#123; <span class="number">0</span>, i, x1, y1, z1, <span class="number">0</span> &#125;;</span><br><span class="line">                    Ans[i] = <span class="number">-1</span>, B[++nB] = z1;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    read(x2), read(y2), read(z2);</span><br><span class="line">                    --x1, --y1, --z1;</span><br><span class="line">                    <span class="comment">// å®¹æ–¥</span></span><br><span class="line">                    Q[++qidx] = (Ask)&#123; <span class="number">1</span>, i, x2, y2, z2, <span class="number">0</span> &#125;;</span><br><span class="line">                    Q[++qidx] = (Ask)&#123;<span class="number">-1</span>, i, x1, y1, z1, <span class="number">0</span> &#125;;</span><br><span class="line">                    Q[++qidx] = (Ask)&#123;<span class="number">-1</span>, i, x1, y2, z2, <span class="number">0</span> &#125;;</span><br><span class="line">                    Q[++qidx] = (Ask)&#123;<span class="number">-1</span>, i, x2, y1, z2, <span class="number">0</span> &#125;;</span><br><span class="line">                    Q[++qidx] = (Ask)&#123;<span class="number">-1</span>, i, x2, y2, z1, <span class="number">0</span> &#125;;</span><br><span class="line">                    Q[++qidx] = (Ask)&#123; <span class="number">1</span>, i, x2, y1, z1, <span class="number">0</span> &#125;;</span><br><span class="line">                    Q[++qidx] = (Ask)&#123; <span class="number">1</span>, i, x1, y2, z1, <span class="number">0</span> &#125;;</span><br><span class="line">                    Q[++qidx] = (Ask)&#123; <span class="number">1</span>, i, x1, y1, z2, <span class="number">0</span> &#125;;</span><br><span class="line">                    Ans[i] = <span class="number">0</span>, B[++nB] = z1, B[++nB] = z2;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>: <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"ERR\n"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// solve</span></span><br><span class="line">        sort(B+<span class="number">1</span>, B+<span class="number">1</span>+nB);</span><br><span class="line">        nB = unique(B+<span class="number">1</span>, B+<span class="number">1</span>+nB) - B - <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// è¿™ä¸€ç»´è¦ä¸¢åˆ° BIT é‡Œ, äºæ˜¯ç¦»æ•£åŒ–</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= qidx; ++i)</span><br><span class="line">            Q[i].z = lower_bound(B+<span class="number">1</span>, B+<span class="number">1</span>+nB, Q[i].z) - B;</span><br><span class="line">        CDQ2d(<span class="number">1</span>, qidx);</span><br><span class="line">        <span class="comment">// output</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            <span class="keyword">if</span> (~Ans[i]) <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, Ans[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="æ•´ä½“äºŒåˆ†"><a href="#æ•´ä½“äºŒåˆ†" class="headerlink" title="æ•´ä½“äºŒåˆ†"></a>æ•´ä½“äºŒåˆ†</h3><p>å¯¹äºä¸€ä¸ªè¯¢é—®, ä¾‹å¦‚åŒºé—´ç¬¬ K å°, æœ‰ä¸€ä¸ªæœ´ç´ çš„æƒ³æ³•: æ¯æ¬¡äºŒåˆ†ç­”æ¡ˆçš„å€¼åŸŸ, çœ‹å½“å‰äºŒåˆ†å€¼æ˜¯å¦æ°å¥½åœ¨åŒºé—´çš„æ’åä¸º K.</p><p>è¿™æ ·çœ‹èµ·æ¥å¾ˆæ…¢, äºæ˜¯å¯ä»¥å°†æ‰€æœ‰æ“ä½œè§†ä¸ºä¸€ä¸ªæ•´ä½“è¿›è¡ŒäºŒåˆ†, æ¯æ¬¡ç»™å®šä¸€ä¸ªç­”æ¡ˆåŒºé—´å’Œä¸€ä¸ªæ“ä½œåŒºé—´, è¿™å°±æ˜¯æ•´ä½“äºŒåˆ†äº†.</p><h4 id="Luogu-P3834ã€æ¨¡æ¿ã€‘å¯æŒä¹…åŒ–çº¿æ®µæ ‘-1ï¼ˆä¸»å¸­æ ‘ï¼‰"><a href="#Luogu-P3834ã€æ¨¡æ¿ã€‘å¯æŒä¹…åŒ–çº¿æ®µæ ‘-1ï¼ˆä¸»å¸­æ ‘ï¼‰" class="headerlink" title="Luogu P3834ã€æ¨¡æ¿ã€‘å¯æŒä¹…åŒ–çº¿æ®µæ ‘ 1ï¼ˆä¸»å¸­æ ‘ï¼‰"></a>Luogu P3834ã€æ¨¡æ¿ã€‘å¯æŒä¹…åŒ–çº¿æ®µæ ‘ 1ï¼ˆä¸»å¸­æ ‘ï¼‰</h4><ul><li>é¢˜ç›®é“¾æ¥: <a href="https://www.luogu.com.cn/problem/P3834" target="_blank" rel="noopener">https://www.luogu.com.cn/problem/P3834</a></li></ul><p>å¯æŒä¹…åŒ–çº¿æ®µæ ‘ $\times$ é™æ€åŒºé—´ç¬¬ k å° $\checkmark$</p><p>ç®—æ˜¯æ•´ä½“äºŒåˆ†çš„ç»å…¸é—®é¢˜äº†. ç›´æ¥ä½¿ç”¨ä¹‹å‰è¯´è¿‡çš„æ€è·¯, æ•´ä½“äºŒåˆ†å³å¯.</p><p>å…·ä½“åœ°è¯´, å¯¹äºåŸåºåˆ—ä¸Šçš„æ•°, æŒ‰å½“å‰äºŒåˆ†çš„å€¼åŸŸè¿›è¡Œåˆ’åˆ†; è€Œå¯¹äºæ“ä½œ, åˆ™ç»Ÿè®¡å½“å‰æ“ä½œå¯¹åº”åŒºé—´å†…æ•°çš„ä¸ªæ•°, ä»¥å½“å‰æ“ä½œç¬¬ k å°ä¸ºä¾æ®è¿›è¡Œåˆ’åˆ†.</p><p><strong>ä»£ç å®ç°</strong></p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Luogu P3834</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">2e5</span>+<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Ask</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> opt, idx, L, R, k;</span><br><span class="line">&#125; Q[MAXN &lt;&lt; <span class="number">1</span>], tmpL[MAXN &lt;&lt; <span class="number">1</span>], tmpR[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, qidx;</span><br><span class="line"><span class="keyword">int</span> A[MAXN], B[MAXN], nB;</span><br><span class="line"><span class="keyword">int</span> Ans[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> BIT &#123;</span><br><span class="line">    <span class="keyword">int</span> C[MAXN];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123; <span class="keyword">return</span> x &amp; -x; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; pos, <span class="keyword">const</span> <span class="keyword">int</span>&amp; val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = pos; i &lt;= n; i += lowbit(i)) C[i] += val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Qry</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; pos)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = pos; i; i -= lowbit(i)) ret += C[i];</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Qry</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; L, <span class="keyword">const</span> <span class="keyword">int</span>&amp; R)</span> </span>&#123; <span class="keyword">return</span> Qry(R) - Qry(L<span class="number">-1</span>); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">divide</span><span class="params">(<span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opL, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opR)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (opL &gt; opR) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (L == R) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = opL; i &lt;= opR; ++i)</span><br><span class="line">            <span class="keyword">if</span> (Q[i].opt == <span class="number">1</span>) Ans[Q[i].idx] = L;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>, p = <span class="number">0</span>, q = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = opL; i &lt;= opR; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (Q[i].opt == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Q[i].R &lt;= Mid)</span><br><span class="line">                BIT::Mdy(Q[i].L, Q[i].k), tmpL[++p] = Q[i];</span><br><span class="line">            <span class="keyword">else</span> tmpR[++q] = Q[i];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> w = BIT::Qry(Q[i].L, Q[i].R);</span><br><span class="line">            <span class="keyword">if</span> (Q[i].k &lt;= w) tmpL[++p] = Q[i];</span><br><span class="line">            <span class="keyword">else</span> Q[i].k -= w, tmpR[++q] = Q[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= p; ++i)</span><br><span class="line">        <span class="keyword">if</span> (tmpL[i].opt == <span class="number">0</span>) BIT::Mdy(tmpL[i].L, -tmpL[i].k);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= p; ++i) Q[opL+i<span class="number">-1</span>] = tmpL[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= q; ++i) Q[opL+p+i<span class="number">-1</span>] = tmpR[i];</span><br><span class="line">    divide(L, Mid, opL, opL + p - <span class="number">1</span>), divide(Mid+<span class="number">1</span>, R, opL + p, opR);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n), read(m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) read(A[i]), B[++nB] = A[i];</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    sort(B+<span class="number">1</span>, B+<span class="number">1</span>+nB);</span><br><span class="line">    nB = unique(B+<span class="number">1</span>, B+<span class="number">1</span>+nB) - B - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        A[i] = lower_bound(B+<span class="number">1</span>, B+<span class="number">1</span>+nB, A[i]) - B;</span><br><span class="line">        Q[++qidx] = (Ask)&#123; <span class="number">0</span>, <span class="number">-1</span>, i, A[i], <span class="number">1</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> L, R, k;</span><br><span class="line">        read(L), read(R), read(k);</span><br><span class="line">        Q[++qidx] = (Ask)&#123; <span class="number">1</span>, i, L, R, k &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    divide(<span class="number">1</span>, nB, <span class="number">1</span>, qidx);</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, B[Ans[i]]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h4 id="Luogu-P3242-HNOI2015-æ¥æ°´æœ"><a href="#Luogu-P3242-HNOI2015-æ¥æ°´æœ" class="headerlink" title="Luogu P3242 [HNOI2015] æ¥æ°´æœ"></a>Luogu P3242 [HNOI2015] æ¥æ°´æœ</h4><ul><li>é¢˜ç›®é“¾æ¥: <a href="https://www.luogu.com.cn/problem/P3242" target="_blank" rel="noopener">https://www.luogu.com.cn/problem/P3242</a></li></ul><p>é€šè¿‡å¯¹è·¯å¾„ä¸¤ç«¯ç‚¹çš„ dfs åºçš„è®¨è®º, è·¯å¾„ä¹‹é—´çš„ç›¸äº’åŒ…å«å¯ä»¥çœ‹ä½œæ˜¯åœ¨äºŒç»´çŸ©é˜µä¸­æ•°ç‚¹, æ”¾åœ¨è¿™é“é¢˜ä¸­å°±æ˜¯äºŒç»´çŸ©é˜µä¸­æŸ¥è¯¢ç¬¬ k å°äº†.</p><p>ç±»ä¼¼çš„è½¬åŒ–è¿˜æœ‰å­æ ‘å†…è·ç¦»å°äºç­‰äºçš„ç‚¹, å°† DFS åºçœ‹ä½œä¸€ç»´, æ·±åº¦çœ‹ä½œå¦ä¸€ç»´â€¦</p><p><del>è¿™ä¸œè¥¿å¯ä»¥å†™å¯æŒä¹…åŒ–æ ‘å¥—æ ‘, æˆ‘â€¦</del></p><p>æˆ‘å½“ç„¶æ˜¯æŠŠçŸ©é˜µæ‹†æˆæ‰«æçº¿, ç„¶åæ•´ä½“äºŒåˆ†è¿›è¡Œç»Ÿè®¡.</p><p><strong>ä»£ç å®ç°</strong></p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Luogu P3242</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">4e4</span>+<span class="number">5</span>, MAXM = <span class="number">5</span> * MAXN;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Ask</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> opt, idx, u, L, R, k, val;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Ask&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> u &lt; rhs.u || (u == rhs.u &amp;&amp; opt &lt; rhs.opt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; Q[MAXM], tmpL[MAXM], tmpR[MAXM];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, qc, qidx;</span><br><span class="line"><span class="keyword">int</span> st[MAXN], ed[MAXN];</span><br><span class="line"><span class="keyword">int</span> Ans[MAXN], B[MAXN], nB;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Graph &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt, to; &#125; edges[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], eidx;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="keyword">sizeof</span> head), eidx = <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to)</span> </span>&#123;</span><br><span class="line">        edges[++eidx] = (Edge)&#123; head[from], to &#125;;</span><br><span class="line">        head[from] = eidx;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> HLD &#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> Graph;</span><br><span class="line">    <span class="keyword">int</span> size[MAXN], depth[MAXN], pre[MAXN], son[MAXN];</span><br><span class="line">    <span class="keyword">int</span> topfa[MAXN], dfs_clock;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa)</span> </span>&#123;</span><br><span class="line">        depth[u] = depth[fa] + <span class="number">1</span>;</span><br><span class="line">        pre[u] = fa, size[u] = <span class="number">1</span>, son[u] = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = head[u]; ~i; i = edges[i].nxt) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((v = edges[i].to) == fa) <span class="keyword">continue</span>;</span><br><span class="line">            dfs1(v, u), size[u] += size[v];</span><br><span class="line">            <span class="keyword">if</span> (son[u] == <span class="number">-1</span> || size[v] &gt; size[son[u]]) son[u] = v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> top)</span> </span>&#123;</span><br><span class="line">        topfa[u] = top, st[u] = ++dfs_clock;</span><br><span class="line">        <span class="keyword">if</span> (~son[u]) dfs2(son[u], top);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, i = head[u]; ~i; i = edges[i].nxt)</span><br><span class="line">            <span class="keyword">if</span> ((v = edges[i].to) != pre[u] &amp;&amp; v != son[u]) dfs2(v, v);</span><br><span class="line">        ed[u] = dfs_clock;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (topfa[u] != topfa[v]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (depth[topfa[u]] &lt; depth[topfa[v]]) swap(u, v);</span><br><span class="line">            u = pre[topfa[u]];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> depth[u] &gt; depth[v]? v: u;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">findson</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (topfa[u] != topfa[v]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (pre[topfa[u]] == v) <span class="keyword">return</span> topfa[u];</span><br><span class="line">            u = pre[topfa[u]];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> son[v];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> root = <span class="number">1</span>)</span> </span>&#123; dfs1(root, <span class="number">0</span>), dfs2(root, root); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> BIT &#123;</span><br><span class="line">    <span class="keyword">int</span> C[MAXN];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123; <span class="keyword">return</span> x &amp; -x; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; pos, <span class="keyword">const</span> <span class="keyword">int</span>&amp; val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = pos; i &lt;= n; i += lowbit(i)) C[i] += val;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; L, <span class="keyword">const</span> <span class="keyword">int</span>&amp; R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; val)</span> </span>&#123;</span><br><span class="line">        Mdy(L, val), Mdy(R+<span class="number">1</span>, -val);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Qry</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; pos)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = pos; i; i -= lowbit(i)) ret += C[i];</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">divide</span><span class="params">(<span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opL, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opR)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (opL &gt; opR) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (L == R) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = opL; i &lt;= opR; ++i)</span><br><span class="line">            <span class="keyword">if</span> (Q[i].opt == <span class="number">1</span>) Ans[Q[i].idx] = B[L];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>, p = <span class="number">0</span>, q = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = opL; i &lt;= opR; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (Q[i].opt == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Q[i].k &lt;= Mid)</span><br><span class="line">                BIT::Mdy(Q[i].L, Q[i].R, Q[i].val), tmpL[++p] = Q[i];</span><br><span class="line">            <span class="keyword">else</span> tmpR[++q] = Q[i];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> w = BIT::Qry(Q[i].L);</span><br><span class="line">            <span class="keyword">if</span> (Q[i].k &lt;= w) tmpL[++p] = Q[i];</span><br><span class="line">            <span class="keyword">else</span> Q[i].k -= w, tmpR[++q] = Q[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= p; ++i)</span><br><span class="line">        <span class="keyword">if</span> (tmpL[i].opt == <span class="number">0</span>) BIT::Mdy(tmpL[i].L, tmpL[i].R, -tmpL[i].val);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= p; ++i) Q[opL + i - <span class="number">1</span>] = tmpL[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= q; ++i) Q[opL + p + i - <span class="number">1</span>] = tmpR[i];</span><br><span class="line">    divide(L, Mid, opL, opL + p - <span class="number">1</span>), divide(Mid+<span class="number">1</span>, R, opL + p, opR);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// init</span></span><br><span class="line">    Graph::init();</span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n), read(m), read(qc);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> u, v, i = <span class="number">1</span>; i &lt; n; ++i)</span><br><span class="line">        read(u), read(v), Graph::AddEdge(u, v), Graph::AddEdge(v, u);</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    HLD::solve();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> u, v, w, i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        read(u), read(v), read(w);</span><br><span class="line">        <span class="keyword">if</span> (st[u] &gt; st[v]) swap(u, v);</span><br><span class="line">        B[++nB] = w;</span><br><span class="line">        <span class="keyword">if</span> (HLD::LCA(u, v) == u) &#123;</span><br><span class="line">            <span class="keyword">int</span> z = HLD::findson(v, u);</span><br><span class="line">            <span class="keyword">if</span> (st[z] &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                Q[++qidx] = (Ask)&#123; <span class="number">0</span>, <span class="number">-1</span>, <span class="number">1</span>, st[v], ed[v], w, <span class="number">1</span> &#125;;</span><br><span class="line">                Q[++qidx] = (Ask)&#123; <span class="number">0</span>, <span class="number">-1</span>, st[z], st[v], ed[v], w, <span class="number">-1</span> &#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (ed[z] &lt; n) &#123;</span><br><span class="line">                Q[++qidx] = (Ask)&#123; <span class="number">0</span>, <span class="number">-1</span>, st[v], ed[z]+<span class="number">1</span>, n, w, <span class="number">1</span> &#125;;</span><br><span class="line">                Q[++qidx] = (Ask)&#123; <span class="number">0</span>, <span class="number">-1</span>, ed[v]+<span class="number">1</span>, ed[z]+<span class="number">1</span>, n, w, <span class="number">-1</span> &#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Q[++qidx] = (Ask)&#123; <span class="number">0</span>, <span class="number">-1</span>, st[u], st[v], ed[v], w, <span class="number">1</span> &#125;;</span><br><span class="line">            Q[++qidx] = (Ask)&#123; <span class="number">0</span>, <span class="number">-1</span>, ed[u]+<span class="number">1</span>, st[v], ed[v], w, <span class="number">-1</span> &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(B+<span class="number">1</span>, B+<span class="number">1</span>+nB);</span><br><span class="line">    nB = unique(B+<span class="number">1</span>, B+<span class="number">1</span>+nB) - B - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= qidx; ++i)</span><br><span class="line">        Q[i].k = lower_bound(B+<span class="number">1</span>, B+<span class="number">1</span>+nB, Q[i].k) - B;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> u, v, k, i = <span class="number">1</span>; i &lt;= qc; ++i) &#123;</span><br><span class="line">        read(u), read(v), read(k);</span><br><span class="line">        <span class="keyword">if</span> (st[u] &gt; st[v]) swap(u, v);</span><br><span class="line">        Q[++qidx] = (Ask)&#123; <span class="number">1</span>, i, st[u], st[v], <span class="number">-1</span>, k, <span class="number">0</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(Q+<span class="number">1</span>, Q+<span class="number">1</span>+qidx);</span><br><span class="line">    divide(<span class="number">1</span>, nB, <span class="number">1</span>, qidx);</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= qc; ++i) <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, Ans[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><p>é‡åˆ°æ¯’ç˜¤å‡ºé¢˜äººå¼ºåˆ¶åœ¨çº¿å°±æŒ‚äº† = =, æ‰€ä»¥è¿˜éœ€è¦ä¸€äº›åœ¨çº¿è§£å†³é—®é¢˜çš„ç§‘æŠ€.</p><h3 id="å¯æŒä¹…åŒ–"><a href="#å¯æŒä¹…åŒ–" class="headerlink" title="å¯æŒä¹…åŒ–"></a>å¯æŒä¹…åŒ–</h3><p>åˆšå¼€å§‹å­¦å¯æŒä¹…åŒ–çš„æ—¶å€™æ„Ÿè§‰è¿™ä¸ªå¥½é«˜çº§å•Š, åæ¥æ„Ÿè§‰â€¦</p><p>è¿™ä¸å°±æ˜¯ä¸ªæ•°æ®ç»“æ„çš„å‰ç¼€å’Œå— = =</p><h4 id="Luogu-P3834ã€æ¨¡æ¿ã€‘å¯æŒä¹…åŒ–çº¿æ®µæ ‘-1ï¼ˆä¸»å¸­æ ‘ï¼‰-1"><a href="#Luogu-P3834ã€æ¨¡æ¿ã€‘å¯æŒä¹…åŒ–çº¿æ®µæ ‘-1ï¼ˆä¸»å¸­æ ‘ï¼‰-1" class="headerlink" title="Luogu P3834ã€æ¨¡æ¿ã€‘å¯æŒä¹…åŒ–çº¿æ®µæ ‘ 1ï¼ˆä¸»å¸­æ ‘ï¼‰"></a>Luogu P3834ã€æ¨¡æ¿ã€‘å¯æŒä¹…åŒ–çº¿æ®µæ ‘ 1ï¼ˆä¸»å¸­æ ‘ï¼‰</h4><ul><li>é¢˜ç›®é“¾æ¥: <a href="https://www.luogu.com.cn/problem/P3834" target="_blank" rel="noopener">https://www.luogu.com.cn/problem/P3834</a></li></ul><p>å»ºæƒå€¼çº¿æ®µæ ‘, åŠ¨æ€å¼€ç‚¹.</p><p>æŒ‰ç…§åˆå§‹åºåˆ—å»ºå¯æŒä¹…åŒ–çº¿æ®µæ ‘, æ¯ä¸ªä½ç½®å¯¹åº”çš„çº¿æ®µæ ‘, å°±æ˜¯åŒ…å«è¿™ä¸ªä½ç½®å‰ç¼€ä¿¡æ¯çš„çº¿æ®µæ ‘äº†.</p><p>å…·ä½“åœ°è¯´, å…ˆå»ºå‡ºä¸€ä¸ªç©ºæ ‘, ç„¶åå¯¹äºæ¯ä¸ªä½ç½®, åœ¨ä¸Šä¸€ä¸ªä½ç½®çš„åŸºç¡€ä¸Šæ‹“å±•, å°½é‡åˆ©ç”¨ä¹‹å‰ä»¥åŠå‚¨å­˜è¿‡çš„ä¿¡æ¯, å†å»ºå‡ºä¸€é¢—æ–°æ ‘. è¿™æ ·æ¯æ¬¡æ–°å¢çš„èŠ‚ç‚¹æ•°ä¸º $O(\log n)$, æ€»å…±å»ºå‡º $n$ é¢—çº¿æ®µæ ‘, æ€»ç©ºé—´å¤æ‚åº¦ä¸º $O(n \log n + n \log n)$.</p><p>è¿™æ ·å¯¹äºæ¯ä¸ªè¯¢é—® $[L,\ R]$, æŒ‰ç…§å‰ç¼€å’Œçš„åŸºæœ¬æ€æƒ³, åœ¨ $L-1,\ R$ ä¸¤é¢—æ ‘ä¸Šè¿›è¡ŒäºŒåˆ†å°±å¥½äº†, å³è®°å½•å½“å‰äºŒåˆ†åˆ°çš„ä¸¤é¢—æ ‘çš„å·¦å­æ ‘ size ä¹‹å·® (å› ä¸ºæ˜¯æ±‚ç¬¬ $k$ å°), ç„¶ååˆ†ç±»è®¨è®ºç§»åŠ¨åˆ°å·¦å­æ ‘è¿˜æ˜¯å³å­æ ‘.</p><p>æ—¶é—´å¤æ‚åº¦: $O(n \log n)$</p><p><strong>ä»£ç å®ç°</strong></p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Luogu P3834</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">2e5</span>+<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, nB;</span><br><span class="line"><span class="keyword">int</span> A[MAXN], B[MAXN], rt[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SGT &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span> <span class="keyword">int</span> lc, rc, sum; &#125; dat[MAXN &lt;&lt; <span class="number">5</span>];</span><br><span class="line">    <span class="keyword">int</span> nidx;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span>&amp; nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">        nd = ++nidx;</span><br><span class="line">        <span class="keyword">if</span> (L == R) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        build(dat[nd].lc, L, Mid), build(dat[nd].rc, Mid+<span class="number">1</span>, R);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> nxt = ++nidx;</span><br><span class="line">        dat[nxt] = dat[nd], ++dat[nxt].sum;</span><br><span class="line">        <span class="keyword">if</span> (L == R) <span class="keyword">return</span> nxt;</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (val &lt;= Mid) dat[nxt].lc = Mdy(dat[nxt].lc, L, Mid, val);</span><br><span class="line">        <span class="keyword">else</span> dat[nxt].rc = Mdy(dat[nxt].rc, Mid+<span class="number">1</span>, R, val);</span><br><span class="line">        <span class="keyword">return</span> nxt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Qry</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (L == R) <span class="keyword">return</span> L;</span><br><span class="line">        <span class="keyword">int</span> d = dat[dat[y].lc].sum - dat[dat[x].lc].sum, Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (k &lt;= d) <span class="keyword">return</span> Qry(dat[x].lc, dat[y].lc, L, Mid, k);</span><br><span class="line">        <span class="keyword">return</span> Qry(dat[x].rc, dat[y].rc, Mid+<span class="number">1</span>, R, k - d);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n), read(m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) read(A[i]), B[i] = A[i];</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    sort(B+<span class="number">1</span>, B+<span class="number">1</span>+n);</span><br><span class="line">    nB = unique(B+<span class="number">1</span>, B+<span class="number">1</span>+n) - B - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) A[i] = lower_bound(B+<span class="number">1</span>, B+<span class="number">1</span>+nB, A[i]) - B;</span><br><span class="line">    SGT::build(rt[<span class="number">0</span>], <span class="number">1</span>, nB);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) rt[i] = SGT::Mdy(rt[i<span class="number">-1</span>], <span class="number">1</span>, nB, A[i]);</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">while</span> (m--) &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> L, R, K;</span><br><span class="line">        read(L), read(R), read(K);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, B[SGT::Qry(rt[L<span class="number">-1</span>], rt[R], <span class="number">1</span>, nB, K)]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h4 id="Luogu-P3168-CQOI2015-ä»»åŠ¡æŸ¥è¯¢ç³»ç»Ÿ"><a href="#Luogu-P3168-CQOI2015-ä»»åŠ¡æŸ¥è¯¢ç³»ç»Ÿ" class="headerlink" title="Luogu P3168 [CQOI2015] ä»»åŠ¡æŸ¥è¯¢ç³»ç»Ÿ"></a>Luogu P3168 [CQOI2015] ä»»åŠ¡æŸ¥è¯¢ç³»ç»Ÿ</h4><ul><li>é¢˜ç›®é“¾æ¥: <a href="https://www.luogu.com.cn/problem/P3168" target="_blank" rel="noopener">https://www.luogu.com.cn/problem/P3168</a></li></ul><p>åˆšæ‰æ˜¯å•ç‚¹ä¿®æ”¹, åŒºé—´æ±‚å’Œ, è€Œç°åœ¨æ˜¯åŒºé—´ä¿®æ”¹, å•ç‚¹æ±‚å’Œ, é‚£ä¹ˆå·®åˆ†å³å¯è§£å†³.</p><p><del>å°è¯•äº†ä¸å…ˆå»ºå‡ºç©ºæ ‘çš„å†™æ³•, æ„Ÿè§‰è¿˜è¡Œ ?</del></p><p>å¯¹æ—¶é—´å»ºæƒå€¼çº¿æ®µæ ‘, æŠŠæ¯æ¬¡åŒºé—´æ“ä½œå·®åˆ†, æŒ‚åœ¨å¯¹åº”çš„æ—¶é—´ç‚¹ä¸Š, è®°å½•æœ€åæ“ä½œå¯¹åº”çš„èŠ‚ç‚¹ä¸ºå½“å‰æ—¶é—´ç‚¹çš„èŠ‚ç‚¹, å¯¹äºè¯¢é—®ç›´æ¥åœ¨å¯¹åº”æ—¶é—´ç‚¹çš„æ ‘ä¸ŠäºŒåˆ†å³å¯.</p><p><strong>ä»£ç å®ç°</strong></p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Luogu P3168</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">2e5</span>+<span class="number">5</span>, MAXV = <span class="number">1e7</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="keyword">int</span> rt[MAXN], pos[MAXN];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; A[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> PSGT &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Mid ((L + R) / 2)</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span> <span class="keyword">int</span> lc, rc, size; LL sum; &#125; dat[MAXN &lt;&lt; <span class="number">6</span>];</span><br><span class="line">    <span class="keyword">int</span> nidx;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Abs</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123; <span class="keyword">return</span> v &gt; <span class="number">0</span>? v: -v; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> nxt = ++nidx;</span><br><span class="line">        dat[nxt] = dat[nd], dat[nxt].size += (val &lt; <span class="number">0</span>? <span class="number">-1</span>: <span class="number">1</span>), dat[nxt].sum += val;</span><br><span class="line">        <span class="keyword">if</span> (L == R) <span class="keyword">return</span> nxt;</span><br><span class="line">        <span class="keyword">if</span> (Abs(val) &lt;= Mid) dat[nxt].lc = Mdy(dat[nxt].lc, L, Mid, val);</span><br><span class="line">        <span class="keyword">else</span> dat[nxt].rc = Mdy(dat[nxt].rc, Mid+<span class="number">1</span>, R, val);</span><br><span class="line">        <span class="keyword">return</span> nxt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">LL <span class="title">Qry</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (L == R) <span class="keyword">return</span> k * L;</span><br><span class="line">        <span class="keyword">int</span> d = dat[dat[nd].lc].size;</span><br><span class="line">        <span class="keyword">if</span> (k &lt;= d) <span class="keyword">return</span> Qry(dat[nd].lc, L, Mid, k);</span><br><span class="line">        <span class="keyword">return</span> Qry(dat[nd].rc, Mid+<span class="number">1</span>, R, k - d) + dat[dat[nd].lc].sum;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> Mid</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(m), read(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> L, R, val;</span><br><span class="line">        read(L), read(R), read(val);</span><br><span class="line">        A[L].push_back(val), A[R+<span class="number">1</span>].push_back(-val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    <span class="keyword">int</span> nidx = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">size_t</span> k = <span class="number">0</span>; k &lt; A[i].size(); ++k)</span><br><span class="line">            ++nidx, rt[nidx] = PSGT::Mdy(rt[nidx<span class="number">-1</span>], <span class="number">1</span>, MAXV, A[i][k]);</span><br><span class="line">        pos[i] = nidx;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">while</span> (n--) &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> x, a, b, c, k, nd; <span class="keyword">static</span> LL pre = <span class="number">1</span>;</span><br><span class="line">        read(x), read(a), read(b), read(c);</span><br><span class="line">        k = <span class="number">1</span> + (a * pre + b) % c, nd = pos[x];</span><br><span class="line">        <span class="keyword">if</span> (PSGT::dat[rt[nd]].size &gt; k) <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, pre = PSGT::Qry(rt[nd], <span class="number">1</span>, MAXV, k));</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, pre = PSGT::dat[rt[nd]].sum);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="K-D-Tree"><a href="#K-D-Tree" class="headerlink" title="K-D Tree"></a>K-D Tree</h3><p>è§£å†³ K ç»´é—®é¢˜ !</p><p>K-D Tree ç±»ä¼¼äºäºŒå‰æœç´¢æ ‘, å»ºæ ‘é€‰æ‹©ä¸€ä¸ªç»´åº¦å¯¹å½“å‰å…ƒç´ è¿›è¡Œåˆ†å‰², é‡‡ç”¨åˆé€‚é€‰æ‹©æ–¹æ³•å’Œä¼˜ç§€å®ç°, å»ºæ ‘çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(n \log n)$. è¯¦æƒ…è¯· <a href="https://oi-wiki.org/ds/kdt/" target="_blank" rel="noopener">OI Wiki</a>.</p><p>è€ƒè™‘åˆ° K-D Tree çš„ç»“æ„, æ’å…¥é‡‡ç”¨ç±»ä¼¼æ›¿ç½ªç¾Šæ ‘çš„å¹³è¡¡æ–¹æ³•, å¦‚æœæœ‰ä¸€ä¸ªèŠ‚ç‚¹æŸä¸€å­æ ‘çš„å¤§å°è¶…è¿‡é™åˆ¶, å°±ç›´æ¥é‡æ„è¿™ä¸ªä»¥è¿™ä¸€èŠ‚ç‚¹ä¸ºæ ¹çš„å­æ ‘.</p><p>æŸ¥è¯¢ç›´æ¥ä»¿ç…§äºŒå‰æœç´¢æ ‘äº†, æ³¨æ„åˆ° K-D Tree æŸäº›æƒ…å†µä¸‹å¯ä»¥å‰ªæ, å¯ä»¥å¤šç»´æŠ¤ä¸€äº›ä¿¡æ¯æ¥æ’é™¤æ‰ä¸€äº›å­æ ‘.</p><p>å¯ä»¥è¯æ˜, åœ¨ $k$ ç»´æƒ…å†µä¸‹, å•æ¬¡æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ä¸º $O(n ^ {1 - \frac{1}{k}} + \log n )$.</p><p>ä¸è¿‡å€¼å¾—æ³¨æ„çš„æ˜¯, è¿™é‡Œçš„æŸ¥è¯¢æ˜¯ç±»ä¼¼äºçŸ©é˜µæŸ¥è¯¢çš„ååºç»´æŠ¤, æ¥ä¸ªå¹³é¢æœ€è¿‘ç‚¹å¯¹å•æ¬¡æ“ä½œè¿˜æ˜¯æœ€åŠ£ $O(n)$.</p><h4 id="Luogu-P4148-ç®€å•é¢˜"><a href="#Luogu-P4148-ç®€å•é¢˜" class="headerlink" title="Luogu P4148 ç®€å•é¢˜"></a>Luogu P4148 ç®€å•é¢˜</h4><ul><li>é¢˜ç›®é“¾æ¥: <a href="https://www.luogu.com.cn/problem/P4148" target="_blank" rel="noopener">https://www.luogu.com.cn/problem/P4148</a></li></ul><p>æ„Ÿè§‰ K-D Tree çš„æ¨¡æ¿é¢˜, æ²¡ä»€ä¹ˆå¥½è¯´çš„, æŠŠ K-D Tree çš„æ“ä½œæ±‡æ€»å°±å¥½äº†.</p><p><del>ç„¶è€Œæˆ‘é‡æ„å†™æŒ‚äº†è°ƒäº†å¥½ä¹…â€¦</del></p><p><strong>ä»£ç å®ç°</strong></p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Luogu P4148</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">2e5</span>+<span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> alpha = <span class="number">0.725</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, nidx, root;</span><br><span class="line"><span class="keyword">int</span> x1, y1, x2, y2;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> &#123;</span> <span class="keyword">int</span> x, y, val; &#125; A[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> KDT &#123;</span><br><span class="line">    <span class="keyword">int</span> ch[<span class="number">2</span>][MAXN], d[MAXN], g[MAXN], t;</span><br><span class="line">    <span class="keyword">int</span> size[MAXN], datSum[MAXN], mnL[MAXN], mxR[MAXN], mnD[MAXN], mxU[MAXN];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">cmp1</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; a, <span class="keyword">const</span> <span class="keyword">int</span>&amp; b)</span> </span>&#123; <span class="keyword">return</span> A[a].x &lt; A[b].x; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">cmp2</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; a, <span class="keyword">const</span> <span class="keyword">int</span>&amp; b)</span> </span>&#123; <span class="keyword">return</span> A[a].y &lt; A[b].y; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">maintain</span><span class="params">(<span class="keyword">int</span> nd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">int</span> &amp;lc = ch[<span class="number">0</span>][nd], &amp;rc = ch[<span class="number">1</span>][nd];</span><br><span class="line">        size[nd] = <span class="number">1</span>, datSum[nd] = A[nd].val;</span><br><span class="line">        mnL[nd] = mxR[nd] = A[nd].x, mnD[nd] = mxU[nd] = A[nd].y;</span><br><span class="line">        <span class="keyword">if</span> (lc) &#123;</span><br><span class="line">            size[nd] += size[lc], datSum[nd] += datSum[lc];</span><br><span class="line">            mnL[nd] = min(mnL[nd], mnL[lc]), mxR[nd] = max(mxR[nd], mxR[lc]);</span><br><span class="line">            mnD[nd] = min(mnD[nd], mnD[lc]), mxU[nd] = max(mxU[nd], mxU[lc]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (rc) &#123;</span><br><span class="line">            size[nd] += size[rc], datSum[nd] += datSum[rc];</span><br><span class="line">            mnL[nd] = min(mnL[nd], mnL[rc]), mxR[nd] = max(mxR[nd], mxR[rc]);</span><br><span class="line">            mnD[nd] = min(mnD[nd], mnD[rc]), mxU[nd] = max(mxU[nd], mxU[rc]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (L &gt; R) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">double</span> avx = <span class="number">0</span>, avy = <span class="number">0</span>, x = <span class="number">0</span>, y = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = L; i &lt;= R; ++i) avx += A[g[i]].x, avy += A[g[i]].y;</span><br><span class="line">        avx /= (R - L + <span class="number">1.0</span>), avy /= (R - L + <span class="number">1.0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = L; i &lt;= R; ++i) &#123;</span><br><span class="line">            x += (A[g[i]].x - avx) * (A[g[i]].x - avx);</span><br><span class="line">            y += (A[g[i]].y - avy) * (A[g[i]].y - avy);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (x &gt; y)</span><br><span class="line">            nth_element(g+L, g+Mid, g+R+<span class="number">1</span>, cmp1), d[g[Mid]] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            nth_element(g+L, g+Mid, g+R+<span class="number">1</span>, cmp2), d[g[Mid]] = <span class="number">2</span>;</span><br><span class="line">        ch[<span class="number">0</span>][g[Mid]] = build(L, Mid<span class="number">-1</span>), ch[<span class="number">1</span>][g[Mid]] = build(Mid+<span class="number">1</span>, R);</span><br><span class="line">        <span class="keyword">return</span> maintain(g[Mid]), g[Mid];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> nd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!nd) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (ch[<span class="number">0</span>][nd]) dfs(ch[<span class="number">0</span>][nd]);</span><br><span class="line">        g[++t] = nd;</span><br><span class="line">        <span class="keyword">if</span> (ch[<span class="number">1</span>][nd]) dfs(ch[<span class="number">1</span>][nd]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rebuild</span><span class="params">(<span class="keyword">int</span>&amp; nd)</span> </span>&#123;</span><br><span class="line">        t = <span class="number">0</span>, dfs(nd), nd = build(<span class="number">1</span>, t);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">canrb</span><span class="params">(<span class="keyword">int</span> nd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> alpha * size[nd] &lt;= max(size[ch[<span class="number">0</span>][nd]], size[ch[<span class="number">1</span>][nd]]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Ins</span><span class="params">(<span class="keyword">int</span>&amp; nd, <span class="keyword">const</span> <span class="keyword">int</span>&amp; pos)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!nd) &#123; nd = pos, maintain(nd); <span class="keyword">return</span>; &#125;</span><br><span class="line">        <span class="keyword">if</span> (d[nd] == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (A[pos].x &lt;= A[nd].x) Ins(ch[<span class="number">0</span>][nd], pos);</span><br><span class="line">            <span class="keyword">else</span> Ins(ch[<span class="number">1</span>][nd], pos);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (A[pos].y &lt;= A[nd].y) Ins(ch[<span class="number">0</span>][nd], pos);</span><br><span class="line">            <span class="keyword">else</span> Ins(ch[<span class="number">1</span>][nd], pos);</span><br><span class="line">        &#125;</span><br><span class="line">        maintain(nd);</span><br><span class="line">        <span class="keyword">if</span> (canrb(nd)) rebuild(nd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Qry</span><span class="params">(<span class="keyword">int</span> nd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!nd || x1 &gt; mxR[nd] || x2 &lt; mnL[nd] || y1 &gt; mxU[nd] || y2 &lt; mnD[nd])</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (x1 &lt;= mnL[nd] &amp;&amp; mxR[nd] &lt;= x2 &amp;&amp; y1 &lt;= mnD[nd] &amp;&amp; mxU[nd] &lt;= y2)</span><br><span class="line">            <span class="keyword">return</span> datSum[nd];</span><br><span class="line">        <span class="keyword">if</span> (x1 &lt;= A[nd].x &amp;&amp; A[nd].x &lt;= x2 &amp;&amp; y1 &lt;= A[nd].y &amp;&amp; A[nd].y &lt;= y2)</span><br><span class="line">            <span class="keyword">return</span> Qry(ch[<span class="number">0</span>][nd]) + Qry(ch[<span class="number">1</span>][nd]) + A[nd].val;</span><br><span class="line">        <span class="keyword">return</span> Qry(ch[<span class="number">0</span>][nd]) + Qry(ch[<span class="number">1</span>][nd]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"11.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    read(n);</span><br><span class="line">    <span class="keyword">int</span> opt, val, lastans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (read(opt), opt != <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (opt == <span class="number">1</span>) &#123;</span><br><span class="line">            read(x1), read(y1), read(val);</span><br><span class="line">            x1 ^= lastans, y1 ^= lastans, val ^= lastans;</span><br><span class="line">            A[++nidx] = (Point)&#123; x1, y1, val &#125;;</span><br><span class="line">            KDT::Ins(root, nidx);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (opt == <span class="number">2</span>) &#123;</span><br><span class="line">            read(x1), read(y1), read(x2), read(y2);</span><br><span class="line">            x1 ^= lastans, y1 ^= lastans, x2 ^= lastans, y2 ^= lastans;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, lastans = KDT::Qry(root));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h4 id="Luogu-P5471-NOI2019-å¼¹è·³"><a href="#Luogu-P5471-NOI2019-å¼¹è·³" class="headerlink" title="Luogu P5471 [NOI2019] å¼¹è·³"></a>Luogu P5471 [NOI2019] å¼¹è·³</h4><ul><li>é¢˜ç›®é“¾æ¥: <a href="https://www.luogu.com.cn/problem/P5471" target="_blank" rel="noopener">https://www.luogu.com.cn/problem/P5471</a></li></ul><p><em>å¦‚æœç›´æ¥ç”¨ K-D Tree å»ºå›¾, <del>å¦‚æœç”¨å››åˆ†æ ‘ç”šè‡³å¯ä»¥ AC</del>, å¯ä»¥æ”¶è· 88 pts çš„å¥½æˆç»©</em></p><p><em>å¡å¡å¸¸å¯ä»¥å¡è¿‡? ä¸ºä»€ä¹ˆä¸å°è¯•æ›´å¿«çš„åšæ³•å‘¢â€¦</em></p><p>é‚£ä¹ˆæ€ä¹ˆåšå‘¢? è€ƒè™‘æ¨¡æ‹Ÿ Dijkstra çš„è¿‡ç¨‹, æŠŠè¿™ä¸ª K-D Tree å½“æˆå †ä½¿ç”¨, è®°å½•å­æ ‘å†…æœ€å°è·¯å¾„é•¿åº¦ (ç”¨äºæ›´æ–°ç­”æ¡ˆ), ä»¥åŠæœ€å¤§è·¯å¾„é•¿åº¦ (ç”¨äºå‰ªæ).</p><p>å…·ä½“åœ°è¯´, å› ä¸ºæ¯ä¸ªç‚¹çš„æœ€çŸ­è·ç¦»åªä¼šè¢«æ›´æ–°ä¸€æ¬¡, æ‰€ä»¥ K-D Tree è¦ç»´æŠ¤</p><ol><li>å½“å‰å­æ ‘è¦†ç›–çŸ©é˜µèŒƒå›´</li><li>å½“å‰èŠ‚ç‚¹åˆ°èµ·ç‚¹çš„æœ€çŸ­è·¯, è§†ä½œå½“å‰ç‚¹çš„æƒå€¼</li><li>å­æ ‘å†…æœ€å°æƒå€¼, ç”¨äºæŸ¥æ‰¾èŠ‚ç‚¹åŠæ›´æ–°ç­”æ¡ˆ</li><li>å½“å‰èŠ‚ç‚¹æ˜¯å¦è¢«æ›´æ–°è¿‡, æ¢è¨€ä¹‹, åœ¨ Dijkstra ç»´æŠ¤çš„ç‚¹é›†ä¸­æ˜¯å¦è¢«åˆ å»</li></ol><p>å¦å¤–æœ‰ä¸€ä¸ªå‰ªæ: ç»´æŠ¤ä¸€ä¸ªå­æ ‘å†…æœ€å¤§æƒå€¼, è¿™æ ·åœ¨ä¿®æ”¹å€¼ (ä¹Ÿå°±æ˜¯ä¸€ä¸ªçŸ©é˜µå†…æ›´æ–°æœ€å°å€¼) çš„æ—¶å€™é‡åˆ° â€œæœ€å¤§å€¼æ¯”ä¿®æ”¹å€¼è¿˜è¦å°â€ çš„æƒ…å†µå°±å¯ä»¥å‰ªæ.</p><p>è¿˜æœ‰ä¸€äº›ç»†èŠ‚, åœ¨ä¿®æ”¹æ•´å—çŸ©é˜µçš„æ—¶å€™æ‰“ä¸€ä¸ªç±»ä¼¼äºçº¿æ®µæ ‘çš„æ ‡è®°, ä»¥åŠå¯¹äºå·²åˆ é™¤èŠ‚ç‚¹å€¼çš„æƒ…å†µè¦æ³¨æ„åˆ†ç±»è®¨è®º.</p><p><strong>ä»£ç å®ç°</strong></p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Luogu P5471</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">7e4</span>+<span class="number">5</span>, MAXM = <span class="number">15e4</span>, MAXD = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> x[MAXD], idx;</span><br><span class="line">    <span class="keyword">int</span>&amp; <span class="keyword">operator</span>[] (<span class="keyword">const</span> <span class="keyword">int</span>&amp; i) &#123; <span class="keyword">return</span> x[i]; &#125;</span><br><span class="line">&#125; A[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, W, H;</span><br><span class="line"><span class="keyword">int</span> pos[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> KDT &#123;</span><br><span class="line">    <span class="keyword">int</span> ch[<span class="number">2</span>][MAXN], mn[MAXD][MAXN], mx[MAXD][MAXN];</span><br><span class="line">    <span class="keyword">bool</span> vis[MAXN];</span><br><span class="line">    <span class="keyword">int</span> tag[MAXN], datMin[MAXN], datMax[MAXN], datVal[MAXN];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">maintain</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; nd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">int</span> &amp;lc = ch[<span class="number">0</span>][nd], &amp;rc = ch[<span class="number">1</span>][nd];</span><br><span class="line">        <span class="keyword">if</span> (vis[nd]) &#123;</span><br><span class="line">            datMin[nd] = INF, datMax[nd] = -INF;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> d = <span class="number">0</span>; d &lt; MAXD; ++d) mn[d][nd] = INF, mx[d][nd] = -INF;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            datMin[nd] = datMax[nd] = datVal[nd];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> d = <span class="number">0</span>; d &lt; MAXD; ++d) mn[d][nd] = mx[d][nd] = A[nd][d];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (lc) &#123;</span><br><span class="line">            datMin[nd] = min(datMin[nd], datMin[lc]);</span><br><span class="line">            datMax[nd] = max(datMax[nd], datMax[lc]);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> d = <span class="number">0</span>; d &lt; MAXD; ++d) &#123;</span><br><span class="line">                mn[d][nd] = min(mn[d][nd], mn[d][lc]);</span><br><span class="line">                mx[d][nd] = max(mx[d][nd], mx[d][lc]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (rc) &#123;</span><br><span class="line">            datMin[nd] = min(datMin[nd], datMin[rc]);</span><br><span class="line">            datMax[nd] = max(datMax[nd], datMax[rc]);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> d = <span class="number">0</span>; d &lt; MAXD; ++d) &#123;</span><br><span class="line">                mn[d][nd] = min(mn[d][nd], mn[d][rc]);</span><br><span class="line">                mx[d][nd] = max(mx[d][nd], mx[d][rc]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushTag</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; nd, <span class="keyword">const</span> <span class="keyword">int</span>&amp; val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (val &gt;= datMax[nd] || val &gt;= tag[nd]) <span class="keyword">return</span>;</span><br><span class="line">        datMax[nd] = tag[nd] = val;</span><br><span class="line">        datMin[nd] = min(datMin[nd], val);</span><br><span class="line">        <span class="keyword">if</span> (!vis[nd]) datVal[nd] = min(datVal[nd], val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> nd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!nd || tag[nd] == INF) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">int</span> &amp;lc = ch[<span class="number">0</span>][nd], &amp;rc = ch[<span class="number">1</span>][nd];</span><br><span class="line">        <span class="keyword">if</span> (lc) pushTag(lc, tag[nd]);</span><br><span class="line">        <span class="keyword">if</span> (rc) pushTag(rc, tag[nd]);</span><br><span class="line">        tag[nd] = INF;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">cmp0</span><span class="params">(<span class="keyword">const</span> Point&amp; a, <span class="keyword">const</span> Point&amp; b)</span> </span>&#123; <span class="keyword">return</span> a.x[<span class="number">0</span>] &lt; b.x[<span class="number">0</span>]; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">cmp1</span><span class="params">(<span class="keyword">const</span> Point&amp; a, <span class="keyword">const</span> Point&amp; b)</span> </span>&#123; <span class="keyword">return</span> a.x[<span class="number">1</span>] &lt; b.x[<span class="number">1</span>]; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (L &gt; R) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">double</span> avx = <span class="number">0</span>, avy = <span class="number">0</span>, x = <span class="number">0</span>, y = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = L; i &lt;= R; ++i) avx += A[i][<span class="number">0</span>], avy += A[i][<span class="number">1</span>];</span><br><span class="line">        avx /= (R - L + <span class="number">1.0</span>), avy /= (R - L + <span class="number">1.0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = L; i &lt;= R; ++i) &#123;</span><br><span class="line">            x += (avx - A[i][<span class="number">0</span>]) * (avx - A[i][<span class="number">0</span>]);</span><br><span class="line">            y += (avy - A[i][<span class="number">1</span>]) * (avy - A[i][<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (x &gt; y) nth_element(A + L, A + Mid, A + R + <span class="number">1</span>, cmp0);</span><br><span class="line">        <span class="keyword">else</span> nth_element(A + L, A + Mid, A + R + <span class="number">1</span>, cmp1);</span><br><span class="line">        pos[Mid] = A[Mid].idx;</span><br><span class="line">        tag[Mid] = INF, datVal[Mid] = (pos[Mid] == <span class="number">1</span>)? <span class="number">0</span>: INF;</span><br><span class="line">        ch[<span class="number">0</span>][Mid] = build(L, Mid<span class="number">-1</span>), ch[<span class="number">1</span>][Mid] = build(Mid+<span class="number">1</span>, R);</span><br><span class="line">        <span class="keyword">return</span> maintain(Mid), Mid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">const</span> <span class="keyword">int</span>&amp; val,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">const</span> <span class="keyword">int</span>&amp; L, <span class="keyword">const</span> <span class="keyword">int</span>&amp; R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; D, <span class="keyword">const</span> <span class="keyword">int</span>&amp; U)</span> </span>&#123;</span><br><span class="line">        pushdown(nd);</span><br><span class="line">        <span class="keyword">if</span> (datMax[nd] &lt;= val) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (L &gt; mx[<span class="number">0</span>][nd] || R &lt; mn[<span class="number">0</span>][nd] || D &gt; mx[<span class="number">1</span>][nd] || U &lt; mn[<span class="number">1</span>][nd]) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (L &lt;= mn[<span class="number">0</span>][nd] &amp;&amp; mx[<span class="number">0</span>][nd] &lt;= R &amp;&amp; D &lt;= mn[<span class="number">1</span>][nd] &amp;&amp; mx[<span class="number">1</span>][nd] &lt;= U)</span><br><span class="line">            <span class="keyword">return</span> pushTag(nd, val);</span><br><span class="line">        <span class="keyword">if</span> (!vis[nd] &amp;&amp; L &lt;= A[nd][<span class="number">0</span>] &amp;&amp; A[nd][<span class="number">0</span>] &lt;= R &amp;&amp; D &lt;= A[nd][<span class="number">1</span>] &amp;&amp; A[nd][<span class="number">1</span>] &lt;= U)</span><br><span class="line">            datVal[nd] = min(datVal[nd], val);</span><br><span class="line">        <span class="keyword">if</span> (ch[<span class="number">0</span>][nd]) Mdy(ch[<span class="number">0</span>][nd], val, L, R, D, U);</span><br><span class="line">        <span class="keyword">if</span> (ch[<span class="number">1</span>][nd]) Mdy(ch[<span class="number">1</span>][nd], val, L, R, D, U);</span><br><span class="line">        maintain(nd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Qry</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">const</span> <span class="keyword">int</span>&amp; val)</span> </span>&#123;</span><br><span class="line">        pushdown(nd);</span><br><span class="line">        <span class="keyword">if</span> (!vis[nd] &amp;&amp; datVal[nd] == val) &#123;</span><br><span class="line">            vis[nd] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">return</span> maintain(nd), nd;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ch[<span class="number">0</span>][nd] &amp;&amp; datMin[ch[<span class="number">0</span>][nd]] == val) &#123;</span><br><span class="line">            <span class="keyword">int</span> ret = Qry(ch[<span class="number">0</span>][nd], val);</span><br><span class="line">            <span class="keyword">return</span> maintain(nd), ret;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> ret = Qry(ch[<span class="number">1</span>][nd], val);</span><br><span class="line">            <span class="keyword">return</span> maintain(nd), ret;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Graph &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> L, R, D, U, w; &#125;; </span><br><span class="line">    <span class="built_in">vector</span>&lt;Edge&gt; G[MAXN];</span><br><span class="line">    <span class="keyword">int</span> dist[MAXN];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">int</span> D, <span class="keyword">int</span> U, <span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">        G[from].push_back((Edge)&#123; L, R, D, U, w &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Dijkstra</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> root = KDT::build(<span class="number">1</span>, n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">int</span> nd = KDT::Qry(root, KDT::datMin[root]);</span><br><span class="line">            <span class="keyword">int</span> u = pos[nd];</span><br><span class="line">            dist[u] = KDT::datVal[nd];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">size_t</span> k = <span class="number">0</span>; k &lt; G[u].size(); ++k) &#123;</span><br><span class="line">                <span class="keyword">const</span> Edge&amp; e = G[u][k];</span><br><span class="line">                KDT::Mdy(root, dist[u] + e.w, e.L, e.R, e.D, e.U);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, dist[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n), read(m), read(W), read(H);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        A[i].idx = i, read(A[i][<span class="number">0</span>]), read(A[i][<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> p, w, L, R, D, U;</span><br><span class="line">        read(p), read(w), read(L), read(R), read(D), read(U);</span><br><span class="line">        Graph::AddEdge(p, L, R, D, U, w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    Graph::Dijkstra();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="æ ‘å¥—æ ‘"><a href="#æ ‘å¥—æ ‘" class="headerlink" title="æ ‘å¥—æ ‘"></a>æ ‘å¥—æ ‘</h3><p>å­—é¢æ„æ€, åµŒå¥—æ•°æ®ç»“æ„.</p><p>å¸¦æœ‰å·¨å¤§å¸¸æ•°, å ç”¨å¤§é‡ç©ºé—´.</p><h4 id="Luogu-P3380ã€æ¨¡æ¿ã€‘äºŒé€¼å¹³è¡¡æ ‘ï¼ˆæ ‘å¥—æ ‘ï¼‰"><a href="#Luogu-P3380ã€æ¨¡æ¿ã€‘äºŒé€¼å¹³è¡¡æ ‘ï¼ˆæ ‘å¥—æ ‘ï¼‰" class="headerlink" title="Luogu P3380ã€æ¨¡æ¿ã€‘äºŒé€¼å¹³è¡¡æ ‘ï¼ˆæ ‘å¥—æ ‘ï¼‰"></a>Luogu P3380ã€æ¨¡æ¿ã€‘äºŒé€¼å¹³è¡¡æ ‘ï¼ˆæ ‘å¥—æ ‘ï¼‰</h4><ul><li>é¢˜ç›®é“¾æ¥: <a href="https://www.luogu.com.cn/problem/P3380" target="_blank" rel="noopener">https://www.luogu.com.cn/problem/P3380</a></li></ul><p>é‡‡ç”¨çº¿æ®µæ ‘å¥—å¹³è¡¡æ ‘çš„æ–¹æ³•, ä¸ºäº†å¥½äº›ä¸€äº›, å†…å±‚å¹³è¡¡æ ‘æˆ‘é€‰æ‹©äº† æ— æ—‹ Treap.</p><ol><li><p>$k$ åœ¨åŒºé—´å†…çš„æ’å</p><p>æŠŠåŒºé—´ä¸¢åˆ°çº¿æ®µæ ‘ä¸Šå¤„ç†, æŠŠåŒºé—´æ‹†åˆ†åå¾—åˆ°çš„æ’åç›¸åŠ å³å¯. å•æ¬¡æ“ä½œæ—¶é—´å¤æ‚åº¦ $O(\log^2 n)$</p><p>æ³¨æ„ä¸€äº›ç»†èŠ‚: æ•°å€¼ $k$ å¯èƒ½åœ¨åŒºé—´å†…çš„è´¡çŒ®å¯èƒ½è¢«è®¡ç®—å¤šæ¬¡, æ‰€ä»¥æ¯æ¬¡æŸ¥è¯¢å†…å±‚å¹³è¡¡æ ‘æ—¶æŠŠå¾—åˆ°çš„æ’å $-1$, æœ€åå¾—å‡ºç­”æ¡ˆæ—¶å†æŠŠè‡ªå·±åŠ ä¸Š.</p></li><li><p>æŸ¥è¯¢åŒºé—´å†…æ’åä¸º $k$ çš„å€¼</p><p>è¿™ä¸ªé—®é¢˜åœ¨æ™®é€šçš„å¹³è¡¡æ ‘ä¸Šå¯ä»¥é€šè¿‡äºŒåˆ†è§£å†³, ä½†æ˜¯åœ¨å¤šæ£µå¹³è¡¡æ ‘çš„æƒ…å†µä¸‹è¿›è¡ŒäºŒåˆ†å¥½åƒå¾ˆå›°éš¾â€¦</p><p>æ‰€ä»¥ç›´æ¥é‡‡ç”¨äºŒåˆ†å€¼åŸŸçš„æ–¹å¼, åˆ¤æ–­å½“å‰äºŒåˆ†çš„å€¼æ˜¯å¦åœ¨åŒºé—´å†…æ’åä¸º $k$, å•æ¬¡æ“ä½œæ—¶é—´å¤æ‚åº¦ $O(\log ^3 n)$.</p><p>(å¥½åƒåœ¨å¤šä¸ª Trie ä¸ŠäºŒåˆ†å¾ˆå¯åš, æˆ–è€…ç”¨æ ‘çŠ¶æ•°ç»„å¥— Trie æ¥ç»´æŠ¤, å¯ä»¥åšåˆ° $O(\log ^2 n)$, è¿˜æ²¡å†™è¿‡, å€¼å¾—å°è¯•)</p></li><li><p>ä¿®æ”¹æŸä¸€ä½å€¼ä¸Šçš„æ•°å€¼</p><p>åœ¨çº¿æ®µæ ‘ä¸Šè·‘ä¸€éå•ç‚¹ä¿®æ”¹çš„æ“ä½œ, æ²¿é€”æŠŠåŸæ¥çš„å€¼åˆ é™¤, å†æŠŠä¿®æ”¹çš„å€¼åŠ å…¥å°±å¥½äº†. æ—¶é—´å¤æ‚åº¦ $O(\log^2 n)$.</p></li><li><p>æŸ¥è¯¢ $k$ åœ¨åŒºé—´å†…çš„å‰é©±</p></li><li><p>æŸ¥è¯¢ $k$ åœ¨åŒºé—´å†…çš„åç»§</p><p>ä¹Ÿæ˜¯æŠŠåŒºé—´ä¸¢åˆ°çº¿æ®µæ ‘ä¸Š, æ³¨æ„æŠŠå‰é©±å– $\max$, åç¼€å– $\min$. æ—¶é—´å¤æ‚åº¦ $O(\log^2 n)$</p></li></ol><p><strong>ä»£ç å®ç°</strong></p><p>åªæœ‰é  O2 æ‰å‹‰å¼ºç»­å‘½çš„æ ·å­.</p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Luogu P3380</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;climits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">5e4</span>+<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="keyword">int</span> A[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Treap &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXN = ::MAXN &lt;&lt; <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">int</span> ch[<span class="number">2</span>][MAXN], size[MAXN], rnd[MAXN], val[MAXN], nidx;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">maintain</span><span class="params">(<span class="keyword">int</span> nd)</span> </span>&#123;</span><br><span class="line">        size[nd] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (ch[<span class="number">0</span>][nd]) size[nd] += size[ch[<span class="number">0</span>][nd]];</span><br><span class="line">        <span class="keyword">if</span> (ch[<span class="number">1</span>][nd]) size[nd] += size[ch[<span class="number">1</span>][nd]];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> val[++nidx] = v, size[nidx] = <span class="number">1</span>, rnd[nidx] = rand(), nidx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">split</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">const</span> <span class="keyword">int</span>&amp; k, <span class="keyword">int</span>&amp; x, <span class="keyword">int</span>&amp; y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!nd) <span class="keyword">return</span> <span class="keyword">void</span>( x = y = <span class="number">0</span> );</span><br><span class="line">        <span class="keyword">if</span> (val[nd] &lt;= k) x = nd, split(ch[<span class="number">1</span>][nd], k, ch[<span class="number">1</span>][nd], y);</span><br><span class="line">        <span class="keyword">else</span> y = nd, split(ch[<span class="number">0</span>][nd], k, x, ch[<span class="number">0</span>][nd]);</span><br><span class="line">        maintain(nd);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!x || !y) <span class="keyword">return</span> x + y;</span><br><span class="line">        <span class="keyword">if</span> (rnd[x] &lt; rnd[y]) <span class="keyword">return</span> ch[<span class="number">1</span>][x] = merge(ch[<span class="number">1</span>][x], y), maintain(x), x;</span><br><span class="line">        <span class="keyword">return</span> ch[<span class="number">0</span>][y] = merge(x, ch[<span class="number">0</span>][y]), maintain(y), y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span>&amp; root, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> x, y; x = y = <span class="number">0</span>;</span><br><span class="line">        split(root, v, x, y), root = merge(merge(x, newnode(v)), y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">int</span>&amp; root, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> x, y, z; x = y = z = <span class="number">0</span>;</span><br><span class="line">        split(root, v, x, z), split(x, v<span class="number">-1</span>, x, y);</span><br><span class="line">        y = merge(ch[<span class="number">0</span>][y], ch[<span class="number">1</span>][y]), root = merge(merge(x, y), z);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Rnk</span><span class="params">(<span class="keyword">int</span>&amp; root, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> x, y, ret; x = y = ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> split(root, v<span class="number">-1</span>, x, y), ret = size[x] + <span class="number">1</span>, root = merge(x, y), ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Kth</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (nd) &#123;</span><br><span class="line">            <span class="keyword">int</span> t = ch[<span class="number">0</span>][nd]? size[ch[<span class="number">0</span>][nd]] + <span class="number">1</span>: <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (k == t) <span class="keyword">return</span> nd;</span><br><span class="line">            <span class="keyword">if</span> (k &gt; t) k -= t, nd = ch[<span class="number">1</span>][nd];</span><br><span class="line">            <span class="keyword">else</span> nd = ch[<span class="number">0</span>][nd];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">abort</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Pre</span><span class="params">(<span class="keyword">int</span>&amp; root, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> x, y, ret; x = y = ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> split(root, v<span class="number">-1</span>, x, y), ret = x? val[Kth(x, size[x])]: -INT_MAX, root = merge(x, y), ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Suf</span><span class="params">(<span class="keyword">int</span>&amp; root, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> x, y, ret; x = y = ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> split(root, v, x, y), ret = y? val[Kth(y, <span class="number">1</span>)]: INT_MAX, root = merge(x, y), ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ch[<span class="number">0</span>][u]) dfs(ch[<span class="number">0</span>][u]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d "</span>, val[u]);</span><br><span class="line">        <span class="keyword">if</span> (ch[<span class="number">1</span>][u]) dfs(ch[<span class="number">1</span>][u]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SGT &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lc (nd&lt;&lt;1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rc (nd&lt;&lt;1|1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Mid ((L + R) / 2)</span></span><br><span class="line">    <span class="keyword">int</span> rt[MAXN &lt;&lt; <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = L; i &lt;= R; ++i) Treap::insert(rt[nd], A[i]);</span><br><span class="line">        <span class="keyword">if</span> (L == R) <span class="keyword">return</span>;</span><br><span class="line">        build(lc, L, Mid), build(rc, Mid+<span class="number">1</span>, R);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; pos, <span class="keyword">const</span> <span class="keyword">int</span>&amp; val)</span> </span>&#123;</span><br><span class="line">        Treap::remove(rt[nd], A[pos]), Treap::insert(rt[nd], val);</span><br><span class="line">        <span class="keyword">if</span> (L == R) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (pos &lt;= Mid) Mdy(lc, L, Mid, pos, val);</span><br><span class="line">        <span class="keyword">else</span> Mdy(rc, Mid+<span class="number">1</span>, R, pos, val);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Rnk</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opL, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opR, <span class="keyword">const</span> <span class="keyword">int</span>&amp; val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (opL &lt;= L &amp;&amp; R &lt;= opR) <span class="keyword">return</span> Treap::Rnk(rt[nd], val) - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (opR &lt;= Mid) <span class="keyword">return</span> Rnk(lc, L, Mid, opL, opR, val);</span><br><span class="line">        <span class="keyword">if</span> (opL &gt; Mid) <span class="keyword">return</span> Rnk(rc, Mid+<span class="number">1</span>, R, opL, opR, val);</span><br><span class="line">        <span class="keyword">return</span> Rnk(lc, L, Mid, opL, opR, val) + Rnk(rc, Mid+<span class="number">1</span>, R, opL, opR, val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Kth</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; opL, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opR, <span class="keyword">const</span> <span class="keyword">int</span>&amp; k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> L = <span class="number">0</span>, R = <span class="number">1e8</span>, ret = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">while</span> (L &lt;= R) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Rnk(<span class="number">1</span>, <span class="number">1</span>, n, opL, opR, Mid) + <span class="number">1</span> &lt;= k) ret = Mid, L = Mid + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> R = Mid - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Pre</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opL, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opR, <span class="keyword">const</span> <span class="keyword">int</span>&amp; val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (opL &lt;= L &amp;&amp; R &lt;= opR) <span class="keyword">return</span> Treap::Pre(rt[nd], val);</span><br><span class="line">        <span class="keyword">if</span> (opR &lt;= Mid) <span class="keyword">return</span> Pre(lc, L, Mid, opL, opR, val);</span><br><span class="line">        <span class="keyword">if</span> (opL &gt; Mid) <span class="keyword">return</span> Pre(rc, Mid+<span class="number">1</span>, R, opL, opR, val);</span><br><span class="line">        <span class="keyword">return</span> max(Pre(lc, L, Mid, opL, opR, val), Pre(rc, Mid+<span class="number">1</span>, R, opL, opR, val));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Suf</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opL, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opR, <span class="keyword">const</span> <span class="keyword">int</span>&amp; val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (opL &lt;= L &amp;&amp; R &lt;= opR) <span class="keyword">return</span> Treap::Suf(rt[nd], val);</span><br><span class="line">        <span class="keyword">if</span> (opR &lt;= Mid) <span class="keyword">return</span> Suf(lc, L, Mid, opL, opR, val);</span><br><span class="line">        <span class="keyword">if</span> (opL &gt; Mid) <span class="keyword">return</span> Suf(rc, Mid+<span class="number">1</span>, R, opL, opR, val);</span><br><span class="line">        <span class="keyword">return</span> min(Suf(lc, L, Mid, opL, opR, val), Suf(rc, Mid+<span class="number">1</span>, R, opL, opR, val));</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> lc</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> rc</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> Mid</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    srand( time(<span class="literal">nullptr</span>) );</span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n), read(m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) read(A[i]);</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    SGT::build(<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">while</span> (m--) &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> opt, L, R, K;</span><br><span class="line">        read(opt), read(L), read(R); <span class="keyword">if</span> (opt != <span class="number">3</span>) read(K);</span><br><span class="line">        <span class="keyword">switch</span> (opt) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>: <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, SGT::Rnk(<span class="number">1</span>, <span class="number">1</span>, n, L, R, K) + <span class="number">1</span>); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>: <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, SGT::Kth(L, R, K)); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>: SGT::Mdy(<span class="number">1</span>, <span class="number">1</span>, n, L, R), A[L] = R; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>: <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, SGT::Pre(<span class="number">1</span>, <span class="number">1</span>, n, L, R, K)); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">5</span>: <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, SGT::Suf(<span class="number">1</span>, <span class="number">1</span>, n, L, R, K)); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>: <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"ERR\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h4 id="Luogu-P3332-ZJOI2013-K-å¤§æ•°æŸ¥è¯¢"><a href="#Luogu-P3332-ZJOI2013-K-å¤§æ•°æŸ¥è¯¢" class="headerlink" title="Luogu P3332 [ZJOI2013] K å¤§æ•°æŸ¥è¯¢"></a>Luogu P3332 [ZJOI2013] K å¤§æ•°æŸ¥è¯¢</h4><ul><li>é¢˜ç›®é“¾æ¥: <a href="https://www.luogu.com.cn/problem/P3332" target="_blank" rel="noopener">https://www.luogu.com.cn/problem/P3332</a></li></ul><p>å¤§æ¦‚æ˜¯æƒå€¼çº¿æ®µæ ‘å¥—æ™®é€šçº¿æ®µæ ‘ ?</p><p><del>è¯è¯´è¿™ç§ç›´æ¥ç»™å‡ºæ“ä½œçš„æ•°æ®ç»“æ„åº”è¯¥æ˜¯å‡ å¹´å‰çš„ç”»é£å§ ?</del></p><p>é¦–å…ˆå¯¹é¢˜æ„è¿›è¡Œè½¬åŒ–, å°†åŠ å…¥çš„å…ƒç´ çœ‹ä½œä¸€ä¸ªå¸¦æœ‰ä¸¤ç§å±æ€§çš„å…ƒç´ , é‚£ä¹ˆæ“ä½œ 1 å°±æ˜¯åŠ å…¥ $(l, c),\ (l+1, c),\ \ldots, (r, c)$ è¿™äº›ç‚¹, æ“ä½œ 2 å°±æ˜¯æŸ¥è¯¢ç¬¬ä¸€ä¸ªå±æ€§ $a$ æ»¡è¶³ $l \le a \le r$ çš„ç‚¹é›†ä¸­ç¬¬ $k$ å¤§.</p><p>äºæ˜¯å°±å¯ä»¥å¾ˆè‡ªç„¶åœ°è”æƒ³åˆ°æ ‘å¥—æ ‘äº†. ä½†æ˜¯åŒºé—´åŠ å…¥ä¸€ä¸ªæ•°çš„æ“ä½œä¸å¥½å®ç°, æ‰€ä»¥å°±æœ‰äº†ä¸€ä¸ªæœ´ç´ çš„æƒ³æ³•: åœ¨å¤–å±‚çº¿æ®µæ ‘ä¸Šç»´æŠ¤æƒå€¼, åœ¨å†…å±‚ç»´æŠ¤ä½ç½®.</p><p>ç°åœ¨çš„é—®é¢˜å°±å¾ˆæ˜æœ—äº†:</p><ul><li><p>å¯¹äºæ“ä½œ 1: åœ¨å¤–å±‚çº¿æ®µæ ‘å•ç‚¹æ’å…¥ä¸€ä¸ªå€¼, å¹¶åœ¨è¿™ä¸ªä½ç½®å¯¹åº”çš„çº¿æ®µæ ‘åŒºé—´åŠ  1, è¡¨æ˜è¿™ä¸ªä½ç½®åŠ å…¥å€¼äº†.</p><p>æ³¨æ„åˆ°ä»£ç ä¸­ä½¿ç”¨äº† â€œæ ‡è®°æ°¸ä¹…åŒ–â€ çš„æŠ€å·§, è¿™æ ·ä¼šæ¯”æ¯æ¬¡ä¸‹ä¼ æ ‡è®°è¦å¿«, <del>ä½†æ˜¯æˆ‘è¦å¡å¸¸ä¸ºä»€ä¹ˆä¸ç›´æ¥å†™æ•´ä½“äºŒåˆ†å‘¢?</del></p><p>å•æ¬¡æ“ä½œæ—¶é—´å¤æ‚åº¦ $O(log^2 n)$.</p></li><li><p>å¯¹äºæ“ä½œ 2: åœ¨å¤–å±‚çº¿æ®µæ ‘ä¸ŠäºŒåˆ†, å’Œæ™®é€šæƒå€¼çº¿æ®µæ ‘çš„æ“ä½œæ²¡ä»€ä¹ˆå¤§çš„å·®åˆ«, åªæ˜¯æŸ¥è¯¢å­æ ‘å¤§å°çš„ $O(\log n)$ è€Œå·²â€¦</p><p>å•æ¬¡æ“ä½œæ—¶é—´å¤æ‚åº¦ $O(log^2 n)$.</p></li></ul><p><strong>ä»£ç å®ç°</strong></p><p>æ´»åœ¨ O2, ä»¥åŠè¢«æ•´ä½“äºŒåˆ†åŠæ‰“çš„ç©ºæ°”ä¹‹ä¸‹ = =.</p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Luogu P3332</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">5e4</span>+<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Ask</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> opt, L, R; LL c;</span><br><span class="line">&#125; Q[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line">LL B[MAXN], nB;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> DSGT &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXN = ::MAXN * <span class="number">17</span> * <span class="number">17</span>;</span><br><span class="line">    <span class="keyword">int</span> lc[MAXN], rc[MAXN], nidx;</span><br><span class="line">    LL datSum[MAXN], tagAdd[MAXN];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">calc</span><span class="params">(<span class="keyword">int</span> l1, <span class="keyword">int</span> r1, <span class="keyword">int</span> l2, <span class="keyword">int</span> r2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (max(l1, l2) &gt; min(r1, r2)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> min(r1, r2) - max(l1, l2) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opL, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opR)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ ‡è®°æ°¸ä¹…åŒ–</span></span><br><span class="line">        datSum[nd] += calc(L, R, opL, opR);</span><br><span class="line">        <span class="keyword">if</span> (opL &lt;= L &amp;&amp; R &lt;= opR) <span class="keyword">return</span> <span class="keyword">void</span>( ++tagAdd[nd] );</span><br><span class="line">        <span class="comment">// å†…å±‚çº¿æ®µæ ‘éœ€è¦åŠ¨æ€å¼€ç‚¹, ç©ºé—´å¤æ‚åº¦ O(n log^2 n)</span></span><br><span class="line">        <span class="keyword">if</span> (!lc[nd]) lc[nd] = ++nidx;</span><br><span class="line">        <span class="keyword">if</span> (!rc[nd]) rc[nd] = ++nidx;</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (opL &lt;= Mid) Mdy(lc[nd], L, Mid, opL, opR);</span><br><span class="line">        <span class="keyword">if</span> (opR &gt; Mid) Mdy(rc[nd], Mid+<span class="number">1</span>, R, opL, opR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">LL <span class="title">Qry</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opL, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opR, <span class="keyword">const</span> <span class="keyword">int</span>&amp; tag = <span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ ‡è®°æ°¸ä¹…åŒ–</span></span><br><span class="line">        <span class="keyword">if</span> (opL &lt;= L &amp;&amp; R &lt;= opR) <span class="keyword">return</span> datSum[nd] + tag * (R-L+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>, ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (opL &lt;= Mid) ret += Qry(lc[nd], L, Mid, opL, opR, tag + tagAdd[nd]);</span><br><span class="line">        <span class="keyword">if</span> (opR &gt; Mid) ret += Qry(rc[nd], Mid+<span class="number">1</span>, R, opL, opR, tag + tagAdd[nd]);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SGT &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lc (nd&lt;&lt;1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rc (nd&lt;&lt;1|1)</span></span><br><span class="line">    <span class="keyword">int</span> rt[MAXN &lt;&lt; <span class="number">2</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opL, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opR, <span class="keyword">const</span> <span class="keyword">int</span>&amp; pos)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!rt[nd]) rt[nd] = ++DSGT::nidx;</span><br><span class="line">        DSGT::Mdy(rt[nd], <span class="number">1</span>, n, opL, opR);</span><br><span class="line">        <span class="keyword">if</span> (L == R) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (pos &lt;= Mid) Mdy(lc, L, Mid, opL, opR, pos);</span><br><span class="line">        <span class="keyword">else</span> Mdy(rc, Mid+<span class="number">1</span>, R, opL, opR, pos);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Kth</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opL, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opR, <span class="keyword">const</span> LL&amp; k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (L == R) <span class="keyword">return</span> L;</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        LL d = DSGT::Qry(rt[rc], <span class="number">1</span>, n, opL, opR);</span><br><span class="line">        <span class="keyword">if</span> (k &lt;= d) <span class="keyword">return</span> Kth(rc, Mid+<span class="number">1</span>, R, opL, opR, k);</span><br><span class="line">        <span class="keyword">return</span> Kth(lc, L, Mid, opL, opR, k - d);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> lc</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> rc</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n), read(m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> opt, L, R; <span class="keyword">static</span> LL c;</span><br><span class="line">        read(opt), read(L), read(R), read(c);</span><br><span class="line">        Q[i] = (Ask)&#123; opt, L, R, c &#125;;</span><br><span class="line">        <span class="keyword">if</span> (opt == <span class="number">1</span>) B[++nB] = c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    sort(B+<span class="number">1</span>, B+<span class="number">1</span>+nB);</span><br><span class="line">    nB = unique(B+<span class="number">1</span>, B+<span class="number">1</span>+nB) - B - <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// éœ€è¦ä¸¢åˆ°æƒå€¼çº¿æ®µæ ‘é‡Œ, éšæ‰‹ç¦»æ•£åŒ–</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        <span class="keyword">if</span> (Q[i].opt == <span class="number">1</span>) Q[i].c = lower_bound(B+<span class="number">1</span>, B+<span class="number">1</span>+nB, Q[i].c) - B;</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">const</span> Ask&amp; q = Q[i];</span><br><span class="line">        <span class="keyword">switch</span> (q.opt) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>: SGT::Mdy(<span class="number">1</span>, <span class="number">1</span>, nB, q.L, q.R, q.c); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>: <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, B[SGT::Kth(<span class="number">1</span>, <span class="number">1</span>, nB, q.L, q.R, q.c)]); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>: <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"ERR\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h4 id="Luogu-P3759-TJOI2017-ä¸å‹¤åŠ³çš„å›¾ä¹¦ç®¡ç†å‘˜"><a href="#Luogu-P3759-TJOI2017-ä¸å‹¤åŠ³çš„å›¾ä¹¦ç®¡ç†å‘˜" class="headerlink" title="Luogu P3759 [TJOI2017] ä¸å‹¤åŠ³çš„å›¾ä¹¦ç®¡ç†å‘˜"></a>Luogu P3759 [TJOI2017] ä¸å‹¤åŠ³çš„å›¾ä¹¦ç®¡ç†å‘˜</h4><ul><li>é¢˜ç›®é“¾æ¥: <a href="https://www.luogu.com.cn/problem/P3759" target="_blank" rel="noopener">https://www.luogu.com.cn/problem/P3759</a></li></ul><p>å¸¦æƒåŠ¨æ€é€†åºå¯¹.</p><p><del>é¢˜å¤–è¯: è¿™é¢˜æœ‰ç‚¹é¢˜æ„æ€, ä¸è¿‡æ¨¡æ‹Ÿä¸€éæ ·ä¾‹å°±å¥½äº†</del></p><p>ä»ç„¶ä½¿ç”¨ä¸Šä¸€é¢˜çš„è½¬åŒ–æ€è·¯, é¢˜ç›®æ‰€æ±‚å³ä¸º $n$ ä¸ªå¸¦æœ‰ä¸¤ç§å±æ€§çš„å…ƒç´  $(a_i,\ b_i)$ ä¸­æ»¡è¶³ $a_i &lt; a_j$ ä¸” $b_i &gt; b_j$ çš„å…ƒç´ å¯¹æƒå€¼å’Œ.</p><p>äº¤æ¢ä½ç½®çš„æ“ä½œå¯ä»¥çœ‹ä½œåˆ é™¤ä¸¤ä¸ªå…ƒç´ ååŠ å…¥ä¸¤ä¸ªæ–°å…ƒç´ , æ‰€ä»¥é—®é¢˜çš„å…³é”®åœ¨äºåŠ å…¥ / åˆ é™¤å…ƒç´ å¯¹ç­”æ¡ˆçš„å½±å“.</p><p>æ¯æ¬¡æŸ¥è¯¢ä¸€ä¸ªå…ƒç´  $(a,\ b)$ çš„å½±å“, å¯¹è¿™ä¸ªå…ƒç´ æœ‰è´¡çŒ®çš„, ä¸€å®šæ»¡è¶³:</p><ul><li><p>ç¬¬ä¸€ç»´ $&lt; a$, ç¬¬äºŒç»´ $&gt; b$</p></li><li><p>ç¬¬ä¸€ç»´ $&gt; a$, ç¬¬äºŒç»´ $&lt; b$</p></li></ul><p>ç”±äºè®°å½•ä¿¡æ¯å…·æœ‰å¯å‡æ€§, é‡‡ç”¨æ ‘çŠ¶æ•°ç»„å¥—æƒå€¼çº¿æ®µæ ‘å®ç°.</p><p><strong>ä»£ç å®ç°</strong></p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Luogu P3759</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">5e4</span>+<span class="number">5</span>, P = <span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, ans;</span><br><span class="line"><span class="keyword">int</span> A[MAXN], v[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SGT &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXN = ::MAXN * <span class="number">16</span> * <span class="number">16</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> size, sum;</span><br><span class="line">        Node() &#123; size = sum = <span class="number">0</span>; &#125;</span><br><span class="line">        Node(<span class="keyword">int</span> _s, <span class="keyword">int</span> _v): size(_s), sum(_v) &#123; &#125;</span><br><span class="line">        Node <span class="keyword">operator</span> + (<span class="keyword">const</span> Node&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Node((size + rhs.size) % P, (sum + rhs.sum) % P);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; dat[MAXN];</span><br><span class="line">    <span class="keyword">int</span> lc[MAXN], rc[MAXN], nidx;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; pos, <span class="keyword">const</span> <span class="keyword">int</span>&amp; val, <span class="keyword">const</span> <span class="keyword">int</span>&amp; type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!nd) nd = ++nidx;</span><br><span class="line">        dat[nd].size = (dat[nd].size + <span class="number">1L</span>L * type) % P;</span><br><span class="line">        dat[nd].sum = (dat[nd].sum + <span class="number">1L</span>L * type * val) % P;</span><br><span class="line">        <span class="keyword">if</span> (L == R) <span class="keyword">return</span> nd;</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (pos &lt;= Mid) lc[nd] = Mdy(lc[nd], L, Mid, pos, val, type);</span><br><span class="line">        <span class="keyword">else</span> rc[nd] = Mdy(rc[nd], Mid+<span class="number">1</span>, R, pos, val, type);</span><br><span class="line">        <span class="keyword">return</span> nd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">Node <span class="title">Qry</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opL, <span class="keyword">const</span> <span class="keyword">int</span>&amp; opR)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (opL &lt;= L &amp;&amp; R &lt;= opR) <span class="keyword">return</span> dat[nd];</span><br><span class="line">        <span class="keyword">if</span> (!nd) <span class="keyword">return</span> Node(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (opR &lt;= Mid) <span class="keyword">return</span> Qry(lc[nd], L, Mid, opL, opR);</span><br><span class="line">        <span class="keyword">if</span> (opL &gt; Mid) <span class="keyword">return</span> Qry(rc[nd], Mid+<span class="number">1</span>, R, opL, opR);</span><br><span class="line">        <span class="keyword">return</span> Qry(lc[nd], L, Mid, opL, opR) + Qry(rc[nd], Mid+<span class="number">1</span>, R, opL, opR);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> BIT &#123;</span><br><span class="line">    <span class="keyword">using</span> SGT::Node;</span><br><span class="line">    <span class="keyword">int</span> rt[MAXN];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123; <span class="keyword">return</span> x &amp; -x; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Mdy</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; d1, <span class="keyword">const</span> <span class="keyword">int</span>&amp; d2, <span class="keyword">const</span> <span class="keyword">int</span>&amp; val, <span class="keyword">const</span> <span class="keyword">int</span>&amp; type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = d1; i &lt;= n; i += lowbit(i))</span><br><span class="line">            rt[i] = SGT::Mdy(rt[i], <span class="number">1</span>, n, d2, val, type);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Qry</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; d1, <span class="keyword">const</span> <span class="keyword">int</span>&amp; d2, <span class="keyword">const</span> <span class="keyword">int</span>&amp; val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = d1; i; i -= lowbit(i)) &#123;</span><br><span class="line">            Node tmp = SGT::Qry(rt[i], <span class="number">1</span>, n, d2, n);</span><br><span class="line">            ret = (ret + tmp.sum + <span class="number">1L</span>L * val * tmp.size) % P;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i; i -= lowbit(i)) &#123;</span><br><span class="line">            Node tmp = SGT::Qry(rt[i], <span class="number">1</span>, n, <span class="number">1</span>, d2);</span><br><span class="line">            ret = (ret + tmp.sum + <span class="number">1L</span>L * val * tmp.size) % P;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = d1; i; i -= lowbit(i)) &#123;</span><br><span class="line">            Node tmp = SGT::Qry(rt[i], <span class="number">1</span>, n, <span class="number">1</span>, d2);</span><br><span class="line">            ret = (ret - (tmp.sum + <span class="number">1L</span>L * val * tmp.size) % P + P) % P;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n), read(m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        read(A[i]), read(v[i]);</span><br><span class="line">        ans = (ans + BIT::Qry(i, A[i], v[i])) % P;</span><br><span class="line">        BIT::Mdy(i, A[i], v[i], <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    <span class="keyword">while</span> (m--) &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> L, R;</span><br><span class="line">        read(L), read(R);</span><br><span class="line">        <span class="comment">// remove</span></span><br><span class="line">        ans = (ans - BIT::Qry(L, A[L], v[L]) + P) % P;</span><br><span class="line">        BIT::Mdy(L, A[L], v[L], <span class="number">-1</span>);</span><br><span class="line">        ans = (ans - BIT::Qry(R, A[R], v[R]) + P) % P;</span><br><span class="line">        BIT::Mdy(R, A[R], v[R], <span class="number">-1</span>);</span><br><span class="line">        swap(A[L], A[R]), swap(v[L], v[R]);</span><br><span class="line">        <span class="comment">// add</span></span><br><span class="line">        BIT::Mdy(L, A[L], v[L], <span class="number">1</span>);</span><br><span class="line">        ans = (ans + BIT::Qry(L, A[L], v[L])) % P;</span><br><span class="line">        BIT::Mdy(R, A[R], v[R], <span class="number">1</span>);</span><br><span class="line">        ans = (ans + BIT::Qry(R, A[R], v[R])) % P;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><p>æ•°æ®ç»“æ„è¿˜æ˜¯å­¦ä¸æ˜ç™½å•Š, çœŸæ˜¯æ´»è¯¥é€€å½¹.png</p><p><strong>UPD on 2020.2.27</strong></p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li>nzhtl1477, ç®€å•æ•°æ®ç»“æ„</li><li>__stdcall, <a href="https://www.cnblogs.com/mlystdcall/p/6219421.html" target="_blank" rel="noopener">ç®€æ˜“ CDQ åˆ†æ²»æ•™ç¨‹ &amp; å­¦ä¹ ç¬”è®°</a></li><li>Owen_codeisking, <a href="https://www.luogu.com.cn/blog/Owencodeisking/post-xue-xi-bi-ji-cdq-fen-zhi-hu-zheng-ti-er-fen" target="_blank" rel="noopener">[å­¦ä¹ ç¬”è®°] CDQ åˆ†æ²»å’Œæ•´ä½“äºŒåˆ†</a></li></ol><hr>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;h2 id=&quot;ç»¼è¿°&quot;&gt;&lt;a href=&quot;#ç»¼è¿°&quot; class=&quot;headerlink&quot; title=&quot;ç»¼è¿°&quot;&gt;&lt;/a&gt;ç»¼è¿°&lt;/h2&gt;&lt;p&gt;æ‹œè¯»äº†æ¯’ç˜¤çš„æ•°æ®ç»“æ„è¯¾ä»¶, æ·±å—å¯å‘, &lt;del&gt;ç”šæ˜¯è°”è°”, å½“å³æ„Ÿè§‰è‡ªå·±ä¹‹å‰ä¸€ç›´åœ¨ç©æ³¥å·´&lt;/del&gt;.&lt;/p&gt;
&lt;p&gt;åˆå­¦æ•°æ®ç»“æ„, æ³è¯·æŒ‡æ­£.&lt;/p&gt;
    
    </summary>
    
    
      <category term="ç¬”è®°" scheme="https://depletedprism.github.io/categories/%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Data Structure" scheme="https://depletedprism.github.io/tags/Data-Structure/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŒåäºŒçœè”è€ƒ 2019ã€å­—ç¬¦ä¸²é—®é¢˜ é¢˜è§£</title>
    <link href="https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/oj/luogu-P5284/"/>
    <id>https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/oj/luogu-P5284/</id>
    <published>2020-02-04T14:24:45.000Z</published>
    <updated>2020-02-20T06:00:29.853Z</updated>
    
    <content type="html"><![CDATA[<hr><blockquote><p>è°¨ä»¥æ­¤é¢˜çºªå¿µè‡ªå·±é¢“åºŸçš„, ä»€ä¹ˆéƒ½ä¸ä¼šçš„é«˜ä¸€ (bushi</p></blockquote><ul><li>é¢˜ç›®é“¾æ¥: <a href="https://www.luogu.com.cn/problem/P5284" target="_blank" rel="noopener">https://www.luogu.com.cn/problem/P5284</a></li></ul><p>SAM ä¼˜åŒ–å»ºå›¾ + æ‹“æ‰‘æ’åºæ±‚æœ€é•¿è·¯.</p><p>å†™è¿™é“é¢˜å•Š, åªæ˜¯æ„Ÿåˆ°è‡ªå·±çš„é«˜ä¸€å¾ˆå¯ç¬‘å§, è¿é¢˜æ„éƒ½ä¸å¤§èƒ½è¯»æ¸…, æ­£è§£çš„ç®—æ³•å¬éƒ½æ²¡æœ‰å¬è¿‡, è¾“å‡ºæ ·ä¾‹å°±å¼ƒç–—ç¦»åœº.</p><a id="more"></a><h4 id="é¢˜ç›®æ€è·¯"><a href="#é¢˜ç›®æ€è·¯" class="headerlink" title="é¢˜ç›®æ€è·¯"></a>é¢˜ç›®æ€è·¯</h4><p>è€ƒè™‘ç›®æ ‡ä¸² $T$ çš„æ„é€ è¿‡ç¨‹, å¯ä»¥å‘ç° $A,\ B$ ä¸²å¯ä»¥è§†ä¸ºèŠ‚ç‚¹, æ”¯é…å…³ç³»å’Œå‰ç¼€å¯ä»¥çœ‹ä½œè¾¹, $T$ å°±å¯¹åº”å›¾ä¸­ä¸€æ¡è·¯å¾„, é‚£ä¹ˆæŠŠå›¾å»ºå‡ºæ¥è·‘æœ€é•¿è·¯å°±å¥½äº†.</p><p>å¦å¤–å¯ä»¥å‘ç°, å¦‚æœå›¾ä¸Šå­˜åœ¨ç¯å°±è¯´æ˜å¯ä»¥æ„é€ å‡ºæ— é™é•¿çš„ä¸² $T$, è¾“å‡º <code>-1</code>, å¦åˆ™è¿™å°±æ˜¯ä¸ª DAG, æœ€é•¿è·¯è·‘æ‹“æ‰‘æ’åºå°±å¥½äº†.</p><p>è¿›ä¸€æ­¥è€ƒè™‘å»ºè¾¹</p><ol><li><p>$A_{id_i} \rightarrow B$</p><p>æ”¯é…å…³ç³»æ˜¯é¢˜ç›®ç»™å‡ºçš„, ç›´æ¥æŠŠ $A,\ B$ ä¸²å¯¹åº”èŠ‚ç‚¹è¿èµ·æ¥å°±å¥½äº†.</p></li><li><p>$B_j \rightarrow A_i$, å…¶ä¸­ $B_j$ ä¸º $A_i$ çš„å‰ç¼€</p><p>è¿™é‡Œå°±æœ‰äº›æ„æ€äº†, <del>å¦‚æœç›´æ¥æš´åŠ›å»ºè¾¹å°±å¯ä»¥æ‹¿åˆ° 10 pts çš„å¥½æˆç»©</del></p><p>è€ƒè™‘å‰ç¼€, å°±æ˜¯åä¸²çš„åç¼€, æˆ‘ä»¬å¯ä»¥æƒ³åˆ°å¯¹ $S$ çš„åä¸²å»ºå‡º SAM, æŠŠä¸² $A,\ B$ æ”¾åˆ° SAM ä¸ŠåŒ¹é…, è¿™ä¸€æ­¥å¯ä»¥å¥—è·¯åœ°ç”¨å€å¢è§£å†³. å‡è®¾åŒ¹é…åˆ° SAM ä¸Šçš„èŠ‚ç‚¹ $u$, é‚£ä¹ˆå°±æ–°å»ºä¸€ä¸ªèŠ‚ç‚¹ $v$ è¡¨ç¤ºå½“å‰åŒ¹é…ä¸², ç‚¹æƒä¸ºåŒ¹é…ä¸²é•¿åº¦, å¹¶æŠŠ $v$ æŒ‚åœ¨ $u$ ä¸Š.</p><p>å¯¹äº SAM ä¸Šçš„ä¸€ä¸ªèŠ‚ç‚¹ $u$, <del>ä¸Šé¢æŒ‚è¿™ä¸€å †èŠ‚ç‚¹è¡¨ç¤º A, B ä¸²</del>, æˆ‘ä»¬å°†è¿™äº›èŠ‚ç‚¹ä»¥ç‚¹æƒä¸ºç¬¬ä¸€å…³é”®å­—, æ˜¯å¦ä¸º $B$ ä¸²ä¸ºç¬¬äºŒå…³é”®å­—ä»å°åˆ°å¤§æ’åº, å¹¶æ ¹æ®è¿™ä¸ªé¡ºåºä¾æ¬¡è¿è¾¹.</p><p>å¦å¤–è¿˜éœ€è€ƒè™‘ SAM ä¸ŠèŠ‚ç‚¹ $u$ å’Œåç¼€é“¾æ¥ $\text{lnk}(u)$ çš„å…³ç³», å¯¹äºåä¸²ä¸­çš„å‰ç¼€, å­˜åœ¨ä¸€ä¸ªå‰ç¼€æ˜¯å¦ä¸€å‰ç¼€çš„å‰ç¼€, é‚£ä¹ˆå°±æ˜¯ä» $\text{lnk}(u)$ å‘ $u$ è¿è¾¹äº†. å½“ç„¶, ç”±äºä¸Šä¸€æ­¥çš„è¿è¾¹æ­¤å¤„ $\text{lnk}(u)$ çš„å®é™…èŠ‚ç‚¹ç¨æœ‰ä¸åŒ.</p><p><del>å…·ä½“å®ç°ä»£ç é‡Œå¾ˆæ¸…æ™°, æ­£ç¡®æ€§å¾ˆæ˜¾ç„¶</del></p></li></ol><h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p>ç»†èŠ‚ä¸å¤šçš„é¢˜è¿˜æ˜¯å¥½ç ä¸€ç‚¹çš„.<br><del>è¿™å°±æ˜¯ä½ æŠ„é¢˜è§£è¿˜ WA äº†ä¸€å‘çš„åŸå› äº† ?</del> (</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Luogu P5284</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">2e5</span>+<span class="number">5</span>, LOG = <span class="number">20</span>, MAXV = MAXN &lt;&lt; <span class="number">2</span>, MAXE = MAXN * <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, na, nb, uidx;</span><br><span class="line"><span class="keyword">char</span> S[MAXN];</span><br><span class="line"><span class="keyword">bool</span> isA[MAXV];</span><br><span class="line"><span class="keyword">int</span> Aidx[MAXN], Bidx[MAXN], lst[MAXN &lt;&lt; <span class="number">1</span>], pos[MAXN], pre[LOG][MAXN &lt;&lt; <span class="number">1</span>], len[MAXV];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; G[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> SAM &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXN = ::MAXN &lt;&lt; <span class="number">1</span>, SIGMA = <span class="number">26</span>;</span><br><span class="line">    <span class="keyword">int</span> ch[MAXN][SIGMA], lnk[MAXN], nidx, last;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        last = nidx = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">memset</span>(ch[<span class="number">1</span>], <span class="number">0</span>, <span class="keyword">sizeof</span> ch[<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> l)</span> </span>&#123;</span><br><span class="line">        len[++nidx] = l, lnk[nidx] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(ch[nidx], <span class="number">0</span>, <span class="keyword">sizeof</span> ch[nidx]);</span><br><span class="line">        <span class="keyword">return</span> nidx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> nd = newnode(len[last] + <span class="number">1</span>), p = last;</span><br><span class="line">        <span class="keyword">while</span> (p &amp;&amp; !ch[p][val]) ch[p][val] = nd, p = lnk[p];</span><br><span class="line">        <span class="keyword">if</span> (!p) lnk[nd] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> q = ch[p][val];</span><br><span class="line">            <span class="keyword">if</span> (len[q] == len[p] + <span class="number">1</span>) lnk[nd] = q;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">int</span> nxt = newnode(len[p] + <span class="number">1</span>);</span><br><span class="line">                lnk[nxt] = lnk[q];</span><br><span class="line">                <span class="built_in">memcpy</span>(ch[nxt], ch[q], <span class="keyword">sizeof</span> ch[nxt]);</span><br><span class="line">                <span class="keyword">while</span> (p &amp;&amp; ch[p][val] == q) ch[p][val] = nxt, p = lnk[p];</span><br><span class="line">                lnk[q] = lnk[nd] = nxt;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        last = nd;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Graph &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> nxt, to; &#125; edges[MAXE];</span><br><span class="line">    <span class="keyword">int</span> head[MAXV], eidx, in[MAXV];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(in, <span class="number">0</span>, <span class="keyword">sizeof</span> in);</span><br><span class="line">        <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="keyword">sizeof</span> head), eidx = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to)</span> </span>&#123;</span><br><span class="line">        ++in[to];</span><br><span class="line">        edges[++eidx] = (Edge)&#123; head[from], to &#125;;</span><br><span class="line">        head[from] = eidx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">LL <span class="title">Toposort</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> LL f[MAXV];</span><br><span class="line">        <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; Q;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= uidx; ++i) &#123;</span><br><span class="line">            f[i] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (!in[i]) Q.push(i);</span><br><span class="line">        &#125;</span><br><span class="line">        LL ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!Q.empty()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = Q.front(); Q.pop();</span><br><span class="line">            ans = max(ans, f[u] + len[u]);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; ~i; i = edges[i].nxt) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = edges[i].to;</span><br><span class="line">                f[v] = max(f[v], f[u] + len[u]);</span><br><span class="line">                <span class="keyword">if</span> (!(--in[v])) Q.push(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= uidx; ++i)</span><br><span class="line">            <span class="keyword">if</span> (in[i]) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> Ti;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;Ti);</span><br><span class="line">    <span class="keyword">while</span> (Ti--) &#123;</span><br><span class="line">        <span class="comment">// init</span></span><br><span class="line">        SAM::init(), Graph::init();</span><br><span class="line">        <span class="built_in">memset</span>(isA, <span class="literal">false</span>, <span class="keyword">sizeof</span> isA);</span><br><span class="line">        <span class="comment">// input</span></span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%s"</span>, S+<span class="number">1</span>);</span><br><span class="line">        <span class="comment">// build SAM</span></span><br><span class="line">        n = (<span class="keyword">int</span>) <span class="built_in">strlen</span>(S+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i; --i)</span><br><span class="line">            SAM::insert(S[i] - <span class="string">'a'</span>), pos[i] = SAM::last;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= SAM::nidx; ++i)</span><br><span class="line">            pre[<span class="number">0</span>][i] = SAM::lnk[i], G[i].clear();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; LOG; ++j)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= SAM::nidx; ++i) pre[j][i] = pre[j<span class="number">-1</span>][pre[j<span class="number">-1</span>][i]];</span><br><span class="line">        <span class="comment">// find A in SAM</span></span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;na);</span><br><span class="line">        uidx = SAM::nidx;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> L, R, i = <span class="number">1</span>; i &lt;= na; ++i) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;L, &amp;R);</span><br><span class="line">            <span class="keyword">int</span> lgt = R - L + <span class="number">1</span>, u = pos[L];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = LOG<span class="number">-1</span>; j &gt;= <span class="number">0</span>; --j)</span><br><span class="line">                <span class="keyword">if</span> (pre[j][u] &amp;&amp; len[pre[j][u]] &gt;= lgt) u = pre[j][u];</span><br><span class="line">            len[++uidx] = lgt, Aidx[i] = uidx, isA[uidx] = <span class="literal">true</span>;</span><br><span class="line">            G[u].push_back(uidx);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// find B in SAM</span></span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;nb);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> L, R, i = <span class="number">1</span>; i &lt;= nb; ++i) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;L, &amp;R);</span><br><span class="line">            <span class="keyword">int</span> lgt = R - L + <span class="number">1</span>, u = pos[L];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = LOG<span class="number">-1</span>; j &gt;= <span class="number">0</span>; --j)</span><br><span class="line">                <span class="keyword">if</span> (pre[j][u] &amp;&amp; len[pre[j][u]] &gt;= lgt) u = pre[j][u];</span><br><span class="line">            len[++uidx] = lgt, Bidx[i] = uidx;</span><br><span class="line">            G[u].push_back(uidx);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// link edges in SAM</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v, u = <span class="number">1</span>; u &lt;= SAM::nidx; ++u) &#123;</span><br><span class="line">            <span class="keyword">int</span> last = u;</span><br><span class="line">            sort(G[u].begin(), G[u].end(),</span><br><span class="line">                    [](<span class="keyword">const</span> <span class="keyword">int</span>&amp; a, <span class="keyword">const</span> <span class="keyword">int</span>&amp; b)&#123; <span class="keyword">return</span> len[a] &lt; len[b] || (len[a] == len[b] &amp;&amp; isA[a] &lt; isA[b]); &#125;);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; G[u].size(); ++i) &#123;</span><br><span class="line">                Graph::AddEdge(last, v = G[u][i]);</span><br><span class="line">                <span class="keyword">if</span> (!isA[v]) last = v;</span><br><span class="line">            &#125;</span><br><span class="line">            lst[u] = last;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= SAM::nidx; ++i)</span><br><span class="line">            Graph::AddEdge(lst[SAM::lnk[i]], i);</span><br><span class="line">        <span class="comment">// clean unexisted value</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> u = <span class="number">1</span>; u &lt;= uidx; ++u)</span><br><span class="line">            <span class="keyword">if</span> (!isA[u]) len[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// link A, B</span></span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> u, v, i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;u, &amp;v), Graph::AddEdge(Aidx[u], Bidx[v]);</span><br><span class="line">        <span class="comment">// solve &amp; output</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, Graph::Toposort());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;è°¨ä»¥æ­¤é¢˜çºªå¿µè‡ªå·±é¢“åºŸçš„, ä»€ä¹ˆéƒ½ä¸ä¼šçš„é«˜ä¸€ (bushi&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;é¢˜ç›®é“¾æ¥: &lt;a href=&quot;https://www.luogu.com.cn/problem/P5284&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.luogu.com.cn/problem/P5284&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;SAM ä¼˜åŒ–å»ºå›¾ + æ‹“æ‰‘æ’åºæ±‚æœ€é•¿è·¯.&lt;/p&gt;
&lt;p&gt;å†™è¿™é“é¢˜å•Š, åªæ˜¯æ„Ÿåˆ°è‡ªå·±çš„é«˜ä¸€å¾ˆå¯ç¬‘å§, è¿é¢˜æ„éƒ½ä¸å¤§èƒ½è¯»æ¸…, æ­£è§£çš„ç®—æ³•å¬éƒ½æ²¡æœ‰å¬è¿‡, è¾“å‡ºæ ·ä¾‹å°±å¼ƒç–—ç¦»åœº.&lt;/p&gt;
    
    </summary>
    
    
      <category term="é¢˜è§£" scheme="https://depletedprism.github.io/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="Graph" scheme="https://depletedprism.github.io/tags/Graph/"/>
    
      <category term="String" scheme="https://depletedprism.github.io/tags/String/"/>
    
  </entry>
  
  <entry>
    <title>ç¬¬ä¸€ / äºŒç±» Stirling æ•°çš„ä¸€äº›å¹³åº¸æ±‚æ³•</title>
    <link href="https://depletedprism.github.io/%E7%AC%94%E8%AE%B0/stirling-polynomial/"/>
    <id>https://depletedprism.github.io/%E7%AC%94%E8%AE%B0/stirling-polynomial/</id>
    <published>2020-01-28T12:19:12.000Z</published>
    <updated>2020-02-27T16:50:20.289Z</updated>
    
    <content type="html"><![CDATA[<hr><h2 id="ç»¼è¿°"><a href="#ç»¼è¿°" class="headerlink" title="ç»¼è¿°"></a>ç»¼è¿°</h2><p>çœ‹åˆ°æ´›è°·ä¸Šæœ‰æ±‚ Stirling æ•°çš„ç¥å¥‡æ¿å­, äºæ˜¯å°±æƒ³å†™ = =</p><p><del>è™½ç„¶ä¸çŸ¥é“ä¼šæœ‰ä»€ä¹ˆç”¨å¤„, å…¶å®æ˜¯ä¸æƒ³å†™é¢˜åˆä¸æ•¢é¢“åºŸå§</del></p><p>å¤§æ¦‚æ˜¯ä¸€äº›å¼å­æ¨æ¨æ¨ç„¶åæ‹‰æ¿å­ç®—ç®—ç®—â€¦</p><a id="more"></a><h3 id="ç¬¬ä¸€ç±»-Stirling-æ•°"><a href="#ç¬¬ä¸€ç±»-Stirling-æ•°" class="headerlink" title="ç¬¬ä¸€ç±» Stirling æ•°"></a>ç¬¬ä¸€ç±» Stirling æ•°</h3><p>æœ¬æ–‡é‡‡ç”¨ $\begin{bmatrix} n \\ m \end{bmatrix}$ è¡¨ç¤ºç¬¬ä¸€ç±» Stirling æ•°.</p><h4 id="Part-1-è¡Œ"><a href="#Part-1-è¡Œ" class="headerlink" title="Part 1 è¡Œ"></a>Part 1 è¡Œ</h4><ul><li>é¢˜ç›®é“¾æ¥: <a href="https://www.luogu.com.cn/problem/P5408" target="_blank" rel="noopener">https://www.luogu.com.cn/problem/P5408</a></li></ul><p>æˆ‘ä»¬çŸ¥é“, $x$ çš„ $n$ æ¬¡ä¸Šå‡å¹‚å°±æ˜¯ç¬¬ $n$ è¡Œç¬¬ä¸€ç±» Stirling æ•°çš„ç”Ÿæˆå‡½æ•°, å³<br>$$x^{\overline n} = \prod_{i=0}^{n-1} (x + i) = \sum_{i=0}^n \begin{bmatrix} n \\ i \end{bmatrix} x^i$$</p><p>è®ºæ®å¦‚ä¸‹, å½’çº³æ³•æ˜“è¯ $$ \begin{bmatrix} n \\ m \end{bmatrix} = \begin{bmatrix} n-1 \\ m-1 \end{bmatrix} + (n-1) \cdot \begin{bmatrix} n-1 \\ m \end{bmatrix}$$</p><p>æ­¤æ—¶é€šè¿‡åˆ†æ²» FFT å¯ä»¥åœ¨ $O(n \log^2 n)$ çš„æ—¶é—´å¤æ‚åº¦å†…è®¡ç®—.</p><p>ä½†æ˜¯ç”¨å€å¢å¯ä»¥åšåˆ° $O(n \log n)$.</p><p>è€ƒè™‘å€å¢, æœ‰<br>$$x^{\overline {2n}} = x^{\overline{n}} (x+n)^{\overline{n}}$$</p><p>å†™æˆè¿™ä¸ªå½¢å¼é¬¼çŸ¥é“æ€ä¹ˆæ¨, äºæ˜¯<br>$$x^{\overline{2n}} = \prod_{i=0}^{n-1} (x+i) \prod_{i=0}^{n-1} (x+i+n)$$</p><p>è®¾ $f(x) = \prod_{i=0}^{n-1} (x+i) = \sum_{i=0}^n a_i x^i$, å¦‚æœèƒ½æ ¹æ® $f(x)$ ç®— $f(x+n)$ å°±å¯ä»¥äº†.<br>$$f(x+n) = \sum_{i=0}^n a_i (x+n)^i = \sum_{i=0}^n a_i \sum_{j=0}^{i} \binom{i}{j} x^i n^{i-j} $$</p><p>äº¤æ¢ $i$, $j$ æšä¸¾é¡ºåº, å¾—<br>$$f(x+n) = \sum_{i=0}^n x^i \sum_{j=i}^n \binom{j}{i} n^{j-i} a_i$$</p><p>å±•å¼€, æœ‰<br>$$f(x+n) = \sum_{i=0}^n \frac{x^i}{i!} \sum_{j=i}^n \frac{n^{j-i}}{(j-i)!} j!\ a_j$$</p><p>æœ€åä¸€ä¸ªå’Œå¼çš„å·ç§¯å½¢å¼å¹¶ä¸æ˜¾ç„¶, è¿˜è¦å°†å…¶ä¸­ä¸€é¡¹ç¿»è½¬â€¦</p><p>å†™èµ·æ¥æœ‰å¾ˆå¤šç»†èŠ‚, ä¸­é€”å‡ºäº†æ— æ•°é”…, ä»¥åŠæˆ‘ç°åœ¨éƒ½ä¸çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘å†™çš„è¿­ä»£å’Œå¼€åŒºé—´ä¼šæ­»â€¦</p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Luogu P5408</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">524295</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P = <span class="number">167772161</span>, G = <span class="number">3</span>, iG = <span class="number">55924054</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> fac[MAXN], ifac[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fpow</span><span class="params">(<span class="keyword">int</span> base, <span class="keyword">int</span> b, <span class="keyword">int</span> m = P)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (b &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>) ret = <span class="number">1L</span>L * base * ret % m;</span><br><span class="line">        base = <span class="number">1L</span>L * base * base % m, b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Poly &#123;</span><br><span class="line">    <span class="keyword">int</span> r[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; Lim, <span class="keyword">const</span> <span class="keyword">int</span>&amp; L)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; Lim; ++i) r[i] = (r[i&gt;&gt;<span class="number">1</span>] &gt;&gt; <span class="number">1</span>) | ((i &amp; <span class="number">1</span>) &lt;&lt; (L<span class="number">-1</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">NTT</span><span class="params">(<span class="keyword">int</span>* f, <span class="keyword">int</span> Lim, <span class="keyword">int</span> type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; Lim; ++i) <span class="keyword">if</span> (i &lt; r[i]) swap(f[i], f[r[i]]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> Mid = <span class="number">1</span>; Mid &lt; Lim; Mid &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> unit = fpow(type &gt; <span class="number">0</span>? G: iG, (P<span class="number">-1</span>) / (Mid &lt;&lt; <span class="number">1</span>));</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; i += Mid &lt;&lt; <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">int</span> w = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; Mid; ++j, w = <span class="number">1L</span>L * w * unit % P) &#123;</span><br><span class="line">                    <span class="keyword">int</span> f0 = f[i+j], f1 = <span class="number">1L</span>L * w * f[i+j+Mid] % P;</span><br><span class="line">                    f[i+j] = (f0 + f1) % P, f[i+j+Mid] = (f0 - f1 + P) % P;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (type &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> inv = fpow(Lim, P<span class="number">-2</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) f[i] = <span class="number">1L</span>L * f[i] * inv % P;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">calc</span><span class="params">(<span class="keyword">int</span>* f, <span class="keyword">int</span>* g, <span class="keyword">int</span> Mid, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> A[MAXN], B[MAXN];</span><br><span class="line">        <span class="keyword">int</span> Lim = <span class="number">1</span>, L = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (Lim &lt; <span class="number">2</span>*Mid) Lim &lt;&lt;= <span class="number">1</span>, ++L;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> powk = <span class="number">1</span>, i = <span class="number">0</span>; i &lt; Mid; ++i, powk = <span class="number">1L</span>L * powk * k % P) &#123;</span><br><span class="line">            A[Mid-i<span class="number">-1</span>] = <span class="number">1L</span>L * f[i] * fac[i] % P;</span><br><span class="line">            B[i] = <span class="number">1L</span>L * powk * ifac[i] % P;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = Mid; i &lt; Lim; ++i) A[i] = B[i] = <span class="number">0</span>;</span><br><span class="line">        init(Lim, L), NTT(A, Lim, <span class="number">1</span>), NTT(B, Lim, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) A[i] = <span class="number">1L</span>L * A[i] * B[i] % P;</span><br><span class="line">        NTT(A, Lim, <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Mid; ++i) g[i] = <span class="number">1L</span>L * A[Mid-i<span class="number">-1</span>] * ifac[i] % P;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span>* f, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> A[MAXN], B[MAXN];</span><br><span class="line">        <span class="keyword">if</span> (!n) <span class="keyword">return</span> <span class="keyword">void</span>( f[<span class="number">0</span>] = <span class="number">1</span> );</span><br><span class="line">        <span class="keyword">int</span> Mid = n / <span class="number">2</span>, Lim = <span class="number">1</span>, L = <span class="number">0</span>;</span><br><span class="line">        solve(f, Mid);</span><br><span class="line">        <span class="keyword">while</span> (Lim &lt;= n) Lim &lt;&lt;= <span class="number">1</span>, ++L;</span><br><span class="line">        <span class="comment">// å¾—åˆ° f(x + Mid)</span></span><br><span class="line">        calc(f, A, Mid+<span class="number">1</span>, Mid);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= Mid; ++i) B[i] = f[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = Mid+<span class="number">1</span>; i &lt; Lim; ++i) A[i] = B[i] = <span class="number">0</span>;</span><br><span class="line">        init(Lim, L), NTT(A, Lim, <span class="number">1</span>), NTT(B, Lim, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) A[i] = <span class="number">1L</span>L * A[i] * B[i] % P;</span><br><span class="line">        NTT(A, Lim, <span class="number">-1</span>);</span><br><span class="line">        <span class="comment">// n ä¸ºå¥‡æ•°æ—¶, æœ‰ä¹˜ (x + (n-1)) çš„æƒ…å†µ, æ­¤æ—¶ç›´æ¥ä¹˜å°±å¥½äº†.</span></span><br><span class="line">        <span class="keyword">if</span> (n &amp; <span class="number">1</span>) <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; ++i)</span><br><span class="line">            f[i] = ((i? A[i<span class="number">-1</span>]: <span class="number">0</span>) + <span class="number">1L</span>L * A[i] * (n<span class="number">-1</span>) % P) % P;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; ++i) f[i] = A[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">int</span> f[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</span><br><span class="line">    <span class="comment">// init</span></span><br><span class="line">    ifac[<span class="number">0</span>] = fac[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) fac[i] = <span class="number">1L</span>L * fac[i<span class="number">-1</span>] * i % P;</span><br><span class="line">    ifac[n] = fpow(fac[n], P<span class="number">-2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i; --i) ifac[i<span class="number">-1</span>] = <span class="number">1L</span>L * ifac[i] * i % P;</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    Poly::solve(f, n);</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; ++i) <span class="built_in">printf</span>(<span class="string">"%d%c"</span>, f[i], <span class="string">" \n"</span>[i==n]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h4 id="Part-2-åˆ—"><a href="#Part-2-åˆ—" class="headerlink" title="Part 2 åˆ—"></a>Part 2 åˆ—</h4><ul><li>é¢˜ç›®é“¾æ¥: <a href="https://www.luogu.com.cn/problem/P5409" target="_blank" rel="noopener">https://www.luogu.com.cn/problem/P5409</a></li></ul><p>é¦–å…ˆæœ‰ç¬¬ä¸€ç±» Stirling æ•°çš„ä¸€ä¸ªæ€§è´¨, å³<br>$$x^{\underline n} = \prod_{i=0}^{n-1} (x-i) = \sum_{i=0}^n (-1)^{n-i} \begin{bmatrix} n \\ i \end{bmatrix} x^i$$</p><p>åŒæ ·ä¹Ÿæ˜¯å½’çº³æ³•æ˜“è¯.</p><p>å¯¹äº $(1+x)^t$, ç”±ç‰›é¡¿äºŒé¡¹å¼å®šç†, å¯çŸ¥<br>$$(1+x)^t = \sum_{i=0}^\infty \binom{t}{i} x^i$$</p><p>å…¶ä¸­ $\binom{t}{i} = \frac{t (t-1) \cdots (t-i+1)}{i!}$, ä¸å¦¨å†™ä½œ<br>$$(1+x)^t = \sum_{i=0}^\infty \frac{t^{\underline i}}{i!} x^i$$</p><p>æ„‰å¿«å¥—å…¬å¼, å¾—<br>$$(1+x)^t = \sum_{i=0}^\infty \frac{1}{i!} x^i \sum_{j=0}^i (-1)^{i-j} \begin{bmatrix} i \\ j \end{bmatrix} t^j$$</p><p>äº¤æ¢æšä¸¾é¡ºåº, å¾—<br>$$(1+x)^t = \sum_{i=0}^\infty t^i \sum_{j=i}^\infty \frac{1}{j!} x^j (-1)^{j-i} \begin{bmatrix}j \\ i \end{bmatrix} $$</p><p>åŒæ—¶, æœ‰<br>$$(1+x)^t = \exp (t \cdot \ln (1+x)) = \sum_{i=0}^\infty \frac{1}{i!} \ln^i (1+x)\ t^i$$</p><p>å¯¹åº”é¡¹ç³»æ•°ç›¸ç­‰, å¾—<br>$$\frac{1}{i!} \ln^i (1+x) = \sum_{j=i}^\infty \frac{1}{j!} (-1)^{j-i} \begin{bmatrix}j \\ i \end{bmatrix} x^j$$</p><p>å¯ä»¥çœ‹åˆ°, å…¶ä¸­ $i$ ä¸ºç»™å®šçš„å€¼, åˆ©ç”¨å¤šé¡¹å¼å¹‚å‡½æ•°ç®—å°±å¥½äº†.</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯, $[x^0] \ln (1+x)$ æœ‰ä¸ç­‰äº $1$ çš„å¯èƒ½, æ‰€ä»¥è¦ç”¨é²æ£’æ€§æ›´å¼ºçš„æ¿å­ = =</p><p>æ—¶é—´å¤æ‚åº¦æ˜¯å¸¦å¸¸æ•°çš„ $O(n \log n)$, å¤§æ¦‚æ˜¯è·‘ä¸è¿‡ $O(n \log^2 n)$ çš„å¸¦å¸¸æ•°å§</p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Luogu P5409</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">131075</span> &lt;&lt; <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P = <span class="number">167772161</span>, G = <span class="number">3</span>, iG = <span class="number">55924054</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> fac[MAXN], ifac[MAXN], inv[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fpow</span><span class="params">(<span class="keyword">int</span> base, <span class="keyword">int</span> b, <span class="keyword">int</span> m = P)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (b &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>) ret = <span class="number">1L</span>L * ret * base % m;</span><br><span class="line">        base = <span class="number">1L</span>L * base * base % m, b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Poly &#123;</span><br><span class="line">    <span class="keyword">int</span> r[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; Lim, <span class="keyword">const</span> <span class="keyword">int</span>&amp; L)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; Lim; ++i) r[i] = (r[i&gt;&gt;<span class="number">1</span>] &gt;&gt; <span class="number">1</span>) | ((i &amp; <span class="number">1</span>) &lt;&lt; (L<span class="number">-1</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">NTT</span><span class="params">(<span class="keyword">int</span>* f, <span class="keyword">int</span> Lim, <span class="keyword">int</span> type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; Lim; ++i) <span class="keyword">if</span> (i &lt; r[i]) swap(f[i], f[r[i]]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> Mid = <span class="number">1</span>; Mid &lt; Lim; Mid &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> unit = fpow(type &gt; <span class="number">0</span>? G: iG, (P<span class="number">-1</span>) / (Mid &lt;&lt; <span class="number">1</span>));</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; i += Mid &lt;&lt; <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">int</span> w = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; Mid; ++j, w = <span class="number">1L</span>L * w * unit % P) &#123;</span><br><span class="line">                    <span class="keyword">int</span> f0 = f[i+j], f1 = <span class="number">1L</span>L * w * f[i+j+Mid] % P;</span><br><span class="line">                    f[i+j] = (f0 + f1) % P, f[i+j+Mid] = (f0 - f1 + P) % P;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (type &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> inv = fpow(Lim, P<span class="number">-2</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) f[i] = <span class="number">1L</span>L * inv * f[i] % P;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Inv</span><span class="params">(<span class="keyword">int</span>* f, <span class="keyword">int</span>* g, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> A[MAXN], B[MAXN];</span><br><span class="line">        g[<span class="number">0</span>] = fpow(f[<span class="number">0</span>], P<span class="number">-2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> L = <span class="number">0</span>, Lim = <span class="number">1</span>, Mid = <span class="number">2</span>; Mid &lt; <span class="number">2</span>*n; Mid &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span> (Lim &lt; <span class="number">2</span>*Mid) Lim &lt;&lt;= <span class="number">1</span>, ++L;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Mid; ++i) A[i] = f[i], B[i] = g[i];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = Mid; i &lt; Lim; ++i) A[i] = B[i] = <span class="number">0</span>;</span><br><span class="line">            init(Lim, L), NTT(A, Lim, <span class="number">1</span>), NTT(B, Lim, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i)</span><br><span class="line">                g[i] = ((B[i] + B[i]) % P - <span class="number">1L</span>L * A[i] * B[i] % P * B[i] % P + P) % P;</span><br><span class="line">            NTT(g, Lim, <span class="number">-1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = min(Mid, n); i &lt; Lim; ++i) g[i] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Der</span><span class="params">(<span class="keyword">int</span>* f, <span class="keyword">int</span>* g, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) g[i<span class="number">-1</span>] = <span class="number">1L</span>L * i * f[i] % P;</span><br><span class="line">        g[n<span class="number">-1</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Int</span><span class="params">(<span class="keyword">int</span>* f, <span class="keyword">int</span>* g, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        g[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n<span class="number">-1</span>; i; --i) g[i] = <span class="number">1L</span>L * inv[i] * f[i<span class="number">-1</span>] % P;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Ln</span><span class="params">(<span class="keyword">int</span>* f, <span class="keyword">int</span>* g, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> A[MAXN], B[MAXN];</span><br><span class="line">        Der(f, A, n), Inv(f, B, n);</span><br><span class="line">        <span class="keyword">int</span> Lim = <span class="number">1</span>, L = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (Lim &lt; <span class="number">2</span>*n) Lim &lt;&lt;= <span class="number">1</span>, ++L;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &lt; Lim; ++i) A[i] = B[i] = <span class="number">0</span>;</span><br><span class="line">        init(Lim, L), NTT(A, Lim, <span class="number">1</span>), NTT(B, Lim, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) A[i] = <span class="number">1L</span>L * A[i] * B[i] % P;</span><br><span class="line">        NTT(A, Lim, <span class="number">-1</span>), Int(A, g, n);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Exp</span><span class="params">(<span class="keyword">int</span>* f, <span class="keyword">int</span>* g, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> A[MAXN], B[MAXN], lng[MAXN];</span><br><span class="line">        g[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> L = <span class="number">0</span>, Lim = <span class="number">1</span>, Mid = <span class="number">2</span>; Mid &lt; <span class="number">2</span>*n; Mid &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            Ln(g, lng, Mid);</span><br><span class="line">            <span class="keyword">while</span> (Lim &lt; <span class="number">2</span>*Mid) Lim &lt;&lt;= <span class="number">1</span>, ++L;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Mid; ++i) A[i] = (f[i] - lng[i] + P) % P, B[i] = g[i];</span><br><span class="line">            A[<span class="number">0</span>] = (A[<span class="number">0</span>] + <span class="number">1</span>) % P;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = Mid; i &lt; Lim; ++i) A[i] = B[i] = <span class="number">0</span>;</span><br><span class="line">            init(Lim, L), NTT(A, Lim, <span class="number">1</span>), NTT(B, Lim, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) g[i] = <span class="number">1L</span>L * A[i] * B[i] % P;</span><br><span class="line">            NTT(g, Lim, <span class="number">-1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = min(Mid, n); i &lt; Lim; ++i) g[i] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Pow</span><span class="params">(<span class="keyword">int</span>* f, <span class="keyword">int</span>* g, <span class="keyword">int</span> n, <span class="keyword">int</span> K)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> lng[MAXN];</span><br><span class="line">        <span class="keyword">int</span> pos = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!f[pos]) ++pos;</span><br><span class="line">        <span class="keyword">int</span> Mid = n - pos;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Mid; ++i) g[i] = f[i+pos];</span><br><span class="line">        <span class="keyword">int</span> base = g[<span class="number">0</span>], inv = fpow(base, P<span class="number">-2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Mid; ++i) g[i] = <span class="number">1L</span>L * g[i] * inv % P;</span><br><span class="line">        Ln(g, lng, Mid);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Mid; ++i) lng[i] = <span class="number">1L</span>L * lng[i] * K % P;</span><br><span class="line">        Exp(lng, g, Mid);</span><br><span class="line">        base = fpow(base, K);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Mid; ++i) g[i] = <span class="number">1L</span>L * g[i] * base % P;</span><br><span class="line">        pos = min(pos * K, n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n<span class="number">-1</span>; i &gt;= pos; --i) g[i] = g[i-pos];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pos; ++i) g[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, K;</span><br><span class="line"><span class="keyword">int</span> f[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;K);</span><br><span class="line">    <span class="comment">// init</span></span><br><span class="line">    <span class="keyword">int</span> N = n;</span><br><span class="line">    ifac[<span class="number">0</span>] = fac[<span class="number">0</span>] = inv[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= N; ++i) inv[i] = <span class="number">1L</span>L * (P - P / i) * inv[P % i] % P;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; ++i) fac[i] = <span class="number">1L</span>L * i * fac[i<span class="number">-1</span>] % P;</span><br><span class="line">    ifac[N] = fpow(fac[N], P<span class="number">-2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = N; i; --i) ifac[i<span class="number">-1</span>] = <span class="number">1L</span>L * i * ifac[i] % P;</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    f[<span class="number">0</span>] = f[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    Poly::Ln(f, f, n+<span class="number">1</span>); Poly::Pow(f, f, n+<span class="number">1</span>, K);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; ++i) f[i] = <span class="number">1L</span>L * f[i] * ifac[K] % P;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; ++i)</span><br><span class="line">        f[i] = <span class="number">1L</span>L * f[i] * fac[i] % P * (((i-K) &amp; <span class="number">1</span>)? P<span class="number">-1</span>: <span class="number">1</span>) % P;</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; ++i) <span class="built_in">printf</span>(<span class="string">"%d%c"</span>, f[i], <span class="string">" \n"</span>[i==n]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="ç¬¬äºŒç±»æ–¯ç‰¹æ—æ•°"><a href="#ç¬¬äºŒç±»æ–¯ç‰¹æ—æ•°" class="headerlink" title="ç¬¬äºŒç±»æ–¯ç‰¹æ—æ•°"></a>ç¬¬äºŒç±»æ–¯ç‰¹æ—æ•°</h3><p>æœ¬æ–‡é‡‡ç”¨ $\begin{Bmatrix} n \\ m \end{Bmatrix}$ è¡¨ç¤ºç¬¬äºŒç±» Stirling æ•°.</p><h4 id="Part-1-è¡Œ-1"><a href="#Part-1-è¡Œ-1" class="headerlink" title="Part 1 è¡Œ"></a>Part 1 è¡Œ</h4><ul><li>é¢˜ç›®é“¾æ¥: <a href="https://www.luogu.com.cn/problem/P5395" target="_blank" rel="noopener">https://www.luogu.com.cn/problem/P5395</a></li></ul><p><del>æ„Ÿè§‰è¿™ä¸ªæ˜¯æœ€ç®€å•çš„äº†</del></p><p>è€ƒè™‘ç¬¬äºŒç±» Stirling æ•°çš„ç»„åˆæ„ä¹‰, ä¹Ÿå°±æ˜¯æŠŠ $n$ ä¸ªæœ‰åŒºåˆ«çš„å°çƒæ”¾å…¥ $m$ ä¸ªæ— åŒºåˆ«çš„ç›’å­é‡Œçš„æ–¹æ¡ˆæ•°.</p><p>å…¶å®è¿™ä¸ªä¸œè¥¿æ˜¯å¯ä»¥ç”¨å®¹æ–¥ç®—çš„, å¯ä»¥å¾—åˆ°<br>$$\begin{Bmatrix} n \\ m \end{Bmatrix} = \frac{1}{m!} \sum_{k=0}^n (-1)^{k} \binom{m}{k} (m-k)^n$$</p><p>å³è¾¹å’Œå¼çš„æ„ä¹‰ä¸º, åœ¨ $m$ ä¸ª<strong>æœ‰åŒºåˆ«</strong>çš„ç›’å­é‡ŒæŒ‘ $k$ ä¸ªç©ºç›’å­, ç„¶åæŠŠ $n$ ä¸ªå°çƒä¸¢åˆ°ç›’å­é‡Œ. å› ä¸ºå®¹æ–¥æ—¶å‡è®¾ç›’å­æœ‰åŒºåˆ«, æœ€åè¿˜è¦é™¤ä»¥ $m!$.</p><p>æŠŠè¿™ä¸ªå¼å­å±•å¼€å°±å¯ä»¥çœ‹åˆ°å·ç§¯çš„å½¢å¼äº†.<br>$$\begin{Bmatrix} n \\ m \end{Bmatrix} = \sum_{k=0}^n \frac{(-1)^k}{k!} \frac{(m-k)^n}{(m-k)!}$$</p><p>é€šè¿‡ NTT å°±å¯ä»¥åœ¨ $O(n \log n)$ çš„æ—¶é—´å¤æ‚åº¦å†…è®¡ç®—.</p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Luogu P5395</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e6</span>+<span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P = <span class="number">167772161</span>, G = <span class="number">3</span>, iG = <span class="number">55924054</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fpow</span><span class="params">(<span class="keyword">int</span> base, <span class="keyword">int</span> b, <span class="keyword">int</span> m = P)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (b &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>) ret = <span class="number">1L</span>L * ret * base % m;</span><br><span class="line">        base = <span class="number">1L</span>L * base * base % m, b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Poly &#123;</span><br><span class="line">    <span class="keyword">int</span> r[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; Lim, <span class="keyword">const</span> <span class="keyword">int</span>&amp; L)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; Lim; ++i) r[i] = (r[i&gt;&gt;<span class="number">1</span>] &gt;&gt; <span class="number">1</span>) | ((i &amp; <span class="number">1</span>) &lt;&lt; (L<span class="number">-1</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">NTT</span><span class="params">(<span class="keyword">int</span>* f, <span class="keyword">int</span> Lim, <span class="keyword">int</span> type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; Lim; ++i) <span class="keyword">if</span> (i &lt; r[i]) swap(f[i], f[r[i]]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> Mid = <span class="number">1</span>; Mid &lt; Lim; Mid &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> unit = fpow(type &gt; <span class="number">0</span>? G: iG, (P<span class="number">-1</span>) / (Mid &lt;&lt; <span class="number">1</span>));</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; i += Mid &lt;&lt; <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">int</span> w = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; Mid; ++j, w = <span class="number">1L</span>L * w * unit % P) &#123;</span><br><span class="line">                    <span class="keyword">int</span> f0 = f[i+j], f1 = <span class="number">1L</span>L * w * f[i+j+Mid] % P;</span><br><span class="line">                    f[i+j] = (f0 + f1) % P, f[i+j+Mid] = (f0 - f1 + P) % P;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (type &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> inv = fpow(Lim, P<span class="number">-2</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) f[i] = <span class="number">1L</span>L * f[i] * inv % P;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">int</span> f[MAXN], g[MAXN];</span><br><span class="line"><span class="keyword">int</span> fac[MAXN], ifac[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</span><br><span class="line">    <span class="comment">// init</span></span><br><span class="line">    fac[<span class="number">0</span>] = ifac[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) fac[i] = <span class="number">1L</span>L * fac[i<span class="number">-1</span>] * i % P;</span><br><span class="line">    ifac[n] = fpow(fac[n], P<span class="number">-2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i; --i) ifac[i<span class="number">-1</span>] = <span class="number">1L</span>L * ifac[i] * i % P;</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        f[i] = (i &amp; <span class="number">1</span>)? P - ifac[i]: ifac[i];</span><br><span class="line">        g[i] = <span class="number">1L</span>L * fpow(i, n) * ifac[i] % P;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> Lim = <span class="number">1</span>, L = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (Lim &lt; <span class="number">2</span>*n) Lim &lt;&lt;= <span class="number">1</span>, ++L;</span><br><span class="line">    Poly::init(Lim, L), Poly::NTT(f, Lim, <span class="number">1</span>), Poly::NTT(g, Lim, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) f[i] = <span class="number">1L</span>L * f[i] * g[i] % P;</span><br><span class="line">    Poly::NTT(f, Lim, <span class="number">-1</span>);</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; ++i) <span class="built_in">printf</span>(<span class="string">"%d%c"</span>, f[i], <span class="string">" \n"</span>[i==n]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h4 id="Part-2-åˆ—-1"><a href="#Part-2-åˆ—-1" class="headerlink" title="Part 2 åˆ—"></a>Part 2 åˆ—</h4><ul><li>é¢˜ç›®é“¾æ¥: <a href="https://www.luogu.com.cn/problem/P5396" target="_blank" rel="noopener">https://www.luogu.com.cn/problem/P5396</a></li></ul><p>è®¾ç¬¬äºŒç±» Stirling æ•°ä¸€åˆ—çš„ç”Ÿæˆå‡½æ•°ä¸º $S_m$, å³<br>$$S_m (x) = \sum_{i=0}^\infty \begin{Bmatrix} i \\ m \end{Bmatrix} x^i$$</p><p>æ ¹æ®ç¬¬äºŒç±» Stirling æ•°é€’æ¨å¼, å¯ä»¥å¾—åˆ°<br>$$S_m (x) = \sum_{i=1}^\infty \begin{Bmatrix} i-1 \\ m-1 \end{Bmatrix} x^i  + m \sum_{i=1}^\infty \begin{Bmatrix} i-1 \\ m \end{Bmatrix} x^i$$</p><p>$$S_m (x) = x \cdot S_{m-1} (x) + m x \cdot S_m (x)$$</p><p>ç§»é¡¹å¹¶æ•´ç†, å¾—<br>$$S_m (x) = \frac{x}{1-mx} S_{m-1} (x) = \frac{x^m}{\prod_{i=1}^m (1-ix)}$$</p><p>åˆ†å¼çš„åˆ†æ¯å¯ä»¥ä½¿ç”¨åˆ†æ²» FFT å¾—åˆ°, ç„¶åæ±‚é€†å¹¶ä¹˜ä¸€ä¸ªå•é¡¹å¼ (ä¹Ÿå°±æ˜¯æŠŠç³»æ•°å³ç§») å³å¯.</p><p>æ‰€ä»¥æˆ‘ä»¬å°±å¾—åˆ°äº† $O(n \log^2 n)$ çš„åšæ³•, ç„¶è€Œå­˜åœ¨ $O(n\log n)$ ä¸”å°å¸¸æ•°çš„å€å¢ä¼˜ç§€åšæ³•, åªæ˜¯æˆ‘å­¦ä¸åŠ¨äº†â€¦</p><p>ä½ä»¥ O2 é£Ÿç”¨æ›´ä½³.</p><div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾ç¤º / éšè— </div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Luogu P5396</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">131075</span> &lt;&lt; <span class="number">1</span>, LOG = <span class="number">35</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P = <span class="number">167772161</span>, G = <span class="number">3</span>, iG = <span class="number">55924054</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fpow</span><span class="params">(<span class="keyword">int</span> base, <span class="keyword">int</span> b, <span class="keyword">int</span> m = P)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (b &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>) ret = <span class="number">1L</span>L * base * ret % m;</span><br><span class="line">        base = <span class="number">1L</span>L * base * base % m, b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Poly &#123;</span><br><span class="line">    <span class="keyword">int</span> r[MAXN];</span><br><span class="line">    <span class="keyword">int</span> tmp[LOG][MAXN], ptr = <span class="number">-1</span>;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; Lim, <span class="keyword">const</span> <span class="keyword">int</span>&amp; L)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; Lim; ++i) r[i] = (r[i&gt;&gt;<span class="number">1</span>] &gt;&gt; <span class="number">1</span>) | ((i &amp; <span class="number">1</span>) &lt;&lt; (L<span class="number">-1</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">NTT</span><span class="params">(<span class="keyword">int</span>* f, <span class="keyword">int</span> Lim, <span class="keyword">int</span> type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; Lim; ++i) <span class="keyword">if</span> (i &lt; r[i]) swap(f[i], f[r[i]]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> Mid = <span class="number">1</span>; Mid &lt; Lim; Mid &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> unit = fpow(type &gt; <span class="number">0</span>? G: iG, (P<span class="number">-1</span>) / (Mid &lt;&lt; <span class="number">1</span>));</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; i += Mid &lt;&lt; <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">int</span> w = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; Mid; ++j, w = <span class="number">1L</span>L * w * unit % P) &#123;</span><br><span class="line">                    <span class="keyword">int</span> f0 = f[i+j], f1 = <span class="number">1L</span>L * w * f[i+j+Mid] % P;</span><br><span class="line">                    f[i+j] = (f0 + f1) % P, f[i+j+Mid] = (f0 - f1 + P) % P;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (type &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> inv = fpow(Lim, P<span class="number">-2</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) f[i] = <span class="number">1L</span>L * f[i] * inv % P;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Inv</span><span class="params">(<span class="keyword">int</span>* f, <span class="keyword">int</span>* g, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> A[MAXN], B[MAXN];</span><br><span class="line">        g[<span class="number">0</span>] = fpow(f[<span class="number">0</span>], P<span class="number">-2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> L = <span class="number">0</span>, Lim = <span class="number">1</span>, Mid = <span class="number">2</span>; Mid &lt; <span class="number">2</span>*n; Mid &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span> (Lim &lt; <span class="number">2</span>*Mid) Lim &lt;&lt;= <span class="number">1</span>, ++L;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Mid; ++i) A[i] = f[i], B[i] = g[i];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = Mid; i &lt; Lim; ++i) A[i] = B[i] = <span class="number">0</span>;</span><br><span class="line">            init(Lim, L), NTT(A, Lim, <span class="number">1</span>), NTT(B, Lim, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i)</span><br><span class="line">                g[i] = ((B[i] + B[i]) % P - <span class="number">1L</span>L * A[i] * B[i] % P * B[i] % P + P) % P;</span><br><span class="line">            NTT(g, Lim, <span class="number">-1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = min(Mid, n); i &lt; Lim; ++i) g[i] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span>* f, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (L == R) <span class="keyword">return</span> f[<span class="number">0</span>] = <span class="number">1</span>, <span class="keyword">void</span>( f[<span class="number">1</span>] = P - L );</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>, *f0 = tmp[++ptr], *f1 = tmp[++ptr];</span><br><span class="line">        solve(f0, L, Mid), solve(f1, Mid+<span class="number">1</span>, R);</span><br><span class="line">        <span class="keyword">int</span> Lim = <span class="number">1</span>, l = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (Lim &lt;= R-L+<span class="number">1</span>) Lim &lt;&lt;= <span class="number">1</span>, ++l;</span><br><span class="line">        init(Lim, l), NTT(f0, Lim, <span class="number">1</span>), NTT(f1, Lim, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) f[i] = <span class="number">1L</span>L * f0[i] * f1[i] % P, f0[i] = f1[i] = <span class="number">0</span>;</span><br><span class="line">        NTT(f, Lim, <span class="number">-1</span>), ptr -= <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, K;</span><br><span class="line"><span class="keyword">int</span> f[MAXN], g[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;K);</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    Poly::solve(f, <span class="number">1</span>, K);</span><br><span class="line">    Poly::Inv(f, g, n+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i+K &lt;= n; ++i) f[i+K] = g[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; K; ++i) f[i] = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; ++i) <span class="built_in">printf</span>(<span class="string">"%d%c"</span>, f[i], <span class="string">" \n"</span>[i==n]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li>Richard A. Brualdi. ç»„åˆæ•°å­¦. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2012.4.</li><li><a href="https://www.cnblogs.com/y2823774827y/p/10700231.html" target="_blank" rel="noopener">æ–¯ç‰¹æ—æ•°åŠæ–¯ç‰¹æ—åæ¼” by y2823774827y</a></li><li><a href="https://www.luogu.com.cn/blog/NaCly-Fish-blog/solution-p5408" target="_blank" rel="noopener">é¢˜è§£ P5408 ã€æ¨¡æ¿ã€‘ç¬¬ä¸€ç±»æ–¯ç‰¹æ—æ•°Â·è¡Œ by NaCly_Fish</a></li><li><a href="https://www.luogu.com.cn/blog/user7035/solution-p5409" target="_blank" rel="noopener">é¢˜è§£ P5409 ã€æ¨¡æ¿ã€‘ç¬¬ä¸€ç±»æ–¯ç‰¹æ—æ•°Â·åˆ— by Great_Influence</a></li><li><a href="https://www.luogu.com.cn/blog/user7035/solution-p5396" target="_blank" rel="noopener">é¢˜è§£ P5396 ã€æ¨¡æ¿ã€‘ç¬¬äºŒç±»æ–¯ç‰¹æ—æ•°Â·åˆ— by Great_Influence</a></li></ul><hr>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;h2 id=&quot;ç»¼è¿°&quot;&gt;&lt;a href=&quot;#ç»¼è¿°&quot; class=&quot;headerlink&quot; title=&quot;ç»¼è¿°&quot;&gt;&lt;/a&gt;ç»¼è¿°&lt;/h2&gt;&lt;p&gt;çœ‹åˆ°æ´›è°·ä¸Šæœ‰æ±‚ Stirling æ•°çš„ç¥å¥‡æ¿å­, äºæ˜¯å°±æƒ³å†™ = =&lt;/p&gt;
&lt;p&gt;&lt;del&gt;è™½ç„¶ä¸çŸ¥é“ä¼šæœ‰ä»€ä¹ˆç”¨å¤„, å…¶å®æ˜¯ä¸æƒ³å†™é¢˜åˆä¸æ•¢é¢“åºŸå§&lt;/del&gt;&lt;/p&gt;
&lt;p&gt;å¤§æ¦‚æ˜¯ä¸€äº›å¼å­æ¨æ¨æ¨ç„¶åæ‹‰æ¿å­ç®—ç®—ç®—â€¦&lt;/p&gt;
    
    </summary>
    
    
      <category term="ç¬”è®°" scheme="https://depletedprism.github.io/categories/%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Polynomial" scheme="https://depletedprism.github.io/tags/Polynomial/"/>
    
  </entry>
  
  <entry>
    <title>ç‰›é¡¿äºŒé¡¹å¼å®šç† å­¦ä¹ ç¬”è®°</title>
    <link href="https://depletedprism.github.io/%E7%AC%94%E8%AE%B0/binomial-theorem/"/>
    <id>https://depletedprism.github.io/%E7%AC%94%E8%AE%B0/binomial-theorem/</id>
    <published>2020-01-21T03:52:42.000Z</published>
    <updated>2020-03-05T12:33:35.109Z</updated>
    
    <content type="html"><![CDATA[<hr><blockquote><p>æ•°å­¦å°±æ˜¯ç”¨çš„æ—¶å€™ä¸å¤Ÿç”¨çš„ä¸œè¥¿. = =</p></blockquote><h2 id="ç»¼è¿°"><a href="#ç»¼è¿°" class="headerlink" title="ç»¼è¿°"></a>ç»¼è¿°</h2><p>ç‰›é¡¿äºŒé¡¹å¼å®šç†æ˜¯å¯¹äºŒé¡¹å¼å®šç†çš„æ¨å¹¿, <del>é‚£ç›´æ¥å«å¹¿ä¹‰äºŒé¡¹å¼å®šç†ä¸å¥½å—</del>, åˆšå¼€å§‹çœ‹ &lt;ç»„åˆæ•°å­¦&gt; çš„æ—¶å€™è§åˆ°è¿™ä¸ªä¸œè¥¿, ä»¥ä¸ºæ²¡ä»€ä¹ˆç”¨ = =, åæ¥â€¦</p><p>å½“ç„¶æœ¬æ–‡ä½œè€…æ²¡æœ‰ä»”ç»†ä¸¥è°¨åœ°å­¦ä¹ ç›¸å…³çš„æ•°å­¦çŸ¥è¯†, å†…å®¹å……æ»¡è°¬è¯¯, æ³è¯·æŒ‡æ­£.</p><a id="more"></a><h2 id="é™ˆè¿°"><a href="#é™ˆè¿°" class="headerlink" title="é™ˆè¿°"></a>é™ˆè¿°</h2><h3 id="äºŒé¡¹å¼å®šç†"><a href="#äºŒé¡¹å¼å®šç†" class="headerlink" title="äºŒé¡¹å¼å®šç†"></a>äºŒé¡¹å¼å®šç†</h3><p>å¯¹äºæ­£æ•´æ•° $n$ å’Œä»»æ„ $x,\ y$, æœ‰<br>$$(x + y) ^ n = \sum_{k=0}^n\; \binom{n}{k} x^k y ^{n-k}$$</p><p>è¿™å°±æ˜¯æœ€å¸¸è§çš„äºŒé¡¹å¼å®šç†, å…¶ä¸­ $n$ å¯ä»¥æ¨å¹¿åˆ°ä»»æ„å®æ•°, å³</p><h3 id="ç‰›é¡¿äºŒé¡¹å¼å®šç†"><a href="#ç‰›é¡¿äºŒé¡¹å¼å®šç†" class="headerlink" title="ç‰›é¡¿äºŒé¡¹å¼å®šç†"></a>ç‰›é¡¿äºŒé¡¹å¼å®šç†</h3><p>è®¾ $\alpha$ æ˜¯å®æ•°, å¯¹äºæ‰€æœ‰æ»¡è¶³ $0 \leq |x| &lt; |y|$ çš„ $x$,  $y$, æœ‰<br>$$(x+y)^\alpha = \sum_{k=0}^\infty\; \binom{\alpha}{k} x^k y^{n-k}$$</p><p>å…¶ä¸­<br>$$\binom{\alpha}{k} = \frac{\alpha (\alpha - 1) \cdots (\alpha - k + 1)}{k!} $$</p><h2 id="è¯æ˜"><a href="#è¯æ˜" class="headerlink" title="è¯æ˜"></a>è¯æ˜</h2><p>åœ¨æ­¤ä¸è¯.</p><h2 id="ç®€å•åº”ç”¨"><a href="#ç®€å•åº”ç”¨" class="headerlink" title="ç®€å•åº”ç”¨"></a>ç®€å•åº”ç”¨</h2><p>çœ‹åˆ°è¿™ä¸ªå’Œå¼ä¸Šçš„æ— ç©·çš„æ—¶å€™, <del>é¡·åˆ»ç•™ä¸‹äº†æ„ŸåŠ¨çš„æ³ªæ°´</del>â€¦</p><h3 id="ä¸€äº›æ‹“å±•"><a href="#ä¸€äº›æ‹“å±•" class="headerlink" title="ä¸€äº›æ‹“å±•"></a>ä¸€äº›æ‹“å±•</h3><p>è®¾ $z = \frac{x}{y}$, é‚£ä¹ˆä¸Šè¿°å®šç†å¯ä»¥è½¬è¿°ä¸º</p><p>å¯¹äºæ‰€æœ‰æ»¡è¶³ $|z| &lt; 1$ çš„ä»»æ„ $z$, æœ‰<br>$$(1+z) ^ \alpha = \sum_{k=0}^\infty\; \binom{\alpha}{k} z^k$$</p><p>è®¾ $n$ ä¸ºæ­£æ•´æ•°, å– $\alpha$ ä¸ºè´Ÿæ•´æ•° $-n$, åˆ™<br>$$\binom{\alpha}{k} = \binom{-n}{k} = \frac{-n (-n-1) \cdots (-n-k+1)}{k!} = (-1)^k \binom{n+k-1}{k}$$</p><p>æ‰€ä»¥<br>$$(1+z)^{-n} = \frac{1}{(1+z)^n} = \sum_{k=0}^\infty\; (-1)^k \binom{n+k-1}{k} z^k$$</p><p>ä¸ºäº†å¹²æ‰é‚£ä¸ª $-1$, ä»¤ $-z$ ä»£æ›¿ $z$, å¾—<br>$$(1-z)^{-n} = \frac{1}{(1-z)^n} = \sum_{k=0}^\infty\; \binom{n+k-1}{k} z^k$$</p><p>å– $n=1$, æœ‰ $\binom{n+k-1}{k} = \binom{k}{k} = 1$, æ‰€ä»¥<br>$$\frac{1}{1-z} = \sum_{k=0}^\infty\; z^k = 1 + z + z^2 + z^3 + \cdots$$</p><p>ç±»ä¼¼åœ°, æœ‰<br>$$\frac{1}{1+z} = \sum_{k=0}^\infty\; (-1)^k z^k = 1 - z + z^2 - z^3 \cdots$$</p><p>ç¨å¾®æ€»ç»“ä¸€ä¸‹</p><p>å¦‚æœ $n$ æ˜¯æ­£æ•´æ•°, $r$ æ˜¯é $0$ å®æ•°, é‚£ä¹ˆ<br>$$(1-rx)^{-n} = \sum_{k=0}^\infty\; \binom{-n}{k} (-rx)^k$$</p><p>æˆ–ç­‰ä»·åœ°, æœ‰<br>$$\frac{1}{(1-rx)^n} = \sum_{k=0}^\infty\; \binom{n+k-1}{k} r^k x^k$$</p><p>å…¶ä¸­ $|x| &lt; \frac{1}{|r|}$.</p><h3 id="ä¸€äº›ä¾‹å­"><a href="#ä¸€äº›ä¾‹å­" class="headerlink" title="ä¸€äº›ä¾‹å­"></a>ä¸€äº›ä¾‹å­</h3><p>å¯èƒ½åœ¨ç”Ÿæˆå‡½æ•°æœ‰å…³çš„é¢˜ç›®ä¼šç”¨åˆ°è¿™äº›ä¸œè¥¿å§â€¦</p><p>$$1 + x + x^2 + \cdots = \frac{1}{1-x} \\<br>1 + x^2 + x^4 + \cdots = 1 + (x)^2 + (x^2)^2 + \cdots = \frac{1}{1 - x^2} \\<br>x + x^2 + x^3 + \cdots = x\; (1 + x + x^2 + \cdots) = \frac{x}{1 - x} \\<br>1 + x + x^2 + x^3 + x^4 = \frac{1 - x^5}{1-x}$$</p><p>æœ€åä¸€ä¸ªå¼å­ä¼¼ä¹æ˜¯ä¹±å…¥çš„â€¦ ä¸è¿‡è¿˜å¥½æ˜¯æ˜¾ç„¶çš„, ç›´æ¥é€šåˆ†éªŒè¯å³å¯</p><h3 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h3><h4 id="BZOJ-3028-é£Ÿç‰©"><a href="#BZOJ-3028-é£Ÿç‰©" class="headerlink" title="BZOJ 3028 é£Ÿç‰©"></a>BZOJ 3028 é£Ÿç‰©</h4><ul><li>é¢˜ç›®é“¾æ¥: <a href="https://lydsy.com/JudgeOnline/problem.php?id=3028" target="_blank" rel="noopener">https://lydsy.com/JudgeOnline/problem.php?id=3028</a></li></ul><p><del>ä¹è‰² OJ ä»€ä¹ˆéƒ½æ˜¯æƒé™é¢˜</del> = =</p><p>é¦–å…ˆæ‚¨è¦å­¦ä¼šç”Ÿæˆå‡½æ•°, ç„¶åè¿™å°±æ˜¯ä¸€é“è£¸é¢˜.</p><p>è®¾ç”Ÿæˆå‡½æ•°ä¸º $g(x)$, åŒ–ç®€åå¾—<br>$$g(x) = \frac{x}{(1-x)^4} = x \sum_{k=0}^\infty\; \binom{k+3}{k} x^k = \sum_{k=0}^\infty\; \binom{k+2}{k-1} x^k$$</p><p>æ‰€ä»¥ç¬¬ $n$ é¡¹ç³»æ•°, å³ç­”æ¡ˆ, ä¸º $\binom{n+2}{n-1} = \binom{n+2}{3} = \frac{1}{6} n(n+1)(n+2)$</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li>Richard A. Brualdi. ç»„åˆæ•°å­¦. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2012.4.</li></ul><hr>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;æ•°å­¦å°±æ˜¯ç”¨çš„æ—¶å€™ä¸å¤Ÿç”¨çš„ä¸œè¥¿. = =&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;ç»¼è¿°&quot;&gt;&lt;a href=&quot;#ç»¼è¿°&quot; class=&quot;headerlink&quot; title=&quot;ç»¼è¿°&quot;&gt;&lt;/a&gt;ç»¼è¿°&lt;/h2&gt;&lt;p&gt;ç‰›é¡¿äºŒé¡¹å¼å®šç†æ˜¯å¯¹äºŒé¡¹å¼å®šç†çš„æ¨å¹¿, &lt;del&gt;é‚£ç›´æ¥å«å¹¿ä¹‰äºŒé¡¹å¼å®šç†ä¸å¥½å—&lt;/del&gt;, åˆšå¼€å§‹çœ‹ &amp;lt;ç»„åˆæ•°å­¦&amp;gt; çš„æ—¶å€™è§åˆ°è¿™ä¸ªä¸œè¥¿, ä»¥ä¸ºæ²¡ä»€ä¹ˆç”¨ = =, åæ¥â€¦&lt;/p&gt;
&lt;p&gt;å½“ç„¶æœ¬æ–‡ä½œè€…æ²¡æœ‰ä»”ç»†ä¸¥è°¨åœ°å­¦ä¹ ç›¸å…³çš„æ•°å­¦çŸ¥è¯†, å†…å®¹å……æ»¡è°¬è¯¯, æ³è¯·æŒ‡æ­£.&lt;/p&gt;
    
    </summary>
    
    
      <category term="ç¬”è®°" scheme="https://depletedprism.github.io/categories/%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Combinatorics" scheme="https://depletedprism.github.io/tags/Combinatorics/"/>
    
  </entry>
  
  <entry>
    <title>ã€Œ51nod 1348ã€ä¹˜ç§¯ä¹‹å’Œ é¢˜è§£</title>
    <link href="https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/oj/51nod-1348/"/>
    <id>https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/oj/51nod-1348/</id>
    <published>2020-01-18T16:41:47.000Z</published>
    <updated>2020-02-06T03:35:32.288Z</updated>
    
    <content type="html"><![CDATA[<hr><ul><li>é¢˜ç›®é“¾æ¥: <a href="https://www.51nod.com/Challenge/Problem.html#problemId=1348" target="_blank" rel="noopener">https://www.51nod.com/Challenge/Problem.html#problemId=1348</a></li></ul><p>åˆ†æ²» FFT å¦‚æœä½¿ç”¨ä¸‰æ¨¡æ•° NTT, é‚£ä¹ˆæ¯æ¬¡åˆå¹¶åªéœ€è¦è®°å½•å®é™…æ¨¡æ•°ä¸‹çš„ç­”æ¡ˆâ€¦</p><a id="more"></a><h4 id="é¢˜ç›®æ€è·¯"><a href="#é¢˜ç›®æ€è·¯" class="headerlink" title="é¢˜ç›®æ€è·¯"></a>é¢˜ç›®æ€è·¯</h4><p>é¦–å…ˆå®¹æ˜“å‘ç°, å¤šæ¬¡è¯¢é—®æ˜¯ä¸ªå‡çš„é™åˆ¶, å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥é¢„å…ˆè®¡ç®—å‡ºæ‰€ä»¥ç­”æ¡ˆ, ç„¶åæ¯æ¬¡ $O(1)$ å›ç­”â€¦</p><p>å¯¹äºæ¯ä¸ªæ•°, æœ‰é€‰å’Œä¸é€‰ä¸¤ç§é€‰æ‹©, å®¹æ˜“æ„é€ å‡ºç”Ÿæˆå‡½æ•° $g(x)$ å¦‚ä¸‹, é€‰æ‹© $k$ ä¸ªæ•°çš„ä¹˜ç§¯å³ä¸º $x^k$ å¯¹åº”é¡¹çš„ç³»æ•°.<br>$$g(x) = \prod_{i=1}^n (a_i x + 1)$$</p><p>ç°åœ¨çš„é—®é¢˜å°±æ˜¯å¦‚ä½•è®¡ç®—è¿™ä¸ªå¼å­, æœ‰ä¸€ç§æ— è„‘ä¸”ç›´æ¥çš„æ–¹æ³•å°±æ˜¯åˆ†æ²» FFTâ€¦</p><p>ä¸è¿‡å€¼å¾—æ³¨æ„çš„æ˜¯, è¿™å±‘é¢˜çš„æ¨¡æ•°ä¸º $100003 = 2\times 3\times 7\times 2381 + 1$, å¹¶ä¸æ˜¯å‹å¥½çš„ NTT æ¨¡æ•°, äºæ˜¯ä½¿ç”¨ä¸‰æ¨¡æ•° NTT, (å®é™…ä¸Šè¿™ä¸ªæ¨¡æ•°å¾ˆå°, ç”¨åŒæ¨¡æ•° NTT å°±è¶³å¤Ÿäº†), ç»Ÿè®¡ç­”æ¡ˆçš„æ—¶å€™ä¸­å›½å‰©ä½™å®šç†åˆå¹¶å³å¯.</p><p>ç„¶åæˆ‘å°±å†™å‡ºäº†è¿™æ ·çš„ä¹è‰²ä»£ç </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">divide</span><span class="params">(<span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">int</span>* a, Num* f)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (L == R) <span class="keyword">return</span> f[<span class="number">0</span>] = Num(<span class="number">1</span>), <span class="keyword">void</span>( f[<span class="number">1</span>] = Num(a[L]) );</span><br><span class="line">    <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>, Lim = <span class="number">1</span>, K = <span class="number">0</span>;</span><br><span class="line">    Num *f0 = tmp[++idx], *f1 = tmp[++idx];</span><br><span class="line">    divide(L, Mid, a, f0), divide(Mid+<span class="number">1</span>, R, a, f1);</span><br><span class="line">    <span class="keyword">while</span> (Lim &lt;= R-L+<span class="number">1</span>) Lim &lt;&lt;= <span class="number">1</span>, ++K;</span><br><span class="line">    init(Lim, K), NTT(f0, Lim, <span class="number">1</span>), NTT(f1, Lim, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) f[i] = f0[i] * f1[i], f0[i] = f1[i] = Num(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// æ³¨æ„åˆ°è¿™é‡Œ f ä¸ºåœ¨ä¸‰æ¨¡æ•°æ„ä¹‰ä¸‹çš„ä¸‰ä¸ªå€¼, è€Œä¸æ˜¯æ¨¡ 100003 æ„ä¹‰ä¸‹çš„ç­”æ¡ˆ (</span></span><br><span class="line">    NTT(f, Lim, <span class="number">-1</span>), idx -= <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæ¥ä¸‹æ¥å°±è°ƒäº†å¥½é•¿æ—¶é—´ = =, ç»ˆäºå‘ç°äº†è¿™ä¸ªé”…,  <del>å…¶å®æƒ³ä¸€æƒ³ä¹ŸæŒºæœ‰é“ç†çš„</del></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">divide</span><span class="params">(<span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">int</span>* a, <span class="keyword">int</span>* f)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (L == R) <span class="keyword">return</span> f[<span class="number">0</span>] = <span class="number">1</span>, <span class="keyword">void</span>( f[<span class="number">1</span>] = a[L] );</span><br><span class="line">    <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>, *f0 = tmp[++idx], *f1 = tmp[++idx];</span><br><span class="line">    divide(L, Mid, a, f0), divide(Mid+<span class="number">1</span>, R, a, f1);</span><br><span class="line">    <span class="keyword">int</span> Lim = <span class="number">1</span>, K = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (Lim &lt;= R-L+<span class="number">1</span>) Lim &lt;&lt;= <span class="number">1</span>, ++K;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= Mid-L+<span class="number">1</span>; ++i) A[i] = Num(f0[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = Mid-L+<span class="number">2</span>; i &lt; Lim; ++i) A[i] = Num(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= R-Mid; ++i) B[i] = Num(f1[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = R-Mid+<span class="number">1</span>; i &lt; Lim; ++i) B[i] = Num(<span class="number">0</span>);</span><br><span class="line">    init(Lim, K), NTT(A, Lim, <span class="number">1</span>), NTT(B, Lim, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) A[i] = A[i] * B[i], f0[i] = f1[i] = <span class="number">0</span>;</span><br><span class="line">    NTT(A, Lim, <span class="number">-1</span>), idx -= <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= R-L+<span class="number">1</span>; ++i) f[i] = A[i].Merge();</span><br><span class="line">    <span class="comment">// åªè®°å½•æ¨¡ 100003 ä¸‹çš„ç­”æ¡ˆ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 51nod 1348</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXSIZE = <span class="number">1</span> &lt;&lt; <span class="number">18</span> | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Gc</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> p1 == p2 &amp;&amp; (p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>), p1 == p2)? EOF: *p1++; &#125;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp; x)</span> </span>&#123;</span><br><span class="line">        x = <span class="number">0</span>; <span class="keyword">int</span> f = <span class="number">0</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) f |= ch == <span class="string">'-'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>, ch = Gc();</span><br><span class="line">        <span class="keyword">if</span> (f) x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> IO::read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">3e5</span>+<span class="number">5</span>, invP1 = <span class="number">669690699</span>, invP12 = <span class="number">354521948</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P1 = <span class="number">998244353</span>, P2 = <span class="number">1004535809</span>, P3 = <span class="number">469762049</span>, G = <span class="number">3</span>, mod = <span class="number">100003</span>;</span><br><span class="line"><span class="keyword">const</span> LL P12 = <span class="number">1L</span>L * P1 * P2;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Num</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> a, b, c;</span><br><span class="line">    Num() &#123; a = b = c = <span class="number">0</span>; &#125;</span><br><span class="line">    Num(<span class="keyword">int</span> _x): a(_x), b(_x), c(_x) &#123; &#125;</span><br><span class="line">    Num(<span class="keyword">int</span> _a, <span class="keyword">int</span> _b, <span class="keyword">int</span> _c): a(_a), b(_b), c(_c) &#123; &#125;</span><br><span class="line">    <span class="function">Num <span class="title">Mod</span><span class="params">(<span class="keyword">const</span> Num&amp; x)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Num(x.a + (x.a &gt;&gt; <span class="number">31</span> &amp; P1), x.b + (x.b &gt;&gt; <span class="number">31</span> &amp; P2), x.c + (x.c &gt;&gt; <span class="number">31</span> &amp; P3));</span><br><span class="line">    &#125;</span><br><span class="line">    Num <span class="keyword">operator</span> + (<span class="keyword">const</span> Num&amp; rhs) <span class="keyword">const</span> &#123; <span class="keyword">return</span> Mod(Num(a + rhs.a - P1, b + rhs.b - P2, c + rhs.c - P3)); &#125;</span><br><span class="line">    Num <span class="keyword">operator</span> - (<span class="keyword">const</span> Num&amp; rhs) <span class="keyword">const</span> &#123; <span class="keyword">return</span> Mod(Num(a - rhs.a, b - rhs.b, c - rhs.c)); &#125;</span><br><span class="line">    Num <span class="keyword">operator</span> * (<span class="keyword">const</span> Num&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Num(<span class="number">1L</span>L * a * rhs.a % P1, <span class="number">1L</span>L * b * rhs.b % P2, <span class="number">1L</span>L * c * rhs.c % P3);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Merge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        LL x = <span class="number">1L</span>L * (b - a + P2) % P2 * invP1 % P2 * P1 + a;</span><br><span class="line">        <span class="keyword">return</span> (<span class="number">1L</span>L * (c - x % P3 + P3) % P3 * invP12 % P3 * (P12 % mod) % mod + x) % mod;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fpow</span><span class="params">(<span class="keyword">int</span> base, <span class="keyword">int</span> b, <span class="keyword">int</span> P)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (b &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>) ret = <span class="number">1L</span>L * base * ret % P;</span><br><span class="line">        base = <span class="number">1L</span>L * base * base % P, b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Poly &#123;</span><br><span class="line">    Num A[MAXN], B[MAXN];</span><br><span class="line">    <span class="keyword">int</span> r[MAXN], tmp[<span class="number">31</span>][MAXN], idx = <span class="number">-1</span>;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; Lim, <span class="keyword">const</span> <span class="keyword">int</span>&amp; L)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; Lim; ++i) r[i] = (r[i&gt;&gt;<span class="number">1</span>] &gt;&gt; <span class="number">1</span>) | ((i &amp; <span class="number">1</span>) &lt;&lt; (L<span class="number">-1</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">NTT</span><span class="params">(Num* f, <span class="keyword">const</span> <span class="keyword">int</span>&amp; Lim, <span class="keyword">const</span> <span class="keyword">int</span>&amp; type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; Lim; ++i) <span class="keyword">if</span> (i &lt; r[i]) swap(f[i], f[r[i]]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> Mid = <span class="number">1</span>; Mid &lt; Lim; Mid &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="function">Num <span class="title">unit</span><span class="params">( fpow(type &gt; <span class="number">0</span>? G: fpow(G, P1<span class="number">-2</span>, P1), (P1<span class="number">-1</span>) / (Mid &lt;&lt; <span class="number">1</span>), P1), </span></span></span><br><span class="line"><span class="function"><span class="params">                      fpow(type &gt; <span class="number">0</span>? G: fpow(G, P2<span class="number">-2</span>, P2), (P2<span class="number">-1</span>) / (Mid &lt;&lt; <span class="number">1</span>), P2),</span></span></span><br><span class="line"><span class="function"><span class="params">                      fpow(type &gt; <span class="number">0</span>? G: fpow(G, P3<span class="number">-2</span>, P3), (P3<span class="number">-1</span>) / (Mid &lt;&lt; <span class="number">1</span>), P3) )</span></span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; i += Mid &lt;&lt; <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="function">Num <span class="title">w</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; Mid; ++j, w = w * unit) &#123;</span><br><span class="line">                    Num f0 = f[i+j], f1 = w * f[i+j+Mid];</span><br><span class="line">                    f[i+j] = f0 + f1, f[i+j+Mid] = f0 - f1;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (type &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="function">Num <span class="title">inv</span><span class="params">( fpow(Lim, P1<span class="number">-2</span>, P1), fpow(Lim, P2<span class="number">-2</span>, P2), fpow(Lim, P3<span class="number">-2</span>, P3) )</span></span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) f[i] = f[i] * inv;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">divide</span><span class="params">(<span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">int</span>* a, <span class="keyword">int</span>* f)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (L == R) <span class="keyword">return</span> f[<span class="number">0</span>] = <span class="number">1</span>, <span class="keyword">void</span>( f[<span class="number">1</span>] = a[L] );</span><br><span class="line">        <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>, *f0 = tmp[++idx], *f1 = tmp[++idx];</span><br><span class="line">        divide(L, Mid, a, f0), divide(Mid+<span class="number">1</span>, R, a, f1);</span><br><span class="line">        <span class="keyword">int</span> Lim = <span class="number">1</span>, K = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (Lim &lt;= R-L+<span class="number">1</span>) Lim &lt;&lt;= <span class="number">1</span>, ++K;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= Mid-L+<span class="number">1</span>; ++i) A[i] = Num(f0[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = Mid-L+<span class="number">2</span>; i &lt; Lim; ++i) A[i] = Num(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= R-Mid; ++i) B[i] = Num(f1[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = R-Mid+<span class="number">1</span>; i &lt; Lim; ++i) B[i] = Num(<span class="number">0</span>);</span><br><span class="line">        init(Lim, K), NTT(A, Lim, <span class="number">1</span>), NTT(B, Lim, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) A[i] = A[i] * B[i], f0[i] = f1[i] = <span class="number">0</span>;</span><br><span class="line">        NTT(A, Lim, <span class="number">-1</span>), idx -= <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= R-L+<span class="number">1</span>; ++i) f[i] = A[i].Merge();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, q;</span><br><span class="line"><span class="keyword">int</span> A[MAXN], f[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// input</span></span><br><span class="line">    read(n), read(q);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) read(A[i]);</span><br><span class="line">    <span class="comment">// solve</span></span><br><span class="line">    Poly::divide(<span class="number">1</span>, n, A, f);</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> K;</span><br><span class="line">        read(K), <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, f[K]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;é¢˜ç›®é“¾æ¥: &lt;a href=&quot;https://www.51nod.com/Challenge/Problem.html#problemId=1348&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.51nod.com/Challenge/Problem.html#problemId=1348&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åˆ†æ²» FFT å¦‚æœä½¿ç”¨ä¸‰æ¨¡æ•° NTT, é‚£ä¹ˆæ¯æ¬¡åˆå¹¶åªéœ€è¦è®°å½•å®é™…æ¨¡æ•°ä¸‹çš„ç­”æ¡ˆâ€¦&lt;/p&gt;
    
    </summary>
    
    
      <category term="é¢˜è§£" scheme="https://depletedprism.github.io/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="Polynomial" scheme="https://depletedprism.github.io/tags/Polynomial/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŒBZOJ 5093ã€å›¾çš„ä»·å€¼ é¢˜è§£</title>
    <link href="https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/oj/BZOJ-5093/"/>
    <id>https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/oj/BZOJ-5093/</id>
    <published>2020-01-17T14:27:41.000Z</published>
    <updated>2020-02-27T16:50:20.289Z</updated>
    
    <content type="html"><![CDATA[<hr><blockquote><p> ç»„åˆæ•°å­¦å­¦ä¸æ˜ç™½ç¥­.</p></blockquote><ul><li>é¢˜ç›®é“¾æ¥: <a href="https://lydsy.com/JudgeOnline/problem.php?id=5093" target="_blank" rel="noopener">https://lydsy.com/JudgeOnline/problem.php?id=5093</a></li></ul><p>æ ¹æ®é¢˜æ„åˆ—å‡ºå¼å­, å¹¶é€šè¿‡ç¬¬äºŒç±» Stirling æ•°å¯¹å¼å­è¿›è¡ŒåŒ–ç®€, åœ¨åˆé€‚çš„æ—¶é—´å†…è®¡ç®—å‡ºç»“æœ.</p><a id="more"></a><h4 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h4><ul><li>NTT</li><li><p>ç¬¬äºŒç±» Stirling æ•°çš„ä¸€äº›æ€§è´¨</p><ul><li><p>$m^n=\sum_{i=0}^{m} \begin{Bmatrix}n \\ i\end{Bmatrix}\  i! \cdot  \binom{m}{i}$<br>æä¾›äº†ä¸€ä¸ªè®¡ç®—è‡ªç„¶æ•°å¹‚çš„æ–°æ€è·¯.</p></li><li><p>$\begin{Bmatrix} n\\ m\end{Bmatrix} =  \sum_{i=0}^{m} \frac{(-1)^i}{i!} \frac{(m-i)^n}{(m-i)!}$<br>æ˜¾ç„¶æ˜¯ä¸€ä¸ªå·ç§¯çš„å½¢å¼, å¯ä»¥åœ¨ $O(n \log n)$ çš„æ—¶é—´å¤æ‚åº¦è®¡ç®—.</p><p>è¯¦å°½çš„è§£é‡Šå¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°: <a href="https://www.cnblogs.com/y2823774827y/p/10700231.html" target="_blank" rel="noopener">https://www.cnblogs.com/y2823774827y/p/10700231.html</a></p></li></ul></li></ul><h4 id="é¢˜ç›®æ€è·¯"><a href="#é¢˜ç›®æ€è·¯" class="headerlink" title="é¢˜ç›®æ€è·¯"></a>é¢˜ç›®æ€è·¯</h4><p>è€ƒè™‘å•ç‹¬æšä¸¾ä¸€ä¸ªç‚¹çš„åº¦æ•° $i$, é‚£ä¹ˆç­”æ¡ˆå¯ä»¥è¡¨ç¤ºä¸º $$n \cdot \sum_{i=0}^{n-1} \binom{n-1}{i} i^k \cdot 2^{\frac{1}{2} (n-1)(n-2)}$$</p><p>å¦‚ä½•ç†è§£å‘¢? é¦–å…ˆ, æ¯ä¸ªç‚¹åœ¨æšä¸¾æ—¶æ˜¯ç­‰ä»·çš„, æ‰€ä»¥æœ€ç»ˆç»“æœä¹˜ $n$</p><p>å…¶æ¬¡, å½“å‰ç‚¹çš„è´¡çŒ®ä¸º $i^k$, è€ƒè™‘åº¦æ•°ä¸º $k$, å³åœ¨å‰©ä½™çš„ $n-1$ ä¸ªç‚¹ä¸­é€‰æ‹© $i$ ä¸ªç‚¹. è¦æ±‚æ— å‘å›¾æ— é‡è¾¹, å‰©ä½™çš„è¾¹éšæ„, æ–¹æ¡ˆæ•°ä¸º $2^{\frac{1}{2} (n-1)(n-2)}$.</p><p>æ•´ç†, å¾— $$n \cdot 2^{\frac{1}{2} (n-1)(n-2)} \sum_{i=0}^{n-1} \ \binom{n-1}{i} i^k$$</p><p>ç°åœ¨çš„é—®é¢˜ä¸»è¦åœ¨ååŠéƒ¨åˆ†, ç”±ç¬¬äºŒç±» Stirling æ•°çš„æ€§è´¨, å¾— $$\sum_{i=0}^{n-1} \ \binom{n-1}{i} \sum_{j=0}^{i} \  \begin{Bmatrix}k \\ j \end{Bmatrix}\ j!\ \binom{i}{j}$$</p><p>æ”¹å˜ $i, j$ çš„æšä¸¾é¡ºåº, æœ‰ $$\sum_{j=0}^{n-1}\ \begin{Bmatrix} k\\ j \end{Bmatrix} \cdot j! \ \sum_{i = j}^{n - 1}\ \binom{n-1}{i} \binom{i}{j}$$<br>ä¸è¿‡è¦æ³¨æ„åˆ° $\forall \ m &gt; n,\ \begin{Bmatrix} n \\ m \end{Bmatrix} = 0$</p><p>æ¥ä¸‹æ¥çš„ trick æ¥æºäº <a href="https://www.cnblogs.com/Tiw-Air-OAO/p/10286501.html" target="_blank" rel="noopener">Tiwâ€™s Blog</a>, è€ƒè™‘å³è¾¹å’Œå¼çš„ç»„åˆæ„ä¹‰, å³åœ¨ $n-1$ ä¸ªç‰©å“ä¸­é€‰å– $i$ ä¸ªç‰©å“, å¹¶åœ¨ $i$ ä¸ªç‰©å“ä¸­é€‰æ‹© $j$ ä¸ªçš„æ–¹æ¡ˆæ•°. å¯ä»¥å‘ç°, è¿™æ ·ç­‰åŒäºåœ¨ $n-1$ ä¸ªç‰©å“ä¸­é€‰æ‹© $j$ ä¸ª, å‰©ä¸‹éƒ¨åˆ†å¯é€‰å¯ä¸é€‰, è¿™æ ·å°±åŒ $i$ æ— å…³äº†. å¯å¾— $$\sum_{j=0}^{n-1}\ \begin{Bmatrix} k\\ j \end{Bmatrix} \cdot j! \ \binom{n-1}{j}\ 2^{ n-1-j } \\ \sum_{j=0}^{n-1}\ \begin{Bmatrix} k\\ j \end{Bmatrix} \ \frac{(n-1)!}{(n-1-j)!}\ 2^{ n-1-j }$$</p><p>æ¥ä¸‹æ¥å°±å¯ä»¥å†™äº†â€¦</p><p>å…ˆè®¡ç®— $k$ å¯¹åº”çš„ç¬¬äºŒç±» Stirling æ•°, ä¹‹å $O(n)$ æ‰«ä¸€éç»Ÿè®¡ç­”æ¡ˆ. å¼å­ä¸­é—´çš„ä¸€é¡¹åœ¨ $j$ å¢åŠ çš„è¿‡ç¨‹ä¸­æ¯æ¬¡åªå¤šå‡ºä¸€ä¸ªä¹˜ç§¯, é¡ºæ‰‹ç»´æŠ¤å°±å¥½äº†.</p><p>æœ€åç­”æ¡ˆ $$n \cdot 2^{\frac{1}{2} (n-1)(n-2)} \sum_{j=0}^{n-1}\ \begin{Bmatrix} k\\ j \end{Bmatrix} \ \frac{(n-1)!}{(n-1-j)!}\ 2^{ n-1-j }$$</p><h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**************************************************************</span></span><br><span class="line"><span class="comment">Â Â Â Â Problem: 5093</span></span><br><span class="line"><span class="comment">Â Â Â Â User: DepletedPrism</span></span><br><span class="line"><span class="comment">Â Â Â Â Language: C++</span></span><br><span class="line"><span class="comment">Â Â Â Â Result: Accepted</span></span><br><span class="line"><span class="comment">Â Â Â Â Time:10104 ms</span></span><br><span class="line"><span class="comment">Â Â Â Â Memory:20352 kb</span></span><br><span class="line"><span class="comment">****************************************************************/</span></span><br><span class="line">Â </span><br><span class="line"><span class="comment">// BZOJ 5093</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line">Â </span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e6</span>+<span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P = <span class="number">998244353</span>, G = <span class="number">3</span>, iG = <span class="number">332748118</span>;</span><br><span class="line">Â </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fpow</span><span class="params">(<span class="keyword">int</span> base, <span class="keyword">int</span> b, <span class="keyword">int</span> m = P)</span> </span>&#123;</span><br><span class="line">Â Â Â Â <span class="keyword">int</span> ret = <span class="number">1</span>;</span><br><span class="line">Â Â Â Â <span class="keyword">while</span> (b &gt; <span class="number">0</span>) &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">if</span> (b &amp; <span class="number">1</span>) ret = <span class="number">1L</span>L * ret * base % m;</span><br><span class="line">Â Â Â Â Â Â Â Â base = <span class="number">1L</span>L * base * base % m, b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line">Â </span><br><span class="line"><span class="keyword">namespace</span> Poly &#123;</span><br><span class="line">Â Â Â Â <span class="keyword">int</span> r[MAXN];</span><br><span class="line">Â Â Â Â <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; Lim, <span class="keyword">const</span> <span class="keyword">int</span>&amp; L)</span> </span>&#123;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; Lim; ++i) r[i] = (r[i&gt;&gt;<span class="number">1</span>] &gt;&gt; <span class="number">1</span>) | ((i &amp; <span class="number">1</span>) &lt;&lt; (L<span class="number">-1</span>));</span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">Â </span><br><span class="line">Â Â Â Â <span class="function"><span class="keyword">void</span> <span class="title">NTT</span><span class="params">(<span class="keyword">int</span>* f, <span class="keyword">int</span> Lim, <span class="keyword">int</span> type)</span> </span>&#123;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; Lim; ++i) <span class="keyword">if</span> (i &lt; r[i]) swap(f[i], f[r[i]]);</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">for</span> (<span class="keyword">int</span> Mid = <span class="number">1</span>; Mid &lt; Lim; Mid &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">int</span> unit = fpow(type &gt; <span class="number">0</span>? G: iG, (P<span class="number">-1</span>) / (Mid &lt;&lt; <span class="number">1</span>));</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; i += Mid &lt;&lt; <span class="number">1</span>) &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">int</span> w = <span class="number">1</span>;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; Mid; ++j, w = <span class="number">1L</span>L * w * unit % P) &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">int</span> f0 = f[i+j], f1 = <span class="number">1L</span>L * w * f[i+j+Mid] % P;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â f[i+j] = (f0 + f1) % P, f[i+j+Mid] = (f0 - f1 + P) % P;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">if</span> (type &lt; <span class="number">0</span>) &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">int</span> inv = fpow(Lim, P<span class="number">-2</span>);</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) f[i] = <span class="number">1L</span>L * f[i] * inv % P;</span><br><span class="line">Â Â Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">&#125;</span><br><span class="line">Â </span><br><span class="line"><span class="keyword">int</span> n, K;</span><br><span class="line"><span class="keyword">int</span> f[MAXN], g[MAXN];</span><br><span class="line"><span class="keyword">int</span> inv[MAXN], fac[MAXN];</span><br><span class="line">Â </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">Â Â Â Â freopen(<span class="string">"input.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">Â Â Â Â <span class="comment">// input</span></span><br><span class="line">Â Â Â Â <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;K);</span><br><span class="line">Â Â Â Â <span class="comment">// init</span></span><br><span class="line">Â Â Â Â inv[<span class="number">0</span>] = fac[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">Â Â Â Â <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= K; ++i) fac[i] = <span class="number">1L</span>L * fac[i<span class="number">-1</span>] * i % P;</span><br><span class="line">Â Â Â Â inv[K] = fpow(fac[K], P<span class="number">-2</span>);</span><br><span class="line">Â Â Â Â <span class="keyword">for</span> (<span class="keyword">int</span> i = K; i; --i) inv[i<span class="number">-1</span>] = <span class="number">1L</span>L * i * inv[i] % P;</span><br><span class="line">Â Â Â Â <span class="comment">// solve</span></span><br><span class="line">Â Â Â Â <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= K; ++i) &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â f[i] = (i &amp; <span class="number">1</span>)? P-inv[i]: inv[i];</span><br><span class="line">Â Â Â Â Â Â Â Â g[i] = <span class="number">1L</span>L * fpow(i, K) * inv[i] % P;</span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â <span class="keyword">int</span> Lim = <span class="number">1</span>, L = <span class="number">0</span>;</span><br><span class="line">Â Â Â Â <span class="keyword">while</span> (Lim &lt;= <span class="number">2</span>*K) Lim &lt;&lt;= <span class="number">1</span>, ++L;</span><br><span class="line">Â Â Â Â Poly::init(Lim, L), Poly::NTT(f, Lim, <span class="number">1</span>), Poly::NTT(g, Lim, <span class="number">1</span>);</span><br><span class="line">Â Â Â Â <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Lim; ++i) f[i] = <span class="number">1L</span>L * f[i] * g[i] % P;</span><br><span class="line">Â Â Â Â Poly::NTT(f, Lim, <span class="number">-1</span>);</span><br><span class="line">Â Â Â Â <span class="comment">// output</span></span><br><span class="line">Â Â Â Â <span class="keyword">int</span> ans = <span class="number">0</span>, b = <span class="number">1L</span>L * (n<span class="number">-1</span>) * (n<span class="number">-2</span>) / <span class="number">2</span> % (P<span class="number">-1</span>);</span><br><span class="line">Â Â Â Â <span class="keyword">int</span> inv2 = fpow(<span class="number">2</span>, P<span class="number">-2</span>), mul = <span class="number">1</span>, pow2 = fpow(<span class="number">2</span>, n<span class="number">-1</span>);</span><br><span class="line">Â Â Â Â <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n &amp;&amp; i &lt;= K; ++i) &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â ans = (ans + <span class="number">1L</span>L * f[i] * mul % P * pow2 % P) % P;</span><br><span class="line">Â Â Â Â Â Â Â Â mul = <span class="number">1L</span>L * mul * (n-i<span class="number">-1</span>) % P, pow2 = <span class="number">1L</span>L * pow2 * inv2 % P;</span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, <span class="number">1L</span>L * ans * fpow(<span class="number">2</span>, b) % P * n % P);</span><br><span class="line">Â Â Â Â <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt; ç»„åˆæ•°å­¦å­¦ä¸æ˜ç™½ç¥­.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;é¢˜ç›®é“¾æ¥: &lt;a href=&quot;https://lydsy.com/JudgeOnline/problem.php?id=5093&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://lydsy.com/JudgeOnline/problem.php?id=5093&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ ¹æ®é¢˜æ„åˆ—å‡ºå¼å­, å¹¶é€šè¿‡ç¬¬äºŒç±» Stirling æ•°å¯¹å¼å­è¿›è¡ŒåŒ–ç®€, åœ¨åˆé€‚çš„æ—¶é—´å†…è®¡ç®—å‡ºç»“æœ.&lt;/p&gt;
    
    </summary>
    
    
      <category term="é¢˜è§£" scheme="https://depletedprism.github.io/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="Combinatorics" scheme="https://depletedprism.github.io/tags/Combinatorics/"/>
    
      <category term="Polynomial" scheme="https://depletedprism.github.io/tags/Polynomial/"/>
    
  </entry>
  
  <entry>
    <title>å°å­¦æ•°å­¦ä¹‹å‰ n ä¸ªæ­£æ•´æ•°çš„ a æ¬¡æ–¹ä¹‹å’Œ</title>
    <link href="https://depletedprism.github.io/%E7%AC%94%E8%AE%B0/sum-of-n/"/>
    <id>https://depletedprism.github.io/%E7%AC%94%E8%AE%B0/sum-of-n/</id>
    <published>2020-01-09T05:09:38.000Z</published>
    <updated>2020-02-27T16:50:20.289Z</updated>
    
    <content type="html"><![CDATA[<hr><blockquote><p>æˆ‘ä¸å¦‚å°å­¦ç”Ÿ.png</p></blockquote><p>ä½œä¸ºé«˜ä¸­ç”Ÿ, è¢«å°å­¦å¥¥ (chang) æ•° (shi) é’ˆå¯¹äº†.</p><p>äºæ˜¯, è¿™é‡Œé›†ä¸­äº†å½¢å¦‚ $\sum_{i=1}^n i^a,\ (a = 1,\ 2,\ 3,\ \ldots )$, å³å‰ $n$ ä¸ªæ­£æ•´æ•°çš„ $a$ æ¬¡æ–¹å’Œçš„è®¡ç®—å…¬å¼.</p><a id="more"></a><h2 id="ç®€å•ç»“è®º"><a href="#ç®€å•ç»“è®º" class="headerlink" title="ç®€å•ç»“è®º"></a>ç®€å•ç»“è®º</h2><p>é¦–å…ˆ, æœ‰ä»¥ä¸‹ç»“è®º</p><p>$$\sum_{i=1}^n i = \frac{n(n+1)}{2}$$</p><p>$$\sum_{i=1}^n i^2 = \frac{n(n+1)(2n+1)}{6}$$</p><p>$$\sum_{i=1}^n i^{3} = \frac{n^2(n+1)^2}{4}$$</p><p>è‡³æ­¤, æœ¬æ–‡ç»“æŸ, <del>ä½ ä¸åº”è¯¥åœ¨è¿™ä¸ªä¹è‰²ç»“è®ºä¸Šæµªè´¹å¤ªå¤šæ—¶é—´ (</del>.</p><h2 id="ç»“è®ºè¯æ˜"><a href="#ç»“è®ºè¯æ˜" class="headerlink" title="ç»“è®ºè¯æ˜"></a>ç»“è®ºè¯æ˜</h2><ul><li><p>$a = 1$</p><p>è®¾ $S_n = \sum_{i=1}^n i$, å¹¶å®¹æ˜“å‘ç°è¿™å°±æ˜¯ä¸ªå…¬å·®ä¸º $1$ çš„ç­‰å·®æ•°åˆ—, ç›´æ¥ä¸Šæ±‚å’Œå…¬å¼å³å¯.</p><p>ä½†æ˜¯, è¿™æ˜¯å°å­¦ç”Ÿçš„æ•°å­¦, æˆ‘ä»¬æ¢ä¸€ç§æ–¹å¼</p><p>$$S_n = 1 + 2 + 3 + \cdots + (n-2) + (n-1) + n \\ S_n = n + (n-1) + (n-2) + \cdots + 3 + 2 + 1$$</p><p>æ˜¾ç„¶æœ‰</p><p>$$2S_n = (n+1) + (n+1) + (n+1) + \cdots + (n+1) + (n+1) \\ S_n = \frac{n(n+1)}{2}$$</p><p>è¿™æ˜¯ä¸ªæ•°åˆ—é‡Œæ™®é€šçš„æŠ€å·§ â€œå€’åºç›¸åŠ â€, <del>ä¹Ÿå°±èƒ½æ‹¿æ¥éª—å°å­¦ç”Ÿç©äº†</del></p><p>ä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¸èƒ½æ¨å¹¿åˆ° $a=2$ çš„æƒ…å†µ, äºæ˜¯ç»§ç»­æ¢ä¸€ç§æ–¹å¼</p><p>æˆ‘ä»¬æœ‰ $(k-1)^2 = k^2 - 2k + 1$, ç§»é¡¹å¾— $k^2 - (k-1)^2 = 2k - 1$</p><p>æ‰€ä»¥ $$\sum_{k=1}^n k^2 - \sum_{k=1}^n (k-1)^2 = 2\sum_{k=1}^n k - n$$</p><p>$$\sum_{k=1}^n k^2 - \sum_{k=1}^{n-1} k^2 = 2\sum_{k=1}^n k - n$$</p><p>æ‰€ä»¥ $$n^2 = 2S_n - n \\ S_n = \frac{n(n+1)}{2}$$</p></li><li><p>$a = 2$</p><p>åŒæ ·, è®¾ $S_n = \sum_{i=1}^n i^2$, æœ‰ $(k-1)^3 = k^3 - 3k^2 + 3k - 1$</p><p>ç§»é¡¹, å¾— $$k^3 - (k-1)^3 = 3k^2 - 3k + 1$$</p><p>æ‰€ä»¥ $$\sum_{i=1}^n k^3 - \sum_{i=1}^n (k-1)^3 = 3 \sum_{k=1}^n k^2 - 3 \sum_{i=1}^n k + n$$</p><p>$$\sum_{i=1}^n k^3 - \sum_{i=1}^{n-1} k^3 = n^3 = 3 \sum_{k=1}^n k^2 - 3 \sum_{i=1}^n k + n$$</p><p>ç»è¿‡ä¸€ç•ªä»£æ¢, æœ‰ $$\sum_{k=1}^n k^2 = \frac{1}{3} n^3 + \frac{1}{2} n^2 + \frac{1}{6} n = \frac{n(n+1)(2n+1)}{6}$$</p></li><li><p>$a = 3$</p><p>åŒç†å¯å¾—, ç•™ç»™è¯»è€…å½“ä½œç»ƒä¹  (</p><p>$$\sum_{i=1}^n i^3 = \frac{n^2(n+1)^2}{4}$$</p><p>å½“ç„¶, è¿™ä¸ªå…¬å¼æœ‰å¦ä¸€ç§ç†è§£æ–¹å¼  $$\sum_{i=1}^n i^3 = (\sum_{i=1}^n i)^2 = \frac{n(n+1)}{2} \cdot \frac{n(n+1)}{2}$$</p><p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢, å¯ä»¥å‚è€ƒ <a href="https://proofwiki.org/wiki/Sum_of_Sequence_of_Cubes/Proof_by_Nicomachus" target="_blank" rel="noopener">Nicomachusâ€™s Proof</a></p></li><li><p>$a \geq 4$</p><p>å¯ä»¥ç”¨å¾ˆå¤šæ–¹æ³•åš, ç„¶è€Œæˆ‘åªä¼šæ‹‰æ ¼æœ—æ—¥æ’å€¼.</p><ul><li><p>æ‹‰æ ¼æœ—æ—¥æ’å€¼</p><p>è¯¦è§ <a href="https://codeforces.com/problemset/problem/622/F" target="_blank" rel="noopener">CF622F The Sum of the k-th Powers</a>, å¥½çš„å®ç°å¯ä»¥åœ¨ $O(a)$ çš„æ—¶é—´å†…è®¡ç®—.</p></li></ul></li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://brilliant.org/wiki/sum-of-n-n2-or-n3/" target="_blank" rel="noopener">https://brilliant.org/wiki/sum-of-n-n2-or-n3/</a></li><li><a href="https://proofwiki.org/wiki/Sum_of_Sequence_of_Cubes" target="_blank" rel="noopener">https://proofwiki.org/wiki/Sum_of_Sequence_of_Cubes</a></li></ul><hr>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;æˆ‘ä¸å¦‚å°å­¦ç”Ÿ.png&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä½œä¸ºé«˜ä¸­ç”Ÿ, è¢«å°å­¦å¥¥ (chang) æ•° (shi) é’ˆå¯¹äº†.&lt;/p&gt;
&lt;p&gt;äºæ˜¯, è¿™é‡Œé›†ä¸­äº†å½¢å¦‚ $\sum_{i=1}^n i^a,\ (a = 1,\ 2,\ 3,\ \ldots )$, å³å‰ $n$ ä¸ªæ­£æ•´æ•°çš„ $a$ æ¬¡æ–¹å’Œçš„è®¡ç®—å…¬å¼.&lt;/p&gt;
    
    </summary>
    
    
      <category term="ç¬”è®°" scheme="https://depletedprism.github.io/categories/%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Polynomial" scheme="https://depletedprism.github.io/tags/Polynomial/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŒCERC2014ã€Virus synthesis é¢˜è§£</title>
    <link href="https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/oj/luogu-P4762/"/>
    <id>https://depletedprism.github.io/%E9%A2%98%E8%A7%A3/sol/oj/luogu-P4762/</id>
    <published>2020-01-07T11:01:44.000Z</published>
    <updated>2020-03-09T14:47:03.974Z</updated>
    
    <content type="html"><![CDATA[<hr><ul><li>é¢˜ç›®é“¾æ¥: <a href="https://www.luogu.com.cn/problem/P4762" target="_blank" rel="noopener">https://www.luogu.com.cn/problem/P4762</a></li></ul><p>ä¸€é“å›æ–‡è‡ªåŠ¨æœº + DP çš„é¢˜, æ„Ÿè§‰èƒ½å¯å‘æ€è·¯ä»¥åŠå­¦ä¹ åˆ°ä¸€äº›æŠ€å·§, æ•…è®°ä¹‹.</p><a id="more"></a><h4 id="é¢˜ç›®æ€è·¯"><a href="#é¢˜ç›®æ€è·¯" class="headerlink" title="é¢˜ç›®æ€è·¯"></a>é¢˜ç›®æ€è·¯</h4><p>å‡è®¾å­—ç¬¦ä¸² $S$ çš„é•¿åº¦ä¸º $n$, å®¹æ˜“æƒ³åˆ° $O(n^3)$ çš„åŒºé—´ DP åšæ³•, ä½†æ˜¯ä¸å¤§å¯å– = =, çŠ¶æ€æ•°å°±å·²ç»åˆ°è¾¾äº† $O(n^2)$.</p><p>äºæ˜¯æ¢ä¸€ç§æ€è·¯, è®¾ $f(i)$ è¡¨ç¤ºæ„é€  PAM ä¸Šç¬¬ $i$ ä¸ªèŠ‚ç‚¹æ‰€ä»£è¡¨çš„å›æ–‡ä¸², ä¸” $len(i)$ ä¸ºå¶æ•°, æ‰€éœ€è¦çš„æœ€å°‘æ“ä½œæ¬¡æ•°, é‚£ä¹ˆ</p><ul><li><p>å¯¹äº $i$ çš„å­èŠ‚ç‚¹ $j$, æœ‰ $f(j) = f(i) + 1$</p><p>å› ä¸º PAM çš„èŠ‚ç‚¹è¡¨ç¤ºä¸€ä¸ªå›æ–‡ä¸², é‚£ä¹ˆ $j$ ä»£è¡¨çš„å›æ–‡ä¸²å¯ä»¥è§†ä¸º $i$ ä»£è¡¨çš„å›æ–‡ä¸²ä¸¤ç«¯å¤šå‡ºä¸€ä¸ªå­—ç¬¦. å› ä¸º $i$ æ˜¯å›æ–‡ä¸², è€ƒè™‘åœ¨æ„é€ å­—ç¬¦ä¸² $i$ æ—¶, ä¸€å®šä¼šæœ‰ä¸€æ¬¡ 2 æ“ä½œ, å¦åˆ™å°±ä¸æ˜¯æœ€ä¼˜è§£. é‚£ä¹ˆ, æˆ‘ä»¬å°±å¯ä»¥åœ¨è¿™æ¬¡ 2 æ“ä½œä¹‹å‰, åœ¨ $i$ çš„æŸç«¯æ·»åŠ ä¸€ä¸ªå­—ç¬¦, è¿™æ ·ä» $i$ åˆ° $j$ åªéœ€è¦ä¸€æ¬¡æ“ä½œ.</p></li><li><p>å‡è®¾ $j$ æ˜¯ $i$ çš„ä¸€ä¸ªå›æ–‡åç¼€, ä¸”æ»¡è¶³ $2 \cdot len(j) \leq len(i)$, æœ‰  $$f(i) = \min\{f(j) + 1 + len(i) / 2 - len(j)\}$$</p><p>è¿™é‡Œå°† $i$ è§†ä¸º $j$ é€šè¿‡ 1 æ“ä½œå¡«åˆ°ä¸€åŠ, å†é€šè¿‡ä¸€æ¬¡ 2 æ“ä½œæ„é€ è€Œæ¥.</p></li></ul><p>ç„¶åç­”æ¡ˆå¾ˆå¥½ç»Ÿè®¡äº†, å¯ä»¥æŠŠæœ€ç»ˆçš„å­—ç¬¦ä¸²è§†ä¸ºä¸€ä¸ªå›æ–‡ä¸²å’Œå¤šæ¬¡ 1 æ“ä½œå †å è€Œæˆ, é‚£ä¹ˆ $$ans = \min\{f(i) + n - len(i)\}$$</p><p>ç°åœ¨çš„é—®é¢˜å°±æ˜¯å¦‚ä½•å®ç°è½¬ç§». </p><p>å¯¹äºç¬¬ä¸€ä¸ªè½¬ç§», æ²¡ä»€ä¹ˆå¥½è¯´çš„, åœ¨ PAM å¶èŠ‚ç‚¹ä»ä¸Šåˆ°ä¸‹ BFS ä¸€éå°±å¥½äº†, (ä¼¼ä¹æœ‰åœ¨çº¿çš„åšæ³•, åœ¨æ–°åŠ å…¥èŠ‚ç‚¹æ—¶æ›´æ–° $f(i)$ çš„å€¼).</p><p>å¯¹äºç¬¬äºŒä¸ªè½¬ç§», éœ€è¦å¤„ç†å‡ºæ»¡è¶³ $i$ æ»¡è¶³ $2 \cdot len(j) \leq len(i)$ çš„æœ€é•¿å›æ–‡åç¼€, è®°ä¸º $trans(i)$ å¯ä»¥é€šè¿‡æ±‚ fail ç±»ä¼¼çš„æ–¹æ³•ç»´æŠ¤, åªæ˜¯åœ¨è·³ fail çš„æ—¶å€™å¤šäº†ä¸€ä¸ªé™åˆ¶æ¡ä»¶, ç›¸åŒçš„æŠ€å·§ä¹Ÿåœ¨ <a href="https://www.luogu.com.cn/problem/P4287" target="_blank" rel="noopener">[SHOI2011]åŒå€å›æ–‡</a> ä½¿ç”¨è¿‡.</p><h4 id="ç®€å•å®ç°"><a href="#ç®€å•å®ç°" class="headerlink" title="ç®€å•å®ç°"></a>ç®€å•å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Luogu P4762</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span>+<span class="number">5</span>, SIGMA = <span class="number">4</span>, INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">int</span> M[<span class="number">128</span>], f[MAXN];</span><br><span class="line"><span class="keyword">char</span> S[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> PAM &#123;</span><br><span class="line">    <span class="keyword">int</span> ch[MAXN][SIGMA], len[MAXN], trans[MAXN], fail[MAXN], last, nidx, ptr;</span><br><span class="line">    <span class="keyword">char</span> S[MAXN];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(ch, <span class="number">0</span>, <span class="keyword">sizeof</span> ch);</span><br><span class="line">        last = <span class="number">0</span>, nidx = <span class="number">1</span>;</span><br><span class="line">        len[<span class="number">0</span>] = <span class="number">0</span>, fail[<span class="number">0</span>] = <span class="number">1</span>, len[<span class="number">1</span>] = <span class="number">-1</span>;</span><br><span class="line">        S[ptr = <span class="number">0</span>] = <span class="string">'$'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">getfail</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (S[ptr-len[u]<span class="number">-1</span>] != S[ptr]) u = fail[u];</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">        S[++ptr] = c;</span><br><span class="line">        <span class="keyword">int</span> val = M[(<span class="keyword">int</span>) c], nd = getfail(last);</span><br><span class="line">        <span class="keyword">if</span> (!ch[nd][val]) &#123;</span><br><span class="line">            <span class="keyword">int</span> p = ++nidx;</span><br><span class="line">            len[p] = len[nd] + <span class="number">2</span>;</span><br><span class="line">            fail[p] = ch[getfail(fail[nd])][val];</span><br><span class="line">            <span class="keyword">if</span> (len[p] &lt;= <span class="number">2</span>) trans[p] = fail[p];</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">int</span> u = trans[nd];</span><br><span class="line">                <span class="comment">// int u = fail[nd];</span></span><br><span class="line">                <span class="comment">// å¦‚æœå†™æˆä»¥ä¸Šå†™æ³•, å¤æ‚åº¦å°±æ˜¯å‡çš„ = =</span></span><br><span class="line">                <span class="keyword">while</span> (S[ptr-len[u]<span class="number">-1</span>] != S[ptr] || <span class="number">2</span>*(len[u]+<span class="number">2</span>) &gt; len[p]) u = fail[u];</span><br><span class="line">                trans[p] = ch[u][val];</span><br><span class="line">            &#125;</span><br><span class="line">            ch[nd][val] = p;</span><br><span class="line">        &#125;</span><br><span class="line">        last = ch[nd][val];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> Q[MAXN], head, tail, ret;</span><br><span class="line">        <span class="built_in">memset</span>(f, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> f);</span><br><span class="line">        ret = n, f[<span class="number">0</span>] = <span class="number">1</span>, Q[head = tail = <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// æ³¨æ„ç­”æ¡ˆçš„æœ€å¤§å€¼ä¸º n, å¦‚æœä¸å­˜åœ¨é•¿åº¦ä¸ºå¶æ•°çš„å›æ–‡ä¸², é‚£ä¹ˆ min&#123;f&#125; = INF...</span></span><br><span class="line">        <span class="keyword">while</span> (head &lt;= tail) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = Q[head++];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> c = <span class="number">0</span>; c &lt; SIGMA; ++c) &#123;</span><br><span class="line">                <span class="keyword">int</span> i = ch[u][c];</span><br><span class="line">                <span class="keyword">if</span> (!i) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">int</span> j = trans[i];</span><br><span class="line">                f[i] = min(f[i], min(f[u] + <span class="number">1</span>, f[j] + <span class="number">1</span> + len[i] / <span class="number">2</span> - len[j]));</span><br><span class="line">                ret = min(ret, f[i] + n - len[i]);</span><br><span class="line">                Q[++tail] = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"1.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    M[<span class="string">'A'</span>] = <span class="number">0</span>, M[<span class="string">'C'</span>] = <span class="number">1</span>, M[<span class="string">'G'</span>] = <span class="number">2</span>, M[<span class="string">'T'</span>] = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">int</span> Ti;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;Ti);</span><br><span class="line">    <span class="keyword">while</span> (Ti--) &#123;</span><br><span class="line">        PAM::init();</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%s"</span>, S+<span class="number">1</span>);</span><br><span class="line">        n = (<span class="keyword">int</span>) <span class="built_in">strlen</span>(S+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) PAM::insert(S[i]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, PAM::solve());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸€äº›æŠ€å·§"><a href="#ä¸€äº›æŠ€å·§" class="headerlink" title="ä¸€äº›æŠ€å·§"></a>ä¸€äº›æŠ€å·§</h4><p>ä¸Šè¿°ä»£ç æˆåŠŸæ‹¿åˆ°äº† 67 pts çš„å¥½æˆç»©, åœ¨ç¬¬ä¸€ä¸ªç‚¹è·‘äº†å¾ˆä¹…â€¦</p><p>é€šè¿‡å­¦ä¹ å…¶ä»–äººçš„å¡å¸¸æŠ€å·§, ç®—æ˜¯å¡äº†è¿‡å»</p><ol><li>ç”¨åˆ°å†åˆå§‹åŒ– <code>ch</code> çš„å€¼</li><li>BFS éå† PAM æ—¶, æ¯ä¸ªèŠ‚ç‚¹åªæ›´æ–°ä¸€æ¬¡</li><li>ç»™ $f(i)$ èµ‹åˆå€¼ä¸ºèŠ‚ç‚¹çš„é•¿åº¦ $len(i)$, å¹¶åªåœ¨ $len(i)$ ä¸ºå¶æ•°çš„æ—¶å€™æ›´æ–° $f(i)$</li><li>ä½¿ç”¨ <code>ckmin</code> æ›´æ–°æœ€å°å€¼</li></ol><p>è¯è¯´ç”¨ <code>static</code> æŠŠæ•°ç»„å¼€åˆ°å‡½æ•°é‡Œä¼šå¿«ä¸€ç‚¹? ä¸æ˜æ‰€ä»¥.png</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Luogu P4762</span></span><br><span class="line"><span class="comment">// DeP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span>+<span class="number">5</span>, SIGMA = <span class="number">4</span>, INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">int</span> M[<span class="number">128</span>], f[MAXN];</span><br><span class="line"><span class="keyword">char</span> S[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> PAM &#123;</span><br><span class="line">    <span class="keyword">int</span> ch[MAXN][SIGMA], len[MAXN], trans[MAXN], fail[MAXN], last, nidx, ptr;</span><br><span class="line">    <span class="keyword">char</span> S[MAXN];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1.</span></span><br><span class="line">        <span class="built_in">memset</span>(ch[<span class="number">0</span>], <span class="number">0</span>, <span class="keyword">sizeof</span> ch[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">memset</span>(ch[<span class="number">1</span>], <span class="number">0</span>, <span class="keyword">sizeof</span> ch[<span class="number">1</span>]);</span><br><span class="line">        last = <span class="number">0</span>, nidx = <span class="number">1</span>;</span><br><span class="line">        len[<span class="number">0</span>] = <span class="number">0</span>, fail[<span class="number">0</span>] = <span class="number">1</span>, len[<span class="number">1</span>] = <span class="number">-1</span>;</span><br><span class="line">        S[ptr = <span class="number">0</span>] = <span class="string">'$'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">getfail</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (S[ptr-len[u]<span class="number">-1</span>] != S[ptr]) u = fail[u];</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">        S[++ptr] = c;</span><br><span class="line">        <span class="keyword">int</span> val = M[(<span class="keyword">int</span>) c], nd = getfail(last);</span><br><span class="line">        <span class="keyword">if</span> (!ch[nd][val]) &#123;</span><br><span class="line">            <span class="keyword">int</span> p = ++nidx;</span><br><span class="line">            <span class="comment">// 1.</span></span><br><span class="line">            <span class="built_in">memset</span>(ch[p], <span class="number">0</span>, <span class="keyword">sizeof</span> ch[p]);</span><br><span class="line">            len[p] = len[nd] + <span class="number">2</span>;</span><br><span class="line">            fail[p] = ch[getfail(fail[nd])][val];</span><br><span class="line">            <span class="keyword">if</span> (len[p] &lt;= <span class="number">2</span>) trans[p] = fail[p];</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">int</span> u = trans[nd];</span><br><span class="line">                <span class="keyword">while</span> (S[ptr-len[u]<span class="number">-1</span>] != S[ptr] || <span class="number">2</span>*(len[u]+<span class="number">2</span>) &gt; len[p]) u = fail[u];</span><br><span class="line">                trans[p] = ch[u][val];</span><br><span class="line">            &#125;</span><br><span class="line">            ch[nd][val] = p;</span><br><span class="line">        &#125;</span><br><span class="line">        last = ch[nd][val];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.</span></span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">ckmin</span><span class="params">(T&amp; x, <span class="keyword">const</span> T&amp; y)</span> </span>&#123; <span class="keyword">if</span> (x &gt; y) x = y; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> vis[MAXN], Time, Q[MAXN], head, tail, ret;</span><br><span class="line">        ++Time;</span><br><span class="line">        <span class="comment">// 3.</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= nidx; ++i) f[i] = len[i];</span><br><span class="line">        ret = n, f[<span class="number">0</span>] = <span class="number">1</span>, Q[head = tail = <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (head &lt;= tail) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = Q[head++];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> c = <span class="number">0</span>; c &lt; SIGMA; ++c) &#123;</span><br><span class="line">                <span class="keyword">int</span> i = ch[u][c];</span><br><span class="line">                <span class="keyword">if</span> (!i) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">int</span> j = trans[i];</span><br><span class="line">                f[i] = f[u] + <span class="number">1</span>;</span><br><span class="line">                <span class="comment">// 3.</span></span><br><span class="line">                <span class="keyword">if</span> (len[i] % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line">                    ckmin(f[i], f[j] + <span class="number">1</span> + len[i] / <span class="number">2</span> - len[j]);</span><br><span class="line">                ckmin(ret, f[i] + n - len[i]);</span><br><span class="line">                <span class="comment">// 2.</span></span><br><span class="line">                <span class="keyword">if</span> (vis[i] != Time) Q[++tail] = i, vis[i] = Time;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"1.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    M[<span class="string">'A'</span>] = <span class="number">0</span>, M[<span class="string">'C'</span>] = <span class="number">1</span>, M[<span class="string">'G'</span>] = <span class="number">2</span>, M[<span class="string">'T'</span>] = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">int</span> Ti;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;Ti);</span><br><span class="line">    <span class="keyword">while</span> (Ti--) &#123;</span><br><span class="line">        PAM::init();</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%s"</span>, S+<span class="number">1</span>);</span><br><span class="line">        n = (<span class="keyword">int</span>) <span class="built_in">strlen</span>(S+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) PAM::insert(S[i]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, PAM::solve());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;é¢˜ç›®é“¾æ¥: &lt;a href=&quot;https://www.luogu.com.cn/problem/P4762&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.luogu.com.cn/problem/P4762&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸€é“å›æ–‡è‡ªåŠ¨æœº + DP çš„é¢˜, æ„Ÿè§‰èƒ½å¯å‘æ€è·¯ä»¥åŠå­¦ä¹ åˆ°ä¸€äº›æŠ€å·§, æ•…è®°ä¹‹.&lt;/p&gt;
    
    </summary>
    
    
      <category term="é¢˜è§£" scheme="https://depletedprism.github.io/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="Dynamic Programing" scheme="https://depletedprism.github.io/tags/Dynamic-Programing/"/>
    
      <category term="String" scheme="https://depletedprism.github.io/tags/String/"/>
    
  </entry>
  
</feed>
