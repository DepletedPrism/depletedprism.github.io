<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<title>
  
    一些简单的图计数问题
  
</title>

<meta name="description" content="老年健忘选手终于下定决心去学数数了. 综述大概是利用生成函数推出一些式子, 然后拿多项式去算吧 &#x3D; &#x3D;">
<meta property="og:type" content="article">
<meta property="og:title" content="一些简单的图计数问题">
<meta property="og:url" content="https://depletedprism.github.io/memos/graph-count/index.html">
<meta property="og:site_name" content="DepletedPrism&#39;s Blog">
<meta property="og:description" content="老年健忘选手终于下定决心去学数数了. 综述大概是利用生成函数推出一些式子, 然后拿多项式去算吧 &#x3D; &#x3D;">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-04-07T13:31:16.000Z">
<meta property="article:modified_time" content="2022-08-04T13:42:25.801Z">
<meta property="article:author" content="DepletedPrism">
<meta property="article:tag" content="Combinatorics">
<meta property="article:tag" content="Polynomial">
<meta name="twitter:card" content="summary">


  <link rel="alternative" href="/atom.xml" title="DepletedPrism&#39;s Blog" type="application/atom+xml">



  <link rel="icon" href="/images/favicon.jpg">



<link rel="stylesheet" href="/perfect-scrollbar/css/perfect-scrollbar.min.css">


<link rel="stylesheet" href="/styles/main.css">







<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"></head>
<body
  
    class="monochrome"
  
  >
  <div class="mobile-header">
  <button class="sidebar-toggle" type="button">
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
  </button>
  <a class="title" href="/">DepletedPrism&#39;s Blog</a>
</div>

  <div class="main-container">
    <div class="sidebar">
  <div class="header">
    <h1 class="title"><a href="/">DepletedPrism&#39;s Blog</a></h1>
    
      <p class="subtitle">
        厌离秽土, 欣求净土.
      </p>
    
    <div class="info">
      <div class="content">
        
        
          <div class="author">DepletedPrism</div>
        
      </div>
      
        <div class="avatar">
          
            <a href="/about"><img src="/images/favicon.jpg"></a>
          
        </div>
      
    </div>
  </div>
  <div class="body">
    
      
        <ul class="nav">
          
            
              <li class="category-list-container">
                <a href="javascript:;">分类</a>
                <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9A%8F%E7%AC%94/">随笔</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%A2%98%E8%A7%A3/">题解</a><span class="category-list-count">48</span></li></ul>
              </li>
            
          
            
              <li class="tag-list-container">
                <a href="javascript:;">标签</a>
                <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Calculus/" rel="tag">Calculus</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Combinatorics/" rel="tag">Combinatorics</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DP/" rel="tag">DP</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Data-Structure/" rel="tag">Data Structure</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Game-Theory/" rel="tag">Game Theory</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Geometry/" rel="tag">Geometry</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Graph/" rel="tag">Graph</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Greedy/" rel="tag">Greedy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Number-Theory/" rel="tag">Number Theory</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Polynomial/" rel="tag">Polynomial</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Probability/" rel="tag">Probability</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/String/" rel="tag">String</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vim/" rel="tag">Vim</a><span class="tag-list-count">1</span></li></ul>
              </li>
            
          
            
              <li class="archive-list-container">
                <a href="javascript:;">归档</a>
                <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/9102/">9102</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/">2022</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a><span class="archive-list-count">42</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a><span class="archive-list-count">15</span></li></ul>
              </li>
            
          
        </ul>
      
        <ul class="nav">
          
            
              <li>
                <a href="/index.html" title="Homepage" external="false">Homepage</a>
              </li>
            
          
        </ul>
      
        <ul class="nav">
          
            
              <li>
                <a href="https://github.com/DepletedPrism" title="Github" target="_blank" rel="noopener">Github</a>
              </li>
            
          
            
              <li>
                <a href="https://codeforces.com/profile/DepletedPrism" title="Codeforces" target="_blank" rel="noopener">Codeforces</a>
              </li>
            
          
        </ul>
      
    
  </div>
</div>

    <div class="main-content">
      
        <div style="max-width: 1000px">
      
          <article id="post-memos/graph-count" class="article article-type-post">
  
    <h1 class="article-header">
      一些简单的图计数问题
    </h1>
  
  

  <div class="article-info">
    <span class="article-date">
  2020-04-07
</span>

    
	<span class="article-category tagcloud">
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a></li></ul>
	</span>


    
	<span class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Combinatorics/" rel="tag">Combinatorics</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Polynomial/" rel="tag">Polynomial</a></li></ul>
	</span>


	
  </div>
  <div class="article-entry">
    <hr>
<p><del>老年健忘选手终于下定决心去学数数了.</del></p>
<h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2><p>大概是利用生成函数推出一些式子, 然后拿多项式去算吧 = =</p>
<span id="more"></span>
<h2 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h2><ol>
<li><p>多项式的相关运算</p>
<p>最好有跑地比谁都快的板子, 以免在做题的时候被卡常.</p>
</li>
<li><p>生成函数</p>
<p>对于一个数列 $\{ a_n \}$, 有</p>
<p>$\{ a_n \}$ 的普通生成函数 (<strong>O</strong>rdinary <strong>G</strong>enerating <strong>F</strong>unction, OGF), 为</p>
<script type="math/tex; mode=display">g(x) = \sum\limits_{k = 0}^\infty a_k x^k</script><p>常用于处理无标号计数问题.</p>
<p>$\{ a_n \}$ 的指数生成函数, (<strong>E</strong>xponential <strong>G</strong>enerating <strong>F</strong>unction, EGF), 为</p>
<script type="math/tex; mode=display">g(x) = \sum\limits_{k = 0}^\infty a_k \frac{x^k}{k!}</script><p>常用于处理有标号计数问题.</p>
<p>$\{ a_n \}$ 的组合生成函数, 为</p>
<script type="math/tex; mode=display">g(x) = \sum\limits_{k = 0}^\infty a_k \frac{x^k}{2 ^ \binom{k}{2} k!}</script><p>其中 “组合生成函数” 是从 JOHNKRAM 课件里看来的新东西, 似乎只在有标号有向图计数中用到过…</p>
</li>
<li><p>拉格朗日反演</p>
<p>在遇到多项式复合逆的时候快速计算出某一位的值. 如果要计算多个位的值, 可考虑分块. 详见 <a href="https://www.luogu.com.cn/problem/P5809">Luogu P5809 【模板】多项式复合逆</a>.</p>
<p>设多项式 $F(x),\ G(x)$ 满足 $F(G(x)) = G(F(x)) = x$, 并记 $[x^n]F(x)$ 表示 $F(x)$ 的第 $n$ 次项系数, 那么</p>
<script type="math/tex; mode=display">[x^n] G(x) = \frac{1}{n} [x^{n-1}] \left(\frac{x}{F(x)}\right)^n</script><p>还有一个拓展形式. 设 $H(x)$ 是另一个多项式, 那么</p>
<script type="math/tex; mode=display">[x^n] H\left(G(x)\right) = \frac{1}{n} [x^{n-1}] H'(x) \left(\frac{x}{F(x)}\right)^n</script></li>
</ol>
<h2 id="连通-不连通"><a href="#连通-不连通" class="headerlink" title="连通 / 不连通?"></a>连通 / 不连通?</h2><p>对于有标号元素 $A$ 组成的集合 $B$, 不妨设 $A$ 的 EGF 为 $A(x)$. 考虑到集合内的元素没有顺序关系, 可以得到 $B$ 的 EGF 为</p>
<script type="math/tex; mode=display">B(x) = \sum_{k = 0} ^ \infty \frac{A(x) ^ k}{k!} = \exp A(x)</script><p>应用在图计数中, 可以将非连通图看作多个连通图构成的集合.</p>
<p>也就是在确定连通图个数的 EGF 后, 可以通过多项式 $\exp$ 得出非连通图个数的 EGF.</p>
<h2 id="有标号无向图计数"><a href="#有标号无向图计数" class="headerlink" title="有标号无向图计数"></a>有标号无向图计数</h2><h3 id="树"><a href="#树" class="headerlink" title="树"></a>树</h3><p>考虑到 Prufer 序列将一个带标号且有 $n$ 个节点的树用 $[1,\ n]$ 中 $n-2$ 个整数表示, 且 Prufer 序列同树一一对应. 那么, 直接统计 Prufer 序列的个数即可.</p>
<p>记树的 EGF 为 $T(x)$, 那么</p>
<script type="math/tex; mode=display">T(x) = \sum_{k = 2} ^ \infty \frac{k ^ {k - 2}}{k!} x^k</script><p>此时得到是无根树的结果, 而对于有根树, 枚举根的位置计算即可, 也就是无根树的个数乘以点数.</p>
<h3 id="无向图"><a href="#无向图" class="headerlink" title="无向图"></a>无向图</h3><p>对于含有 $n$ 个点的无向图, 先考虑不连通的情况, 直接利用 $\binom{n}{2}$ 条边的存在情况计算即可.</p>
<p>记无向图的 EGF 为 $G(x)$, 那么</p>
<script type="math/tex; mode=display">G(x) = \sum_{k = 0} ^ \infty \frac{2 ^ \binom{n}{2}}{k!} x ^ k</script><p>根据之前的讨论, 无向连通图的 EGF 即为 $\exp G(x)$.</p>
<h4 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h4><ul>
<li><a href="https://www.luogu.com.cn/problem/P4841">Luogu P4841 城市规划</a></li>
</ul>
<h3 id="基环树"><a href="#基环树" class="headerlink" title="基环树"></a>基环树</h3><p>基环树即为包含 $n$ 个节点, $n$ 条边的简单图. 在形态上仅有一个简单环, 且环上每一个节点都是一棵有根树的根节点.</p>
<p>回忆有标号环的计数, 以及圆排列公式. 对于组合对象 $A$, 由 $A$ 构成的环 $B$ 的 EGF 为</p>
<script type="math/tex; mode=display">B(x) = \sum_{k = 1} ^ \infty \frac{(k - 1)!}{k!} A(x) ^ k = \sum_{k = 1} ^ \infty \frac{1}{k} A(x) ^ k = - \ln \left(1 - A(x)\right)</script><p>注意到基环树上一定存在一个长度 $\ge 3$ 的环, 记有根树的 EGF 为 $T(x)$, 基环树的 EGF 为 $C(x)$, 那么</p>
<script type="math/tex; mode=display">T(x) = \sum_{k = 1} ^ \infty \frac{k ^ {k - 1}}{k!} x^k</script><p>考虑到基环树中的环没有方向, 可以翻转, 直接套用上面的公式会算重.</p>
<script type="math/tex; mode=display">C(x) = \frac{1}{2} \sum_{k = 3} ^ \infty \frac{T(x) ^ k}{k}</script><p>化简之后可得</p>
<script type="math/tex; mode=display">C(x) = \frac{1}{2} \ln \big(1 - T(x)\big) - \frac{1}{2} T(x) - \frac{1}{4} T(x) ^ 2</script><p>利用多项式 $\ln$ 和多项式乘法即可在 $O(n\log n)$ 的时间复杂度内计算.</p>
<h3 id="仙人掌"><a href="#仙人掌" class="headerlink" title="仙人掌"></a>仙人掌</h3><p>如果一个无向连通图任意一条边最多属于一个简单环, 那么称这个无向连通图为仙人掌.</p>
<p>先钦定仙人掌上某一点为根, 设 “有根仙人掌” 个数的 EGF 为 $C(x)$, 最后在结果的系数上除 $n$ 即可.</p>
<p>从 “任意一条边最多属于一个简单环” 这一条件入手. 考虑根节点连出的边, 可以分为简单环上和不属于任何简单环的独立边两种.</p>
<p>对于环上的边, 设环中点数为 $k + 1$, 考虑环上每一个节点都可以作为有根仙人掌的根, 那么环的生成函数为 $\frac{1}{2} C(x) ^ k$. 对于独立边, 另一端点为有根仙人掌的根, 其生成函数为 $C(x)$.</p>
<p>而根节点连出的边可看作上述两种情况构成的集合, 同时考虑根节点的影响, 可以得出</p>
<script type="math/tex; mode=display">C(x) = x \exp\left( C(x) + \frac{1}{2} \sum_{k = 2} ^ \infty C(x) ^ k\right) = x \exp \frac{2C(x) - C(x) ^ 2}{2 - 2 C(x)}</script><p><em>此处也可以从圆方树的角度考虑, 可以得到同样的结果. 详见: <a href="https://blog.csdn.net/qq_39972971/article/details/89214832">https://blog.csdn.net/qq_39972971/article/details/89214832</a></em></p>
<p>然后套牛顿迭代的式子, 记 $C_0(x)$ 为模 $x ^ {\lceil \frac{n}{2} \rceil}$ 意义下的结果, $C(x)$ 为模 $x ^ n$ 意义下的结果, 同时记录 $T(x)$ 来便于表述, 有</p>
<script type="math/tex; mode=display">T(x) = x \exp \frac{ 2C_0(x) - C_0 (x) ^ 2 }{ 2 - 2 C_0(x) ^ 2 }</script><script type="math/tex; mode=display">C(x) = C_0(x) - \frac{ 2T(x) - 2 C_0 }{ \Big( 1 + 1\ /\ \big(C_0(x) ^ 2 - 2C_0(x) + 1\big) \Big) T(x) - 2 }</script><p><em>详细的过程可以在 <a href="https://memset0.cn/loj6569">memset0 的博客</a> 内找到.</em></p>
<p>至此我们得出了在 $O(n\log n)$ 的时间复杂度内计算 $n$ 项的做法. 实现时可以合并一部分式子来避免重复计算, 以及便于实现.</p>
<h4 id="例题-1"><a href="#例题-1" class="headerlink" title="例题"></a>例题</h4><ul>
<li><a href="https://loj.ac/problem/6569">LOJ #6569 仙人掌计数</a></li>
<li><a href="https://www.luogu.com.cn/problem/P5434">Luogu P5434 有标号荒漠计数</a></li>
</ul>
<h3 id="二分图"><a href="#二分图" class="headerlink" title="二分图"></a>二分图</h3><p>二分图为节点可分作两个集合, 且保证集合内部不存在边的图.</p>
<p>先考虑将二分图的两个部分黑白染色, 枚举黑色节点的个数 $k$, 容易得到黑白染色的二分图个数 $f_n$ 为</p>
<script type="math/tex; mode=display">f_n = \sum_{k = 0} ^ n \binom{n}{k} 2 ^ {k (n - k)}</script><p>我们有 $k (n - k) = \binom{n}{2} - \binom{k}{2} - \binom{n - k}{2}$, 所以原式可化作</p>
<script type="math/tex; mode=display">f_n = \sum_{k = 0} ^ n \frac{n!}{k! (n - k)!} 2 ^ \binom{n}{2} 2 ^ {-\binom{k}{2}} 2 ^ {-\binom{n - k}{2}}</script><script type="math/tex; mode=display">\frac{f_n}{n!\ 2 ^ {\binom{n}{2}}} = \sum_{k = 0} ^ n \frac{1}{(n - k)!\ 2 ^ \binom{n - k}{2}} \cdot \frac{1}{k!\ 2 ^ \binom{k}{2}}</script><p>显然是卷积的形式, 利用 FFT 即可在 $O(n \log n)$ 的时间内计算.</p>
<p>接下来考虑去掉染色怎么做.</p>
<p>设黑白染色后的二分图 EGF 为 $F(x)$, 不染色二分图 EGF 为 $B(x)$, 连通的不染色二分图为 $C(x)$. 那么有</p>
<script type="math/tex; mode=display">F(x) = \sum_{k = 0} ^ \infty \frac{2 ^ k C(x) ^ k}{k!} = \exp \big(2C(x)\big)</script><script type="math/tex; mode=display">B(x) = \sum_{k = 0} ^ \infty \frac{C(x) ^ k}{k!} = \exp \big( C(x) \big)</script><p>容易发现 $B(x) = \sqrt {F(x)}$, 利用多项式开方即可在 $O(n \log n)$ 的时间内计算.</p>
<h4 id="例题-2"><a href="#例题-2" class="headerlink" title="例题"></a>例题</h4><ul>
<li><a href="https://zyzoj.com/problem/1191">ZYZOJ #1191 有标号二分图计数</a></li>
<li><a href="http://cogs.pro:8081/cogs/problem/problem.php?pid=vzQSJVjPj">COGS 2393 [HZOI 2015] 有标号的二分图计数 II</a></li>
<li><a href="http://cogs.pro:8081/cogs/problem/problem.php?pid=vNymQVjPg">COGS 2395 [HZOI 2015] 有标号的二分图计数 III</a></li>
</ul>
<h3 id="边双连通图"><a href="#边双连通图" class="headerlink" title="边双连通图"></a>边双连通图</h3><p>边双连通图为任意删去一条边, 使得原图不连通的无向图.</p>
<p>按照以往的思路, 先统计有根的情况. 设 $b_n$ 为有 $n$ 个节点的有根边双连通图个数, $f_n$ 为有 $n$ 个节点的有根连通图个数. 设根所在的边双连通分量大小为 $k$, 那么该边双连通分量中每个点…</p>
<h4 id="例题-3"><a href="#例题-3" class="headerlink" title="例题"></a>例题</h4><ul>
<li><a href="https://www.luogu.com.cn/problem/P5828">Luogu P5828 边双连通图计数</a></li>
</ul>
<h3 id="点双连通图"><a href="#点双连通图" class="headerlink" title="点双连通图"></a>点双连通图</h3><p>点双连通图为任意删去一个点, 使得原图不连通的无向图.</p>
<p>咕咕咕.</p>
<h4 id="例题-4"><a href="#例题-4" class="headerlink" title="例题"></a>例题</h4><ul>
<li><a href="https://www.luogu.com.cn/problem/P5827">Luogu P5827 点双连通图计数</a></li>
</ul>
<h2 id="有标号有向图计数"><a href="#有标号有向图计数" class="headerlink" title="有标号有向图计数"></a>有标号有向图计数</h2><h3 id="有向无环图"><a href="#有向无环图" class="headerlink" title="有向无环图"></a>有向无环图</h3><p>考虑容斥.</p>
<p>设 $d_n$ 表示有 $n$ 个节点的 DAG 个数, 且不要求弱连通. 记 $A_{n, i}$ 表示有 $n$ 个节点, 其中有 $i$ 个节点入度为 $0$. 有</p>
<script type="math/tex; mode=display">d_n = \mid \bigcap_{i = 0} ^ n A_{n, i} \mid</script><p>根据容斥原理展开, 得</p>
<script type="math/tex; mode=display">d_n = \sum_{k = 1} ^ n (-1) ^ {k - 1} \sum_{1 \le i_1, \cdots, i_k \le n} ^ {} \mid \bigcup_{j = 1} ^ k A_{n, i_j} \mid</script><p>注意到后者的并集大小和 $i_j$ 具体取值无关, 也就是在 $n$ 个点中取出 $k$ 个点, 而将这 $k$ 个点删去后剩余 $n - k$ 个点仍然组成 DAG, 且这 $k$ 个点同其余点连边不破坏两边的性质. 因此可得出</p>
<script type="math/tex; mode=display">d_n = \sum_{k = 1} ^ n (-1) ^ {k - 1} \binom{n}{k} d_{n - k} 2 ^ {k (n - k)}</script><p>我们有 $k (n - k) = \binom{n}{2} - \binom{k}{2} - \binom{n - k}{2}$, 所以原式可化作</p>
<script type="math/tex; mode=display">d_n = \sum_{k = 1} ^ n (-1) ^ {k - 1} \frac{n!}{k! (n - k)!} d_{n - k} 2 ^ \binom{n}{2} 2 ^ {-\binom{k}{2}} 2 ^ {-\binom{n - k}{2}}</script><script type="math/tex; mode=display">\frac{d_n}{n!\ 2 ^ {\binom{n}{2}}} = \sum_{k = 1} ^ n \frac{d_{n - k}}{(n - k)!\ 2 ^ {\binom{n - k}{2}}} \cdot \frac{(-1) ^ {k - 1}}{k!\ 2 ^ \binom{k}{2}}</script><p>设 $d_n$ 的组合生成函数为 $D(x)$, 同时设</p>
<script type="math/tex; mode=display">F(x) = \sum\limits_{k = 1} ^ \infty \frac{(-1) ^ {k - 1}}{k!\ 2 ^ \binom{k}{2}}</script><p>那么有</p>
<script type="math/tex; mode=display">D(x) = D(x)  F(x) + 1 \\\ D(x) = \frac{1}{1 - F(x)}</script><p>一次求乘法逆即可. 时间复杂度 $O(n\log n)$.</p>
<p>简洁的形式背后一定有我不能理解的高妙组合意义…</p>
<h4 id="例题-5"><a href="#例题-5" class="headerlink" title="例题"></a>例题</h4><ul>
<li><a href="https://www.luogu.com.cn/problem/P6295">Luogu P6295 有标号 DAG 计数</a></li>
</ul>
<h3 id="强连通图"><a href="#强连通图" class="headerlink" title="强连通图"></a>强连通图</h3><p>强连通图即为任意两点连通的有向图.</p>
<p>设 $n$ 个点有标号强连通图个数为 $d_n$. 考虑强连通图和 DAG 的关系: 强连通图缩点后为一个 DAG. 但是缩点后 DAG 上每个节点所包含的缩点前的点数并不一定为 $1$, 从而无法利用原来的方法计算.</p>
<p>此处有一个思路为, 对 DAG 的式子中容斥系数改写, 也就是将系数和方案数 “放在一起” 计算.</p>
<p>记一个集合 $|S|$ 的权值为 $(-1) ^ {|S|}$, 设 $e_n$ 为任一元素都为强连通图, 且所有强连通图点数和为 $n$ 的集合的权值和. 那么有</p>
<script type="math/tex; mode=display">e_n = - \sum_{k = 1} ^ n \binom{n}{k} e_{n - k} 2 ^ {k (k-1)} \cdot 2 ^ {k (n-k)}</script><p>其组合意义和 DAG 计数类似, 不再赘述.</p>
<p>此时可以根据 $e_n$ 计算 $d_n$. 考虑到在一强连通图中删去节点 $1$ 及节点 $1$ 所在连通块, 仍可得到一个由强连通图组成的集合. 同时, 在所有强连通图集合中减去不包含节点 $1$ 的情况即为最终答案. 即</p>
<script type="math/tex; mode=display">d_n = -e_n - \sum_{k = 1} ^ {n - 1} \binom{n - 1}{k - 1}\ d_k \cdot e_{n - k}</script><p>具体实现时可能需要一些技巧, 例如计算 $d_n$ 时可将 $k$ 枚举的上限改为 $n$ 同时做一些处理, 并不会影响答案且便于计算等.</p>
<p>利用多项式求逆, 则时间复杂度为 $O(n \log n)$.</p>
<h4 id="例题-6"><a href="#例题-6" class="headerlink" title="例题"></a>例题</h4><ul>
<li><a href="https://zyzoj.com/problem/1164">ZYZOJ #1164 有标号强连通图计数</a></li>
<li><a href="http://cogs.pro:8081/cogs/problem/problem.php?pid=vQmxzVjPW">COGS 2397 [HZOI 2015]有标号的强连通图计数 II</a></li>
</ul>
<h2 id="有标号-无标号"><a href="#有标号-无标号" class="headerlink" title="有标号 / 无标号?"></a>有标号 / 无标号?</h2><p>首先定义形式幂级数的 Euler 变换. 即</p>
<script type="math/tex; mode=display">\mathcal E\big(F(x)\big) = \prod_{k = 0} ^ \infty (1 + x ^ k + x ^ {2k} + \cdots) ^ {f_k} = \prod_{k = 0} ^ \infty (\frac{1}{1 - x ^ k}) ^ {f_k}</script><p>类比于 exp, Euler 变换的组合意义即为选取若干无标号元素组成集合的方案数. 注意无标号元素的影响, 某些在有标号情况下不同的方案在无标号情况下相同.</p>
<p>利用一些运算的技巧, 可以得到</p>
<script type="math/tex; mode=display">\mathcal E\big(F(x)\big) = \exp \left( \sum_{i = 0} ^ \infty f_i \sum_{j = 0} ^ \infty \frac{1}{j} x ^ {ij} \right) = \exp \left( \sum_{k = 0} ^ \infty \frac{1}{k} F(x ^ k) \right)</script><p>这个结果也可以通过 Polya 定理得到.</p>
<h2 id="无标号图计数"><a href="#无标号图计数" class="headerlink" title="无标号图计数"></a>无标号图计数</h2><h3 id="有根树"><a href="#有根树" class="headerlink" title="有根树"></a>有根树</h3><p>借助 Euler 变换, 有根树可看作根节点接上若干子树. 设无标号有根树 OGF 为 $F(x)$, 那么有</p>
<script type="math/tex; mode=display">F(x) = x \cdot \mathcal E \big(F(x)\big) = x \cdot \prod_{k = 0} ^ \infty (\frac{1}{1 - x ^ k}) ^ {f_k}</script><p>两边同时取 $\ln$, 得</p>
<script type="math/tex; mode=display">\ln F(x) = \ln x - \sum_{k = 0} ^ \infty f_k \ln (1 - x ^ k)</script><p>求导, 得</p>
<script type="math/tex; mode=display">\frac{F(x)'}{F(x)} = \frac{1}{x} + \sum_{k = 1} ^ \infty f_k \cdot \frac{k x ^ {k - 1}}{1 - x ^ k}</script><p>两侧同时乘 $F(x) \cdot x$, 得</p>
<script type="math/tex; mode=display">x \cdot F(x)' = F(x) + F(x) \left( \sum_{k = 1} ^ \infty k f_k \cdot \frac{x ^ k}{1 - x ^ k}\right)</script><p>取第 $n$ 项系数, 同时设 $g_n = \sum_{k \mid n} k f_k$. 则有</p>
<script type="math/tex; mode=display">n \cdot f_n = f_n + \sum_{k = 1} ^ n f_k g_{n - k}</script><script type="math/tex; mode=display">f_n = \frac{1}{n - 1} \sum_{k = 1} ^ n f_k g_{n - k}</script><p>分治 FFT 计算即可, 时间复杂度为 $O(n \log ^ 2 n)$.</p>
<p>实现时, 在计算 $f_n$ 后枚举 $n$ 的倍数更新 $g$. 注意到如果分治的左端点为 $1$, $g$ 位数不够. 在计算左区间对右区间的贡献时, 需要额外注意.</p>
<div><div class="fold_hider"><div class="close hider_title">> 点击显示 / 隐藏 </div></div><div class="fold">
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123; <span class="comment">// [L, R)</span></span><br><span class="line">  <span class="keyword">if</span> (R-L &lt; <span class="number">2</span>) &#123;</span><br><span class="line">    f[L] = (L == <span class="number">1</span>)? <span class="number">1</span>: <span class="number">1LL</span> * f[L] * inv[L - <span class="number">1</span>] % P;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> v = <span class="number">1LL</span> * L * f[L] % P, i = L; i &lt;= n; i += L)</span><br><span class="line">      g[i] = (g[i] + v) % P;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> Mid = (L + R) / <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">solve</span>(L, Mid);</span><br><span class="line">  <span class="keyword">if</span> (L == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="built_in">Mul</span>(f, Mid, g + L, Mid - L, h);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = Mid; i &lt; R; ++i) f[i] = (f[i] + h[i - L]) % P;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">Mul</span>(f + L, Mid - L, g, R - L, h);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = Mid; i &lt; R; ++i) f[i] = (f[i] + h[i - L]) % P;</span><br><span class="line">    <span class="built_in">Mul</span>(f, R - L, g + L, Mid - L, h);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = Mid; i &lt; R; ++i) f[i] = (f[i] + h[i - L]) % P;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">solve</span>(Mid, R);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<p>另外存在时间复杂度为 $O(n \log n)$ 的牛顿迭代实现. 在常数和推导过程上都没有什么优势…</p>
<h3 id="无根树"><a href="#无根树" class="headerlink" title="无根树"></a>无根树</h3><p>一个经典的套路是只讨论根为重心的情况, 那么用有根树个数 $f_n$ 减去根不是重心的个数即为无根树个数. 此时根据 $n$ 的奇偶性不同存在 $1$ 或 $2$ 个重心, 讨论的情况相对较少.</p>
<p>对于 $n$ 为奇数的情况, 重心唯一. 考虑根节点和任意一条和儿子相连的边, 如果根节点不是重心, 那么该儿子的子树大小 $&gt; \lfloor \frac{n}{2} \rfloor$. 可以得出无根树个数为</p>
<script type="math/tex; mode=display">f_n - \sum_{k = \lfloor \frac{n}{2} \rfloor + 1} ^ {n - 1} f_k \cdot f_{n - k}</script><p>对于 $n$ 为偶数的情况, 重心不唯一. 如果按照奇数的方法计算, 则另外要注意到根和该儿子都为重心的情况. 此时如果断开这条边, 得到的两棵树不同, 则会在之前的过程中重复统计. 也就是说, 需要在奇数的基础上额外减去</p>
<script type="math/tex; mode=display">\binom{f_{n / 2}}{2}</script><p>利用有根树的计算方法即可.</p>
<h4 id="例题-7"><a href="#例题-7" class="headerlink" title="例题"></a>例题</h4><ul>
<li><a href="https://www.luogu.com.cn/problem/P5900">Luogu P5900 无标号无根树计数</a></li>
</ul>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>似乎这些问题本质上都能归类于 <a href="https://oeis.org/transforms2.html">https://oeis.org/transforms2.html</a>?</p>
<p>另外还有其他更为复杂的图计数问题, 以及 “二元生成函数” 之类的科技… 等我学明白了再说吧 (</p>
<h2 id="习题"><a href="#习题" class="headerlink" title="习题"></a>习题</h2><p>部分整理自 JOHNKRAM 的课件, 也有一些自己的发现.</p>
<ol>
<li><a href="http://codeforces.com/problemset/problem/438/E">CF438E The Child and Binary Tree</a></li>
<li><a href="http://lydsy.com/JudgeOnline/problem.php?id=3684">BZOJ 3684 大朋友和多叉树</a></li>
<li><a href="https://www.luogu.com.cn/problem/P4233">Luogu P4233 射命丸文的笔记</a></li>
<li><a href="http://acm.hdu.edu.cn/showproblem.php?pid=5279">HDU 5279 YJC plays Minecraft</a></li>
<li><a href="https://www.luogu.com.cn/problem/P5448">Luogu P5448 [THUPC2018] 好图计数</a></li>
<li><a href="https://loj.ac/problem/6570">LOJ #6570 毛毛虫计数</a></li>
<li><a href="https://loj.ac/problem/6684">LOJ #6684 有根无标号「奇树」计数</a></li>
<li><a href="https://loj.ac/problem/6538">LOJ #6538 烷基计数 加强版 加强版</a></li>
</ol>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li>汪乐平, &lt;生成函数, 多项式算法与图的计数&gt;. 2019.1.28.</li>
<li>金策, &lt;生成函数的运算与组合计数问题&gt;. 国家集训队 2015 论文集.</li>
<li>AntiLeaf, <a href="https://www.cnblogs.com/hzoier/p/6597833.html">COGS 有标号的二分图计数系列</a>.</li>
<li>Weng_Weijie, <a href="https://www.luogu.com.cn/blog/wengweijie/solution-p5900">题解 P5900【无标号无根树计数】</a></li>
</ul>
<hr>

  </div>
  <footer class="article-footer">
    
  <div class="cc">
    <a href="http://creativecommons.org/licenses/by-nc/4.0/deed.z" target="_blank" title="署名-非商业性使用">
      <img src="/images/cc/cc.png">
      
          <img src="/images/cc/by.png">
        
          <img src="/images/cc/nc.png">
        
      <span>
        本作品采用知识共享 署名-非商业性使用 4.0 国际许可协议进行许可。
      </span>
    </a>
  </div>


  </footer>
  
</article>





          <div class="main-footer">
  
    © 2019-2022 DepletedPrism&#39;s Blog
    
	- Powered by <a href="http://hexo.io" target="_blank">Hexo</a> - Theme <a href="https://github.com/denjones/hexo-theme-chan" target="_blank">Chan</a>
  
</div>

      
        </div>
      
    </div>
  </div>
  
<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>


  
<link rel="stylesheet" href="/PhotoSwipe/photoswipe.css">

  
<link rel="stylesheet" href="/PhotoSwipe/default-skin/default-skin.css">


  <!-- Root element of PhotoSwipe. Must have class pswp. -->
  <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
             It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

      <!-- Container that holds slides.
                PhotoSwipe keeps only 3 of them in the DOM to save memory.
                Don't modify these 3 pswp__item elements, data is added later on. -->
      <div class="pswp__container">
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
      </div>

      <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
      <div class="pswp__ui pswp__ui--hidden">

        <div class="pswp__top-bar">

          <!--  Controls are self-explanatory. Order can be changed. -->

          <div class="pswp__counter"></div>

          <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

          <button class="pswp__button pswp__button--share" title="Share"></button>

          <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

          <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

          <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
          <!-- element will get class pswp__preloader--active when preloader is running -->
          <div class="pswp__preloader">
            <div class="pswp__preloader__icn">
              <div class="pswp__preloader__cut">
                <div class="pswp__preloader__donut"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
          <div class="pswp__share-tooltip"></div>
        </div>

        <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>

        <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>

        <div class="pswp__caption">
          <div class="pswp__caption__center"></div>
        </div>
      </div>
    </div>
  </div>

  
<script src="/PhotoSwipe/photoswipe.js"></script>

  
<script src="/PhotoSwipe/photoswipe-ui-default.js"></script>




<script src="/perfect-scrollbar/js/min/perfect-scrollbar.min.js"></script>


<script src="/scripts/main.js"></script>


<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<!--script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

</body>
</html>
